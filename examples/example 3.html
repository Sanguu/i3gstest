<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Interactive 3DGS</title>
    <style type="text/css">
        html, body {
            margin: 0;
            height: 100%;
            background-image: linear-gradient(white, lightgrey);
            overflow: hidden; 
        }

        #title{
           position:absolute;
           width:100%;
           margin: auto;
           margin-top:20px;
           margin-left:20px;
           font-family:'Palatino';
           color:"darkgrey";
           font-size:1em;
 
           text-align : left;
           user-select: none;
          }

          #title2{
             position:absolute;
             width:100%;
             margin: auto;
             margin-top:26px;
             margin-left:280px;
             font-family:'Palatino';
             color:"darkgrey";
             font-size:.5em;
 
             text-align : left;
             user-select: none;
            }

          #subtitle{
             position:absolute;
             width:100%;
             margin: auto;
             margin-top:38px;
             margin-left:20px;
             font-family:'Palatino';
             color:"darkgrey";
             font-size:.7em;
 
             text-align : left;
             user-select: none;
            }

            #subtitle2{
               position:absolute;
               width:100%;
               margin: auto;
               margin-top:38px;
               margin-left:1000px;
               font-family:'Palatino';
               color:"darkgrey";
               font-size:.7em;
 
               text-align : left;
               user-select: none;
              }

              #Form{
                position:absolute;
               top:75%;
               margin-left:25%;
               font-family:'Palatino';
               color:"darkgrey";
               font-size:.9em;
               font-weight: bold;
              }
             
            #Force{
                position:absolute;
               top:75%;
               margin-left:75%;
               font-family:'Palatino';
               color:"darkgrey";
               font-size:.9em;
               font-weight: bold;
              }
            #p1z{
                position:absolute;
               top:80%;
               margin-left:10%;
               font-family:'Palatino';
               color:"darkgrey";
               font-size:.7em;
              }
              
            #p2z{
                position:absolute;
               top:82%;
               margin-left:10%;
               font-family:'Palatino';
               color:"darkgrey";
               font-size:.7em;
              }
            
            #p3z{
                position:absolute;
               top:84%;
               margin-left:10%;
               font-family:'Palatino';
               color:"darkgrey";
               font-size:.7em;
              }

              #p4z{
                position:absolute;
               top:86%;
               margin-left:10%;
               font-family:'Palatino';
               color:"darkgrey";
               font-size:.7em;
              }


            #gdof1{
                position:absolute;
               top:80%;
               margin-left:20%;
               font-family:'Palatino';
               color:"darkgrey";
               font-size:.7em;
              }
            #gdof2{
                position:absolute;
               top:82%;
               margin-left:20%;
               font-family:'Palatino';
               color:"darkgrey";
               font-size:.7em;
              }

            #gdof3{
                position:absolute;
               top:84%;
               margin-left:20%;
               font-family:'Palatino';
               color:"darkgrey";
               font-size:.7em;
              }

              #gdof4{
                position:absolute;
               top:86%;
               margin-left:20%;
               font-family:'Palatino';
               color:"darkgrey";
               font-size:.7em;
              }

              
              #gdof5{
                position:absolute;
               top:88%;
               margin-left:20%;
               font-family:'Palatino';
               color:"darkgrey";
               font-size:.7em;
              }

              #gdof6{
                position:absolute;
               top:90%;
               margin-left:20%;
               font-family:'Palatino';
               color:"darkgrey";
               font-size:.7em;
              }


           




            #p1l{
                position:absolute;
               top:80%;
               margin-left:31%;
               font-family:'Palatino';
               color:"darkgrey";
               font-size:.7em;
              }
            
            #p2l{
                position:absolute;
               top:82%;
               margin-left:31%;
               font-family:'Palatino';
               color:"darkgrey";
               font-size:.7em;
              }
            
            #p3l{
                position:absolute;
               top:84%;
               margin-left:31%;
               font-family:'Palatino';
               color:"darkgrey";
               font-size:.7em;
              }

            #p4l{
               position:absolute;

               top:50%;
               margin-top:337px;
               margin-left:560px;
               font-family:'Palatino';
               color:"darkgrey";
               font-size:.7em;
              }

            #trpx{
                position:absolute;
               top:80%;
               margin-left:60%;
               font-family:'Palatino';
               color:"darkgrey";
               font-size:.7em;
               position:absolute;
              }
            #trpy{
                position:absolute;
               top:82%;
               margin-left:60%;
               font-family:'Palatino';
               color:"darkgrey";
               font-size:.7em;
               position:absolute;
              }
            #trpz{
                position:absolute;
               top:84%;
               margin-left:60%;
               font-family:'Palatino';
               color:"darkgrey";
               font-size:.7em;
               position:absolute;
              }

            #fpbx{
                position:absolute;
               top:80%;
               margin-left:70%;
               font-family:'Palatino';
               color:"darkgrey";
               font-size:.7em;
               position:absolute;
              }
              #fpby{
                position:absolute;
               top:82%;
               margin-left:70%;
               font-family:'Palatino';
               color:"darkgrey";
               font-size:.7em;
               position:absolute;
              }

              #fpcx{
                position:absolute;
               top:84%;
               margin-left:70%;
               font-family:'Palatino';
               color:"darkgrey";
               font-size:.7em;
               position:absolute;
              }
              #fpcy{
                position:absolute;
               top:86%;
               margin-left:70%;
               font-family:'Palatino';
               color:"darkgrey";
               font-size:.7em;
               position:absolute;
              }

              #fpdx{
                position:absolute;
               top:80%;
               margin-left:79.5%;
               font-family:'Palatino';
               color:"darkgrey";
               font-size:.7em;
               position:absolute;
              }

              #fpdx2{
                position:absolute;
               top:82%;
               margin-left:79.5%;
               font-family:'Palatino';
               color:"darkgrey";
               font-size:.7em;
               position:absolute;
              }
              #fpdx3{
                position:absolute;
               top:84%;
               margin-left:79.5%;
               font-family:'Palatino';
               color:"darkgrey";
               font-size:.7em;
               position:absolute;
              }
              #fpdx4{
                position:absolute;
               top:86%;
               margin-left:79.5%;
               font-family:'Palatino';
               color:"darkgrey";
               font-size:.7em;
               position:absolute;
              }
              #fpdy{
                position:absolute;
               top:88%;
               margin-left:79.5%;
               font-family:'Palatino';
               color:"darkgrey";
               font-size:.7em;
               position:absolute;
              }
/* 
/* 
/* 
            #Steps{
               position:absolute;

               top:50%;
               margin-top:275px;
               margin-left:220px;
               font-family:'Open Sans', sans-serif;
               color:"darkgrey";
               font-size:.8em;
               text-transform: uppercase;
              }

              #Vertice2X{
                 position:absolute;

                 top:50%;
                 margin-top:300px;
                 margin-left:220px;
                 font-family:'Open Sans', sans-serif;
                 color:"lightgrey";
                 font-size:.5em;
                 text-transform: uppercase;
                 user-select: none;
                }

                #Vertice2Y{
                   position:absolute;

                   top:50%;
                   margin-top:300px;
                   margin-left:280px;
                   font-family:'Open Sans', sans-serif;
                   color:"lightgrey";
                   font-size:.5em;
                   text-transform: uppercase;
                   user-select: none;
                  }

                  #Vertice2Z{
                     position:absolute;

                     top:50%;
                     margin-top:340px;
                     margin-left:220px;
                     font-family:'Open Sans', sans-serif;
                     color:"lightgrey";
                     font-size:.5em;
                     text-transform: uppercase;
                     user-select: none;
                    }

            #Minkowski{
                       position:absolute;

                       top:50%;
                       margin-top:275px;
                       margin-left:360px;
                       font-family:'Open Sans', sans-serif;
                       color:"darkgrey";
                       font-size:.8em;
                       text-transform: uppercase;
                      }

                      #scale{
                         position:absolute;

                         top:50%;
                         margin-top:300px;
                         margin-left:360px;
                         font-family:'Open Sans', sans-serif;
                         color:"lightgrey";
                         font-size:.5em;
                         text-transform: uppercase;
                         user-select: none;
                        }

            #Form{
                           position:absolute;

                           top:50%;
                           margin-top:275px;
                           margin-left:590px;
                           font-family:'Open Sans', sans-serif;
                           color:"darkgrey";
                           font-size:.8em;
                           text-transform: uppercase;
                      }

                      #faces{
                         position:absolute;

                         top:50%;
                         margin-top:300px;
                         margin-left:590px;
                         font-family:'Open Sans', sans-serif;
                         color:"lightgrey";
                         font-size:.5em;
                         text-transform: uppercase;
                         user-select: none;
                        }

                        #cells{
                           position:absolute;

                           top:50%;
                           margin-top:320px;
                           margin-left:590px;
                           font-family:'Open Sans', sans-serif;
                           color:"lightgrey";
                           font-size:.5em;
                           text-transform: uppercase;
                           user-select: none;
                          }

              #Force{
                     position:absolute;

                     top:50%;
                     margin-top:275px;
                     margin-left:720px;
                     font-family:'Open Sans', sans-serif;
                     color:"darkgrey";
                     font-size:.8em;
                     text-transform: uppercase;
                  }
                  #forcefaces{
                     position:absolute;

                     top:50%;
                     margin-top:300px;
                     margin-left:720px;
                     font-family:'Open Sans', sans-serif;
                     color:"lightgrey";
                     font-size:.5em;
                     text-transform: uppercase;
                     user-select: none;
                    }
                    #forcearrows{
                       position:absolute;

                       top:50%;
                       margin-top:320px;
                       margin-left:720px;
                       font-family:'Open Sans', sans-serif;
                       color:"lightgrey";
                       font-size:.5em;
                       text-transform: uppercase;
                       user-select: none;
                      }

                      #forceedges{
                         position:absolute;

                         top:50%;
                         margin-top:340px;
                         margin-left:720px;
                         font-family:'Open Sans', sans-serif;
                         color:"lightgrey";
                         font-size:.5em;
                         text-transform: uppercase;
                         user-select: none;
                        }
          #Topology{
                       position:absolute;

                       top:50%;
                       margin-top:275px;
                       margin-left:845px;
                       font-family:'Open Sans', sans-serif;
                       color:"darkgrey";
                       font-size:.8em;
                       text-transform: uppercase;
                }
                #Topologya{
                   position:absolute;

                   top:50%;
                   margin-top:300px;
                   margin-left:845px;
                   font-family:'Open Sans', sans-serif;
                   color:"lightgrey";
                   font-size:.5em;
                   text-transform: uppercase;
                   user-select: none;
                  }

                  #Topologyab{
                     position:absolute;

                     top:50%;
                     margin-top:300px;
                     margin-left:900px;
                     font-family:'Open Sans', sans-serif;
                     color:"lightgrey";
                     font-size:.5em;
                     text-transform: uppercase;
                     user-select: none;
                    }

                    #Topologyad{
                       position:absolute;

                       top:50%;
                       margin-top:300px;
                       margin-left:960px;
                       font-family:'Open Sans', sans-serif;
                       color:"lightgrey";
                       font-size:.5em;
                       text-transform: uppercase;
                       user-select: none;
                      }



                  #Topologyb{
                     position:absolute;

                     top:50%;
                     margin-top:320px;
                     margin-left:845px;
                     font-family:'Open Sans', sans-serif;
                     color:"lightgrey";
                     font-size:.5em;
                     text-transform: uppercase;
                     user-select: none;
                    }

                    #Topologybc{
                       position:absolute;

                       top:50%;
                       margin-top:320px;
                       margin-left:900px;
                       font-family:'Open Sans', sans-serif;
                       color:"lightgrey";
                       font-size:.5em;
                       text-transform: uppercase;
                       user-select: none;
                      }

                      #Topologybd{
                         position:absolute;

                         top:50%;
                         margin-top:320px;
                         margin-left:960px;
                         font-family:'Open Sans', sans-serif;
                         color:"lightgrey";
                         font-size:.5em;
                         text-transform: uppercase;
                         user-select: none;
                        }

                    #Topologyc{
                       position:absolute;

                       top:50%;
                       margin-top:340px;
                       margin-left:845px;
                       font-family:'Open Sans', sans-serif;
                       color:"lightgrey";
                       font-size:.5em;
                       text-transform: uppercase;
                       user-select: none;
                      }

                      #Topologyac{
                         position:absolute;

                         top:50%;
                         margin-top:340px;
                         margin-left:900px;
                         font-family:'Open Sans', sans-serif;
                         color:"lightgrey";
                         font-size:.5em;
                         text-transform: uppercase;
                         user-select: none;
                        }

                        #Topologycd{
                           position:absolute;

                           top:50%;
                           margin-top:340px;
                           margin-left:960px;
                           font-family:'Open Sans', sans-serif;
                           color:"lightgrey";
                           font-size:.5em;
                           text-transform: uppercase;
                           user-select: none;
                          }

                      #Topologyd{
                         position:absolute;

                         top:50%;
                         margin-top:360px;
                         margin-left:845px;
                         font-family:'Open Sans', sans-serif;
                         color:"lightgrey";
                         font-size:.5em;
                         text-transform: uppercase;
                         user-select: none;
                        } */
        canvas {
            display: block;
        }

    </style>
</head>
<body onload="draw();">

  <!-- <div id="title">3D Graphic Statics Webtool</div>
  <div id="title2">Demo 3.0</div>
  <div id="subtitle">Polyhedral Structures Laboratory</div> -->

  <div id="Form">form</div>
  <div id="Force">force</div>

  <div id="p1z">CP1.z</div>
  <div id="p2z">CP2.z</div>
  <div id="p3z">CP3.z</div>
  <div id="p4z">Size</div>

  <div id="gdof1">GDoF.l1</div>
  <div id="gdof2">GDoF.l2</div>
  <div id="gdof3">GDoF.l3</div>
  <div id="gdof4">GDoF.l4</div>
  <div id="gdof5">GDoF.l5</div>
  <div id="gdof6">GDoF.l6</div>

  <div id="p1l">Trial.z</div>
  <div id="p2l">Trial</div>
  <div id="p3l">Faces</div>
  <!-- <div id="p4l">P4.L</div> -->

  <div id="trpx">O'.x</div>
  <div id="trpy">O'.y</div>
  <div id="trpz">O'.z</div>

  <div id="fpbx">B.x</div>
  <div id="fpby">B.y</div>

  <div id="fpcx">C.x</div>
  <div id="fpcy">C.y</div>

  <div id="fpdx">O.len</div>
  <div id="fpdx2">A.Type1</div>
  <div id="fpdx3">A.Type2</div>
  <div id="fpdx4">Cell</div>
  <div id="fpdy">Cell.S</div>

  <a href="../layouts/Exmaples.html"><img src="../images/logo.png"  style="width: 75px;
    position:absolute;
    top:6%;
    margin-left:10%;
    height: 23px;
    "></a>


  <!-- <div id="Minkowskiscale"></div>
  <div id="Barthickness"></div> -->
  <!-- <div id="Forcelength"></div> -->
  <div id="ForceP_Bx"></div>
  <div id="ForceP_By"></div>
  <div id="ForceP_Cx"></div>
  <div id="ForceP_Cy"></div>
  <!-- <div id="ForceP_Dx"></div>
  <div id="ForceP_Dy"></div> -->
  <div id="FormtrialP3z"></div>
  <!-- <div id="Divlen1"></div>
  <div id="Divlen2"></div>
  <div id="Divlen3"></div>
  <div id="Divlen4"></div> -->
  <div id="cpoint1"></div>
  <div id="cpoint2"></div>
  <div id="cpoint3"></div>
  <!-- <div id="cpoint4"></div> -->
  <div id="fpointox"></div>
  <div id="fpointoy"></div>
  <div id="fpointoz"></div>
  <div id="o1len"></div>
  <div id="o2len"></div>
  <div id="formo2len"></div>
  <div id="formG_AC_len"></div>
  <div id="formG_ACC_len"></div>
  <div id="formG_C1C_len"></div>
  <div id="formG_C1AC_len"></div>
  <div id="formG_C1BC_len"></div>
  <div id="formG_A1B1_len"></div>
  <div id="forceoffset"></div>
  <div id="forceoffset2"></div>

  <div id="check_Trial">
      <input id="Trial" name="chkItem" type="checkbox">
  </div>

  <div id="check_ForceCell">
      <input id="ForceCell" name="chkItem" type="checkbox">
  </div>

  <div id="check_greenfaces">
      <input id="FormGreen" name="chkItem" type="checkbox">
  </div>

  <!-- <div id="checkcells">
      <input id="ch5" name="chkItem" type="checkbox">
  </div>

  <div id="arrows">
      <input id="ch6" name="chkItem" type="checkbox">
  </div>

  <div id="edges">
      <input id="ch7" name="chkItem" type="checkbox">
  </div>

  <div id="ta">
      <input id="ch8" name="chkItem" type="checkbox">
  </div>

  <div id="tb">
      <input id="ch9" name="chkItem" type="checkbox">
  </div>

  <div id="tc">
      <input id="ch10" name="chkItem" type="checkbox">
  </div>

  <div id="td">
      <input id="ch11" name="chkItem" type="checkbox">
  </div>

  <div id="tab">
      <input id="ch12" name="chkItem" type="checkbox">
  </div>

  <div id="tbc">
      <input id="ch13" name="chkItem" type="checkbox">
  </div>

  <div id="tac">
      <input id="ch14" name="chkItem" type="checkbox">
  </div>

  <div id="tad">
      <input id="ch15" name="chkItem" type="checkbox">
  </div>

  <div id="tbd">
      <input id="ch16" name="chkItem" type="checkbox">
  </div>

  <div id="tcd">
      <input id="ch17" name="chkItem" type="checkbox">
  </div> -->

  <!-- <div id="st1">
      <input id="ch18" name="chkItem" type="checkbox">
  </div> -->


<!-- 
  <div id="Steps">Form finding</div>
  <div id="Vertice2X">P</div>



  <div id="Minkowski">MINKOWSKI SUM</div>
  <div id="scale">Scale</div> -->


  <!-- <div id="Form">Form</div>
  <div id="faces">faces</div>
  <div id="cells">cells</div>

  <div id="Force">Force</div>
  <div id="forcefaces">faces</div>
  <div id="forcearrows">arrows</div>
  <div id="forceedges">edges</div>

  <div id="Topology">topology</div>
  <div id="Topologya">a</div>
  <div id="Topologyb">b</div>
  <div id="Topologyc">c</div>
  <div id="Topologyd">d</div>

  <div id="Topologyab">ab</div>
  <div id="Topologybc">bc</div>
  <div id="Topologyac">ac</div>

  <div id="Topologyad">ad</div>
  <div id="Topologybd">bd</div>
  <div id="Topologycd">cd</div> -->

  <!-- <hr style="width: 190px;
  position:absolute;
  top:50%;
  margin-top:290px;
  margin-left:360px;
     height: 1px;
     background-color:#666;">

     <hr style="width: 100px;
     position:absolute;
     top:50%;
     margin-top:290px;
     margin-left:220px;
        height: 1px;
        background-color:#666;">

        <hr style="width: 85px;
        position:absolute;
        top:50%;
        margin-top:290px;
        margin-left:590px;
           height: 1px;
           background-color:#666;">

           <hr style="width: 85px;
           position:absolute;
           top:50%;
           margin-top:290px;
           margin-left:720px;
              height: 1px;
              background-color:#666;">

              <hr style="width: 150px;
              position:absolute;
              top:50%;
              margin-top:290px;
              margin-left:845px;
                 height: 1px;
                 background-color:#666;"> -->






</body>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r124/three.js"></script>
    <script type="text/javascript" src="../libs/three/utils/SceneUtils.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/three@0.101.1/examples/js/controls/TransformControls.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/three@0.101.1/examples/js/controls/OrbitControls.js"></script>
  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/17.2.0/Tween.js"></script>
    <script src="https://threejs.org/examples/js/curves/NURBSCurve.js"></script>
    <script src="https://threejs.org/examples/js/curves/NURBSUtils.js"></script>


    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.css">
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>

    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.7.7/dat.gui.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/stats.js/7/Stats.js"></script>
    

    <style>
    
    #check_Trial{
        position: absolute;
    float: left;
    clear: left;
    top: 81.7%;
    margin-left: 34.5%;

        }

    #check_ForceCell{
        position: absolute;
    float: left;
    clear: left;
    top: 85.7%;
    margin-left: 82.8%;

        }

    #check_greenfaces{
        position: absolute;
    float: left;
    clear: left;
    top: 83.7%;
    margin-left: 34.5%;

        }

        #checkcells{
    position: absolute;

    top: 50%;
    width: 200px;
    height:10px;

    margin-left: 660px;
    margin-top: 315px;

        }

        #arrows{
    position: absolute;

    top: 50%;
    width: 200px;
    height:10px;

    margin-left: 790px;
    margin-top: 315px;

        }

        #edges{
    position: absolute;

    top: 50%;
    width: 200px;
    height:10px;

    margin-left: 790px;
    margin-top: 335px;

        }

        #ta{
    position: absolute;

    top: 50%;
    width: 200px;
    height:10px;

    margin-left: 860px;
    margin-top: 295px;

        }

        #tb{
    position: absolute;

    top: 50%;
    width: 200px;
    height:10px;

    margin-left: 860px;
    margin-top: 315px;

        }
        #tc{
    position: absolute;

    top: 50%;
    width: 200px;
    height:10px;

    margin-left: 860px;
    margin-top: 335px;

        }
        #td{
    position: absolute;

    top: 50%;
    width: 200px;
    height:10px;

    margin-left: 860px;
    margin-top: 355px;

        }

        #tab{
    position: absolute;

    top: 50%;
    width: 200px;
    height:10px;

    margin-left: 920px;
    margin-top: 295px;

        }
        #tbc{
    position: absolute;

    top: 50%;
    width: 200px;
    height:10px;

    margin-left: 920px;
    margin-top: 315px;

        }
        #tac{
    position: absolute;

    top: 50%;
    width: 200px;
    height:10px;

    margin-left: 920px;
    margin-top: 335px;

        }

        #tad{
      position: absolute;

      top: 50%;
      width: 200px;
      height:10px;

      margin-left: 980px;
      margin-top: 295px;

        }

        #tbd{
      position: absolute;

      top: 50%;
      width: 200px;
      height:10px;

      margin-left: 980px;
      margin-top: 315px;

        }

        #tcd{
      position: absolute;

      top: 50%;
      width: 200px;
      height:10px;

      margin-left: 980px;
      margin-top: 335px;

        }

        #st1{
        position: absolute;

        top: 50%;
        width: 200px;
        height:10px;

        margin-left: 255px;
        margin-top: 295px;

        }
        #st2{
        position: absolute;

        top: 50%;
        width: 200px;
        height:10px;

        margin-left: 310px;
        margin-top: 295px;

        }


    #Minkowskiscale{
    position: absolute;
    float: left;
    clear: left;
    top: 50%;

    width: 100px;
    height: 5px;

    margin-left: 450px;
    margin-top: 300px;

    }



    #Minkowskiscale .ui-slider-range { background: #383838; }
    #Minkowskiscale .ui-slider-handle { border-color: #666666;
    border-color: #666666;
    height:10px;
    width:10px;

    border-radius: 10px;
    border-width: 3px; }

    #Barthickness{
    position: absolute;
    float: left;
    clear: left;
    top: 50%;

    width: 75px;
    height: 5px;

    margin-left: 600px;
    margin-top: 340px;

    }



    #Barthickness .ui-slider-range { background: #383838; }
    #Barthickness .ui-slider-handle { border-color: #666666;
    border-color: #666666;
    height:10px;
    width:10px;

    border-radius: 10px;
    border-width: 3px; }

    #Forcelength{
    position: absolute;
    float: left;
    clear: left;
    top: 50%;

    width: 75px;
    height: 5px;

    margin-left: 240px;
    margin-top: 300px;

    }

    #Divlen1{
    position: absolute;
    float: left;
    clear: left;
    top: 50%;

    width: 75px;
    height: 5px;

    margin-left: 590px;
    margin-top: 320px;

    }



    #Divlen1 .ui-slider-range { background: #383838; }
    #Divlen1 .ui-slider-handle { border-color: #666666;
    border-color: #666666;
    height:10px;
    width:10px;

    border-radius: 10px;
    border-width: 3px; }

    #Divlen2{
    position: absolute;
    float: left;
    clear: left;
    top: 50%;

    width: 75px;
    height: 5px;

    margin-left: 590px;
    margin-top: 340px;

    }



    #Divlen2 .ui-slider-range { background: #383838; }
    #Divlen2 .ui-slider-handle { border-color: #666666;
    border-color: #666666;
    height:10px;
    width:10px;

    border-radius: 10px;
    border-width: 3px; }

    #Divlen3{
    position: absolute;
    float: left;
    clear: left;
    top: 50%;

    width: 75px;
    height: 5px;

    margin-left: 470px;
    margin-top: 320px;

    }



    #Divlen3 .ui-slider-range { background: #383838; }
    #Divlen3 .ui-slider-handle { border-color: #666666;
    border-color: #666666;
    height:10px;
    width:10px;

    border-radius: 10px;
    border-width: 3px; }

    #Divlen4{
    position: absolute;
    float: left;
    clear: left;
    top: 50%;

    width: 75px;
    height: 5px;

    margin-left: 470px;
    margin-top: 340px;

    }



    #Divlen4 .ui-slider-range { background: #383838; }
    #Divlen4 .ui-slider-handle { border-color: #666666;
    border-color: #666666;
    height:10px;
    width:10px;

    border-radius: 10px;
    border-width: 3px; }

    #cpoint1{
        position: absolute;
    top: 80.2%;
    width: 5%;
    height: 5px;
    margin-left: 13.5%;

    }



    #cpoint1 .ui-slider-range { background: #383838; }
    #cpoint1 .ui-slider-handle { border-color: #666666;
    border-color: #666666;
    height:10px;
    width:10px;

    border-radius: 10px;
    border-width: 3px; }

    #cpoint2{
        position: absolute;
    top: 82.2%;
    width: 5%;
    height: 5px;
    margin-left: 13.5%;
    }



    #cpoint2 .ui-slider-range { background: #383838; }
    #cpoint2 .ui-slider-handle { border-color: #666666;
    border-color: #666666;
    height:10px;
    width:10px;

    border-radius: 10px;
    border-width: 3px; }

    #cpoint3{
        position: absolute;
    top: 84.2%;
    width: 5%;
    height: 5px;
    margin-left: 13.5%;

    }



    #cpoint3 .ui-slider-range { background: #383838; }
    #cpoint3 .ui-slider-handle { border-color: #666666;
    border-color: #666666;
    height:10px;
    width:10px;

    border-radius: 10px;
    border-width: 3px; }

    #cpoint4{
    position: absolute;
    float: left;
    clear: left;
    top: 50%;

    width: 75px;
    height: 5px;

    margin-left: 350px;
    margin-top: 340px;

    }



    #cpoint4 .ui-slider-range { background: #383838; }
    #cpoint4 .ui-slider-handle { border-color: #666666;
    border-color: #666666;
    height:10px;
    width:10px;

    border-radius: 10px;
    border-width: 3px; }

    #fpointox{
    position: absolute;
    top: 80.3%;
    width: 5%;
    height: 5px;
    margin-left: 63.5%;


    }



    #fpointox .ui-slider-range { background: #383838; }
    #fpointox .ui-slider-handle { border-color: #666666;
    border-color: #666666;
    height:10px;
    width:10px;

    border-radius: 10px;
    border-width: 3px; }

    #fpointoy{
        position: absolute;
    top: 82.3%;
    width: 5%;
    height: 5px;
    margin-left: 63.5%;

    }



    #fpointoy .ui-slider-range { background: #383838; }
    #fpointoy .ui-slider-handle { border-color: #666666;
    border-color: #666666;
    height:10px;
    width:10px;

    border-radius: 10px;
    border-width: 3px; }

    #fpointoz{
        position: absolute;
    top: 84.3%;
    width: 5%;
    height: 5px;
    margin-left: 63.5%;

    }



    #fpointoz .ui-slider-range { background: #383838; }
    #fpointoz .ui-slider-handle { border-color: #666666;
    border-color: #666666;
    height:10px;
    width:10px;

    border-radius: 10px;
    border-width: 3px; }

    #o1len{
        position: absolute;
    top: 80.3%;
    width: 5%;
    height: 5px;
    margin-left: 83%;


    }



    #o1len .ui-slider-range { background: #383838; }
    #o1len .ui-slider-handle { border-color: #666666;
    border-color: #666666;
    height:10px;
    width:10px;

    border-radius: 10px;
    border-width: 3px; }

    #o2len{
        position: absolute;
    top: 88.3%;
    width: 5%;
    height: 5px;
    margin-left: 83%;


    }



    #o2len .ui-slider-range { background: #383838; }
    #o2len .ui-slider-handle { border-color: #666666;
    border-color: #666666;
    height:10px;
    width:10px;

    border-radius: 10px;
    border-width: 3px; }

    #formo2len{
        position: absolute;
    top: 86.2%;
    width: 5%;
    height: 5px;
    margin-left: 13.5%;

    }



    #formo2len .ui-slider-range { background: #383838; }
    #formo2len .ui-slider-handle { border-color: #666666;
    border-color: #666666;
    height:10px;
    width:10px;

    border-radius: 10px;
    border-width: 3px; }



    #formG_AC_len{
        position: absolute;
    top: 80.2%;
    width: 5%;
    height: 5px;
    margin-left: 24%;

    }



    #formG_AC_len .ui-slider-range { background: #383838; }
    #formG_AC_len .ui-slider-handle { border-color: #666666;
    border-color: #666666;
    height:10px;
    width:10px;

    border-radius: 10px;
    border-width: 3px; }

    #formG_ACC_len{
        position: absolute;
    top: 82.2%;
    width: 5%;
    height: 5px;
    margin-left: 24%;
    }



    #formG_ACC_len .ui-slider-range { background: #383838; }
    #formG_ACC_len .ui-slider-handle { border-color: #666666;
    border-color: #666666;
    height:10px;
    width:10px;

    border-radius: 10px;
    border-width: 3px; }

    #formG_C1C_len{
        position: absolute;
    top: 84.2%;
    width: 5%;
    height: 5px;
    margin-left: 24%;
    }



    #formG_C1C_len .ui-slider-range { background: #383838; }
    #formG_C1C_len .ui-slider-handle { border-color: #666666;
    border-color: #666666;
    height:10px;
    width:10px;

    border-radius: 10px;
    border-width: 3px; }

    #formG_C1AC_len{
        position: absolute;
    top: 86.2%;
    width: 5%;
    height: 5px;
    margin-left: 24%;

    }



    #formG_C1AC_len .ui-slider-range { background: #383838; }
    #formG_C1AC_len .ui-slider-handle { border-color: #666666;
    border-color: #666666;
    height:10px;
    width:10px;

    border-radius: 10px;
    border-width: 3px; }

    #formG_C1BC_len{
        position: absolute;
    top: 88.2%;
    width: 5%;
    height: 5px;
    margin-left: 24%;

    }



    #formG_C1BC_len .ui-slider-range { background: #383838; }
    #formG_C1BC_len .ui-slider-handle { border-color: #666666;
    border-color: #666666;
    height:10px;
    width:10px;

    border-radius: 10px;
    border-width: 3px; }

    #formG_A1B1_len{
        position: absolute;
    top: 90.2%;
    width: 5%;
    height: 5px;
    margin-left: 24%;

    }



    #formG_A1B1_len .ui-slider-range { background: #383838; }
    #formG_A1B1_len .ui-slider-handle { border-color: #666666;
    border-color: #666666;
    height:10px;
    width:10px;

    border-radius: 10px;
    border-width: 3px; }


    #forceoffset{
        position: absolute;
    top: 82.3%;
    width: 5%;
    height: 5px;
    margin-left: 83%;

    }



    #forceoffset.ui-slider-range { background: #383838; }
    #forceoffset .ui-slider-handle { border-color: #666666;
    border-color: #666666;
    height:10px;
    width:10px;

    border-radius: 10px;
    border-width: 3px; }

    #forceoffset2{
        position: absolute;
    top: 84.3%;
    width: 5%;
    height: 5px;
    margin-left: 83%;


    }



    #forceoffset2.ui-slider-range { background: #383838; }
    #forceoffset2 .ui-slider-handle { border-color: #666666;
    border-color: #666666;
    height:10px;
    width:10px;

    border-radius: 10px;
    border-width: 3px; }















    #Forcelength{
    position: absolute;
    float: left;
    clear: left;
    top: 50%;

    width: 75px;
    height: 5px;

    margin-left: 240px;
    margin-top: 300px;

    }

    



    #Forcelength .ui-slider-range { background: #383838; }
    #Forcelength .ui-slider-handle { border-color: #666666;
    border-color: #666666;
    height:10px;
    width:10px;

    border-radius: 10px;
    border-width: 3px; }



    #ForceP_Bx{
        position: absolute;
    top: 80.3%;
    width: 5%;
    height: 5px;
    margin-left: 73%;

    }



    #ForceP_Bx .ui-slider-range { background: #383838; }
    #ForceP_Bx .ui-slider-handle { border-color: #666666;
    border-color: #666666;
    height:10px;
    width:10px;

    border-radius: 10px;
    border-width: 3px; }

  
    #ForceP_By{
        position: absolute;
    top: 82.3%;
    width: 5%;
    height: 5px;
    margin-left: 73%;

    }



    #ForceP_By .ui-slider-range { background: #383838; }
    #ForceP_By .ui-slider-handle { border-color: #666666;
    border-color: #666666;
    height:10px;
    width:10px;

    border-radius: 10px;
    border-width: 3px; }

    #ForceP_Cx{
        position: absolute;
    top: 84.3%;
    width: 5%;
    height: 5px;
    margin-left: 73%;

    }



    #ForceP_Cx .ui-slider-range { background: #383838; }
    #ForceP_Cx .ui-slider-handle { border-color: #666666;
    border-color: #666666;
    height:10px;
    width:10px;

    border-radius: 10px;
    border-width: 3px; }

    #ForceP_Cy{
        position: absolute;
    top: 86.3%;
    width: 5%;
    height: 5px;
    margin-left: 73%;

    }



    #ForceP_Cy .ui-slider-range { background: #383838; }
    #ForceP_Cy .ui-slider-handle { border-color: #666666;
    border-color: #666666;
    height:10px;
    width:10px;

    border-radius: 10px;
    border-width: 3px; }

    #ForceP_Dx{
    position: absolute;
    float: left;
    clear: left;
    top: 50%;

    width: 75px;
    height: 5px;

    margin-left: 960px;
    margin-top: 397px;

    }



    #ForceP_Dx .ui-slider-range { background: #383838; }
    #ForceP_Dx .ui-slider-handle { border-color: #666666;
    border-color: #666666;
    height:10px;
    width:10px;

    border-radius: 10px;
    border-width: 3px; }

    #ForceP_Dy{
    position: absolute;
    float: left;
    clear: left;
    top: 50%;

    width: 75px;
    height: 5px;

    margin-left: 960px;
    margin-top: 417px;

    }



    #ForceP_Dy .ui-slider-range { background: #383838; }
    #ForceP_Dy .ui-slider-handle { border-color: #666666;
    border-color: #666666;
    height:10px;
    width:10px;

    border-radius: 10px;
    border-width: 3px; }

    #FormtrialP3z{
        position: absolute;
    top: 80.2%;
    width: 5%;
    height: 5px;
    margin-left: 34.5%;

    }



    #FormtrialP3z .ui-slider-range { background: #383838; }
    #FormtrialP3z .ui-slider-handle { border-color: #666666;
    border-color: #666666;
    height:10px;
    width:10px;

    border-radius: 10px;
    border-width: 3px; }




    </style>


<script>
    var renderer;
    var orbit_ctrl;
    //var camera;
    var Ctrl_pts=[];
    var Ctrl_tubes=[];
    var trfm_ctrl;
    var transformControls2;
    var lattice_line_material = new THREE.MeshPhongMaterial( {
                color: "green"
            } );
    var lattice_line_material1 = new THREE.MeshPhongMaterial( {
                color: 0x3b3b3b
            } );
    var lattice_line_material2 = new THREE.MeshPhongMaterial( {
                color: 0x3b3b3b
            } );
    var lattice_line_material3 = new THREE.MeshPhongMaterial( {
                color: 0x3b3b3b
            } );

    var arrow_material=new THREE.MeshPhongMaterial( {
                color: 0x000080
            } );

    var DragPointMat = new THREE.MeshPhongMaterial({color: 0x696969, transparent: true, opacity:0.8});

    var rayCaster = new THREE.Raycaster();
    var mouse = new THREE.Vector2();

    var f1;

    var control_right;

    var controls_scale = new function () {
            this.scale = 0;
            this.MaxScale=3;

            this.Force_face=true;
            this.Arrow_face=false;
            this.Force_Arrow=true;
            this.Scale_face=false;

            this.Control_Face=false;
            this.ForceFace_left=false;

            this.Cell_Faces=false;

            this.A=false;
            this.B=false;
            this.C=false;
            this.D=false;

            this.AB=false;
            this.AC=false;
            this.AD=false;
            this.BC=false;
            this.BD=false;
            this.CD=false;

            this.Pair_Control=false;
        };

        var tubethick = new function () {
               this.v = 0.05;
             }

        var flen = new function () {
                    this.l = 2;
                  }

        var FP_B = new function () {
                    this.x = 1;
                    this.y = 1.8;
                  }
        var FP_C = new function () {
                    this.x = 0;
                    this.y = -1.2;
                  }

        var FP_D = new function () {
                    this.x = -1;
                    this.y = -1;
                  }
        var Dlen1 = new function () {
                    this.l = 0.5;
                   
                  }
        var Dlen2 = new function () {
                    this.l = 0.5;
                   
                  }
        var Dlen3 = new function () {
                    this.l = 0.5;
                   
                  }
        var Dlen4 = new function () {
                    this.l = 0.5;
                   
                  }
        var cp1 = new function () {
                    this.z = -1.2;
                   
                  }
        var cp2 = new function () {
                    this.z = -1.2;
                   
                  }
        var cp3 = new function () {
                    this.z = -1.2;
                   
                  }
        var cp4 = new function () {
                    this.z = -1.2;
                   
                  }

        var fo = new function () {
                    this.x = 0;
                    this.y = 0;
                    this.z = -2;
                   
                  }
        var o1 = new function () {
          this.l = 2;
          
         
        }

        var o2 = new function () {
          this.l = 0.8;
          
         
        }

        var formo2 = new function () {
          this.l = 2;
          
         
        }

        var formG_AC = new function () {
          this.l = 1;
          
         
        }

        var formG_ACC = new function () {
          this.l = 0.6;
          
         
        }

        var formG_C1C = new function () {
          this.l = 0.6;
          
         
        }

        var formG_C1AC = new function () {
          this.l = 0.25;
          
         
        }

        var formG_C1BC = new function () {
          this.l = 0.15;
          
         
        }

        var formG_A1B1 = new function () {
          this.l = 0.2;
          
         
        }


        var foffset = new function () {
          this.l = 0.2;
          
         
        }

        var foffset2 = new function () {
          this.l = 0.2;
          
         
        }

        var triP3 = new function () {
                    this.z = 0;
                   
                  }


    function initRender() {
        renderer = new THREE.WebGLRenderer({alpha: true});
        //renderer.setClearColor(new THREE.Color(0xf5f5f5)); 
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMapEnabled = true;
        renderer.shadowMaptype = THREE.PCFSoftShadowMap;
        renderer.localClippingEnabled = true;
        //renderer.shadowMapType=THREE.PCFSoftShadowMap;
        document.body.appendChild(renderer.domElement);


    }

    var camera;

    function initCamera() {
        camera = new THREE.PerspectiveCamera(45, window.innerWidth/(window.innerHeight*2), 0.1, 200);
        camera.position.set(10, 0, 0);

        camera.up.x = 0;
        camera.up.y = 0;
        camera.up.z = 1;

        camera.lookAt({
                    x : 0,
                    y : 0,
                    z : 0
                });



    }

    var scene,scene2;

    function initScene() {
        scene = new THREE.Scene();

        scene2 = new THREE.Scene();
    }

    var light;

    function initLight() {
        scene.add(new THREE.AmbientLight(0x404040));

        light = new THREE.DirectionalLight(0xffffff);
        light.position.set(1, 1, 1);
        scene.add(light);

    }




        var Tube_group;
        var Tube_group_right;
        var Face_group_left;
        var wrapper;
        var step_group_1
        var step_group_2
        var step_group_1_1
        var trial_force
        var form_group
        var force_group
        var force_cell
        var form_trial
        var form_closingplane
        var form_greenfaces
        var face_arrow1;
        var face_arrow2;
        var face_arrow3;
        var face_arrow4;

        var mesh_left;
        var mesh_left_pair;
        var mesh_left_ForceFace;
        var corePoint_body;

        var Change_N3N4=false;

        //var



        function addControl(x, y, z) {
            var controls = new function () {
                this.x = x;
                this.y = y;
                this.z = z;
            };

            return controls;
        }





                $( "#Minkowskiscale, #Maxscale" ).slider({
                    orientation: "horizontal",

                    range: "min",
                    max: 3,
                    min:0,
                    step:0.01,
                    round:1


                });


                                $( "#Barthickness" ).slider({
                                    orientation: "horizontal",

                                    range: "min",
                                    max: 0.1,
                                    min:0.01,
                                    step:0.01,
                                    round:1


                                });

                                $( "#Forcelength" ).slider({
                                    orientation: "horizontal",

                                    range: "min",
                                    max: 5,
                                    min:0.01,
                                    step:0.01,
                                    round:1


                                });

                                $( "#ForceP_Bx" ).slider({
                                    orientation: "horizontal",

                                    range: "min",
                                    max: 4,
                                    min:-1,
                                    step:0.01,
                                    round:1


                                });

                                $( "#ForceP_By" ).slider({
                                    orientation: "horizontal",

                                    range: "min",
                                    max: 4,
                                    min:-1,
                                    step:0.01,
                                    round:1


                                });

                                $( "#ForceP_Cx" ).slider({
                                    orientation: "horizontal",

                                    range: "min",
                                    max: 2,
                                    min:-2,
                                    step:0.01,
                                    round:1


                                });

                                $( "#ForceP_Cy" ).slider({
                                    orientation: "horizontal",

                                    range: "min",
                                    max: 2,
                                    min:-2,
                                    step:0.01,
                                    round:1


                                });


                                $( "#ForceP_Dx" ).slider({
                                    orientation: "horizontal",

                                    range: "min",
                                    max: 4,
                                    min:-3,
                                    step:0.01,
                                    round:1


                                });

                                $( "#ForceP_Dy" ).slider({
                                    orientation: "horizontal",

                                    range: "min",
                                    max: 4,
                                    min:-3,
                                    step:0.01,
                                    round:1


                                });
                                
                                $( "#FormtrialP3z" ).slider({
                                    orientation: "horizontal",

                                    range: "min",
                                    max: 1,
                                    min:-1.5,
                                    step:0.01,
                                    round:1


                                });

                                $( "#Divlen1" ).slider({
                                    orientation: "horizontal",

                                    range: "min",
                                    max: 0.99,
                                    min:0.01,
                                    step:0.01,
                                    round:1


                                });

                                $( "#Divlen2" ).slider({
                                    orientation: "horizontal",

                                    range: "min",
                                    max: 0.99,
                                    min:0.01,
                                    step:0.01,
                                    round:1


                                });

                                
                                $( "#Divlen3" ).slider({
                                    orientation: "horizontal",

                                    range: "min",
                                    max: 0.99,
                                    min:0.01,
                                    step:0.01,
                                    round:1


                                });

                                $( "#Divlen4" ).slider({
                                    orientation: "horizontal",

                                    range: "min",
                                    max: 0.99,
                                    min:0.01,
                                    step:0.01,
                                    round:1


                                });

                                $( "#cpoint1" ).slider({
                                    orientation: "horizontal",

                                    range: "min",
                                    max: 0,
                                    min:-1.5,
                                    step:0.01,
                                    round:1


                                });

                                $( "#cpoint2" ).slider({
                                    orientation: "horizontal",

                                    range: "min",
                                    max: 0,
                                    min:-1.5,
                                    step:0.01,
                                    round:1


                                });

                                $( "#cpoint3" ).slider({
                                    orientation: "horizontal",

                                    range: "min",
                                    max: 0,
                                    min:-1.5,
                                    step:0.01,
                                    round:1


                                });

                                $( "#cpoint4" ).slider({
                                    orientation: "horizontal",

                                    range: "min",
                                    max: 0,
                                    min:-1.5,
                                    step:0.01,
                                    round:1


                                });

                                $( "#fpointox" ).slider({
                                    orientation: "horizontal",

                                    range: "min",
                                    max: 2,
                                    min:-2,
                                    step:0.01,
                                    round:1


                                });

                                $( "#fpointoy" ).slider({
                                    orientation: "horizontal",

                                    range: "min",
                                    max: 2,
                                    min:-2,
                                    step:0.01,
                                    round:1


                                });

                                $( "#fpointoz" ).slider({
                                    orientation: "horizontal",

                                    range: "min",
                                    max: 2,
                                    min:-2,
                                    step:0.01,
                                    round:1


                                });

                                $( "#o1len" ).slider({
                                    orientation: "horizontal",

                                    range: "min",
                                    max: 3,
                                    min:-3,
                                    step:0.01,
                                    round:1


                                });

                                $( "#o2len" ).slider({
                                    orientation: "horizontal",

                                    range: "min",
                                    max: 1,
                                    min:0.1,
                                    step:0.01,
                                    round:1


                                });

                                $( "#formo2len" ).slider({
                                    orientation: "horizontal",

                                    range: "min",
                                    max: 2.4,
                                    min:2,
                                    step:0.01,
                                    round:1


                                });

                                $( "#formG_AC_len" ).slider({
                                    orientation: "horizontal",

                                    range: "min",
                                    max: 1,
                                    min:0.7,
                                    step:0.01,
                                    round:1


                                });

                                $( "#formG_ACC_len" ).slider({
                                    orientation: "horizontal",

                                    range: "min",
                                    max: 0.6,
                                    min:0.3,
                                    step:0.01,
                                    round:1


                                });

                                
                                $( "#formG_C1C_len" ).slider({
                                    orientation: "horizontal",

                                    range: "min",
                                    max: 0.6,
                                    min:0.2,
                                    step:0.01,
                                    round:1


                                });

                                $( "#formG_C1AC_len" ).slider({
                                    orientation: "horizontal",

                                    range: "min",
                                    max: 0.3,
                                    min:0.05,
                                    step:0.01,
                                    round:1


                                });

                                $( "#formG_C1BC_len" ).slider({
                                    orientation: "horizontal",

                                    range: "min",
                                    max: 0.3,
                                    min:0.05,
                                    step:0.01,
                                    round:1


                                });

                                $( "#formG_A1B1_len" ).slider({
                                    orientation: "horizontal",

                                    range: "min",
                                    max: 0.5,
                                    min:0.05,
                                    step:0.01,
                                    round:1


                                });


                                $( "#forceoffset" ).slider({
                                    orientation: "horizontal",

                                    range: "min",
                                    max: 0.5,
                                    min:0.05,
                                    step:0.01,
                                    round:1


                                });

                                $( "#forceoffset2" ).slider({
                                    orientation: "horizontal",

                                    range: "min",
                                    max: 0.6,
                                    min:0.2,
                                    step:0.01,
                                    round:1


                                });






               $( "#Minkowskiscale" ).slider( "value", 0 );
               $( "#Barthickness" ).slider( "value", 0.01 );
               $( "#Forcelength" ).slider( "value", 3 );
               $( "#ForceP_Bx" ).slider( "value", 1 );
               $( "#ForceP_By" ).slider( "value", 1.8 );
               $( "#ForceP_Cx" ).slider( "value", 0 );
               $( "#ForceP_Cy" ).slider( "value", -1.2 );
               $( "#ForceP_Dx" ).slider( "value", -1 );
               $( "#ForceP_Dy" ).slider( "value", -1 );
               $( "#FormtrialP3z" ).slider( "value", -1 );
               $( "#Divlen1" ).slider( "value", 0.5 );
               $( "#Divlen2" ).slider( "value", 0.5 );
               $( "#Divlen3" ).slider( "value", 0.5 );
               $( "#Divlen4" ).slider( "value", 0.5 );
               $( "#cpoint1" ).slider( "value", -1.5 );
               $( "#cpoint2" ).slider( "value", -1.5 );
               $( "#cpoint3" ).slider( "value", -1.5 );
               $( "#cpoint4" ).slider( "value", -1.5 );
               $( "#fpointox" ).slider( "value", 0 );
               $( "#fpointoy" ).slider( "value", 0 );
               $( "#fpointoz" ).slider( "value", -2 );
               $( "#o1len" ).slider( "value", 2 );
               $( "#o2len" ).slider( "value", 0.8 );
               $( "#formo2len" ).slider( "value", 2 );
               $( "#formG_AC_len" ).slider( "value", 1 );
               $( "#formG_ACC_len" ).slider( "value", 0.6 );
               $( "#formG_C1C_len" ).slider( "value", 0.6 );
               $( "#formG_C1AC_len" ).slider( "value", 0.25 );
               $( "#formG_C1BC_len" ).slider( "value", 0.15 );
               $( "#formG_A1B1_len" ).slider( "value", 0.2 );
               $( "#forceoffset" ).slider( "value", 0.2 );
               $( "#forceoffset2" ).slider( "value", 0.2 );









               



                $( "#Minkowskiscale" ).slider({
                   slide:function(event,ui){
                       controls_scale.scale = ui.value;
                       redraw_Force();
                   },
                   change:function(event,ui){
                     controls_scale.scale = ui.value;
                     redraw_Force();
                   }
               });

               $( "#Barthickness" ).slider({
                  slide:function(event,ui){
                      tubethick.v = ui.value;
                      redraw();
                  },
                  change:function(event,ui){
                    tubethick.v = ui.value;
                    redraw();
                  }
              });

              $( "#Forcelength" ).slider({
                 slide:function(event,ui){
                     flen.l = ui.value;
                     redraw();
                     for(i=0;i<=3;i++){
                          text_closingplane_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    for(i=0;i<=6;i++){
                          text_force_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    form_trial.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    trial_force.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    form_greenfaces.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#FormGreen").prop('checked');
                                }
                                // if (obj.type === "LineSegments") {
                                //     obj.material.visible =$("#FormGreen").prop('checked');
                                // }
                           });

                   if ($("#ForceCell").prop('checked')){
                   
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =false;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                    });
                  }
                  
                  else{
                  
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =true;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                    });
                  
                  }
                 },
                 change:function(event,ui){
                   flen.l = ui.value;
                   redraw();
                   for(i=0;i<=3;i++){
                          text_closingplane_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    for(i=0;i<=6;i++){
                          text_force_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    form_trial.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    trial_force.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    form_greenfaces.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#FormGreen").prop('checked');
                                }
                                // if (obj.type === "LineSegments") {
                                //     obj.material.visible =$("#FormGreen").prop('checked');
                                // }
                           });

                   if ($("#ForceCell").prop('checked')){
                   
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =false;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                    });
                  }
                  
                  else{
                  
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =true;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                    });
                  
                  }
                 }
             });

             $( "#ForceP_Bx" ).slider({
                 slide:function(event,ui){
                     FP_B.x = ui.value;
                     redraw();
                     for(i=0;i<=3;i++){
                          text_closingplane_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    for(i=0;i<=6;i++){
                          text_force_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    form_trial.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    trial_force.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    form_greenfaces.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#FormGreen").prop('checked');
                                }
                                // if (obj.type === "LineSegments") {
                                //     obj.material.visible =$("#FormGreen").prop('checked');
                                // }
                           });

                   if ($("#ForceCell").prop('checked')){
                   
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =false;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                    });
                  }
                  
                  else{
                  
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =true;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                    });
                  
                  }
                 },
                 change:function(event,ui){
                    FP_B.x = ui.value;
                   redraw();
                   for(i=0;i<=3;i++){
                          text_closingplane_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    for(i=0;i<=6;i++){
                          text_force_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    form_trial.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    trial_force.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    form_greenfaces.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#FormGreen").prop('checked');
                                }
                                // if (obj.type === "LineSegments") {
                                //     obj.material.visible =$("#FormGreen").prop('checked');
                                // }
                           });

                   if ($("#ForceCell").prop('checked')){
                   
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =false;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                    });
                  }
                  
                  else{
                  
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =true;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                    });
                  
                  }
                 }
             });

             $( "#ForceP_By" ).slider({
                 slide:function(event,ui){
                     FP_B.y = ui.value;
                     redraw();
                     for(i=0;i<=3;i++){
                          text_closingplane_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    for(i=0;i<=6;i++){
                          text_force_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    form_trial.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    trial_force.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    form_greenfaces.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#FormGreen").prop('checked');
                                }
                                // if (obj.type === "LineSegments") {
                                //     obj.material.visible =$("#FormGreen").prop('checked');
                                // }
                           });

                   if ($("#ForceCell").prop('checked')){
                   
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =false;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                    });
                  }
                  
                  else{
                  
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =true;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                    });
                  
                  }
                 },
                 change:function(event,ui){
                    FP_B.y = ui.value;
                   redraw();
                   for(i=0;i<=3;i++){
                          text_closingplane_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    for(i=0;i<=6;i++){
                          text_force_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    form_trial.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    trial_force.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    form_greenfaces.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#FormGreen").prop('checked');
                                }
                                // if (obj.type === "LineSegments") {
                                //     obj.material.visible =$("#FormGreen").prop('checked');
                                // }
                           });

                   if ($("#ForceCell").prop('checked')){
                   
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =false;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                    });
                  }
                  
                  else{
                  
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =true;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                    });
                  
                  }
                 }
             });

             $( "#ForceP_Cx" ).slider({
                 slide:function(event,ui){
                     FP_C.x = ui.value;
                     redraw();
                     for(i=0;i<=3;i++){
                          text_closingplane_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    for(i=0;i<=6;i++){
                          text_force_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    form_trial.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    trial_force.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    form_greenfaces.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#FormGreen").prop('checked');
                                }
                                // if (obj.type === "LineSegments") {
                                //     obj.material.visible =$("#FormGreen").prop('checked');
                                // }
                           });

                   if ($("#ForceCell").prop('checked')){
                   
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =false;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                    });
                  }
                  
                  else{
                  
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =true;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                    });
                  
                  }
                 },
                 change:function(event,ui){
                    FP_C.x = ui.value;
                   redraw();
                   for(i=0;i<=3;i++){
                          text_closingplane_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    for(i=0;i<=6;i++){
                          text_force_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    form_trial.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    trial_force.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    form_greenfaces.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#FormGreen").prop('checked');
                                }
                                // if (obj.type === "LineSegments") {
                                //     obj.material.visible =$("#FormGreen").prop('checked');
                                // }
                           });

                   if ($("#ForceCell").prop('checked')){
                   
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =false;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                    });
                  }
                  
                  else{
                  
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =true;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                    });
                  
                  }
                 }
             });

             $( "#ForceP_Cy" ).slider({
                 slide:function(event,ui){
                     FP_C.y = ui.value;
                     redraw();
                     for(i=0;i<=3;i++){
                          text_closingplane_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    for(i=0;i<=6;i++){
                          text_force_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    form_trial.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    trial_force.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    form_greenfaces.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#FormGreen").prop('checked');
                                }
                                // if (obj.type === "LineSegments") {
                                //     obj.material.visible =$("#FormGreen").prop('checked');
                                // }
                           });

                   if ($("#ForceCell").prop('checked')){
                   
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =false;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                    });
                  }
                  
                  else{
                  
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =true;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                    });
                  
                  }
                 },
                 change:function(event,ui){
                    FP_C.y = ui.value;
                   redraw();
                   for(i=0;i<=3;i++){
                          text_closingplane_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    for(i=0;i<=6;i++){
                          text_force_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    form_trial.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    trial_force.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    form_greenfaces.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#FormGreen").prop('checked');
                                }
                                // if (obj.type === "LineSegments") {
                                //     obj.material.visible =$("#FormGreen").prop('checked');
                                // }
                           });

                   if ($("#ForceCell").prop('checked')){
                   
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =false;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                    });
                  }
                  
                  else{
                  
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =true;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                    });
                  
                  }
                 }
             });

             $( "#ForceP_Dx" ).slider({
                 slide:function(event,ui){
                     FP_D.x = ui.value;
                     redraw();
                 },
                 change:function(event,ui){
                    FP_D.x = ui.value;
                   redraw();
                 }
             });

             $( "#ForceP_Dy" ).slider({
                 slide:function(event,ui){
                     FP_D.y = ui.value;
                     redraw();
                 },
                 change:function(event,ui){
                    FP_D.y = ui.value;
                   redraw();
                 }
             });

             $( "#FormtrialP3z" ).slider({
                 slide:function(event,ui){
                     triP3.z = ui.value;
                     redraw();
                     for(i=0;i<=3;i++){
                          text_closingplane_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    for(i=0;i<=6;i++){
                          text_force_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    form_trial.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    trial_force.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    form_greenfaces.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#FormGreen").prop('checked');
                                }
                                // if (obj.type === "LineSegments") {
                                //     obj.material.visible =$("#FormGreen").prop('checked');
                                // }
                           });

                   if ($("#ForceCell").prop('checked')){
                   
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =false;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                    });
                  }
                  
                  else{
                  
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =true;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                    });
                  
                  }
                 },
                 change:function(event,ui){
                    triP3.z = ui.value;
                   redraw();
                   for(i=0;i<=3;i++){
                          text_closingplane_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    for(i=0;i<=6;i++){
                          text_force_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    form_trial.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    trial_force.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    form_greenfaces.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#FormGreen").prop('checked');
                                }
                                // if (obj.type === "LineSegments") {
                                //     obj.material.visible =$("#FormGreen").prop('checked');
                                // }
                           });

                   if ($("#ForceCell").prop('checked')){
                   
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =false;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                    });
                  }
                  
                  else{
                  
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =true;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                    });
                  
                  }
                 }
             });

             $( "#Divlen1" ).slider({
                 slide:function(event,ui){
                     Dlen1.l = ui.value;
                     redraw();
                     for(i=0;i<=3;i++){
                          text_closingplane_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    for(i=0;i<=6;i++){
                          text_force_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    form_trial.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    trial_force.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    form_greenfaces.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#FormGreen").prop('checked');
                                }
                                // if (obj.type === "LineSegments") {
                                //     obj.material.visible =$("#FormGreen").prop('checked');
                                // }
                           });

                   if ($("#ForceCell").prop('checked')){
                   
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =false;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                    });
                  }
                  
                  else{
                  
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =true;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                    });
                  
                  }
                 },
                 change:function(event,ui){
                    Dlen1.l = ui.value;
                   redraw();
                   for(i=0;i<=3;i++){
                          text_closingplane_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    for(i=0;i<=6;i++){
                          text_force_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    form_trial.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    trial_force.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    form_greenfaces.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#FormGreen").prop('checked');
                                }
                                // if (obj.type === "LineSegments") {
                                //     obj.material.visible =$("#FormGreen").prop('checked');
                                // }
                           });

                   if ($("#ForceCell").prop('checked')){
                   
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =false;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                    });
                  }
                  
                  else{
                  
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =true;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                    });
                  
                  }
                 }
             });

             $( "#Divlen2" ).slider({
                 slide:function(event,ui){
                     Dlen2.l = ui.value;
                     redraw();
                 },
                 change:function(event,ui){
                    Dlen2.l = ui.value;
                   redraw();
                 }
             });

             $( "#Divlen3" ).slider({
                 slide:function(event,ui){
                     Dlen3.l = ui.value;
                     redraw();
                 },
                 change:function(event,ui){
                    Dlen3.l = ui.value;
                   redraw();
                 }
             });

             $( "#Divlen4" ).slider({
                 slide:function(event,ui){
                     Dlen4.l = ui.value;
                     redraw();
                 },
                 change:function(event,ui){
                    Dlen4.l = ui.value;
                   redraw();
                 }
             });

             $( "#cpoint1" ).slider({
                 slide:function(event,ui){
                     cp1.z = ui.value;
                     redraw();
                     for(i=0;i<=3;i++){
                          text_closingplane_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    for(i=0;i<=6;i++){
                          text_force_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    form_trial.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    trial_force.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    form_greenfaces.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#FormGreen").prop('checked');
                                }
                                // if (obj.type === "LineSegments") {
                                //     obj.material.visible =$("#FormGreen").prop('checked');
                                // }
                           });

                   if ($("#ForceCell").prop('checked')){
                   
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =false;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                    });
                  }
                  
                  else{
                  
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =true;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                    });
                  
                  }
                 },
                 change:function(event,ui){
                    cp1.z = ui.value;
                   redraw();
                   for(i=0;i<=3;i++){
                          text_closingplane_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    for(i=0;i<=6;i++){
                          text_force_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    form_trial.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    trial_force.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    form_greenfaces.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#FormGreen").prop('checked');
                                }
                                // if (obj.type === "LineSegments") {
                                //     obj.material.visible =$("#FormGreen").prop('checked');
                                // }
                           });

                   if ($("#ForceCell").prop('checked')){
                   
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =false;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                    });
                  }
                  
                  else{
                  
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =true;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                    });
                  
                  }
                 }
             });

             $( "#cpoint2" ).slider({
                 slide:function(event,ui){
                     cp2.z = ui.value;
                     redraw();
                     for(i=0;i<=3;i++){
                          text_closingplane_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    for(i=0;i<=6;i++){
                          text_force_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    form_trial.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    trial_force.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    form_greenfaces.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#FormGreen").prop('checked');
                                }
                                // if (obj.type === "LineSegments") {
                                //     obj.material.visible =$("#FormGreen").prop('checked');
                                // }
                           });

                   if ($("#ForceCell").prop('checked')){
                   
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =false;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                    });
                  }
                  
                  else{
                  
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =true;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                    });
                  
                  }
                 },
                 change:function(event,ui){
                    cp2.z = ui.value;
                   redraw();
                   for(i=0;i<=3;i++){
                          text_closingplane_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    for(i=0;i<=6;i++){
                          text_force_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    form_trial.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    trial_force.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    form_greenfaces.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#FormGreen").prop('checked');
                                }
                                // if (obj.type === "LineSegments") {
                                //     obj.material.visible =$("#FormGreen").prop('checked');
                                // }
                           });

                   if ($("#ForceCell").prop('checked')){
                   
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =false;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                    });
                  }
                  
                  else{
                  
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =true;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                    });
                  
                  }
                 }
             });

             $( "#cpoint3" ).slider({
                 slide:function(event,ui){
                     cp3.z = ui.value;
                     redraw();
                     for(i=0;i<=3;i++){
                          text_closingplane_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    for(i=0;i<=6;i++){
                          text_force_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    form_trial.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    trial_force.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    form_greenfaces.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#FormGreen").prop('checked');
                                }
                                // if (obj.type === "LineSegments") {
                                //     obj.material.visible =$("#FormGreen").prop('checked');
                                // }
                           });

                   if ($("#ForceCell").prop('checked')){
                   
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =false;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                    });
                  }
                  
                  else{
                  
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =true;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                    });
                  
                  }
                 },
                 change:function(event,ui){
                    cp3.z = ui.value;
                   redraw();
                   for(i=0;i<=3;i++){
                          text_closingplane_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    for(i=0;i<=6;i++){
                          text_force_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    form_trial.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    trial_force.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    form_greenfaces.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#FormGreen").prop('checked');
                                }
                                // if (obj.type === "LineSegments") {
                                //     obj.material.visible =$("#FormGreen").prop('checked');
                                // }
                           });

                   if ($("#ForceCell").prop('checked')){
                   
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =false;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                    });
                  }
                  
                  else{
                  
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =true;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                    });
                  
                  }
                 }
             });

             $( "#cpoint4" ).slider({
                 slide:function(event,ui){
                     cp4.z = ui.value;
                     redraw();
                     for(i=0;i<=3;i++){
                          text_closingplane_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    for(i=0;i<=6;i++){
                          text_force_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    form_trial.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    trial_force.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    form_greenfaces.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#FormGreen").prop('checked');
                                }
                                // if (obj.type === "LineSegments") {
                                //     obj.material.visible =$("#FormGreen").prop('checked');
                                // }
                           });

                   if ($("#ForceCell").prop('checked')){
                   
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =false;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                    });
                  }
                  
                  else{
                  
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =true;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                    });
                  
                  }
                 }, 
                 change:function(event,ui){
                    cp4.z = ui.value;
                   redraw();
                   for(i=0;i<=3;i++){
                          text_closingplane_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    for(i=0;i<=6;i++){
                          text_force_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    form_trial.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    trial_force.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    form_greenfaces.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#FormGreen").prop('checked');
                                }
                                // if (obj.type === "LineSegments") {
                                //     obj.material.visible =$("#FormGreen").prop('checked');
                                // }
                           });

                   if ($("#ForceCell").prop('checked')){
                   
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =false;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                    });
                  }
                  
                  else{
                  
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =true;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                    });
                  
                  }

                 }
             });

             $( "#fpointox" ).slider({
                 slide:function(event,ui){
                     fo.x = ui.value;
                     redraw();
                     for(i=0;i<=3;i++){
                          text_closingplane_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    for(i=0;i<=6;i++){
                          text_force_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    form_trial.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    trial_force.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    form_greenfaces.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#FormGreen").prop('checked');
                                }
                                // if (obj.type === "LineSegments") {
                                //     obj.material.visible =$("#FormGreen").prop('checked');
                                // }
                           });

                   if ($("#ForceCell").prop('checked')){
                   
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =false;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                    });
                  }
                  
                  else{
                  
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =true;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                    });
                  
                  }
                 }, 
                 change:function(event,ui){
                    fo.x = ui.value;
                   redraw();
                   for(i=0;i<=3;i++){
                          text_closingplane_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    for(i=0;i<=6;i++){
                          text_force_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    form_trial.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    trial_force.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    form_greenfaces.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#FormGreen").prop('checked');
                                }
                                // if (obj.type === "LineSegments") {
                                //     obj.material.visible =$("#FormGreen").prop('checked');
                                // }
                           });

                   if ($("#ForceCell").prop('checked')){
                   
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =false;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                    });
                  }
                  
                  else{
                  
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =true;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                    });
                  
                  }
                 }
             });

             $( "#fpointoy" ).slider({
                 slide:function(event,ui){
                     fo.y = ui.value;
                     redraw();
                     for(i=0;i<=3;i++){
                          text_closingplane_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    for(i=0;i<=6;i++){
                          text_force_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    form_trial.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    trial_force.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    form_greenfaces.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#FormGreen").prop('checked');
                                }
                                // if (obj.type === "LineSegments") {
                                //     obj.material.visible =$("#FormGreen").prop('checked');
                                // }
                           });

                   if ($("#ForceCell").prop('checked')){
                   
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =false;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                    });
                  }
                  
                  else{
                  
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =true;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                    });
                  
                  }
                 }, 
                 change:function(event,ui){
                    fo.y = ui.value;
                   redraw();
                   for(i=0;i<=3;i++){
                          text_closingplane_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    for(i=0;i<=6;i++){
                          text_force_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    form_trial.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    trial_force.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    form_greenfaces.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#FormGreen").prop('checked');
                                }
                                // if (obj.type === "LineSegments") {
                                //     obj.material.visible =$("#FormGreen").prop('checked');
                                // }
                           });

                   if ($("#ForceCell").prop('checked')){
                   
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =false;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                    });
                  }
                  
                  else{
                  
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =true;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                    });
                  
                  }
                 }
             });

             $( "#fpointoz" ).slider({
                 slide:function(event,ui){
                     fo.z = ui.value;
                     redraw();
                     for(i=0;i<=3;i++){
                          text_closingplane_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    for(i=0;i<=6;i++){
                          text_force_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    form_trial.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    trial_force.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    form_greenfaces.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#FormGreen").prop('checked');
                                }
                                // if (obj.type === "LineSegments") {
                                //     obj.material.visible =$("#FormGreen").prop('checked');
                                // }
                           });

                   if ($("#ForceCell").prop('checked')){
                   
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =false;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                    });
                  }
                  
                  else{
                  
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =true;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                    });
                  
                  }
                 }, 
                 change:function(event,ui){
                    fo.z = ui.value;
                   redraw();
                   for(i=0;i<=3;i++){
                          text_closingplane_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    for(i=0;i<=6;i++){
                          text_force_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    form_trial.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    trial_force.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    form_greenfaces.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#FormGreen").prop('checked');
                                }
                                // if (obj.type === "LineSegments") {
                                //     obj.material.visible =$("#FormGreen").prop('checked');
                                // }
                           });

                   if ($("#ForceCell").prop('checked')){
                   
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =false;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                    });
                  }
                  
                  else{
                  
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =true;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                    });
                  
                  }
                 }
             });

             $( "#o1len" ).slider({
                 slide:function(event,ui){
                     o1.l = ui.value;
                     redraw();
                     for(i=0;i<=3;i++){
                          text_closingplane_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    for(i=0;i<=6;i++){
                          text_force_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    form_trial.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    trial_force.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    form_greenfaces.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#FormGreen").prop('checked');
                                }
                                // if (obj.type === "LineSegments") {
                                //     obj.material.visible =$("#FormGreen").prop('checked');
                                // }
                           });

                   if ($("#ForceCell").prop('checked')){
                   
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =false;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                    });
                  }
                  
                  else{
                  
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =true;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                    });
                  
                  }
                 }, 
                 change:function(event,ui){
                    o1.l = ui.value;
                   redraw();
                   for(i=0;i<=3;i++){
                          text_closingplane_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    for(i=0;i<=6;i++){
                          text_force_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    form_trial.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    trial_force.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    form_greenfaces.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#FormGreen").prop('checked');
                                }
                                // if (obj.type === "LineSegments") {
                                //     obj.material.visible =$("#FormGreen").prop('checked');
                                // }
                           });

                   if ($("#ForceCell").prop('checked')){
                   
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =false;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                    });
                  }
                  
                  else{
                  
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =true;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                    });
                  
                  }
                 }
             });

             $( "#o2len" ).slider({
                 slide:function(event,ui){
                     o2.l = ui.value;
                     redraw();
                     for(i=0;i<=3;i++){
                          text_closingplane_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    for(i=0;i<=6;i++){
                          text_force_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    form_trial.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    trial_force.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    form_greenfaces.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#FormGreen").prop('checked');
                                }
                                // if (obj.type === "LineSegments") {
                                //     obj.material.visible =$("#FormGreen").prop('checked');
                                // }
                           });

                   if ($("#ForceCell").prop('checked')){
                   
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =false;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                    });
                  }
                  
                  else{
                  
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =true;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                    });
                  
                  }
                 }, 
                 change:function(event,ui){
                    o2.l = ui.value;
                   redraw();
                   for(i=0;i<=3;i++){
                          text_closingplane_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    for(i=0;i<=6;i++){
                          text_force_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    form_trial.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    trial_force.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    form_greenfaces.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#FormGreen").prop('checked');
                                }
                                // if (obj.type === "LineSegments") {
                                //     obj.material.visible =$("#FormGreen").prop('checked');
                                // }
                           });

                   if ($("#ForceCell").prop('checked')){
                   
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =false;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                    });
                  }
                  
                  else{
                  
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =true;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                    });
                  
                  }
                 }
             });

             $( "#formo2len" ).slider({
                 slide:function(event,ui){
                     formo2.l = ui.value;
                     redraw();
                     for(i=0;i<=3;i++){
                          text_closingplane_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    for(i=0;i<=6;i++){
                          text_force_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    form_trial.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    trial_force.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    form_greenfaces.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#FormGreen").prop('checked');
                                }
                                // if (obj.type === "LineSegments") {
                                //     obj.material.visible =$("#FormGreen").prop('checked');
                                // }
                           });

                   if ($("#ForceCell").prop('checked')){
                   
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =false;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                    });
                  }
                  
                  else{
                  
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =true;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                    });
                  
                  }
                 }, 
                 change:function(event,ui){
                    formo2.l = ui.value;
                   redraw();
                   for(i=0;i<=3;i++){
                          text_closingplane_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    for(i=0;i<=6;i++){
                          text_force_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    form_trial.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    trial_force.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    form_greenfaces.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#FormGreen").prop('checked');
                                }
                                // if (obj.type === "LineSegments") {
                                //     obj.material.visible =$("#FormGreen").prop('checked');
                                // }
                           });

                   if ($("#ForceCell").prop('checked')){
                   
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =false;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                    });
                  }
                  
                  else{
                  
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =true;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                    });
                  
                  }
                 }
             });

             $( "#formG_AC_len" ).slider({
                 slide:function(event,ui){
                    formG_AC.l = ui.value;
                     redraw();
                     for(i=0;i<=3;i++){
                          text_closingplane_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    for(i=0;i<=6;i++){
                          text_force_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    form_trial.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    trial_force.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    form_greenfaces.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#FormGreen").prop('checked');
                                }
                                // if (obj.type === "LineSegments") {
                                //     obj.material.visible =$("#FormGreen").prop('checked');
                                // }
                           });

                   if ($("#ForceCell").prop('checked')){
                   
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =false;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                    });
                  }
                  
                  else{
                  
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =true;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                    });
                  
                  }
                 }, 
                 change:function(event,ui){
                    formG_AC.l = ui.value;
                   redraw();
                   for(i=0;i<=3;i++){
                          text_closingplane_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    for(i=0;i<=6;i++){
                          text_force_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    form_trial.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    trial_force.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    form_greenfaces.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#FormGreen").prop('checked');
                                }
                                // if (obj.type === "LineSegments") {
                                //     obj.material.visible =$("#FormGreen").prop('checked');
                                // }
                           });

                   if ($("#ForceCell").prop('checked')){
                   
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =false;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                    });
                  }
                  
                  else{
                  
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =true;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                    });
                  
                  }
                 }
             });

             $( "#formG_ACC_len" ).slider({
                 slide:function(event,ui){
                    formG_ACC.l = ui.value;
                     redraw();
                     for(i=0;i<=3;i++){
                          text_closingplane_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    for(i=0;i<=6;i++){
                          text_force_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    form_trial.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    trial_force.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    form_greenfaces.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#FormGreen").prop('checked');
                                }
                                // if (obj.type === "LineSegments") {
                                //     obj.material.visible =$("#FormGreen").prop('checked');
                                // }
                           });

                   if ($("#ForceCell").prop('checked')){
                   
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =false;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                    });
                  }
                  
                  else{
                  
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =true;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                    });
                  
                  }
                 }, 
                 change:function(event,ui){
                    formG_ACC.l = ui.value;
                   redraw();
                   for(i=0;i<=3;i++){
                          text_closingplane_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    for(i=0;i<=6;i++){
                          text_force_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    form_trial.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    trial_force.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    form_greenfaces.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#FormGreen").prop('checked');
                                }
                                // if (obj.type === "LineSegments") {
                                //     obj.material.visible =$("#FormGreen").prop('checked');
                                // }
                           });

                   if ($("#ForceCell").prop('checked')){
                   
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =false;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                    });
                  }
                  
                  else{
                  
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =true;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                    });
                  
                  }
                 }
             });

             $( "#formG_C1C_len" ).slider({
                 slide:function(event,ui){
                    formG_C1C.l = ui.value;
                     redraw();
                     for(i=0;i<=3;i++){
                          text_closingplane_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    for(i=0;i<=6;i++){
                          text_force_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    form_trial.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    trial_force.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    form_greenfaces.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#FormGreen").prop('checked');
                                }
                                // if (obj.type === "LineSegments") {
                                //     obj.material.visible =$("#FormGreen").prop('checked');
                                // }
                           });

                   if ($("#ForceCell").prop('checked')){
                   
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =false;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                    });
                  }
                  
                  else{
                  
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =true;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                    });
                  
                  }
                 }, 
                 change:function(event,ui){
                    formG_C1C.l = ui.value;
                   redraw();
                   for(i=0;i<=3;i++){
                          text_closingplane_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    for(i=0;i<=6;i++){
                          text_force_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    form_trial.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    trial_force.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    form_greenfaces.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#FormGreen").prop('checked');
                                }
                                // if (obj.type === "LineSegments") {
                                //     obj.material.visible =$("#FormGreen").prop('checked');
                                // }
                           });

                   if ($("#ForceCell").prop('checked')){
                   
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =false;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                    });
                  }
                  
                  else{
                  
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =true;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                    });
                  
                  }
                 }
             });

             $( "#formG_C1AC_len" ).slider({
                 slide:function(event,ui){
                    formG_C1AC.l = ui.value;
                     redraw();
                     for(i=0;i<=3;i++){
                          text_closingplane_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    for(i=0;i<=6;i++){
                          text_force_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    form_trial.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    trial_force.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    form_greenfaces.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#FormGreen").prop('checked');
                                }
                                // if (obj.type === "LineSegments") {
                                //     obj.material.visible =$("#FormGreen").prop('checked');
                                // }
                           });

                   if ($("#ForceCell").prop('checked')){
                   
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =false;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                    });
                  }
                  
                  else{
                  
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =true;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                    });
                  
                  }
                 }, 
                 change:function(event,ui){
                    formG_C1AC.l = ui.value;
                   redraw();
                   for(i=0;i<=3;i++){
                          text_closingplane_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    for(i=0;i<=6;i++){
                          text_force_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    form_trial.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    trial_force.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    form_greenfaces.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#FormGreen").prop('checked');
                                }
                                // if (obj.type === "LineSegments") {
                                //     obj.material.visible =$("#FormGreen").prop('checked');
                                // }
                           });

                   if ($("#ForceCell").prop('checked')){
                   
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =false;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                    });
                  }
                  
                  else{
                  
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =true;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                    });
                  
                  }
                 }
             });

             $( "#formG_C1BC_len" ).slider({
                 slide:function(event,ui){
                    formG_C1BC.l = ui.value;
                     redraw();
                     for(i=0;i<=3;i++){
                          text_closingplane_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    for(i=0;i<=6;i++){
                          text_force_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    form_trial.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    trial_force.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    form_greenfaces.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#FormGreen").prop('checked');
                                }
                                // if (obj.type === "LineSegments") {
                                //     obj.material.visible =$("#FormGreen").prop('checked');
                                // }
                           });

                   if ($("#ForceCell").prop('checked')){
                   
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =false;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                    });
                  }
                  
                  else{
                  
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =true;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                    });
                  
                  }
                 }, 
                 change:function(event,ui){
                    formG_C1BC.l = ui.value;
                   redraw();
                   for(i=0;i<=3;i++){
                          text_closingplane_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    for(i=0;i<=6;i++){
                          text_force_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    form_trial.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    trial_force.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    form_greenfaces.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#FormGreen").prop('checked');
                                }
                                // if (obj.type === "LineSegments") {
                                //     obj.material.visible =$("#FormGreen").prop('checked');
                                // }
                           });

                   if ($("#ForceCell").prop('checked')){
                   
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =false;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                    });
                  }
                  
                  else{
                  
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =true;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                    });
                  
                  }
                 }
             });

             $( "#formG_A1B1_len" ).slider({
                 slide:function(event,ui){
                    formG_A1B1.l = ui.value;
                     redraw();
                     for(i=0;i<=3;i++){
                          text_closingplane_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    for(i=0;i<=6;i++){
                          text_force_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    form_trial.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    trial_force.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    form_greenfaces.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#FormGreen").prop('checked');
                                }
                                // if (obj.type === "LineSegments") {
                                //     obj.material.visible =$("#FormGreen").prop('checked');
                                // }
                           });

                   if ($("#ForceCell").prop('checked')){
                   
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =false;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                    });
                  }
                  
                  else{
                  
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =true;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                    });
                  
                  }
                 }, 
                 change:function(event,ui){
                    formG_A1B1.l = ui.value;
                   redraw();
                   for(i=0;i<=3;i++){
                          text_closingplane_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    for(i=0;i<=6;i++){
                          text_force_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    form_trial.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    trial_force.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    form_greenfaces.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#FormGreen").prop('checked');
                                }
                                // if (obj.type === "LineSegments") {
                                //     obj.material.visible =$("#FormGreen").prop('checked');
                                // }
                           });

                   if ($("#ForceCell").prop('checked')){
                   
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =false;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                    });
                  }
                  
                  else{
                  
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =true;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                    });
                  
                  }
                 }
             });

             $( "#forceoffset" ).slider({
                 slide:function(event,ui){
                     foffset.l = ui.value;
                     redraw();
                     for(i=0;i<=3;i++){
                          text_closingplane_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    for(i=0;i<=6;i++){
                          text_force_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    form_trial.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    trial_force.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    form_greenfaces.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#FormGreen").prop('checked');
                                }
                                // if (obj.type === "LineSegments") {
                                //     obj.material.visible =$("#FormGreen").prop('checked');
                                // }
                           });

                   if ($("#ForceCell").prop('checked')){
                   
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =false;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                    });
                  }
                  
                  else{
                  
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =true;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                    });
                  
                  }
                 }, 
                 change:function(event,ui){
                    foffset.l = ui.value;
                   redraw();
                   for(i=0;i<=3;i++){
                          text_closingplane_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    for(i=0;i<=6;i++){
                          text_force_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    form_trial.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    trial_force.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    form_greenfaces.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#FormGreen").prop('checked');
                                }
                                // if (obj.type === "LineSegments") {
                                //     obj.material.visible =$("#FormGreen").prop('checked');
                                // }
                           });

                   if ($("#ForceCell").prop('checked')){
                   
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =false;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                    });
                  }
                  
                  else{
                  
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =true;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                    });
                  
                  }
                 }
             });

             $( "#forceoffset2" ).slider({
                 slide:function(event,ui){
                     foffset2.l = ui.value;
                     redraw();
                     for(i=0;i<=3;i++){
                          text_closingplane_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    for(i=0;i<=6;i++){
                          text_force_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    form_trial.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    trial_force.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    form_greenfaces.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#FormGreen").prop('checked');
                                }
                                // if (obj.type === "LineSegments") {
                                //     obj.material.visible =$("#FormGreen").prop('checked');
                                // }
                           });

                   if ($("#ForceCell").prop('checked')){
                   
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =false;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                    });
                  }
                  
                  else{
                  
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =true;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                    });
                  
                  }
                 }, 
                 change:function(event,ui){
                    foffset2.l = ui.value;
                   redraw();
                   for(i=0;i<=3;i++){
                          text_closingplane_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    for(i=0;i<=6;i++){
                          text_force_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    form_trial.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    trial_force.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    form_greenfaces.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#FormGreen").prop('checked');
                                }
                                // if (obj.type === "LineSegments") {
                                //     obj.material.visible =$("#FormGreen").prop('checked');
                                // }
                           });

                   if ($("#ForceCell").prop('checked')){
                   
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =false;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                    });
                  }
                  
                  else{
                  
                   force_group.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =true;
                        }
                        if (obj.type === "Sprite") {
                            obj.material.visible =true;
                        }
                    });
                  
                    force_cell.traverse(function(obj) {
                        if (obj.type === "Mesh") {
                            obj.material.visible =false;
                        }
                    });
                  
                  }
                 }
             });






















             $("#Trial").attr("checked",false);
             $("#Trial").change(function() {

                    redraw;

                    for(i=0;i<=3;i++){
                          text_closingplane_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    for(i=0;i<=6;i++){
                          text_force_trial_group.children[i].visible=$("#Trial").prop('checked');
                          }

                    form_trial.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                    trial_force.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =$("#Trial").prop('checked');
                                }
                            });

                
                   });

             $("#ForceCell").attr("checked",false);
             $("#ForceCell").change(function() {
                redraw;

                   if ($("#ForceCell").prop('checked')){
                   
                    force_group.traverse(function(obj) {
                         if (obj.type === "Mesh") {
                             obj.material.visible =false;
                         }
                         if (obj.type === "Sprite") {
                             obj.material.visible =false;
                         }
                     });
                   
                     force_cell.traverse(function(obj) {
                         if (obj.type === "Mesh") {
                             obj.material.visible =true;
                         }
                     });
                   }
                   
                   else{
                   
                    force_group.traverse(function(obj) {
                         if (obj.type === "Mesh") {
                             obj.material.visible =true;
                         }
                         if (obj.type === "Sprite") {
                             obj.material.visible =true;
                         }
                     });
                   
                     force_cell.traverse(function(obj) {
                         if (obj.type === "Mesh") {
                             obj.material.visible =false;
                         }
                     });
                   
                   }

                   });

             $("#FormGreen").attr("checked",false);

             $("#FormGreen").change(function() {
                     
                     redraw;

                     form_greenfaces.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =$("#FormGreen").prop('checked');
                                }
                                // if (obj.type === "LineSegments") {
                                //     obj.material.visible =$("#FormGreen").prop('checked');
                                // }
                            });

                    });

                
                        $("#ch4").attr("checked",false);//show or not

                        $("#ch4").change(function() {

                          controls_scale.ForceFace_left=$("#ch4").prop('checked');
                          redraw_Faces6();

                          mesh_left_ForceFace.children[0].material.visible=$("#ch4").prop('checked');
                          mesh_left_ForceFace.children[1].material.visible=$("#ch4").prop('checked');
                              });

                              $("#ch5").attr("checked",false);//show or not

                              $("#ch5").change(function() {

                                controls_scale.Cell_Faces=$("#ch5").prop('checked');
                                redraw_Cell();

                                for(i=0;i<2;i++)
                                {
                                    mesh_left_Cell1.children[i].material.visible=$("#ch5").prop('checked');
                                    mesh_left_Cell2.children[i].material.visible=$("#ch5").prop('checked');
                                    mesh_left_Cell3.children[i].material.visible=$("#ch5").prop('checked');
                                    mesh_left_Cell4.children[i].material.visible=$("#ch5").prop('checked');

                                }

                              //  for(i=0;i<=8;i++){
                              //    text_group2.children[4].material.visible=$("#ch5").prop('checked');
                              //    text_group2.children[5].material.visible=$("#ch5").prop('checked');
                              //    text_group2.children[6].material.visible=$("#ch5").prop('checked');
                              //    text_group2.children[7].material.visible=$("#ch5").prop('checked');
                              //  }

                                    });


                                    $("#ch6").attr("checked",false);
                                    //show or not

                                    $("#ch6").change(function() {

                                      controls_scale.Arrow_face=$("#ch6").prop('checked');

                                      mesh_TriFace1.children[0].material.visible=$("#ch6").prop('checked');
                                      mesh_TriFace2.children[0].material.visible=$("#ch6").prop('checked');
                                      mesh_TriFace3.children[0].material.visible=$("#ch6").prop('checked');
                                      mesh_TriFace4.children[0].material.visible=$("#ch6").prop('checked');

                                      for(i=1;i<=3;i++){
                                          mesh_TriFace1.children[i].visible=$("#ch6").prop('checked');
                                          mesh_TriFace2.children[i].visible=$("#ch6").prop('checked');
                                          mesh_TriFace3.children[i].visible=$("#ch6").prop('checked');
                                          mesh_TriFace4.children[i].visible=$("#ch6").prop('checked');
                                      }

                                          });


                                          $("#ch7").attr("checked",false);
                                          //show or not

                                          $("#ch7").change(function() {

                                            controls_scale.Control_Face=$("#ch7").prop('checked');
                                            redraw_right();

                                            Tube_group_right.traverse(function(obj) {//hide group
                                                    if (obj.type === "Mesh") {
                                                        obj.material.visible =$("#ch7").prop('checked');
                                                    }
                                                });

                                                });

                                                $("#ch8").attr("checked",false);//show or not

                                                $("#ch8").change(function() {

                                                  if($("#ch8").prop('checked'))//hlight
                                                  {
                                                   Tube_group_right.children[0].material.color.set(0xFF6347);

                                                   for(i=0;i<=2;i++)
                                                   {
                                                       mesh_left_Cell2.children[1].geometry.faces[i].color.set(0xFF6347);
                                                   }

                                                  }
                                              else //old color
                                              {
                                                   Tube_group_right.children[0].material.color.set(0x5a5a5a);

                                                   for(i=0;i<=2;i++)
                                                   {
                                                       mesh_left_Cell2.children[1].geometry.faces[i].color.set(0xCCCCCC);
                                                   }

                                              }

                                                   mesh_left_Cell2.children[1].geometry.facesNeedUpdate=true;
                                                   mesh_left_Cell2.children[1].geometry.elementsNeedUpdate = true;
                                                   mesh_left_Cell2.children[1].geometry.computeFaceNormals();

                                                    });//show or no

                                                    $("#ch9").attr("checked",false);//show or not

                                                    $("#ch9").change(function() {

                                                      if($("#ch9").prop('checked'))//hlight
                                                      {
                                                       Tube_group_right.children[1].material.color.set(0xFF6347);

                                                       for(i=0;i<=2;i++)
                                                       {
                                                           mesh_left_Cell3.children[1].geometry.faces[i].color.set(0xFF6347);
                                                       }

                                                      }
                                                  else //old color
                                                  {
                                                       Tube_group_right.children[1].material.color.set(0x5a5a5a);

                                                       for(i=0;i<=2;i++)
                                                       {
                                                           mesh_left_Cell3.children[1].geometry.faces[i].color.set(0xCCCCCC);
                                                       }



                                                  }
                                                       mesh_left_Cell3.children[1].geometry.facesNeedUpdate=true;
                                                       mesh_left_Cell3.children[1].geometry.elementsNeedUpdate = true;
                                                       mesh_left_Cell3.children[1].geometry.computeFaceNormals();

                                                        });//show or no

                                                        $("#ch10").attr("checked",false);//show or not

                                                        $("#ch10").change(function() {

                                                          if($("#ch10").prop('checked'))//hlight
                                                          {
                                                           Tube_group_right.children[2].material.color.set(0xFF6347);
                                                           for(i=0;i<=2;i++)
                                                           {
                                                               mesh_left_Cell1.children[1].geometry.faces[i].color.set(0xFF6347);
                                                           }

                                                          }
                                                      else //old color
                                                      {
                                                           Tube_group_right.children[2].material.color.set(0x5a5a5a);
                                                           for(i=0;i<=2;i++)
                                                           {
                                                               mesh_left_Cell1.children[1].geometry.faces[i].color.set(0xCCCCCC);
                                                           }


                                                      }
                                                           mesh_left_Cell1.children[1].geometry.facesNeedUpdate=true;
                                                           mesh_left_Cell1.children[1].geometry.elementsNeedUpdate = true;
                                                           mesh_left_Cell1.children[1].geometry.computeFaceNormals();


                                                            });//show or no
                                                            $("#ch11").attr("checked",false);//show or not

                                                            $("#ch11").change(function() {

                                                              if($("#ch11").prop('checked'))//hlight
                                                              {
                                                               Tube_group_right.children[3].material.color.set(0xFF6347);
                                                               for(i=0;i<=2;i++)
                                                               {
                                                                   mesh_left_Cell4.children[1].geometry.faces[i].color.set(0xFF6347);
                                                               }



                                                              }
                                                          else //old color
                                                          {
                                                               Tube_group_right.children[3].material.color.set(0x5a5a5a);

                                                               for(i=0;i<=2;i++)
                                                               {
                                                                   mesh_left_Cell4.children[1].geometry.faces[i].color.set(0xCCCCCC);
                                                               }


                                                          }
                                                               mesh_left_Cell4.children[1].geometry.facesNeedUpdate=true;
                                                               mesh_left_Cell4.children[1].geometry.elementsNeedUpdate = true;
                                                               mesh_left_Cell4.children[1].geometry.computeFaceNormals();


                                                                });//show or no

                                                                $("#ch12").attr("checked",false);//show or not

                                                                $("#ch12").change(function() {

                                                                  if($("#ch12").prop('checked'))//hlight
                                                                  {
                                                                   Tube_group_right.children[4].material.color.set(0xFF6347);
                                                                   mesh_left_ForceFace.children[0].geometry.faces[1].color.set(0xFF6347);

                                                                  }
                                                              else //old color
                                                              {
                                                                   Tube_group_right.children[4].material.color.set(0x5a5a5a);
                                                                   mesh_left_ForceFace.children[0].geometry.faces[1].color.set(0x009600);

                                                              }
                                                                   mesh_left_ForceFace.children[0].geometry.facesNeedUpdate=true;

                                                                   mesh_left_ForceFace.children[0].geometry.elementsNeedUpdate = true;
                                                                   mesh_left_ForceFace.children[0].geometry.computeFaceNormals();


                                                                    });//show or no

                                                                    $("#ch13").attr("checked",false);//show or not

                                                                    $("#ch13").change(function() {

                                                                      if($("#ch13").prop('checked'))//hlight
                                                                      {
                                                                       Tube_group_right.children[5].material.color.set(0xFF6347);
                                                                       mesh_left_ForceFace.children[0].geometry.faces[2].color.set(0xFF6347);

                                                                      }
                                                                  else //old color
                                                                  {
                                                                       Tube_group_right.children[5].material.color.set(0x5a5a5a);
                                                                       mesh_left_ForceFace.children[0].geometry.faces[2].color.set(0x009600);

                                                                  }
                                                                       mesh_left_ForceFace.children[0].geometry.facesNeedUpdate=true;

                                                                       mesh_left_ForceFace.children[0].geometry.elementsNeedUpdate = true;
                                                                       mesh_left_ForceFace.children[0].geometry.computeFaceNormals();


                                                                        });//show or no

                                                                        $("#ch14").attr("checked",false);//show or not

                                                                        $("#ch14").change(function() {

                                                                          if($("#ch14").prop('checked'))//hlight
                                                                          {
                                                                           Tube_group_right.children[6].material.color.set(0xFF6347);
                                                                           mesh_left_ForceFace.children[0].geometry.faces[0].color.set(0xFF6347);

                                                                          }
                                                                      else //old color
                                                                      {
                                                                           Tube_group_right.children[6].material.color.set(0x5a5a5a);
                                                                           mesh_left_ForceFace.children[0].geometry.faces[0].color.set(0x009600);

                                                                      }
                                                                           mesh_left_ForceFace.children[0].geometry.facesNeedUpdate=true;

                                                                           mesh_left_ForceFace.children[0].geometry.elementsNeedUpdate = true;
                                                                           mesh_left_ForceFace.children[0].geometry.computeFaceNormals();

                                                                            });//show or no


                                                                            $("#ch15").attr("checked",false);//show or not

                                                                            $("#ch15").change(function() {

                                                                              if($("#ch15").prop('checked'))//hlight
                                                                              {
                                                                               Tube_group_right.children[7].material.color.set(0xFF6347);
                                                                               mesh_left_ForceFace.children[0].geometry.faces[3].color.set(0xFF6347);

                                                                              }
                                                                          else //old color
                                                                          {
                                                                               Tube_group_right.children[7].material.color.set(0x5a5a5a);
                                                                               mesh_left_ForceFace.children[0].geometry.faces[3].color.set(0x009600);

                                                                          }
                                                                               mesh_left_ForceFace.children[0].geometry.facesNeedUpdate=true;

                                                                               mesh_left_ForceFace.children[0].geometry.elementsNeedUpdate = true;
                                                                               mesh_left_ForceFace.children[0].geometry.computeFaceNormals();

                                                                                });//show or no

                                                                                $("#ch16").attr("checked",false);//show or not

                                                                                $("#ch16").change(function() {

                                                                                  if($("#ch16").prop('checked'))//hlight
                                                                                  {
                                                                                   Tube_group_right.children[8].material.color.set(0xFF6347);
                                                                                   mesh_left_ForceFace.children[0].geometry.faces[5].color.set(0xFF6347);

                                                                                  }
                                                                              else //old color
                                                                              {
                                                                                   Tube_group_right.children[8].material.color.set(0x5a5a5a);
                                                                                   mesh_left_ForceFace.children[0].geometry.faces[5].color.set(0x009600);

                                                                              }
                                                                                   mesh_left_ForceFace.children[0].geometry.facesNeedUpdate=true;

                                                                                   mesh_left_ForceFace.children[0].geometry.elementsNeedUpdate = true;
                                                                                   mesh_left_ForceFace.children[0].geometry.computeFaceNormals();

                                                                                    });//show or no

                                                                                    $("#ch17").attr("checked",false);//show or not

                                                                                    $("#ch17").change(function() {

                                                                                      if($("#ch17").prop('checked'))//hlight
                                                                                      {
                                                                                       Tube_group_right.children[9].material.color.set(0xFF6347);
                                                                                       mesh_left_ForceFace.children[0].geometry.faces[4].color.set(0xFF6347);

                                                                                      }
                                                                                  else //old color
                                                                                  {
                                                                                       Tube_group_right.children[9].material.color.set(0x5a5a5a);
                                                                                       mesh_left_ForceFace.children[0].geometry.faces[4].color.set(0x009600);

                                                                                  }
                                                                                       mesh_left_ForceFace.children[0].geometry.facesNeedUpdate=true;

                                                                                       mesh_left_ForceFace.children[0].geometry.elementsNeedUpdate = true;
                                                                                       mesh_left_ForceFace.children[0].geometry.computeFaceNormals();

                                                                                        });//show or no

                                                                                        $("#ch18").attr("checked",false);//show or not

                                                                                        $("#ch18").change(function() {



                                                                                                  mesh_TriFace1.children[4].visible=false;
                                                                                                    mesh_TriFace2.children[4].visible=false;
                                                                                                    mesh_TriFace3.children[4].visible=false;
                                                                                                    mesh_TriFace4.children[4].visible=false;
                                                                                                   // controls_scale.Force_Arrow=false;


                                                                                                    //hide arrow

                                                                                                     //hide normal arrow

                                                                                                  mesh_TriFace1.children[5].visible=false;
                                                                                                    mesh_TriFace2.children[5].visible=false;
                                                                                                    mesh_TriFace3.children[5].visible=false;
                                                                                                    mesh_TriFace4.children[5].visible=false;

                                                                                                    mesh_TriFace1.children[6].visible=false;
                                                                                                    mesh_TriFace2.children[6].visible=false;
                                                                                                    mesh_TriFace3.children[6].visible=false;
                                                                                                    mesh_TriFace4.children[6].visible=false;





                                                                                                    //point and edges

                                                                                                    Tube_group_right.traverse(function(obj) {//hide group
                                                                                                    if (obj.type === "Mesh") {
                                                                                                        obj.material.visible =false;
                                                                                                    }
                                                                                                });

                                                                                                    //controls_scale.Control_Face=false;


                                                                                                    //show force face

                                                                                                    redraw_Force();


                                                                                          if(controls_scale.ForceFace_left=$("#ch18").prop('checked'))
                                                                                          {

                                                                                          redraw_Faces6();

                                                                                          for(i=0;i<=1;i++){
                                                                                          mesh.children[i].material.visible=false;
                                                                                          };
                                                                                          mesh_left_ForceFace.children[0].material.visible=false;
                                                                                          mesh_left_ForceFace.children[1].material.visible=false;

                                                                                          mesh_TriFace1.children[0].material.visible=false;
                                                                                            mesh_TriFace2.children[0].material.visible=false;
                                                                                            mesh_TriFace3.children[0].material.visible=false;
                                                                                            mesh_TriFace4.children[0].material.visible=false;

                                                                                            for(i=1;i<=3;i++){
                                                                                                mesh_TriFace1.children[i].visible=false;
                                                                                                mesh_TriFace2.children[i].visible=false;
                                                                                                mesh_TriFace3.children[i].visible=false;
                                                                                                mesh_TriFace4.children[i].visible=false;
                                                                                            }

                                                                                          for(i=0;i<=1;i++){
                                                                                             mesh.children[i].material.visible=false;
                                                                                           }
                                                                                          for(i=0;i<=4;i++){
                                                                                            text_group1.children[1].material.visible=false;
                                                                                            text_group1.children[2].material.visible=false;
                                                                                            text_group1.children[3].material.visible=false;

                                                                                          }

                                                                                            Tube_group.children[11].material.visible=false;

                                                                                            Tube_group.children[14].material.visible=false;
                                                                                            Tube_group.children[20].material.visible=false;
                                                                                            Tube_group.children[9].material.visible=false;




                                                                                                      mesh_TriFace1.children[4].visible=false;
                                                                                                        mesh_TriFace2.children[4].visible=false;
                                                                                                        mesh_TriFace3.children[4].visible=false;
                                                                                                        mesh_TriFace4.children[4].visible=false;
                                                                                                       // controls_scale.Force_Arrow=false;


                                                                                                        //hide arrow

                                                                                                         //hide normal arrow


                                                                                                        for(i=1;i<=3;i++){
                                                                                                            mesh_TriFace1.children[i].visible=false;
                                                                                                            mesh_TriFace2.children[i].visible=false;
                                                                                                            mesh_TriFace3.children[i].visible=false;
                                                                                                            mesh_TriFace4.children[i].visible=false;
                                                                                                        }




                                                                                                        //point and edges

                                                                                                        Tube_group_right.traverse(function(obj) {//hide group
                                                                                                        if (obj.type === "Mesh") {
                                                                                                            obj.material.visible =false;
                                                                                                        }
                                                                                                    });

                                                                                                    step_group_2.traverse(function(obj) {//hide group
                                                                                                            if (obj.type === "Mesh") {
                                                                                                                obj.material.visible =false;
                                                                                                            }
                                                                                                            if (obj.type === "Line") {
                                                                                                                obj.material.visible =false;
                                                                                                            }
                                                                                                        });


                                                                                             }
                                                                                              else
                                                                                              {
                                                                                                for(i=0;i<=4;i++){
                                                                                                text_group1.children[1].material.visible=true;
                                                                                                text_group1.children[2].material.visible=true;
                                                                                                text_group1.children[3].material.visible=true;

                                                                                              }
                                                                                              mesh_left_ForceFace.children[0].material.visible=false;
                                                                                              mesh_left_ForceFace.children[1].material.visible=false;
                                                                                              Tube_group.children[9].material.visible=true;
                                                                                              Tube_group.children[1].material.visible=true;
                                                                                              Tube_group.children[4].material.visible=true;
                                                                                              Tube_group.children[7].material.visible=true;
                                                                                              Tube_group.children[10].material.visible=true;

                                                                                              }

                                                                                                                                                                                            });





        var TubePoints1 = [];
        TubePoints1.push(addControl(0,0,0));
        TubePoints1.push(addControl(0,0,1));

   
        var TubePoints2 = [];
        TubePoints2.push(addControl(0,0,0));
        TubePoints2.push(addControl(1,-1,-1));



        var TubePoints3 = [];
        TubePoints3.push(addControl(0,0,0));
        TubePoints3.push(addControl(-1.3660,-0.3660,-1));



        var TubePoints4 = [];
        TubePoints4.push(addControl(0,0,0));
        TubePoints4.push(addControl(0.3660,1.3660,-1));

        var newPoint1 = [];
        newPoint1.push(addControl(-1.7,-1,-1));
                
        var newPoint2 =[];
        newPoint2.push(addControl(-0.5,-2,-1));

        var newPoint3 = [];
        newPoint3.push(addControl(1.7,1,-1));

        var newPoint4 = [];
        newPoint4.push(addControl(0.5,2,-1));

        var newFP_B2;




        var P_A;


        var P_B;
        var P_C;
        var P_D;

        var L;

        var P_A_Right;
        var P_B_Right;
        var P_C_Right;
        var P_D_Right;

        var P_A_Left;
        var P_B_Left;
        var P_C_Left;
        var P_D_Left;

        var P_A_Left_Pair;
        var P_B_Left_Pair;
        var P_C_Left_Pair;
        var P_D_Left_Pair;






        var corePoint_temp=new THREE.Vector3(0,0,0);

        var mesh;

        var mesh_left_Cell1;
        var mesh_left_Cell2;
        var mesh_left_Cell3;
        var mesh_left_Cell4;




        function initModel() {



          var geometry = new THREE.PlaneBufferGeometry( 2, 2 );
          // var planeMaterial = new THREE.MeshLambertMaterial( { color: 0xdddddd } );
          var planeMaterial = new THREE.MeshLambertMaterial({
            color: 0x9a9b9c,
            shading: THREE.SmoothShading,
            side: THREE.DoubleSide
          })


        L=3;

        Cal_ForcesPnt();
        Force_move();

        P_A_Right=Pnt_copy(P_A);
        P_B_Right=Pnt_copy(P_B);
        P_C_Right=Pnt_copy(P_C);
        P_D_Right=Pnt_copy(P_D);


        var vertices = [
            P_A_Right,P_B_Right,P_C_Right,P_D_Right
        ];

        corePoint_body=new THREE.Vector3();

        corePoint_body.x=(P_A_Right.x+P_B_Right.x+P_C_Right.x+P_D_Right.x)/4;
        corePoint_body.y=(P_A_Right.y+P_B_Right.y+P_C_Right.y+P_D_Right.y)/4;
        corePoint_body.z=(P_A_Right.z+P_B_Right.z+P_C_Right.z+P_D_Right.z)/4;

        var faces = [
            new THREE.Face3(0, 1, 2),
            new THREE.Face3(0, 2, 3),
            new THREE.Face3(0, 1, 3),
            new THREE.Face3(2, 3, 1)
        ];


        var geom = new THREE.Geometry();
        geom.vertices = vertices;
        geom.faces = faces;
        geom.computeFaceNormals();


        var hex=0x009600;
        geom.faces[0].color.setHex(hex);


        for (i = 1;i<geom.faces.length;i++){

                var hex1="lightgrey";
                geom.faces[i].color.setHex(hex1);
            }


            //  var materials = new THREE.MeshBasicMaterial( {
            // vertexColors: THREE.FaceColors
            // } );


        var materials = [
            //new THREE.MeshLambertMaterial({color: 0x4d4dff, transparent: true}),
            new THREE.MeshBasicMaterial({color: "lightgrey", wireframe: true, transparent: true,opacity:0.001}),
            new THREE.MeshLambertMaterial({
            vertexColors: THREE.FaceColors,transparent: true,opacity:0.2,side:THREE.DoubleSide,depthWrite:false
            } )
        ];


         mesh = THREE.SceneUtils.createMultiMaterialObject(geom, materials);


         // var cubeEdges = new THREE.EdgesGeometry(geom, 1);

         // var edgesMtl =  new THREE.LineBasicMaterial({color: 0x4d4dff});

         //  // edgesMtl.depthTest = false; deep test
         // var cubeLine = new THREE.LineSegments(cubeEdges, edgesMtl);

         // mesh.add(cubeLine);
         mesh.children.forEach(function (e) {
             e.geometry.vertices = vertices;
             e.geometry.verticesNeedUpdate = true;

             // e.geometry.faces[0].color.set(0xff00ee);
             // e.geometry.facesNeedUpdate=true;
             e.geometry.elementsNeedUpdate = true;
             e.geometry.computeFaceNormals();
             //e.geometry.center();
         });

        mesh.children[0].castShadow=true;
        mesh.children[0].receiveShadow=false;



        //mesh.children[1].geometry.faces[0].color.set(0xFF6347);


        //scene2.add(mesh);




        L=controls_scale.scale;

        Cal_ForcesPnt();
        Force_move_left();

        P_A_Left=Pnt_copy(P_A);
        P_B_Left=Pnt_copy(P_B);
        P_C_Left=Pnt_copy(P_C);
        P_D_Left=Pnt_copy(P_D);





        var vertices_left = [
            P_A_Left,P_B_Left,P_C_Left,P_D_Left
        ];

        var faces_left = [
            new THREE.Face3(0, 1, 2),
            new THREE.Face3(0, 1, 3),
            new THREE.Face3(2, 3, 1),
            new THREE.Face3(0, 2, 3)
        ];

        var faces_step = [
            new THREE.Face3(0, 1, 2),
            new THREE.Face3(0, 1, 3),
            new THREE.Face3(2, 3, 1),
            new THREE.Face3(0, 2, 3)

        ];

        var geom_left = new THREE.Geometry();
        geom_left.vertices = vertices_left;
        geom_left.faces = faces_left;
        geom_left.computeFaceNormals();

        var geom_step = new THREE.Geometry();
        geom_step.vertices = vertices_left;
        geom_step.faces = faces_step;
        geom_step.computeFaceNormals();


        for (i = 0;i<geom_left.faces.length;i++){
                var hex =0x156289;
                geom_left.faces[i].color.setHex(hex);
            }

            //  var materials = new THREE.MeshBasicMaterial( {
            // vertexColors: THREE.FaceColors
            // } );





         var materials_left = [
            //new THREE.MeshLambertMaterial({color: 0x4d4dff, transparent: true}),
            new THREE.MeshBasicMaterial({color: "black", wireframe: true,transparent: true,opacity:0.5}),
            new THREE.MeshBasicMaterial( {
            vertexColors: THREE.FaceColors,transparent: true,opacity:0.1,side:THREE.DoubleSide,depthWrite:false
            } )
        ];

        var materials_step = [
          new THREE.MeshPhongMaterial({color: "black",transparent: true,opacity:0.5})
        ];


          mesh_left = new THREE.SceneUtils.createMultiMaterialObject(geom_left, materials_left);
          mesh_step = new THREE.SceneUtils.createMultiMaterialObject(geom_step, materials_step);

         // var cubeEdges = new THREE.EdgesGeometry(geom, 1);

         // var edgesMtl =  new THREE.LineBasicMaterial({color: 0x4d4dff});

         //  // edgesMtl.depthTest = false; deep test
         // var cubeLine = new THREE.LineSegments(cubeEdges, edgesMtl);

         // mesh.add(cubeLine);


        mesh_left.children[0].castShadow=true;
        mesh_left.children[0].receiveShadow=true;

        //scene.add(mesh_left);
        //scene.add(mesh_step);




        L=controls_scale.MaxScale-controls_scale.scale;

        Cal_ForcesPnt();
        Force_move_left();

        P_A_Left_Pair=Pnt_copy(P_A);
        P_B_Left_Pair=Pnt_copy(P_B);
        P_C_Left_Pair=Pnt_copy(P_C);
        P_D_Left_Pair=Pnt_copy(P_D);





        var vertices_left_pair = [
            P_A_Left_Pair,P_B_Left_Pair,P_C_Left_Pair,P_D_Left_Pair
        ];

        var faces_left_pair = [
            new THREE.Face3(0, 1, 2),
            new THREE.Face3(0, 1, 3),
            new THREE.Face3(2, 3, 1),
            new THREE.Face3(0, 2, 3)
        ];

        var geom_left_pair = new THREE.Geometry();
        geom_left_pair.vertices = vertices_left_pair;
        geom_left_pair.faces = faces_left_pair;
        geom_left_pair.computeFaceNormals();


        for (i = 0;i<geom_left_pair.faces.length;i++){
                var hex =0x156289;
                geom_left_pair.faces[i].color.setHex(hex);
            }

            //  var materials = new THREE.MeshBasicMaterial( {
            // vertexColors: THREE.FaceColors
            // } );





         var materials_left_pair = [
            //new THREE.MeshLambertMaterial({color: 0x4d4dff, transparent: true}),
            new THREE.MeshBasicMaterial({color: "black", wireframe: true,transparent: true,opacity:0.5}),
            new THREE.MeshBasicMaterial( {
            vertexColors: THREE.FaceColors,transparent: true,opacity:0.1,side:THREE.DoubleSide,depthWrite:false
            } )
        ];


          mesh_left_pair = new THREE.SceneUtils.createMultiMaterialObject(geom_left_pair, materials_left_pair);

         // var cubeEdges = new THREE.EdgesGeometry(geom, 1);

         // var edgesMtl =  new THREE.LineBasicMaterial({color: 0x4d4dff});

         //  // edgesMtl.depthTest = false; deep test
         // var cubeLine = new THREE.LineSegments(cubeEdges, edgesMtl);

         // mesh.add(cubeLine);


        mesh_left_pair.children[0].castShadow=true;
       // mesh_left_pair.children[0].receiveShadow=true;

        scene2.add(mesh_left_pair);


        var vertices_ForceFace = [
            new THREE.Vector3(0,0,0),TubePoints1[1],TubePoints2[1],TubePoints3[1],TubePoints4[1]
        ];

        var faces_left_ForceFace = [
            new THREE.Face3(0, 1, 2),
            new THREE.Face3(0, 1, 3),
            new THREE.Face3(0, 1, 4),
            new THREE.Face3(0, 2, 3),
            new THREE.Face3(0, 2, 4),
            new THREE.Face3(0, 3, 4)

        ];

        var geom_left_ForceFace = new THREE.Geometry();
        geom_left_ForceFace.vertices = vertices_ForceFace;
        geom_left_ForceFace.faces = faces_left_ForceFace;
        geom_left_ForceFace.computeFaceNormals();

        geom_left_ForceFace.faces[0].color.setHex(0x008000);
        geom_left_ForceFace.faces[1].color.setHex(0x008000);
        geom_left_ForceFace.faces[2].color.setHex(0x008000);


        for (i = 3;i<geom_left_ForceFace.faces.length;i++){
                var hex =0xCCCCCC;
                geom_left_ForceFace.faces[i].color.setHex(hex);
            }

            //  var materials = new THREE.MeshBasicMaterial( {
            // vertexColors: THREE.FaceColors
            // } );





         var materials_left_ForceFace = [
            //new THREE.MeshLambertMaterial({color: 0x4d4dff, transparent: true}),
            new THREE.MeshBasicMaterial({color: "grey", wireframe: true,transparent: true,opacity:0.1}),
            new THREE.MeshBasicMaterial( {
            vertexColors: THREE.FaceColors,transparent: true,opacity:0.3,side:THREE.DoubleSide,depthWrite:false
            } )
        ];


        mesh_left_ForceFace = new THREE.SceneUtils.createMultiMaterialObject(geom_left_ForceFace, materials_left_ForceFace);

         // var cubeEdges = new THREE.EdgesGeometry(geom, 1);

         // var edgesMtl =  new THREE.LineBasicMaterial({color: 0x4d4dff});

         //  // edgesMtl.depthTest = false; deep test
         // var cubeLine = new THREE.LineSegments(cubeEdges, edgesMtl);

         // mesh.add(cubeLine);




        scene.add(mesh_left_ForceFace);

        mesh_left_ForceFace.children[0].material.visible=false;
        mesh_left_ForceFace.children[1].material.visible=false;



        var Cell_left_ForceFace1 = [
                new THREE.Face3(0, 1, 4),
                new THREE.Face3(0, 1, 2),
                new THREE.Face3(0, 2, 4)
        ];

        var Cell_Test = [
                new THREE.Face3(1, 2, 4),

        ];

        var geom_left_ForceFace1 = new THREE.Geometry();
        geom_left_ForceFace1.vertices = vertices_ForceFace;
        geom_left_ForceFace1.faces = Cell_left_ForceFace1;
        geom_left_ForceFace1.computeFaceNormals();

        var geom_Cell_Test = new THREE.Geometry();
        geom_Cell_Test.vertices = vertices_ForceFace;
        geom_Cell_Test.faces = Cell_Test;
        geom_Cell_Test.computeFaceNormals();

        var materials_geom_Cell_Test = new THREE.MeshPhongMaterial( {
        color: "grey",transparent: true,opacity:0.2,side:THREE.DoubleSide,depthWrite:false})

        var Cell_test_1 = new THREE.Mesh(geom_Cell_Test, materials_geom_Cell_Test);

        Cell_test_1.scale.set(0.7,0.7,0.7);

  //      scene.add(Cell_test_1);

        for (i = 0;i<geom_left_ForceFace1.faces.length;i++){
                var hex =0xCCCCCC;
                geom_left_ForceFace1.faces[i].color.setHex(hex);
            }

            //  var materials = new THREE.MeshBasicMaterial( {
            // vertexColors: THREE.FaceColors
            // } );

         var materials_left_Cell1 = [
            //new THREE.MeshLambertMaterial({color: 0x4d4dff, transparent: true}),
            new THREE.MeshBasicMaterial({color: "white", wireframe: true,transparent: true,opacity:0.01}),
            new THREE.MeshPhongMaterial( {
            vertexColors: THREE.FaceColors,transparent: true,opacity:0.7,side:THREE.DoubleSide,depthWrite:false,
            //clippingPlanes:[clipPlanes],
						//clipIntersection: true
            } )
        ];


         mesh_left_Cell1 = new THREE.SceneUtils.createMultiMaterialObject(geom_left_ForceFace1, materials_left_Cell1);

         var Cell_left_ForceFace2 = [
                new THREE.Face3(0, 1, 3),
                new THREE.Face3(0, 1, 2),
                new THREE.Face3(0, 2, 3)

        ];

        var geom_left_ForceFace2= new THREE.Geometry();
        geom_left_ForceFace2.vertices = vertices_ForceFace;
        geom_left_ForceFace2.faces = Cell_left_ForceFace2;
        geom_left_ForceFace2.computeFaceNormals();


        for (i = 0;i<geom_left_ForceFace2.faces.length;i++){
                var hex =0xCCCCCC;
                geom_left_ForceFace2.faces[i].color.setHex(hex);
            }


         var materials_left_Cell2 = [
            //new THREE.MeshLambertMaterial({color: 0x4d4dff, transparent: true}),
            new THREE.MeshBasicMaterial({color: "white", wireframe: true,transparent: true,opacity:0.1}),
            new THREE.MeshBasicMaterial( {
            vertexColors: THREE.FaceColors,transparent: true,opacity:0.7,side:THREE.DoubleSide,depthWrite:false,
            // clippingPlanes:[clipPlanes],
						//clipIntersection: true
            } )
        ];


         mesh_left_Cell2 = new THREE.SceneUtils.createMultiMaterialObject(geom_left_ForceFace2, materials_left_Cell2);


         var Cell_left_ForceFace3 = [
                  new THREE.Face3(0, 1, 4),
                  new THREE.Face3(0, 1, 3),
                  new THREE.Face3(0, 3, 4)

        ];

        var geom_left_ForceFace3= new THREE.Geometry();
        geom_left_ForceFace3.vertices = vertices_ForceFace;
        geom_left_ForceFace3.faces = Cell_left_ForceFace3;
        geom_left_ForceFace3.computeFaceNormals();


        for (i = 0;i<geom_left_ForceFace3.faces.length;i++){
                var hex =0xCCCCCC;
                geom_left_ForceFace3.faces[i].color.setHex(hex);
            }


         var materials_left_Cell3 = [
            //new THREE.MeshLambertMaterial({color: 0x4d4dff, transparent: true}),
            new THREE.MeshBasicMaterial({color: "white", wireframe: true,transparent: true,opacity:0.1}),
            new THREE.MeshBasicMaterial( {
            vertexColors: THREE.FaceColors,transparent: true,opacity:0.7,side:THREE.DoubleSide,depthWrite:false,
          //  clippingPlanes:[clipPlanes],
					 // clipIntersection: true
            } )
        ];


         mesh_left_Cell3 = new THREE.SceneUtils.createMultiMaterialObject(geom_left_ForceFace3, materials_left_Cell3);

         var Cell_left_ForceFace4 = [
                  new THREE.Face3(0, 2, 3),
                  new THREE.Face3(0, 2, 4),
                  new THREE.Face3(0, 3, 4)

        ];

        var geom_left_ForceFace4= new THREE.Geometry();
        geom_left_ForceFace4.vertices = vertices_ForceFace;
        geom_left_ForceFace4.faces = Cell_left_ForceFace4;
        geom_left_ForceFace4.computeFaceNormals();


        for (i = 0;i<geom_left_ForceFace4.faces.length;i++){
                var hex =0xCCCCCC;
                geom_left_ForceFace4.faces[i].color.setHex(hex);
            }


         var materials_left_Cell4 = [
            //new THREE.MeshLambertMaterial({color: 0x4d4dff, transparent: true}),
            new THREE.MeshBasicMaterial({color: "white", wireframe: true,transparent: true,opacity:0.1}),
            new THREE.MeshBasicMaterial( {
            vertexColors: THREE.FaceColors,transparent: true,opacity:0.7,side:THREE.DoubleSide,depthWrite:false
            } )
        ];


         mesh_left_Cell4 = new THREE.SceneUtils.createMultiMaterialObject(geom_left_ForceFace4, materials_left_Cell4);

   

         mesh_left_Cell1.scale.set(0.7,0.7,0.7);
         mesh_left_Cell2.scale.set(0.7,0.7,0.7);
         mesh_left_Cell3.scale.set(0.7,0.7,0.7);
         mesh_left_Cell4.scale.set(0.7,0.7,0.7);


         mesh_left_Cell1.position.set(0.2,0,-0.05);

         mesh_left_Cell2.position.set(0,-0.2,-0.05);

         mesh_left_Cell3.position.set(-0.15,0.2,-0.05);

         mesh_left_Cell4.position.set(0,0,-0.2);

         scene.add(mesh_left_Cell1);
         scene.add(mesh_left_Cell2);
         scene.add(mesh_left_Cell3);
      //   scene.add(mesh_left_Cell4);

         for(i=0;i<2;i++)
            {
                mesh_left_Cell1.children[i].material.visible=false;
                mesh_left_Cell2.children[i].material.visible=false;
                mesh_left_Cell3.children[i].material.visible=false;
                mesh_left_Cell4.children[i].material.visible=false;

            }



                  redraw();

                  redraw_Force();

                  redraw_right();

                Tube_group_right.traverse(function(obj) {//hide group
                    if (obj.type === "Mesh") {
                        obj.material.visible =false;
                    }
                });








             // Transform control (a triad)
            trfm_ctrl = new THREE.TransformControls(camera, renderer.domElement);
            trfm_ctrl.addEventListener('change', render);

            trfm_ctrl.addEventListener('objectChange', function(e) {

                if(Math.abs(selectObj.position.x)<=2&&Math.abs(selectObj.position.y)<=2&&Math.abs(selectObj.position.z)<=2)
                {

            //     if(selectObj.name.charAt(2)==='1')
            //     {
            //          TubePoints1[1].x=selectObj.position.x;
            //          TubePoints1[1].y=selectObj.position.y;
            //          TubePoints1[1].z=selectObj.position.z;

            //          console.log("TubePoints1="+TubePoints1[1].z);

            //     }

            //    if(selectObj.name.charAt(2)==='2')
            //     {
            //          TubePoints2[1].x=selectObj.position.x;
            //          TubePoints2[1].y=selectObj.position.y;
            //          TubePoints2[1].z=selectObj.position.z;

            //          console.log("TubePoints2="+TubePoints2[1].z);

            //     }
            //     if(selectObj.name.charAt(2)==='3')
            //     {
            //          TubePoints3[1].x=selectObj.position.x;
            //          TubePoints3[1].y=selectObj.position.y;
            //          TubePoints3[1].z=selectObj.position.z;

            //          console.log("TubePoints3="+TubePoints3[1].z);

            //     }
            //     if(selectObj.name.charAt(2)==='4')
            //     {
            //          TubePoints4[1].x=selectObj.position.x;
            //          TubePoints4[1].y=selectObj.position.y;
            //          TubePoints4[1].z=selectObj.position.z;

            //          console.log("TubePoints4="+TubePoints4[1].z);

            //     }

                // if(selectObj.name.charAt(2)==='2')
                // {
                //      newFP_B2.x=selectObj.position.x;
                //      newFP_B2.y=selectObj.position.y;
                //      newFP_B2.z=selectObj.position.z;

                     

                // }

                // if(selectObj.name.charAt(2)==='7')
                // {
                //      newPoint2[0].x=selectObj.position.x;
                //      newPoint2[0].y=selectObj.position.y;
                //      newPoint2[0].z=selectObj.position.z;

                     

                // }
                // if(selectObj.name.charAt(2)==='8')
                // {
                //      newPoint3[0].x=selectObj.position.x;
                //      newPoint3[0].y=selectObj.position.y;
                //      newPoint3[0].z=selectObj.position.z;

                     

                // }
                // if(selectObj.name.charAt(2)==='9')
                // {
                //      newPoint4[0].x=selectObj.position.x;
                //      newPoint4[0].y=selectObj.position.y;
                //      newPoint4[0].z=selectObj.position.z;

                     

                // }

                redraw();
                if(controls_scale.Scale_face)
                    redraw_Force();
                if(controls_scale.Control_Face)
                    redraw_right();
                if(controls_scale.ForceFace_left)
                    redraw_Faces6();
                if(controls_scale.Cell_Faces)
                    redraw_Cell();
            }


            //render();
             });

            trfm_ctrl.addEventListener('mouseDown', (evt) => {
               
                  orbit_ctrl.enabled = false;
                  if(controls_scale.Pair_Control)
                  {

                   for(i=0;i<=1;i++){
                mesh_F1_pair.children[i].material.visible=false;
                mesh_F2_pair.children[i].material.visible=false;
                mesh_F3_pair.children[i].material.visible=false;
                mesh_F4_pair.children[i].material.visible=false;
                mesh_left_pair.children[i].material.visible=false;
            }

            redraw();
            for(i=0;i<=1;i++){
                mesh.children[i].material.visible=true;
            }

            // mesh_left_ForceFace.children.forEach(function (e) {
            //     e.geometry.vertices = vertices;
            //     e.geometry.verticesNeedUpdate = true;

            //     // e.geometry.faces[0].color.set(0xff00ee);
            //     // e.geometry.facesNeedUpdate=true;
            //     e.geometry.elementsNeedUpdate = true;
            //     e.geometry.computeFaceNormals();
            //     //e.geometry.center();
            // });

             Tube_group_pair.traverse(function(obj) {//hide group
                    if (obj.type === "Mesh") {
                        obj.material.visible =false;
                    }
                });

             for(i=0;i<=1;i++){
                mesh_F1.children[i].material.visible=false;
                mesh_F2.children[i].material.visible=false;
                mesh_F3.children[i].material.visible=false;
                mesh_F4.children[i].material.visible=false;
                mesh_left.children[i].material.visible=false;
            }
        }



                });
            trfm_ctrl.addEventListener('mouseUp', (evt) => {
            
                orbit_ctrl.enabled = true;
                });





         scene.add(trfm_ctrl);
         

        document.addEventListener('mousedown', onMouseDown);
        document.addEventListener('mouseup', onMouseUp);
        document.addEventListener('mousemove', onMouseMove);
        //document.addEventListener('wheel', onMouseWheel);
      
        document.oncontextmenu = function (event) {
            event.preventDefault();
        };



        var ambient = new THREE.AmbientLight(0xffffff );
        scene.add( ambient );
        scene2.add( ambient.clone() );

        var light = new THREE.DirectionalLight( 0xffffff );
        // light.position.set( 1, 1, 1 ).normalize();
        light.position.set( 0, 0, 20 );
        light.shadow.camera.left = -30; // or whatever value works for the scale of your scene
        light.shadow.camera.right = 30;
        light.shadow.camera.top = 30;
        light.shadow.camera.bottom = -30;
        light.shadow.camera.near = 0.01;
        light.shadow.camera.far = 100;
        light.castShadow = true;
         light.shadowMapHeight=4096;
         light.shadowMapWidth=4096;
        //light.shadow.map.width=512;
        //light.shadow.map.height=1000;

        scene.add( light );
        scene2.add( light.clone() );

        // var helper = new THREE.CameraHelper( light.shadow.camera );
        // scene1.add( helper );


        // ground plane for shadow effects
        var FLOOR = - 2.5;
        var geometry = new THREE.PlaneBufferGeometry( 100, 100 );
        // var planeMaterial = new THREE.MeshLambertMaterial( { color: 0xdddddd } );
        var planeMaterial = new THREE.ShadowMaterial();
        planeMaterial.opacity = 0.2;
        var ground = new THREE.Mesh( geometry, planeMaterial);
        ground.position.set( 0, 0, FLOOR);
        ground.rotation.x = 0;
        ground.scale.set( 100, 100, 100 );
        ground.castShadow = false;
        ground.receiveShadow = true;
        scene.add( ground );
        scene2.add( ground.clone() );




         for(i=0;i<=1;i++){

                mesh_left.children[i].material.visible=false;
            }
            mesh_F1.children[0].material.visible=false;
            mesh_F2.children[0].material.visible=false;
            mesh_F3.children[0].material.visible=false;
            mesh_F4.children[0].material.visible=false;
            for(i=0;i<=1;i++){




                mesh_left_pair.children[i].material.visible=false;
            }



                mesh_TriFace1.children[0].material.visible=false;
                mesh_TriFace2.children[0].material.visible=false;
                mesh_TriFace3.children[0].material.visible=false;
                mesh_TriFace4.children[0].material.visible=false;

                for(i=1;i<=3;i++){
                    mesh_TriFace1.children[i].visible=false;
                    mesh_TriFace2.children[i].visible=false;
                    mesh_TriFace3.children[i].visible=false;
                    mesh_TriFace4.children[i].visible=false;
                }










    }



        function createCircleFaceArrow(centerPt,radius,arr_dir)
        {

        var Vec_a=cross(arr_dir,new THREE.Vector3(1,0,0)); 

        if(Vec_a.x===0&&Vec_a.y===0&&Vec_a.z===0)
        {
            Vec_a=cross(arr_dir,new THREE.Vector3(0,1,0));
        }

        var Vec_b=cross(arr_dir,Vec_a);

        Vec_a.normalize();
        Vec_b.normalize();

       // console.log("vec_a,vec_b",Vec_a,Vec_b);

        var points = [];
        var length = 20;


        for (i = 0; i <= length; i++)
        {
            var Pts_Circle=new THREE.Vector3(0,0,0);
            Pts_Circle.x=centerPt.x + radius*Vec_a.x*Math.cos(Math.PI*1.5*i/length) + radius*Vec_b.x*Math.sin(Math.PI*1.5*i/length);
            Pts_Circle.y=centerPt.y + radius*Vec_a.y*Math.cos(Math.PI*1.5*i/length) + radius*Vec_b.y*Math.sin(Math.PI*1.5*i/length);
            Pts_Circle.z=centerPt.z + radius*Vec_a.z*Math.cos(Math.PI*1.5*i/length) + radius*Vec_b.z*Math.sin(Math.PI*1.5*i/length);

　　       points.push(Pts_Circle);

        }

        var geometrySpacedPoints = new THREE.BufferGeometry().setFromPoints(points);
        //var line2 = new THREE.Line( geometrySpacedPoints, material);

        var arcMaterial = new THREE.LineDashedMaterial({
                                 color: 0x00ff00,//color
                                 dashSize: 0.1,//size
                                gapSize: 0.05//gap size
                                 });



        var CircleMesh = new THREE.Line(geometrySpacedPoints,arcMaterial);

        //console.log("points=",points[1],points[5]);

        CircleMesh.computeLineDistances();//compute

        var arrow_material1=new THREE.MeshBasicMaterial( {
                color:  "white"//green
            } );

        // var CircleMesh=createCylinderMesh(points[0],points[1],arrow_material1,0.02,0.02);

        for(i=0;i<length;i++)
        {
            var CircleMesh1=createCylinderMesh(points[i],points[i+1],arrow_material1,0.005,0.005);
            CircleMesh.add(CircleMesh1);
        }

        var Arr_Pt1=new THREE.Vector3(0,0,0);

            Arr_Pt1.x=centerPt.x + radius*Vec_a.x*Math.cos(Math.PI*1.6*i/length) + radius*Vec_b.x*Math.sin(Math.PI*1.6*i/length);
            Arr_Pt1.y=centerPt.y + radius*Vec_a.y*Math.cos(Math.PI*1.6*i/length) + radius*Vec_b.y*Math.sin(Math.PI*1.6*i/length);
            Arr_Pt1.z=centerPt.z + radius*Vec_a.z*Math.cos(Math.PI*1.6*i/length) + radius*Vec_b.z*Math.sin(Math.PI*1.6*i/length);


        var face_arrow1=createCylinderArrowMesh(points[length],Arr_Pt1,arrow_material1,0.01,0.02,0.01);

        CircleMesh.add(face_arrow1);



        // CircleMesh.position.x=centerPt.x;
        // CircleMesh.position.y=centerPt.y;
        // CircleMesh.position.z=centerPt.z;
         //scene2.add(CircleMesh);

        return CircleMesh;


        }

        function createCircleFaceArrow2(centerPt,radius,arr_dir)
        {

        var Vec_a=cross(arr_dir,new THREE.Vector3(1,0,0)); 

        if(Vec_a.x===0&&Vec_a.y===0&&Vec_a.z===0)
        {
            Vec_a=cross(arr_dir,new THREE.Vector3(0,1,0));
        }

        var Vec_b=cross(arr_dir,Vec_a);

        Vec_a.normalize();
        Vec_b.normalize();

        // console.log("vec_a,vec_b",Vec_a,Vec_b);

        var points = [];
        var length = 20;


        for (i = 0; i <= length; i++)
        {
            var Pts_Circle=new THREE.Vector3(0,0,0);
            Pts_Circle.x=centerPt.x + radius*Vec_a.x*Math.cos(Math.PI*1.5*i/length) + radius*Vec_b.x*Math.sin(Math.PI*1.5*i/length);
            Pts_Circle.y=centerPt.y + radius*Vec_a.y*Math.cos(Math.PI*1.5*i/length) + radius*Vec_b.y*Math.sin(Math.PI*1.5*i/length);
            Pts_Circle.z=centerPt.z + radius*Vec_a.z*Math.cos(Math.PI*1.5*i/length) + radius*Vec_b.z*Math.sin(Math.PI*1.5*i/length);

        　　       points.push(Pts_Circle);

        }

        var geometrySpacedPoints = new THREE.BufferGeometry().setFromPoints(points);
        //var line2 = new THREE.Line( geometrySpacedPoints, material);

        var arcMaterial = new THREE.LineDashedMaterial({
                                 color: 0x00ff00,//color
                                 dashSize: 0.1,//size
                                gapSize: 0.05//gap size
                                 });



        var CircleMesh = new THREE.Line(geometrySpacedPoints,arcMaterial);

        //console.log("points=",points[1],points[5]);

        CircleMesh.computeLineDistances();//compute

        var arrow_material1=new THREE.MeshPhongMaterial( {
                color:  0x009600//green
            } );

        // var CircleMesh=createCylinderMesh(points[0],points[1],arrow_material1,0.02,0.02);

        for(i=0;i<length;i++)
        {
            var CircleMesh1=createCylinderMesh(points[i],points[i+1],arrow_material1,0.005,0.005);
            CircleMesh.add(CircleMesh1);
        }

        var Arr_Pt1=new THREE.Vector3(0,0,0);

            Arr_Pt1.x=centerPt.x + radius*Vec_a.x*Math.cos(Math.PI*1.6*i/length) + radius*Vec_b.x*Math.sin(Math.PI*1.6*i/length);
            Arr_Pt1.y=centerPt.y + radius*Vec_a.y*Math.cos(Math.PI*1.6*i/length) + radius*Vec_b.y*Math.sin(Math.PI*1.6*i/length);
            Arr_Pt1.z=centerPt.z + radius*Vec_a.z*Math.cos(Math.PI*1.6*i/length) + radius*Vec_b.z*Math.sin(Math.PI*1.6*i/length);


        var face_arrow1=createCylinderArrowMesh(points[length],Arr_Pt1,arrow_material1,0.01,0.02,0.01);

        CircleMesh.add(face_arrow1);



        // CircleMesh.position.x=centerPt.x;
        // CircleMesh.position.y=centerPt.y;
        // CircleMesh.position.z=centerPt.z;
         //scene2.add(CircleMesh);

        return CircleMesh;


        }



    function createCylinderMesh(pointX, pointY, material1, radius, radius2) {
    if (radius === undefined) {
        radius = 1;
    }

    if (radius2 === undefined) {
        radius2 = radius;
    }

    var direction = new THREE.Vector3().subVectors(pointY, pointX);
    var orientation = new THREE.Matrix4();
    orientation.lookAt(pointX, pointY, new THREE.Object3D().up);
    orientation.multiply(new THREE.Matrix4().set(1, 0, 0, 0,
        0, 0, 1, 0,
        0, -1, 0, 0,
        0, 0, 0, 1));
    var edgeGeometry = new THREE.CylinderGeometry(radius, radius2, direction.length(), 8, 1);
    var edge = new THREE.Mesh(edgeGeometry, material1);
    edge.applyMatrix4(orientation);
    // position based on midpoints - there may be a better solution than this
    edge.position.x = (pointY.x + pointX.x) / 2;
    edge.position.y = (pointY.y + pointX.y) / 2;
    edge.position.z = (pointY.z + pointX.z) / 2;


    //console.log("pos=", edge.position.x);
    return edge;
}



    function create_TriangleMesh(p1,p2,p3,direction,coreScale)
        {

            var corepoint=face_center(p1,p2,p3);



            var unit_direction=new THREE.Vector3();//normalize
            unit_direction.x=direction.x/norm(direction);
            unit_direction.y=direction.y/norm(direction);
            unit_direction.z=direction.z/norm(direction);


            // var Scale_direction=new THREE.Vector3();

            // Scale_direction.x=1.2*unit_direction.x;
            // Scale_direction.y=1.2*unit_direction.y;
            // Scale_direction.z=1.2*unit_direction.z;


            var direction1 = new THREE.Vector3().subVectors(coreScale, corepoint);
            var m = direction1.length();



            //var dis=distance(,);//dis

            //console.log("m=",m);


            //var m=Math.sqrt((dis*dis)/(norm(unit_direction)*norm(unit_direction)));


            // var out1=new THREE.Vector3();
            // out1.x=corepoint.x+0.2*unit_direction.x;
            // out1.y=corepoint.y+0.2*unit_direction.y;
            // out1.z=corepoint.z+0.2*unit_direction.z;

            // if(out1.length()<corepoint.length())
            // {
            //     unit_direction.multiplyScalar(-1);
            // }


            //point

            var p1_1=new THREE.Vector3();
            p1_1.x=p1.x+m*unit_direction.x;
            p1_1.y=p1.y+m*unit_direction.y;
            p1_1.z=p1.z+m*unit_direction.z;

            var p2_1=new THREE.Vector3();
            p2_1.x=p2.x+m*unit_direction.x;
            p2_1.y=p2.y+m*unit_direction.y;
            p2_1.z=p2.z+m*unit_direction.z;

            var p3_1=new THREE.Vector3();
            p3_1.x=p3.x+m*unit_direction.x;
            p3_1.y=p3.y+m*unit_direction.y;
            p3_1.z=p3.z+m*unit_direction.z;

            //console.log("p1=",p1,"p2=",p2,"p3=",p3,"p1_1=",p1_1,"p2_1=",p2_1,"p3_1=",p3_1,"direction",direction,"dis",dis);


      

            var vertices_tri=[
            p1,p2,p3,p1_1,p2_1,p3_1
            ];

            var faces_tri=[
            new THREE.Face3(0, 1, 2),
            new THREE.Face3(0, 4, 1),
            new THREE.Face3(2, 1, 4),
            new THREE.Face3(0, 3, 4),
            new THREE.Face3(2, 4, 5),
            new THREE.Face3(0, 3, 5),
            new THREE.Face3(2, 0, 5),
            new THREE.Face3(3, 4, 5)

            ];



            var geom_tri = new THREE.Geometry();
            geom_tri.vertices = vertices_tri;
            geom_tri.faces = faces_tri;
            geom_tri.computeFaceNormals();


        for (i = 0;i<geom_tri.faces.length;i++){
                var hex =0x156289;
                geom_tri.faces[i].color.setHex(hex);
            }

            //  var materials = new THREE.MeshBasicMaterial( {
            // vertexColors: THREE.FaceColors
            // } );





         var materials_tri = [
            //new THREE.MeshLambertMaterial({color: 0x4d4dff, transparent: true}),
    //       new THREE.MeshBasicMaterial({color: 0x156289, wireframe: true,transparent: true,opacity:0.001}),
            new THREE.MeshPhongMaterial( {
            vertexColors: THREE.FaceColors,transparent: true,opacity:0.1,side:THREE.DoubleSide
            } )
        ];



          var mesh_tri = new THREE.SceneUtils.createMultiMaterialObject(geom_tri, materials_tri);


            //var polyhedron =createMesh(new THREE.PolyhedronGeometry(vertices,faces));
            return mesh_tri;

        }



    function create_Tri_FaceMesh(p1,p2,p3,arr_face_dir,Is_First,arr_dir,text)
        {

            var corepoint=face_center(p1,p2,p3);
            var m = 0.2;

 
            var dirA=new THREE.Vector3().subVectors(corepoint,p1);
            var dirB=new THREE.Vector3().subVectors(corepoint,p2);
            var dirC=new THREE.Vector3().subVectors(corepoint,p3);

            dirA.normalize();
            dirB.normalize();
            dirC.normalize();

            // var unit_dir1=new THREE.Vector3();//normalize
            // unit_dir1.x=dirA.x/norm(dirA);
            // unit_dir1.y=dirA.y/norm(dirA);
            // unit_dir1.z=dirA.z/norm(dirA);

            // var unit_dir2=new THREE.Vector3();//normalize
            // unit_dir2.x=dirB.x/norm(dirB);
            // unit_dir2.y=dirB.y/norm(dirB);
            // unit_dir2.z=dirB.z/norm(dirB);

            // var unit_dir3=new THREE.Vector3();//normalize
            // unit_dir3.x=dirC.x/norm(dirC);
            // unit_dir3.y=dirC.y/norm(dirC);
            // unit_dir3.z=dirC.z/norm(dirC);


            //point

            var p1_1=new THREE.Vector3();
           // p1_1=subVec(p1,m*unit_dir1);
            p1_1.x=p1.x+m*dirA.x;
            p1_1.y=p1.y+m*dirA.y;
            p1_1.z=p1.z+m*dirA.z;

            var p2_1=new THREE.Vector3();
            p2_1.x=p2.x+m*dirB.x;
            p2_1.y=p2.y+m*dirB.y;
            p2_1.z=p2.z+m*dirB.z;

            var p3_1=new THREE.Vector3();
            p3_1.x=p3.x+m*dirC.x;
            p3_1.y=p3.y+m*dirC.y;
            p3_1.z=p3.z+m*dirC.z;



            var vertices_tri=[
            p1_1,p2_1,p3_1
            ];

            var faces_tri=[
            new THREE.Face3(2,1,0),

            ];


            var geom_tri = new THREE.Geometry();
            geom_tri.vertices = vertices_tri;
            geom_tri.faces = faces_tri;
            geom_tri.computeFaceNormals();


            for (i = 0;i<geom_tri.faces.length;i++){
            if(Is_First)
            {
                var hex =0x008000;
                geom_tri.faces[i].color.setHex(hex);
            }
            else
            {
                var hex =0xa9a9a9;
                geom_tri.faces[i].color.setHex(hex);
                }

            }

            //  var materials = new THREE.MeshBasicMaterial( {
            // vertexColors: THREE.FaceColors
            // } );

            var materials_tri = [
            //new THREE.MeshLambertMaterial({color: 0x4d4dff, transparent: true}),
            // new THREE.MeshBasicMaterial({color: 0x4d4dff, wireframe: true,transparent: true,opacity:0.05}),
            new THREE.MeshBasicMaterial( {
            vertexColors: THREE.FaceColors,transparent: true,opacity:0.2,side:THREE.DoubleSide
            } )
            ];

            var mesh_tri = new THREE.SceneUtils.createMultiMaterialObject(geom_tri, materials_tri);

            // return mesh_tri;

            //arrowHelper1.add(mesh_tri)

            //var arrowHelper1;


            //var length = 1;
            // var hex = 0x000000;
            if(Is_First)

            var arr_face_material=new THREE.MeshPhongMaterial( {
                color:  0x009600//force face green
            } );
            else
            var arr_face_material=new THREE.MeshPhongMaterial( {
                color:  0x000000//force face 
            } );

            var arr_material2;

                if(arr_dir<0)
                {
                    arrow_material2=new THREE.MeshPhongMaterial( {
                color: 0xC00000
                });

                }
                else
                {
                    arrow_material2=new THREE.MeshPhongMaterial( {

                color: 0x0F3150
                });

                }



            var forceFaceDir=Pnt_copy(arr_face_dir);
            forceFaceDir.normalize();

                var out1=new THREE.Vector3();
                out1.x=corepoint.x+0.2*forceFaceDir.x;
                out1.y=corepoint.y+0.2*forceFaceDir.y;
                out1.z=corepoint.z+0.2*forceFaceDir.z;


                var out2=new THREE.Vector3();
                out2.x=corepoint.x-0.2*forceFaceDir.x;
                out2.y=corepoint.y-0.2*forceFaceDir.y;
                out2.z=corepoint.z-0.2*forceFaceDir.z;

                var out1_core=new THREE.Vector3().subVectors(out1,corePoint_body);
                var out2_core=new THREE.Vector3().subVectors(out2,corePoint_body);

                if(out1_core.length()>out2_core.length())//朝外
                {


                var arrowHP1=createCylinderArrowMesh(p3_1,p1_1,arr_face_material,0.01,0.03,0.9);//face arrow

                // var direction1 = new THREE.Vector3().subVectors(p1_1, p3_1);
                // var length1=direction1.length();
                // direction1.normalize();
                // var arrowHelper1 = new THREE.ArrowHelper(direction1, p3_1, length1,hex,0.2,0.05);
               mesh_tri.add(arrowHP1);

                // var direction2 = new THREE.Vector3().subVectors(p3_1, p2_1);
                // var length2=direction2.length();
                // direction2.normalize();
                // var arrowHelper2 = new THREE.ArrowHelper(direction2, p2_1, length2,hex,0.2,0.05);
                 var arrowHP2=createCylinderArrowMesh(p2_1,p3_1,arr_face_material,0.01,0.03,0.9);//face arrow
                mesh_tri.add(arrowHP2);

                // var direction3 = new THREE.Vector3().subVectors(p2_1, p1_1);
                // var length3=direction3.length();
                // direction3.normalize();
                // var arrowHelper3 = new THREE.ArrowHelper(direction3, p1_1, length3,hex,0.2,0.05);
                 var arrowHP3=createCylinderArrowMesh(p1_1,p2_1,arr_face_material,0.01,0.03,0.9);//face arrow
                mesh_tri.add(arrowHP3);

                 //normal

                var corepoint2=new THREE.Vector3();
                corepoint2.x=corepoint.x+0.4*forceFaceDir.x;
                corepoint2.y=corepoint.y+0.4*forceFaceDir.y;
                corepoint2.z=corepoint.z+0.4*forceFaceDir.z;

                var corepoint3=new THREE.Vector3();
                corepoint3.x=corepoint.x+0.37*forceFaceDir.x;
                corepoint3.y=corepoint.y+0.37*forceFaceDir.y;
                corepoint3.z=corepoint.z+0.37*forceFaceDir.z;



                //=new THREE.ArrowHelper(forceFaceDir,corepoint,0.5*forceFaceDir.length(),0x00ff00,0.2,0.1);
                if(Is_First)//arrow 
                {
                    var arrow_material1=new THREE.MeshPhongMaterial( {
                color: 0x009600
            } );
                 var arrowN=createCylinderArrowMesh(corepoint,corepoint2,arrow_material1,0.02,0.05,0.6);
                 //
                }
                else
                 var arrowN=createCylinderArrowMesh(corepoint,corepoint2,arrow_material2,0.02,0.05,0.6);


                mesh_tri.add(arrowN);

                if(Is_First)//arrow 
                {
                    var arrow_material_outline= new THREE.MeshBasicMaterial( { color: "white", transparent: false, side: THREE.BackSide } );
                 var arrowN_O=createCylinderArrowMesh(corepoint,corepoint3,arrow_material_outline,0.025,0.05,0.55);
                 //
                }
                else
                    var arrow_material_outline= new THREE.MeshBasicMaterial( { color: "white", transparent: false, side: THREE.BackSide } );
                    var arrowN_O=createCylinderArrowMesh(corepoint,corepoint3,arrow_material_outline,0.025,0.05,0.55);



                mesh_tri.add(arrowN_O);
                arrowN_O.scale.multiplyScalar(1.2);

                var TXMesh=createSpriteText(text,corepoint2);

                text_group2.add(TXMesh);

                //face arrow

                 var cir_dir=new THREE.Vector3().subVectors(corepoint,p1);
                cir_dir.normalize();

                var arrowpt=new THREE.Vector3();
                arrowpt.x=corepoint.x+0.2*cir_dir.x;
                arrowpt.y=corepoint.y+0.2*cir_dir.y;
                arrowpt.z=corepoint.z+0.2*cir_dir.z;

                     //arr_dir.normalize();

                var direction1=cir_dir.applyAxisAngle(forceFaceDir,Math.PI/2);

             //var direction1 = new THREE.Vector3().subVectors(p1, p2);
                var length1=0.001;
                direction1.normalize();
                var arrowHelper1 = new THREE.ArrowHelper(direction1, arrowpt, length1,"black",0.1,0.05);

        //        mesh_tri.add(arrowHelper1);


               //circle arrow

               var circle_mesh=createCircleFaceArrow(corepoint,0.1,forceFaceDir);
               mesh_tri.add(circle_mesh);

               //var step_1=createCircleFaceArrow2(TubePoints1[1],0.2,forceFaceDir);
              // Tube_group.add(step_1);


                }
                else
                {

                // var direction1 = new THREE.Vector3().subVectors(p2_1, p1_1);
                // var length1=direction1.length();
                // direction1.normalize();
                // var arrowHelper1 = new THREE.ArrowHelper(direction1, p1_1, length1,hex,0.1,0.05);
                var arrowHP1=createCylinderArrowMesh(p1_1,p2_1,arr_face_material,0.01,0.03,0.9);//face arrow
                mesh_tri.add(arrowHP1);

                // var direction2 = new THREE.Vector3().subVectors(p3_1, p2_1);
                // var length2=direction2.length();
                // direction2.normalize();
                // var arrowHelper2 = new THREE.ArrowHelper(direction2, p2_1, length2,hex,0.1,0.05);
                var arrowHP2=createCylinderArrowMesh(p2_1,p3_1,arr_face_material,0.01,0.03,0.9);//face arrow
                mesh_tri.add(arrowHP2);



                // var direction3 = new THREE.Vector3().subVectors(p1_1, p3_1);
                // var length3=direction3.length();
                // direction3.normalize();
                // var arrowHelper3 = new THREE.ArrowHelper(direction3, p3_1, length3,hex,0.1,0.05);
                var arrowHP3=createCylinderArrowMesh(p3_1,p1_1,arr_face_material,0.01,0.03,0.9);//face arrow
                mesh_tri.add(arrowHP3);



                var corepoint2=new THREE.Vector3();
                corepoint2.x=corepoint.x-0.4*forceFaceDir.x;
                corepoint2.y=corepoint.y-0.4*forceFaceDir.y;
                corepoint2.z=corepoint.z-0.4*forceFaceDir.z;

                var corepoint3=new THREE.Vector3();
                corepoint3.x=corepoint.x-0.37*forceFaceDir.x;
                corepoint3.y=corepoint.y-0.37*forceFaceDir.y;
                corepoint3.z=corepoint.z-0.37*forceFaceDir.z;

                if(Is_First)//arrow 
                {
                    var arrow_material1=new THREE.MeshPhongMaterial( {
                color: 0x009600
            } );
                 //var arrowN=createCylinderArrowMesh(corepoint,corepoint2,arrow_material1,0.02,0.05,0.7);
                 var arrowN=createCylinderArrowMesh(corepoint2,corepoint,arrow_material1,0.02,0.05,0.6);

                }
                else
                 var arrowN=createCylinderArrowMesh(corepoint2,corepoint,arrow_material2,0.02,0.05,0.6);


                //=new THREE.ArrowHelper(forceFaceDir,corepoint,0.5*forceFaceDir.length(),0x00ff00,0.2,0.1);



                //normal

                //var dirN=cross(direction2,direction1);

                //dirN.normalize();


                //var arrowN=new THREE.ArrowHelper(forceFaceDir,corepoint,0.5*forceFaceDir.length(),0x00ff00,0.2,0.1);
                mesh_tri.add(arrowN);

                if(Is_First)//arrow 
                {
                    var arrow_material_outline= new THREE.MeshBasicMaterial( { color: "white", transparent: false, side: THREE.BackSide } );
                 var arrowN_O=createCylinderArrowMesh(corepoint3,corepoint,arrow_material_outline,0.025,0.05,0.55);
                 //
                }
                else
                    var arrow_material_outline= new THREE.MeshBasicMaterial( { color: "white", transparent: false, side: THREE.BackSide } );
                    var arrowN_O=createCylinderArrowMesh(corepoint3,corepoint,arrow_material_outline,0.025,0.05,0.55);



                mesh_tri.add(arrowN_O);
                arrowN_O.scale.multiplyScalar(1.2);

                var TXMesh1=createSpriteText(text,corepoint2);

                text_group2.add(TXMesh1);

                // var Line_center=new THREE.Vector3((p1.x+p2.x)/2,(p1.y+p2.y)/2,(p1.z+p2.z)/2);

                var cir_dir=new THREE.Vector3().subVectors(corepoint,p1);
                cir_dir.normalize();

                var arrowpt=new THREE.Vector3();
                arrowpt.x=corepoint.x+0.2*cir_dir.x;
                arrowpt.y=corepoint.y+0.2*cir_dir.y;
                arrowpt.z=corepoint.z+0.2*cir_dir.z;

                     //arr_dir.normalize();

                var direction1=cir_dir.applyAxisAngle(forceFaceDir,Math.PI/2);

             //var direction1 = new THREE.Vector3().subVectors(p1, p2);
                var length1=0.001;
                direction1.normalize();
               var arrowHelper1 = new THREE.ArrowHelper(direction1, arrowpt, length1,"black",0.1,0.1);

    //            mesh_tri.add(arrowHelper1);


               //circle arrow

               var circle_mesh=createCircleFaceArrow(corepoint,0.1,forceFaceDir);
               mesh_tri.add(circle_mesh);

            

              // var step_1=createCircleFaceArrow2(TubePoints1[1],0.4,Force_face_dir[0]);
              // Tube_group.add(step_1);


                }







            //normal



            return mesh_tri;



        







        }

        var fontloaded;


        function createTextMesh(text,position)
        {



            //var text = "three.js";
            var loader = new THREE.FontLoader();
            var posdir=Pnt_copy(position);

            posdir.normalize();





            loader.load('libs/fonts/optimer_regular.typeface.json', function (font1) {



        // mat
            var fontMaterial = new THREE.MeshLambertMaterial({
                color: 0x2F4F4F,
                side: THREE.DoubleSide
            });


            var options={


                size: 0.15, //size
                height: 0.04, //h
                weight: 'normal', //bold
                font: font1, //type
                style: 'italics', //type
                bevelThickness: 0.01, //th
                bevelSize: 0.01, //wide
                curveSegments: 10,//seg
                bevelEnabled: true, //true

            }

            //var text1 = new THREE.FontLoader().load('libs/fonts/helvetiker_bold.typeface.json', function(text) {
            var gem = new THREE.TextGeometry(text, options);


      
             var font2 = new THREE.Mesh(gem, fontMaterial);


        font2.position.x =position.x+0.5*posdir.x; //* (fontGeometry.boundingBox.max.x - fontGeometry.boundingBox.min.x);
        font2.position.y =position.y+0.5*posdir.y;
        font2.position.z =position.z+0.5*posdir.z;
        font2.rotation.x=Math.PI/2;
        font2.rotation.y=Math.PI/2;

        text_group1.add(font2);


    });





            //return font;





}

       function createSpriteText(text,pos){
        //canvas
        var canvas = document.createElement("canvas");
        canvas.width=240;
        canvas.height=240;
        var ctx = canvas.getContext("2d");
        ctx.fillStyle = "grey";
        ctx.font = "Bold 100px Palatino";
        ctx.lineWidth = 2;
        ctx.fillText(text.charAt(0),150,150);
        ctx.fillStyle = "grey";
        ctx.font = "50px Palatino";
        ctx.lineWidth = 2;
        ctx.fillText(text.charAt(1),210,170);

        var texture = new THREE.Texture(canvas);
        texture.needsUpdate = true;

        //sprite
        var material = new THREE.SpriteMaterial({map:texture,transparent:true});
        var textObj = new THREE.Sprite(material);
         textObj.scale.set(0.5, 0.5, 0.5);


        //textObj.position.set(pos1);

        var posdir=Pnt_copy(pos);

            posdir.normalize();

        textObj.position.x =pos.x+0.2*posdir.x; //* (fontGeometry.boundingBox.max.x - fontGeometry.boundingBox.min.x);
        textObj.position.y =pos.y+0.3*posdir.y;
        textObj.position.z =pos.z+0.1*posdir.z;


        return textObj;
}


function createSpriteText3(text,pos){
 //canvas
 var canvas = document.createElement("canvas");
 canvas.width=240;
 canvas.height=240;
 var ctx = canvas.getContext("2d");
 ctx.fillStyle = "black";
 ctx.font = "Bold 100px Palatino";
 ctx.lineWidth = 2;
 ctx.fillText(text.charAt(0),150,150);
 ctx.fillStyle = "black";
 ctx.font = "50px Palatino";
 ctx.lineWidth = 2;
 ctx.fillText(text.charAt(1),190,170);

 var texture = new THREE.Texture(canvas);
 texture.needsUpdate = true;

 //sprite
 var material = new THREE.SpriteMaterial({map:texture,transparent:true});
 var textObj = new THREE.Sprite(material);
  textObj.scale.set(0.5, 0.5, 0.5);


   //textObj.position.set(pos1);

   var posdir=Pnt_copy(pos);

       posdir.normalize();

   textObj.position.x =pos.x+0.18*posdir.x; //* (fontGeometry.boundingBox.max.x - fontGeometry.boundingBox.min.x);
   textObj.position.y =pos.y+0.18*posdir.y;
   textObj.position.z =pos.z+0.18*posdir.z;


   return textObj;
  }

  function createSpriteText5(text,pos){
 //canvas
 var canvas = document.createElement("canvas");
 canvas.width=240;
 canvas.height=240;
 var ctx = canvas.getContext("2d");
 ctx.fillStyle = "black";
 ctx.font = "Bold 100px Palatino";
 ctx.lineWidth = 2;
 ctx.fillText(text.charAt(0),150,150);
 ctx.fillStyle = "black";
 ctx.font = "50px Palatino";
 ctx.lineWidth = 2;
 ctx.fillText(text.charAt(1),190,170);

 var texture = new THREE.Texture(canvas);
 texture.needsUpdate = true;

 //sprite
 var material = new THREE.SpriteMaterial({map:texture,transparent:true});
 var textObj = new THREE.Sprite(material);
  textObj.scale.set(0.5, 0.5, 0.5);


   //textObj.position.set(pos1);

   var posdir=Pnt_copy(pos);

       posdir.normalize();

   textObj.position.x =pos.x+0.5*posdir.x; //* (fontGeometry.boundingBox.max.x - fontGeometry.boundingBox.min.x);
   textObj.position.y =pos.y+0.5*posdir.y;
   textObj.position.z =pos.z+0.5*posdir.z;


   return textObj;
  }

  function createSpriteText6(text,pos){
 //canvas
 var canvas = document.createElement("canvas");
 canvas.width=240;
 canvas.height=240;
 var ctx = canvas.getContext("2d");
 ctx.fillStyle = "black";
 ctx.font = "Bold 100px Palatino";
 ctx.lineWidth = 2;
 ctx.fillText(text.charAt(0),150,150);
 ctx.fillStyle = "black";
 ctx.font = "50px Palatino";
 ctx.lineWidth = 2;
 ctx.fillText(text.charAt(1),190,170);

 var texture = new THREE.Texture(canvas);
 texture.needsUpdate = true;

 //sprite
 var material = new THREE.SpriteMaterial({map:texture,transparent:true});
 var textObj = new THREE.Sprite(material);
  textObj.scale.set(0.5, 0.5, 0.5);


   //textObj.position.set(pos1);

   var posdir=Pnt_copy(pos);

       posdir.normalize();

   textObj.position.x =pos.x+0.2*posdir.x; //* (fontGeometry.boundingBox.max.x - fontGeometry.boundingBox.min.x);
   textObj.position.y =pos.y+0.2*posdir.y;
   textObj.position.z =pos.z+0.2*posdir.z;


   return textObj;
  }

  function createSpriteText4(text,pos){
   //canvas
   var canvas = document.createElement("canvas");
   canvas.width=240;
   canvas.height=240;
   var ctx = canvas.getContext("2d");
   ctx.fillStyle = 0xDCDCDC;
   ctx.font = "80px Arial";
   ctx.lineWidth = 2;
   ctx.fillText(text.charAt(0),150,150);
   ctx.fillStyle = 0xDCDCDC;
   ctx.font = "50px Arial";
   ctx.lineWidth = 2;
   ctx.fillText(text.charAt(1),190,150);

   var texture = new THREE.Texture(canvas);
   texture.needsUpdate = true;

   //sprite
   var material = new THREE.SpriteMaterial({map:texture,transparent:true});
   var textObj = new THREE.Sprite(material);
    textObj.scale.set(0.5, 0.5, 0.5);


     //textObj.position.set(pos1);

     var posdir=Pnt_copy(pos);

         posdir.normalize();

     textObj.position.x =pos.x+0.1*posdir.x; //* (fontGeometry.boundingBox.max.x - fontGeometry.boundingBox.min.x);
     textObj.position.y =pos.y+0.1*posdir.y;
     textObj.position.z =pos.z+0.1*posdir.z;


     return textObj;
    }

 function createSpriteText1(text,pos){
        //canvas
        var canvas = document.createElement("canvas");
        canvas.width=240;
        canvas.height=240;
        var ctx = canvas.getContext("2d");
        ctx.fillStyle = "grey";
        ctx.font = "Bold 100px Palatino";
        ctx.lineWidth = 2;
        ctx.fillText(text,150,150);


        var texture = new THREE.Texture(canvas);
        texture.needsUpdate = true;

        //sprite
        var material = new THREE.SpriteMaterial({map:texture,transparent:true});
        var textObj = new THREE.Sprite(material);
         textObj.scale.set(0.5, 0.5, 0.5);


        //textObj.position.set(pos1);

        var posdir=Pnt_copy(pos);

            posdir.normalize();

        textObj.position.x =pos.x+0.1*posdir.x; //* (fontGeometry.boundingBox.max.x - fontGeometry.boundingBox.min.x);
        textObj.position.y =pos.y+0.1*posdir.y;
        textObj.position.z =pos.z+0.1*posdir.z;


        return textObj;
}

function createSpriteTextstep1(text,pos){
       //canvas
       var canvas = document.createElement("canvas");
       canvas.width=240;
       canvas.height=240;
       var ctx = canvas.getContext("2d");
       ctx.fillStyle = "grey";
       ctx.font = "100px Palatino";
       ctx.lineWidth = 2;
       ctx.fillText(text,150,150);


       var texture = new THREE.Texture(canvas);
       texture.needsUpdate = true;

       //sprite
       var material = new THREE.SpriteMaterial({map:texture,transparent:true});
       var textObj = new THREE.Sprite(material);
        textObj.scale.set(0.5, 0.5, 0.5);


       //textObj.position.set(pos1);

       var posdir=Pnt_copy(pos);

           posdir.normalize();

       textObj.position.x =pos.x+0.1*posdir.x; //* (fontGeometry.boundingBox.max.x - fontGeometry.boundingBox.min.x);
       textObj.position.y =pos.y+0.1*posdir.y;
       textObj.position.z =pos.z+0.1*posdir.z;


       return textObj;
}

        function createTextMesh1(text,position)
        {



            //var text = "three.js";
            var loader = new THREE.FontLoader();
            var posdir=Pnt_copy(position);

            posdir.normalize();





            loader.load('libs/fonts/optimer_regular.typeface.json', function (font1) {



        // mat
            var fontMaterial = new THREE.MeshLambertMaterial({
                color: 0x2F4F4F,
                side: THREE.DoubleSide
            });


            var options={

                size: 0.1, //size
                height: 0.03, //h
                weight: 'normal', //bold
                font: font1, //type
                style: 'italics', //type
                bevelThickness: 0.01, //th
                bevelSize: 0.01, //wide
                curveSegments: 10,//seg
                bevelEnabled: true, //true

            }

            //var text1 = new THREE.FontLoader().load('libs/fonts/helvetiker_bold.typeface.json', function(text) {
            var gem = new THREE.TextGeometry(text, options);


             var font2 = new THREE.Mesh(gem, fontMaterial);

      

        font2.position.x =position.x+0.1*posdir.x; //* (fontGeometry.boundingBox.max.x - fontGeometry.boundingBox.min.x);
        font2.position.y =position.y+0.1*posdir.y;
        font2.position.z =position.z+0.1*posdir.z;
        font2.rotation.x=Math.PI/2;
        font2.rotation.y=Math.PI/2;

        text_group2.add(font2);


    });





            //return font;





}


       

    function createCylinderArrowMesh(pointX, pointY, material, radius, radiusCone, edgeLengthRatio) {

    var direction = new THREE.Vector3().subVectors(pointY, pointX);
    var l = direction.length();

    if (radius === undefined) {
        radius = l * 0.01;
    }

    // fixedConeLength = fixedConeLength !== undefined ? fixedConeLength : 4;

    if (radiusCone === undefined) {
        radiusCone = 2 * radius;
    }

    // edgeLengthRatio = edgeLengthRatio !== undefined ? edgeLengthRatio : 0.7 ;

    var pointMid = new THREE.Vector3().addVectors(pointX, edgeLengthRatio * direction);

    var orientation = new THREE.Matrix4();
    orientation.lookAt(pointX, pointY, new THREE.Object3D().up);
    orientation.multiply(new THREE.Matrix4().set(1, 0, 0, 0,
        0, 0, 1, 0,
        0, -1, 0, 0,
        0, 0, 0, 1));

    var edgeGeometry;
    var coneGeometry;
    if (edgeLengthRatio !== undefined) {
        edgeGeometry = new THREE.CylinderGeometry(radius, radius, edgeLengthRatio * l, 8, 1);
        coneGeometry = new THREE.CylinderGeometry(0, radiusCone, (1-edgeLengthRatio) * l, 8, 1);
        edgeGeometry.translate( 0,  -(0.5 - 0.5 * edgeLengthRatio) * l, 0 );
        var translate = new THREE.Matrix4().makeTranslation( 0,  (0.5 - 0.5 * (1 - edgeLengthRatio)) * l, 0 );
        edgeGeometry.merge(coneGeometry, translate);
    } else {
        // fixed length cone
        var fixedConeLength = 1;
        edgeGeometry = new THREE.CylinderGeometry(radius, radius, l - fixedConeLength, 8, 1);
        coneGeometry = new THREE.CylinderGeometry(0, radiusCone, fixedConeLength, 8, 1);
        edgeGeometry.translate( 0, - 0.5 * fixedConeLength, 0 );
        var translate = new THREE.Matrix4().makeTranslation( 0, 0.5 * (l - fixedConeLength), 0 );
        edgeGeometry.merge(coneGeometry, translate);
    }



    var arrow = new THREE.Mesh(edgeGeometry, material);

    arrow.applyMatrix4(orientation);

    arrow.position.x = (pointY.x + pointX.x) / 2;
    arrow.position.y = (pointY.y + pointX.y) / 2;
    arrow.position.z = (pointY.z + pointX.z) / 2;



    return arrow;
}

window.addEventListener( 'keydown', function ( event ) {

    switch ( event.keyCode ) {

            case 87: // W
            trfm_ctrl.detach();
                //scene.remove(trfm_ctrl);
                break;


            }

      } );




        var leftMouseDown, rightMouseDown;
        var selectObj=null;
        var lastPosition;
        var lastIntersection, nowIntersection;
        var mouseX, mouseY;
        var control;
       // var mouse = new THREE.Vector2();

        function onMouseDown(event) {
            //event.preventDefault();

            rayCaster.setFromCamera(mouse, camera);


            //var rayCaster = getRay(event);
            var intersects = rayCaster.intersectObjects(Ctrl_pts);
            
            if (event.button === 2) { 

                trfm_ctrl.detach();





            }



                //document.addEventListener('mousemove', onMouseMove);


         
            if (event.button === 0&&intersects[0]) {



                selectObj = intersects[0].object;
                console.log("selectobj.name="+intersects[0].object.name.charAt(2));
                //leftMouseDown = true;
                lastPosition = selectObj.position;
                //lastIntersection = getIntersection(event);

                if(controls_scale.Pair_Control)
                {

                 for(i=0;i<=1;i++){
                mesh_F1_pair.children[i].material.visible=false;
                mesh_F2_pair.children[i].material.visible=false;
                mesh_F3_pair.children[i].material.visible=false;
                mesh_F4_pair.children[i].material.visible=false;
                mesh_left_pair.children[i].material.visible=false;
            }

            redraw();
            for(i=0;i<=1;i++){
                mesh.children[i].material.visible=true;
            }

            // mesh_left_ForceFace.children.forEach(function (e) {
            //     e.geometry.vertices = vertices;
            //     e.geometry.verticesNeedUpdate = true;

            //     // e.geometry.faces[0].color.set(0xff00ee);
            //     // e.geometry.facesNeedUpdate=true;
            //     e.geometry.elementsNeedUpdate = true;
            //     e.geometry.computeFaceNormals();
            //     //e.geometry.center();
            // });

             Tube_group_pair.traverse(function(obj) {//hide group
                    if (obj.type === "Mesh") {
                        obj.material.visible =false;
                    }
                });

             for(i=0;i<=1;i++){
                mesh_left.children[i].material.visible=false;
            }
            mesh_F1.children[0].material.visible=false;
            mesh_F2.children[0].material.visible=false;
            mesh_F3.children[0].material.visible=false;
            mesh_F4.children[0].material.visible=false;
        }










                trfm_ctrl.attach(selectObj);
               // leftMouseDown = true;
            }

                // mouseX = event.clientX;
                // mouseY = event.clientY;

                //document.addEventListener('mousemove', onMouseMove);
            }


        function onMouseUp(event) {
            leftMouseDown = false;
            rightMouseDown = false;
            //document.removeEventListener('mousemove', onMouseMove);
        }

        function onMouseMove(event) {
           

                event.preventDefault();
                mouse.x = ((event.clientX*2)/window.innerWidth) * 2 - 1;
                mouse.y = -(event.clientY/window.innerHeight) * 2 + 1;

            //mouse.x = ((event.clientX*2)/window.innerWidth) * 2 - 1;
           // mouse.y = -(event.clientY/window.innerHeight) * 2 + 1;

           //event.clientX=event.clientX/2;


            if (rightMouseDown) {
               
           }
           
            if (leftMouseDown) {

                 for(i=0;i<=1;i++){

                mesh_left.children[i].material.visible=false;
            }
            mesh_F1.children[0].material.visible=false;
            mesh_F2.children[0].material.visible=false;
            mesh_F3.children[0].material.visible=false;
            mesh_F4.children[0].material.visible=false;


             for(i=0;i<2;i++)
            {
                mesh_left_Cell1.children[i].material.visible=false;
                mesh_left_Cell2.children[i].material.visible=false;
                mesh_left_Cell3.children[i].material.visible=false;
                mesh_left_Cell4.children[i].material.visible=false;

            }


                // var deltaX = event.clientX - mouseX;
                // mouseX = event.clientX;
                // var deltaY = event.clientY - mouseY;
                // mouseY = event.clientY;
               // rotation(deltaX, deltaY);
            }
        }

       




    function redraw_right(){

        scene2.remove(Tube_group_right);
        //scene.remove(Face_group_left);
        Tube_group_right=new THREE.Group();
        //Face_group_left=new THREE.Group();


        var materialA = new THREE.MeshPhongMaterial({color: 0xdcdcdc, transparent: false});

        var spGeomA = new THREE.SphereGeometry(0.02);
        var sp_TubeA= new THREE.Mesh(spGeomA, materialA);

        sp_TubeA.name="fpA0";
        sp_TubeA.position.copy(P_A_Right);
                //sp_Tube0.castShadow=true;

        //Ctrl_tubes.push(sp_TubeA);


        Tube_group_right.add(sp_TubeA);

        var materialB = new THREE.MeshPhongMaterial({color: 0xdcdcdc, transparent: false});

        var spGeomB = new THREE.SphereGeometry(0.02);
        var sp_TubeB= new THREE.Mesh(spGeomB, materialB);

        sp_TubeB.name="fpB1";
        sp_TubeB.position.copy(P_B_Right);
                //sp_Tube0.castShadow=true;

        //Ctrl_tubes.push(sp_TubeB);


        Tube_group_right.add(sp_TubeB);

        var materialC = new THREE.MeshPhongMaterial({color: 0xdcdcdc, transparent: false});

        var spGeomC = new THREE.SphereGeometry(0.02);
        var sp_TubeC= new THREE.Mesh(spGeomC, materialC);

        sp_TubeC.name="fpC2";
        sp_TubeC.position.copy(P_C_Right);
                //sp_Tube0.castShadow=true;

        ///Ctrl_tubes.push(sp_TubeC);


        Tube_group_right.add(sp_TubeC);

        var materialD = new THREE.MeshPhongMaterial({color: 0xdcdcdc, transparent: false});

        var spGeomD = new THREE.SphereGeometry(0.02);
        var sp_TubeD= new THREE.Mesh(spGeomD, materialD);

        sp_TubeD.name="fpD3";
        sp_TubeD.position.copy(P_D_Right);



                //sp_Tube0.castShadow=true;

        //Ctrl_tubes.push(sp_TubeD);


        Tube_group_right.add(sp_TubeD);



        var materialAB = new THREE.MeshPhongMaterial({color: 0xc0c0c0, transparent: false});
        var tubeMeshAB=createCylinderMesh(P_A_Right,P_B_Right,materialAB,0.01,0.01);

         tubeMeshAB.name="ftAB0";
        Ctrl_tubes.push(tubeMeshAB);

        Tube_group_right.add(tubeMeshAB);

        var materialBC = new THREE.MeshPhongMaterial({color: 0xc0c0c0, transparent: false});
        var tubeMeshBC=createCylinderMesh(P_B_Right,P_C_Right,materialBC,0.01,0.01);

         tubeMeshBC.name="ftBC1";
        Ctrl_tubes.push(tubeMeshBC);

        Tube_group_right.add(tubeMeshBC);

        var materialAC = new THREE.MeshPhongMaterial({color: 0xc0c0c0, transparent: false});
        var tubeMeshAC=createCylinderMesh(P_A_Right,P_C_Right,materialAC,0.01,0.01);

         tubeMeshAC.name="ftAC2";
        Ctrl_tubes.push(tubeMeshAC);

        Tube_group_right.add(tubeMeshAC);

        var materialAD = new THREE.MeshPhongMaterial({color: 0xc0c0c0, transparent: false});
        var tubeMeshAD=createCylinderMesh(P_A_Right,P_D_Right,materialAD,0.01,0.01);

         tubeMeshAD.name="ftAD3";
        Ctrl_tubes.push(tubeMeshAD);

        Tube_group_right.add(tubeMeshAD);


        var materialBD = new THREE.MeshPhongMaterial({color: 0xc0c0c0, transparent: false});
        var tubeMeshBD=createCylinderMesh(P_B_Right,P_D_Right,materialBD,0.01,0.01);

         tubeMeshBD.name="ftBD4";
        Ctrl_tubes.push(tubeMeshBD);

        Tube_group_right.add(tubeMeshBD);

        var materialCD = new THREE.MeshPhongMaterial({color: 0xc0c0c0, transparent: false});
        var tubeMeshCD=createCylinderMesh(P_C_Right,P_D_Right,materialCD,0.01,0.01);

         tubeMeshCD.name="ftCD5";
        Ctrl_tubes.push(tubeMeshCD);

        Tube_group_right.add(tubeMeshCD);








        scene2.add(Tube_group_right);

    }



        function redraw_Faces6(){
                        

        var vertices = [ 
                        new THREE.Vector3(0,0,0),TubePoints1[1],TubePoints2[1],TubePoints3[1],TubePoints4[1]
                    ];


        //console.log("TubePoints1="+P_A.z);

        // for (i = 0;i<geom.faces.length;i++){
        //         var hex = Math.random() * 0xffffff;
        //         geom.faces[i].color.setHex(hex);
        //     }

            mesh_left_ForceFace.children.forEach(function (e) {
                e.geometry.vertices = vertices;
                e.geometry.verticesNeedUpdate = true;

                // e.geometry.faces[0].color.set(0xff00ee);
                // e.geometry.facesNeedUpdate=true;
                e.geometry.elementsNeedUpdate = true;
                e.geometry.computeFaceNormals();
                //e.geometry.center();
            });
        }




    function redraw_Cell()
        {

            var vertices = [
                        new THREE.Vector3(0,0,0),TubePoints1[1],TubePoints2[1],TubePoints3[1],TubePoints4[1]
                    ];

            mesh_left_Cell1.children.forEach(function (e) {
                e.geometry.vertices = vertices;
                e.geometry.verticesNeedUpdate = true;

                // e.geometry.faces[0].color.set(0xff00ee);
                // e.geometry.facesNeedUpdate=true;
                e.geometry.elementsNeedUpdate = true;
                e.geometry.computeFaceNormals();
                //e.geometry.center();
            });

             mesh_left_Cell2.children.forEach(function (e) {
                e.geometry.vertices = vertices;
                e.geometry.verticesNeedUpdate = true;

                // e.geometry.faces[0].color.set(0xff00ee);
                // e.geometry.facesNeedUpdate=true;
                e.geometry.elementsNeedUpdate = true;
                e.geometry.computeFaceNormals();
                //e.geometry.center();
            });

              mesh_left_Cell3.children.forEach(function (e) {
                e.geometry.vertices = vertices;
                e.geometry.verticesNeedUpdate = true;

                // e.geometry.faces[0].color.set(0xff00ee);
                // e.geometry.facesNeedUpdate=true;
                e.geometry.elementsNeedUpdate = true;
                e.geometry.computeFaceNormals();
                //e.geometry.center();
            });

               mesh_left_Cell4.children.forEach(function (e) {
                e.geometry.vertices = vertices;
                e.geometry.verticesNeedUpdate = true;

                // e.geometry.faces[0].color.set(0xff00ee);
                // e.geometry.facesNeedUpdate=true;
                e.geometry.elementsNeedUpdate = true;
                e.geometry.computeFaceNormals();
                //e.geometry.center();
            });
    }

    



            var mesh_TriFace1;
            var mesh_TriFace2;
            var mesh_TriFace3;
            var mesh_TriFace4;

            var text_group1;
            var text_closingplane_group
            var text_closingplane_trial_group
            var text_force_trial_group
            var text_group2;
            var Tube_group_pair;











            function redraw(){


                scene.remove(Tube_group);
               // scene2.remove(Tube_group_pair);
                Ctrl_pts=[];
                Ctrl_tubes=[];
                scene.remove(step_group_1);
                scene.remove(step_group_2);
                // scene2.remove(face_arrow1);
                // scene2.remove(face_arrow2);
                // scene2.remove(face_arrow3);
                // scene2.remove(face_arrow4);

                scene.remove(form_group);
                scene.remove(form_trial);
                scene.remove(form_closingplane);
                scene.remove(form_greenfaces);

                scene2.remove(step_group_1_1);
                scene2.remove(mesh_TriFace1);
                scene2.remove(mesh_TriFace2);
                scene2.remove(mesh_TriFace3);
                scene2.remove(mesh_TriFace4);

                scene2.remove(trial_force);
                scene2.remove(force_group);
                scene2.remove(force_cell);

                scene.remove(text_group1);
                scene.remove(text_closingplane_group);
                scene.remove(text_closingplane_trial_group);
                scene2.remove(text_group2);
                scene2.remove(text_force_trial_group);


                // scene.remove(textf1);
                // scene.remove(textf2);



                var arr_direction=arrow_direction(TubePoints1[1],TubePoints2[1],TubePoints3[1],TubePoints4[1]);

                console.log("n1=",TubePoints1[1],"n2=",TubePoints2[1],"n3=",TubePoints3[1],"n4=",TubePoints4[1]);

                var arrow_material2=new THREE.MeshPhongMaterial({
                color: 0xC00000
                } );




                Tube_group=new THREE.Group();
                step_group_1=new THREE.Group();
                step_group_2=new THREE.Group();
                step_group_1_1=new THREE.Group();
                trial_force=new THREE.Group();
                form_group=new THREE.Group();
                force_group=new THREE.Group();
                force_cell=new THREE.Group();
                form_trial=new THREE.Group();
                form_closingplane=new THREE.Group();
                form_greenfaces=new THREE.Group();

                // Tube_group_pair=new THREE.Group();

                text_group1=new THREE.Group();
                text_closingplane_group=new THREE.Group();
                text_closingplane_trial_group=new THREE.Group();
                text_force_trial_group=new THREE.Group();
                text_group2=new THREE.Group();


                var material = new THREE.MeshPhongMaterial({color: "lightgrey", transparent: false});

                var spGeom0 = new THREE.SphereGeometry(0.05);
                var sp_Tube0 = new THREE.Mesh(spGeom0, material);
                var sp_Tube5 = new THREE.Mesh(spGeom0, material);


                sp_Tube0.name="sp0";
                sp_Tube0.position.copy(new THREE.Vector3(-0.5,-0.5,0));
                sp_Tube0.castShadow=true;

                sp_Tube5.position.copy(new THREE.Vector3(0.5,1,0));
                sp_Tube5.castShadow=true;
                sp_Tube5.name="sp5";

                Ctrl_tubes.push(sp_Tube0);
                Ctrl_pts.push(sp_Tube5);

                var outlineMaterial1 = new THREE.MeshBasicMaterial( { color: "black", transparent: false, side: THREE.BackSide } );
                var outlineMesh1 = new THREE.Mesh( spGeom0, outlineMaterial1 );

                var outlineMesh2 = new THREE.Mesh( spGeom0, outlineMaterial1 );
                outlineMesh1.position.copy(new THREE.Vector3(-0.5,-0.5,0));
                outlineMesh1.scale.multiplyScalar(1.55);
                Tube_group.add( outlineMesh1 );

                outlineMesh2.position.copy(new THREE.Vector3(0.5,1,0));
                outlineMesh2.scale.multiplyScalar(1.55);
                Tube_group.add( outlineMesh2 );







            // ****************** New Construct *************************************************************************************************************************************************









              //Trial Construction 
               
                // Trial Force Diagram

                 //Construct Force Diagram

                    //locate apply loads point A,B,C,D

                       var ForceP_A = new THREE.Vector3(-2,1,0);
                       var ForceP_B = new THREE.Vector3(FP_B.x,FP_B.y,0);
                       var ForceP_C = new THREE.Vector3(FP_C.x,FP_C.y,0);
                       var ForceP_D = new THREE.Vector3(FP_D.x,FP_D.y,0);

                       //add sphere ?

                       var vertices = [
                       ForceP_A,ForceP_B,ForceP_C,ForceP_D
                       ];

                       var faces = [
                               new THREE.Face3(0, 1, 2),
                               new THREE.Face3(0, 2, 3),
                              
                           ];

                       var geom = new THREE.Geometry();
                       geom.vertices = vertices;
                       geom.faces = faces;
                       geom.computeFaceNormals();

                       var material_AL = [
                       //new THREE.MeshLambertMaterial({color: 0x4d4dff, transparent: true}),
                       new THREE.MeshBasicMaterial({color: "black", wireframe:true, transparent: true,opacity:0.4}),
                       new THREE.MeshPhongMaterial({
                       color: 0x009600,transparent: true,opacity:0.3,side:THREE.DoubleSide,depthWrite:false
                       } )
                       ];

                       var Applied_loads_faces = THREE.SceneUtils.createMultiMaterialObject(geom, material_AL);
                       
                       //force_group.add(Applied_loads_faces); 

                    
                   //step1: locate force point A,B,C

                       var ForceP_A = new THREE.Vector3(-2,1,0);
                       var ForceP_B = new THREE.Vector3(FP_B.x,FP_B.y,0);
                       var ForceP_C = new THREE.Vector3(FP_C.x,FP_C.y,0);

                       var ForceP_Cen = new THREE.Vector3((ForceP_A.x+ForceP_B.x+ForceP_C.x)/3,(ForceP_A.y+ForceP_B.y+ForceP_C.y)/3,(ForceP_A.z+ForceP_B.z+ForceP_C.z)/3)
                      


                   //step2: locate subdivided points

                       function create_offset_point_plane(point1,point2,point3,scale){

                       var centroid = new THREE.Vector3((point1.x+point2.x+point3.x)/3,(point1.y+point2.y+point3.y)/3,(point1.z+point2.z+point3.z)/3);                              
                       var scale_point = new THREE.Vector3(centroid.x + (point1.x - centroid.x)*scale, centroid.y + (point1.y - centroid.y)*scale, centroid.z + (point1.z - centroid.z)*scale );
                       return scale_point
                       }
                       
                       //point A1, B1, C1
                       var ForceP_A_1 = create_offset_point_plane(ForceP_A,ForceP_B,ForceP_C,foffset.l);
                       var ForceP_B_1 = create_offset_point_plane(ForceP_B,ForceP_A,ForceP_C,foffset.l);
                       var ForceP_C_1 = create_offset_point_plane(ForceP_C,ForceP_A,ForceP_B,foffset.l);

                       function create_force_apply_plane(vertice1,vertice2,vertice3){

                            var vertices = [
                            vertice1,vertice2,vertice3
                            ];
    
                            var faces = [
                                    new THREE.Face3(0, 1, 2),                           
                                ];
    
                            var geom = new THREE.Geometry();
                            geom.vertices = vertices;
                            geom.faces = faces;
                            geom.computeFaceNormals();
    
                            var material_AL = [
                            //new THREE.MeshLambertMaterial({color: 0x4d4dff, transparent: true}),
                            new THREE.MeshBasicMaterial({color: "black", wireframe:true, transparent: true,opacity:0.4}),
                            new THREE.MeshPhongMaterial({
                            color: 0x009600,transparent: true,opacity:0.3,side:THREE.DoubleSide,depthWrite:false
                            } )
                            ];
    
                            var Applied_loads_faces = THREE.SceneUtils.createMultiMaterialObject(geom, material_AL);
                            return Applied_loads_faces

                       }

                      var Force_apply_A1B1C1 = create_force_apply_plane(ForceP_A_1,ForceP_B_1,ForceP_C_1);
                      force_group.add(Force_apply_A1B1C1); 

                      //point AC

                      var ForceP_A1C1_mid = new THREE.Vector3((ForceP_A_1.x+ForceP_C_1.x)/2,(ForceP_A_1.y+ForceP_C_1.y)/2,(ForceP_A_1.z+ForceP_C_1.z)/2);   
                      var ForceP_AC_mid = new THREE.Vector3((ForceP_A.x+ForceP_C.x)/2,(ForceP_A.y+ForceP_C.y)/2,(ForceP_A.z+ForceP_C.z)/2);   

                      var ForceP_AC = new THREE.Vector3(ForceP_A1C1_mid.x + (ForceP_AC_mid.x - ForceP_A1C1_mid.x)*foffset2.l, ForceP_A1C1_mid.y + (ForceP_AC_mid.y - ForceP_A1C1_mid.y)*foffset2.l, ForceP_A1C1_mid.z + (ForceP_AC_mid.z - ForceP_A1C1_mid.z)*foffset2.l );

                      //create mesh AA1AC, A1ACC1, ACC1C, AACC

                      var Force_apply_AA1AC = create_force_apply_plane(ForceP_A,ForceP_A_1,ForceP_AC);
                      var Force_apply_A1ACC1 = create_force_apply_plane(ForceP_A_1,ForceP_AC,ForceP_C_1);
                      var Force_apply_ACC1C = create_force_apply_plane(ForceP_AC,ForceP_C_1,ForceP_C);
                      var Force_apply_AACC = create_force_apply_plane(ForceP_A,ForceP_AC,ForceP_C);


                      force_group.add(Force_apply_AA1AC); 
                      force_group.add(Force_apply_A1ACC1); 
                      force_group.add(Force_apply_ACC1C); 
                      force_group.add(Force_apply_AACC); 



                      //point AB

                      var ForceP_A1B1_mid = new THREE.Vector3((ForceP_A_1.x+ForceP_B_1.x)/2,(ForceP_A_1.y+ForceP_B_1.y)/2,(ForceP_A_1.z+ForceP_B_1.z)/2);   
                      var ForceP_AB_mid = new THREE.Vector3((ForceP_A.x+ForceP_B.x)/2,(ForceP_A.y+ForceP_B.y)/2,(ForceP_A.z+ForceP_B.z)/2);   

                      var ForceP_AB = new THREE.Vector3(ForceP_A1B1_mid.x + (ForceP_AB_mid.x - ForceP_A1B1_mid.x)*foffset2.l, ForceP_A1B1_mid.y + (ForceP_AB_mid.y - ForceP_A1B1_mid.y)*foffset2.l, ForceP_A1B1_mid.z + (ForceP_AB_mid.z - ForceP_A1B1_mid.z)*foffset2.l );

                      
                      //create mesh AA1AB, A1ABB1, ABB1B, AABB

                      var Force_apply_AA1AB = create_force_apply_plane(ForceP_A,ForceP_A_1,ForceP_AB);
                      var Force_apply_A1ABB1 = create_force_apply_plane(ForceP_A_1,ForceP_AB,ForceP_B_1);
                      var Force_apply_ABB1B = create_force_apply_plane(ForceP_AB,ForceP_B_1,ForceP_B);
                      var Force_apply_AABB = create_force_apply_plane(ForceP_A,ForceP_AB,ForceP_B);


                      force_group.add(Force_apply_AA1AB); 
                      force_group.add(Force_apply_A1ABB1); 
                      force_group.add(Force_apply_ABB1B); 
                      force_group.add(Force_apply_AABB); 

                      //point BC

                      var ForceP_B1C1_mid = new THREE.Vector3((ForceP_C_1.x+ForceP_B_1.x)/2,(ForceP_C_1.y+ForceP_B_1.y)/2,(ForceP_C_1.z+ForceP_B_1.z)/2);   
                      var ForceP_BC_mid = new THREE.Vector3((ForceP_C.x+ForceP_B.x)/2,(ForceP_C.y+ForceP_B.y)/2,(ForceP_C.z+ForceP_B.z)/2);   

                      var ForceP_BC = new THREE.Vector3(ForceP_B1C1_mid.x + (ForceP_BC_mid.x - ForceP_B1C1_mid.x)*foffset2.l, ForceP_B1C1_mid.y + (ForceP_BC_mid.y - ForceP_B1C1_mid.y)*foffset2.l, ForceP_B1C1_mid.z + (ForceP_BC_mid.z - ForceP_B1C1_mid.z)*foffset2.l );

                       
                      //create mesh BB1BC, B1BCC1, BCC1C, BBCC

                      var Force_apply_BB1BC = create_force_apply_plane(ForceP_B,ForceP_B_1,ForceP_BC);
                      var Force_apply_B1BCC1 = create_force_apply_plane(ForceP_B_1,ForceP_BC,ForceP_C_1);
                      var Force_apply_BCC1C = create_force_apply_plane(ForceP_BC,ForceP_C_1,ForceP_C);
                      var Force_apply_BBCC = create_force_apply_plane(ForceP_B,ForceP_BC,ForceP_C);

                      force_group.add(Force_apply_BB1BC); 
                      force_group.add(Force_apply_B1BCC1); 
                      force_group.add(Force_apply_BCC1C); 
                      force_group.add(Force_apply_BBCC); 


                    //decomposoiton point o'
                       var TrialP_O = new THREE.Vector3(fo.x,fo.y,fo.z);
                    
                    //Trial force faces

                    function create_force_trial_plane(vertice1,vertice2){

                        var vertices = [
                        vertice1,vertice2,TrialP_O
                        ];
                        
                        var faces = [
                                new THREE.Face3(0, 1, 2),                           
                            ];
                        
                        var geom = new THREE.Geometry();
                        geom.vertices = vertices;
                        geom.faces = faces;
                        geom.computeFaceNormals();
                        
                        var material_trial = [
                        //new THREE.MeshLambertMaterial({color: 0x4d4dff, transparent: true}),
                        new THREE.MeshBasicMaterial({color: "white", wireframe: true, transparent: true,opacity:0.1}),
                        new THREE.MeshPhongMaterial({
                        color: "grey",transparent: true,opacity:0.2,side:THREE.DoubleSide,depthWrite:false
                        } )
                        ];
                        
                        var trial_faces = THREE.SceneUtils.createMultiMaterialObject(geom, material_trial);
                        return trial_faces
                        
                        }

                    //Trail force faces - Part 1 - A A1 B1 B

                        var Force_trial_AB = create_force_trial_plane(ForceP_A,ForceP_B);
                        var Force_trial_AAB = create_force_trial_plane(ForceP_A,ForceP_AB);
                        var Force_trial_ABB = create_force_trial_plane(ForceP_AB,ForceP_B);
                        var Force_trial_ABB1 = create_force_trial_plane(ForceP_AB,ForceP_B_1);
                        var Force_trial_ABA1 = create_force_trial_plane(ForceP_AB,ForceP_A_1);
                        var Force_trial_A1A = create_force_trial_plane(ForceP_A_1,ForceP_A);
                        var Force_trial_B1B = create_force_trial_plane(ForceP_B_1,ForceP_B);
                        var Force_trial_A1B1 = create_force_trial_plane(ForceP_A_1,ForceP_B_1);

                        trial_force.add(Force_trial_AB) 
                        trial_force.add(Force_trial_AAB) 
                        trial_force.add(Force_trial_ABB) 
                        trial_force.add(Force_trial_ABB1)
                        trial_force.add(Force_trial_ABA1)
                        trial_force.add(Force_trial_A1A) 
                        trial_force.add(Force_trial_B1B) 
                        trial_force.add(Force_trial_A1B1)

                    //Trail force faces - Part 2 - A A1 C1 C

                        var Force_trial_AC = create_force_trial_plane(ForceP_A,ForceP_C);
                        var Force_trial_AAC = create_force_trial_plane(ForceP_A,ForceP_AC);
                        var Force_trial_ACC = create_force_trial_plane(ForceP_AC,ForceP_C);
                        var Force_trial_ACC1 = create_force_trial_plane(ForceP_AC,ForceP_C_1);
                        var Force_trial_ACA1 = create_force_trial_plane(ForceP_AB,ForceP_A_1);
                        var Force_trial_C1C = create_force_trial_plane(ForceP_C_1,ForceP_C);
                        var Force_trial_A1C1 = create_force_trial_plane(ForceP_A_1,ForceP_C_1);

                        trial_force.add(Force_trial_AC) 
                        trial_force.add(Force_trial_AAC) 
                        trial_force.add(Force_trial_ACC) 
                        trial_force.add(Force_trial_ACC1)
                        trial_force.add(Force_trial_ACA1)
                        trial_force.add(Force_trial_C1C) 
                        trial_force.add(Force_trial_A1C1)

                    //Trail force faces - Part 3 - B B1 C1 C

                        var Force_trial_BC = create_force_trial_plane(ForceP_B,ForceP_C);
                        var Force_trial_BBC = create_force_trial_plane(ForceP_B,ForceP_BC);
                        var Force_trial_BCC = create_force_trial_plane(ForceP_BC,ForceP_C);
                        var Force_trial_BCC1 = create_force_trial_plane(ForceP_BC,ForceP_C_1);
                        var Force_trial_BCB1 = create_force_trial_plane(ForceP_BC,ForceP_B_1);
                        var Force_trial_B1C1 = create_force_trial_plane(ForceP_B_1,ForceP_C_1);

                        trial_force.add(Force_trial_BC) 
                        trial_force.add(Force_trial_BBC) 
                        trial_force.add(Force_trial_BCC) 
                        trial_force.add(Force_trial_BCC1)
                        trial_force.add(Force_trial_BCB1)
                        trial_force.add(Force_trial_B1C1)





                
                  //Form diagram green faces

                       var FormP_O = new THREE.Vector3(0,0,1);

                       // find point G1 from triangle ABB2, B2=c.z-1

                       let ForceP_B_2 = new THREE.Vector3(ForceP_B.x,ForceP_B.y,ForceP_B.z-1);

                       var Vec_tri_ABB2 = Cal_Vec_2 (ForceP_A,ForceP_B_2,ForceP_B,1.2);

                       var FormG_1 = new THREE.Vector3(FormP_O.x-formo2.l*Vec_tri_ABB2.x,FormP_O.y-formo2.l*Vec_tri_ABB2.y,FormP_O.z-formo2.l*Vec_tri_ABB2.z);
                       var FormG_1B = new THREE.Vector3(FormG_1.x,FormG_1.y,-1.5);

                       // find point G2 from triangle CBB2, B2=c.z-1

                       var Vec_tri_CBB2 = Cal_Vec_2 (ForceP_B,ForceP_B_2,ForceP_C,1.2);

                       var FormG_2 = new THREE.Vector3(FormP_O.x-formo2.l*Vec_tri_CBB2.x,FormP_O.y-formo2.l*Vec_tri_CBB2.y,FormP_O.z-formo2.l*Vec_tri_CBB2.z);
                       var FormG_2B = new THREE.Vector3(FormG_2.x,FormG_2.y,-1.5);

                        // find point G3 from triangle ACC2, c2=c.z-1
                       
                       let ForceP_C_2 = new THREE.Vector3(ForceP_C.x,ForceP_C.y,ForceP_C.z-1);   
                       var Vec_tri_ACC2 = Cal_Vec_2 (ForceP_C,ForceP_C_2,ForceP_A,1.2);   

                       var FormG_3 = new THREE.Vector3(FormP_O.x-formo2.l*Vec_tri_ACC2.x,FormP_O.y-formo2.l*Vec_tri_ACC2.y,FormP_O.z-formo2.l*Vec_tri_ACC2.z);
                       var FormG_3B = new THREE.Vector3(FormG_3.x,FormG_3.y,-1.5);



                       // find subdivided green faces 

                                function create_form_greenfaces(point1,point1b,point2b,point2){
                                  var vertices = [
                                  point1,point1b,point2b,point2
                                  ];
             
                                  var faces = [
                                          new THREE.Face3(2, 1, 0),
                                          new THREE.Face3(3, 2, 0),
                                         
                                      ];
             
                                  var geom = new THREE.Geometry();
                                  geom.vertices = vertices;
                                  geom.faces = faces;
                                  geom.computeFaceNormals();
                                  var material_greenfaces = [
                                  //new THREE.MeshLambertMaterial({color: 0x4d4dff, transparent: true}),
                                  new THREE.MeshBasicMaterial({color: "black", wireframe:false, transparent: true,opacity:0.4}),
                                  new THREE.MeshPhongMaterial({
                                  color: 0x009600,transparent: true,opacity:0.3,side:THREE.DoubleSide,depthWrite:false
                                  } )
                                  ];
             
                                  var greenface= THREE.SceneUtils.createMultiMaterialObject(geom, material_greenfaces);
                                  return greenface
                                }

                                function create_form_greenface_dashlines(point1,point1b){

                                    var points = [];
                                    points.push(point1);
                                    points.push(point1b);
                
                                    var geo = new THREE.Geometry().setFromPoints(points );
                
                                    var line_dash = new THREE.LineDashedMaterial({
                                                 color: 0x009600,//color
                                                 dashSize: 0.05,
                                                gapSize: 0.03,
                                                linewidth: 1
                
                                                 });
                
                                    var dashline= new THREE.LineSegments(geo,line_dash);
                                    dashline.computeLineDistances();//compute
                                    return dashline
                                }

                        
                             
                             function create_form_applyload(point){
                                 
                             var arrow_apply=new THREE.MeshPhongMaterial( {color: 0x009600} );

                             var arrow_apply_outline = new THREE.MeshBasicMaterial( { color: "white", transparent: false, side: THREE.BackSide } );

                             var apply_arrow1=createCylinderArrowMesh(point,new THREE.Vector3(point.x,point.y,point.z-0.3),arrow_apply,0.015,0.035,0.6);
                             var apply_arrow12=createCylinderArrowMesh(new THREE.Vector3(point.x,point.y,point.z-0.03),new THREE.Vector3(point.x,point.y,point.z-0.3),arrow_apply_outline,0.020,0.035,0.55); 
                             apply_arrow12.scale.multiplyScalar(1.2);
                             form_group.add( apply_arrow1)
                             form_group.add( apply_arrow12)
                         

                             }

                           // AC
                             var Vec_tri_ACC3 = Cal_Vec_2 (ForceP_A,ForceP_C_2,ForceP_C,1.2);   

                             var FormG_AC = new THREE.Vector3(FormG_3.x-formG_AC.l*Vec_tri_ACC3.x,FormG_3.y-formG_AC.l*Vec_tri_ACC3.y,FormG_3.z-formG_AC.l*Vec_tri_ACC3.z);
                             var FormG_ACb = new THREE.Vector3(FormG_AC.x,FormG_AC.y,-1.5);

                             var Form_green_3AC = create_form_greenfaces(FormG_3,FormG_3B,FormG_ACb,FormG_AC);
                             var Form_greendash_G3 = create_form_greenface_dashlines(FormG_3,FormG_3B);
                          //   var Form_arrow_G3 = create_form_applyload(FormG_3);
                              form_greenfaces.add(Form_green_3AC);
                            //  form_greenfaces.add(Form_greendash_G3);
                            

                             
                           // AC C
                             var Vec_tri_ACC = Cal_Vec_2 (ForceP_AC,ForceP_C_2,ForceP_C,1.2);   

                             var FormG_ACC = new THREE.Vector3(FormG_AC.x-formG_ACC.l*Vec_tri_ACC.x,FormG_AC.y-formG_ACC.l*Vec_tri_ACC.y,FormG_AC.z-formG_ACC.l*Vec_tri_ACC.z);
                             var FormG_ACCb = new THREE.Vector3(FormG_ACC.x,FormG_ACC.y,-1.5);

                             var Form_green_ACC = create_form_greenfaces(FormG_AC,FormG_ACb,FormG_ACCb,FormG_ACC);
                             var Form_greendash_AC = create_form_greenface_dashlines(FormG_AC,FormG_ACb);
                             var Form_arrow_AC = create_form_applyload(FormG_AC);
                             
                             form_greenfaces.add(Form_green_ACC);
                             form_greenfaces.add(Form_greendash_AC);

                           //C1 C
                             var Vec_tri_C1C = Cal_Vec_2 (ForceP_C_1,ForceP_C_2,ForceP_C,1.2);   

                             var FormG_C1C = new THREE.Vector3(FormG_ACC.x-formG_C1C.l*Vec_tri_C1C.x,FormG_ACC.y-formG_C1C.l*Vec_tri_C1C.y,FormG_ACC.z-formG_C1C.l*Vec_tri_C1C.z);
                             var FormG_C1Cb = new THREE.Vector3(FormG_C1C.x,FormG_C1C.y,-1.5);
                             
                             var Form_green_C1C = create_form_greenfaces(FormG_ACC,FormG_ACCb,FormG_C1Cb,FormG_C1C);
                             var Form_greendash_ACC = create_form_greenface_dashlines(FormG_ACC,FormG_ACCb);
                             var Form_arrow_ACC = create_form_applyload(FormG_ACC);
                             form_greenfaces.add(Form_green_C1C);
                             form_greenfaces.add(Form_greendash_ACC);

                           //C1 AC
                             var ForceP_AC_2 = new THREE.Vector3(ForceP_AC.x,ForceP_AC.y,-1.5);
                             var Vec_tri_C1AC = Cal_Vec_2 (ForceP_AC,ForceP_AC_2,ForceP_C_1,1.2);   

                             var FormG_C1AC = new THREE.Vector3(FormG_ACC.x-formG_C1AC.l*Vec_tri_C1AC.x,FormG_ACC.y-formG_C1AC.l*Vec_tri_C1AC.y,FormG_ACC.z-formG_C1AC.l*Vec_tri_C1AC.z);
                             var FormG_C1ACb = new THREE.Vector3(FormG_C1AC.x,FormG_C1AC.y,-1.5);
                             
                             var Form_green_C1AC = create_form_greenfaces(FormG_ACC,FormG_ACCb,FormG_C1ACb,FormG_C1AC);
                             var Form_greendash_C1C = create_form_greenface_dashlines(FormG_C1C,FormG_C1Cb);
                             var Form_arrow_C1C = create_form_applyload(FormG_C1C);
                             form_greenfaces.add(Form_green_C1AC);
                             form_greenfaces.add(Form_greendash_C1C);

                           //C1 BC

                             var ForceP_C1_2 = new THREE.Vector3(ForceP_C_1.x,ForceP_C_1.y,-1.5);
                             var Vec_tri_C1BC = Cal_Vec_2 (ForceP_C_1,ForceP_C1_2,ForceP_BC,1.2);   

                             var FormG_C1BC = new THREE.Vector3(FormG_C1C.x-formG_C1BC.l*Vec_tri_C1BC.x,FormG_C1C.y-formG_C1BC.l*Vec_tri_C1BC.y,FormG_C1C.z-formG_C1BC.l*Vec_tri_C1BC.z);
                             var FormG_C1BCb = new THREE.Vector3(FormG_C1BC.x,FormG_C1BC.y,-1.5);
                             
                             var Form_green_C1BC = create_form_greenfaces(FormG_C1C,FormG_C1Cb,FormG_C1BCb,FormG_C1BC);
                             var Form_greendash_C1AC = create_form_greenface_dashlines(FormG_C1AC,FormG_C1ACb);
                             var Form_greendash_C1BC = create_form_greenface_dashlines(FormG_C1BC,FormG_C1BCb);
                             var Form_arrow_C1AC = create_form_applyload(FormG_C1AC);
                             var Form_arrow_C1BC = create_form_applyload(FormG_C1BC);
                             form_greenfaces.add(Form_green_C1BC);
                             form_greenfaces.add(Form_greendash_C1AC);
                             form_greenfaces.add(Form_greendash_C1BC);
                             
                           //A1C1 intersect C1B1
                            
                             function create_form_intec(point1,point2,point3,point4){
                           
                               var dir1 = new THREE.Vector3(); // create once an reuse it
                               
                               dir1.subVectors( point1,point2 ).normalize();
                               
                               var dir2 = new THREE.Vector3(); // create once an reuse it
                               
                               dir2.subVectors( point3,point4).normalize();
                               
                               var intec = LinesSectPt(dir1,point1,dir2,point3);
                               return intec
                             }

                             
                             var Vec_tri_C1B1 = Cal_Vec_2 (ForceP_C_1,ForceP_C1_2,ForceP_B_1,1.2);   
                             var FormG_C1B1 = new THREE.Vector3(FormG_C1BC.x-1.2*Vec_tri_C1B1.x,FormG_C1BC.y-1.2*Vec_tri_C1B1.y,FormG_C1BC.z-1.2*Vec_tri_C1B1.z);
                             var FormG_C1B1b = new THREE.Vector3(FormG_C1B1.x,FormG_C1B1.y,-1.5)

                             var Vec_tri_C1A1 = Cal_Vec_2 (ForceP_C_1,ForceP_C1_2,ForceP_A_1,1.2);   
                             var FormG_C1A1 = new THREE.Vector3(FormG_C1AC.x-1.2*Vec_tri_C1A1.x,FormG_C1AC.y-1.2*Vec_tri_C1A1.y,FormG_C1AC.z-1.2*Vec_tri_C1A1.z);
                             var FormG_C1A1b = new THREE.Vector3(FormG_C1A1.x,FormG_C1A1.y,-1.5)

                             var FormG_A1C1B1 = create_form_intec(FormG_C1B1,FormG_C1BC,FormG_C1A1,FormG_C1AC)
                             var FormG_A1C1B1b = new THREE.Vector3(FormG_A1C1B1.x,FormG_A1C1B1.y,-1.5)

                             var Form_green_A1C1B1a = create_form_greenfaces(FormG_A1C1B1,FormG_A1C1B1b,FormG_C1BCb,FormG_C1BC);
                             var Form_green_A1C1B1b = create_form_greenfaces(FormG_C1AC,FormG_C1ACb,FormG_A1C1B1b,FormG_A1C1B1);
                             var Form_greendash_A1C1B1 = create_form_greenface_dashlines(FormG_A1C1B1,FormG_A1C1B1b);
                             var Form_arrow_A1C1B1 = create_form_applyload(FormG_A1C1B1);
                             form_greenfaces.add(Form_green_A1C1B1a);
                             form_greenfaces.add(Form_green_A1C1B1b);
                             form_greenfaces.add(Form_greendash_A1C1B1);

                          //A1 B1

                             var ForceP_B1_2 = new THREE.Vector3(ForceP_B_1.x,ForceP_B_1.y,-1.5);
                             var Vec_tri_A1B1 = Cal_Vec_2 (ForceP_A_1,ForceP_B1_2,ForceP_B_1,1.2);   

                             var FormG_A1B1 = new THREE.Vector3(FormG_A1C1B1.x-formG_A1B1.l*Vec_tri_A1B1.x,FormG_A1C1B1.y-formG_A1B1.l*Vec_tri_A1B1.y,FormG_A1C1B1.z-formG_A1B1.l*Vec_tri_A1B1.z);
                             var FormG_A1B1b = new THREE.Vector3(FormG_A1B1.x,FormG_A1B1.y,-1.5);
                             
                             var Form_green_A1B1 = create_form_greenfaces(FormG_A1C1B1,FormG_A1C1B1b,FormG_A1B1b,FormG_A1B1);
                             var Form_greendash_A1B1 = create_form_greenface_dashlines(FormG_A1B1,FormG_A1B1b);
                             var Form_arrow_A1B1 = create_form_applyload(FormG_A1B1);
                             
                             form_greenfaces.add(Form_green_A1B1);
                             form_greenfaces.add(Form_greendash_A1B1);

                          //AAC intersect A1AC


                             var Vec_tri_AAC = Cal_Vec_2 (ForceP_AC,ForceP_AC_2,ForceP_A,1.2);   
                             var FormG_ACAAC = new THREE.Vector3(FormG_AC.x-1.2*Vec_tri_AAC.x,FormG_AC.y-1.2*Vec_tri_AAC.y,FormG_AC.z-1.2*Vec_tri_AAC.z);

                             var Vec_tri_A1AC = Cal_Vec_2 (ForceP_AC,ForceP_AC_2,ForceP_A_1,1.2);   
                             var FormG_ACC1ACA1 = new THREE.Vector3(FormG_C1AC.x-1.2*Vec_tri_A1AC.x,FormG_C1AC.y-1.2*Vec_tri_A1AC.y,FormG_C1AC.z-1.2*Vec_tri_A1AC.z);

                             var FormG_AACA1 = create_form_intec(FormG_AC,FormG_ACAAC,FormG_C1AC,FormG_ACC1ACA1)
                             var FormG_AACA1b = new THREE.Vector3(FormG_AACA1.x,FormG_AACA1.y,-1.5)

                             var Form_green_AACA1a = create_form_greenfaces(FormG_AC,FormG_ACb,FormG_AACA1b,FormG_AACA1);
                             var Form_green_AACA1b = create_form_greenfaces(FormG_AACA1,FormG_AACA1b,FormG_C1ACb,FormG_C1AC);
                             var Form_greendash_AACA1 = create_form_greenface_dashlines(FormG_AACA1,FormG_AACA1b);
                             var Form_arrow_AACA1 = create_form_applyload(FormG_AACA1);

                             form_greenfaces.add(Form_green_AACA1a);
                             form_greenfaces.add(Form_green_AACA1b);
                             form_greenfaces.add(Form_greendash_AACA1);
                             
                          //AAC intersect A1AC

                             var ForceP_A_2 = new THREE.Vector3(ForceP_A.x,ForceP_A.y,ForceP_A.z-1);
                             var Vec_tri_AA1 = Cal_Vec_2 (ForceP_A_1,ForceP_A_2,ForceP_A,1.2);   
                             var FormG_AACA1AA1 = new THREE.Vector3(FormG_AACA1.x-1.2*Vec_tri_AA1.x,FormG_AACA1.y-1.2*Vec_tri_AA1.y,FormG_AACA1.z-1.2*Vec_tri_AA1.z);

                               
                             var ForceP_AB_2 = new THREE.Vector3(ForceP_AB.x,ForceP_AB.y,-1.5)
                             var Vec_tri_A1AB = Cal_Vec_2 (ForceP_AB,ForceP_AB_2,ForceP_A_1,1.2);   
                             var FormG_A1B1A1AB = new THREE.Vector3(FormG_A1B1.x-1.2*Vec_tri_A1AB.x,FormG_A1B1.y-1.2*Vec_tri_A1AB.y,FormG_A1B1.z-1.2*Vec_tri_A1AB.z);

                             var FormG_AA1AB = create_form_intec(FormG_AACA1,FormG_AACA1AA1,FormG_A1B1,FormG_A1B1A1AB)
                             var FormG_AA1ABb = new THREE.Vector3(FormG_AA1AB.x,FormG_AA1AB.y,-1.5)

                             var Form_green_AA1ABa = create_form_greenfaces(FormG_AACA1,FormG_AACA1b,FormG_AA1ABb,FormG_AA1AB );
                             var Form_green_AA1ABb = create_form_greenfaces(FormG_AA1AB,FormG_AA1ABb,FormG_A1B1b,FormG_A1B1);
                             var Form_greendash_AA1AB= create_form_greenface_dashlines(FormG_AA1AB,FormG_AA1ABb);
                             var Form_arrow_AA1AB = create_form_applyload(FormG_AA1AB);

                             form_greenfaces.add(Form_green_AA1ABa);
                             form_greenfaces.add(Form_green_AA1ABb);
                             form_greenfaces.add(Form_greendash_AA1AB);

                          //BCC intersect BC

                             //var ForceP_C_2 = new THREE.Vector3(ForceP_C.x,ForceP_C.y,ForceP_C.z-1);
                             var Vec_tri_BCC = Cal_Vec_2 (ForceP_BC,ForceP_C_2,ForceP_C,1.2);   
                             var FormG_BCC = new THREE.Vector3(FormG_C1C.x-1.2*Vec_tri_BCC.x,FormG_C1C.y-1.2*Vec_tri_BCC.y,FormG_C1C.z-1.2*Vec_tri_BCC.z);
                             
                             var Vec_tri_BC = Cal_Vec_2 (ForceP_B,ForceP_C_2,ForceP_C,1.2);   
                             var FormG_BC = new THREE.Vector3(FormG_2.x-1.2*Vec_tri_BC.x,FormG_2.y-1.2*Vec_tri_BC.y,FormG_2.z-1.2*Vec_tri_BC.z);

                             var FormG_BCCB = create_form_intec(FormG_C1C,FormG_BCC,FormG_2,FormG_BC)
                             var FormG_BCCBb = new THREE.Vector3(FormG_BCCB.x,FormG_BCCB.y,-1.5)

                             var Form_green_BCCBa = create_form_greenfaces(FormG_C1C,FormG_C1Cb,FormG_BCCBb,FormG_BCCB );
                             var Form_green_BCCBb = create_form_greenfaces(FormG_BCCB,FormG_BCCBb,FormG_2B,FormG_2);
                             var Form_greendash_BCCB= create_form_greenface_dashlines(FormG_BCCB ,FormG_BCCBb);
                             var Form_arrow_BCCB = create_form_applyload(FormG_BCCB);
                             var Form_greendash_G2= create_form_greenface_dashlines(FormG_2B ,FormG_2);


                             
                             form_greenfaces.add(Form_green_BCCBa);
                             form_greenfaces.add(Form_green_BCCBb);
                             form_greenfaces.add(Form_greendash_BCCB);
                            //  form_greenfaces.add(Form_greendash_G2);

                           //BBC intersect B1BC

                             var Vec_tri_BBC = Cal_Vec_2 (ForceP_BC,ForceP_B_2,ForceP_B,1.2);   
                             var FormG_BBC = new THREE.Vector3(FormG_BCCB.x-1.2*Vec_tri_BBC.x,FormG_BCCB.y-1.2*Vec_tri_BBC.y,FormG_BCCB.z-1.2*Vec_tri_BBC.z);

                             var Vec_tri_B1BC = Cal_Vec_2 (ForceP_BC,ForceP_B1_2,ForceP_B_1,1.2);   
                             var FormG_B1BC = new THREE.Vector3(FormG_C1BC.x-1.2*Vec_tri_B1BC.x,FormG_C1BC.y-1.2*Vec_tri_B1BC.y,FormG_C1BC.z-1.2*Vec_tri_B1BC.z);

                             var FormG_B1BCB = create_form_intec(FormG_BCCB,FormG_BBC,FormG_C1BC,FormG_B1BC )
                             var FormG_B1BCBb = new THREE.Vector3(FormG_B1BCB.x,FormG_B1BCB.y,-1.5)

                             var Form_green_B1BCBa = create_form_greenfaces(FormG_B1BCB,FormG_B1BCBb,FormG_BCCBb,FormG_BCCB);
                             var Form_green_B1BCBb = create_form_greenfaces(FormG_C1BC,FormG_C1BCb,FormG_B1BCBb,FormG_B1BCB);
                             var Form_greendash_B1BCB= create_form_greenface_dashlines(FormG_B1BCB ,FormG_B1BCBb);
                             var Form_arrow_B1BCB = create_form_applyload(FormG_B1BCB);

                             form_greenfaces.add(Form_green_B1BCBa);
                             form_greenfaces.add(Form_green_B1BCBb );
                             form_greenfaces.add(Form_greendash_B1BCB);
                            // form_greenfaces.add(Form_greendash_G2);

                          //BB1 intersect ABB1

                             var Vec_tri_BB1 = Cal_Vec_2 (ForceP_B_1,ForceP_B_2,ForceP_B,1.2);   
                             var FormG_BB1 = new THREE.Vector3(FormG_B1BCB.x-1.2*Vec_tri_BB1.x,FormG_B1BCB.y-1.2*Vec_tri_BB1.y,FormG_B1BCB.z-1.2*Vec_tri_BB1.z);

                             
                             var Vec_tri_ABB1 = Cal_Vec_2 (ForceP_AB,ForceP_AB_2,ForceP_B_1,1.2);   
                             var FormG_ABB1 = new THREE.Vector3(FormG_A1B1.x-1.2*Vec_tri_ABB1.x,FormG_A1B1.y-1.2*Vec_tri_ABB1.y,FormG_A1B1.z-1.2*Vec_tri_ABB1.z);

                             var FormG_ABB1B = create_form_intec(FormG_B1BCB,FormG_BB1,FormG_A1B1,FormG_ABB1 )
                             var FormG_ABB1Bb = new THREE.Vector3(FormG_ABB1B.x,FormG_ABB1B.y,-1.5)

                             var Form_green_ABB1Ba = create_form_greenfaces(FormG_A1B1,FormG_A1B1b,FormG_ABB1Bb,FormG_ABB1B);
                             var Form_green_ABB1Bb = create_form_greenfaces(FormG_ABB1B,FormG_ABB1Bb,FormG_B1BCBb,FormG_B1BCB);
                             var Form_greendash_ABB1B= create_form_greenface_dashlines(FormG_ABB1B ,FormG_ABB1Bb);
                             var Form_arrow_ABB1B = create_form_applyload(FormG_ABB1B);
                           
                            form_greenfaces.add(Form_green_ABB1Ba);
                             form_greenfaces.add(Form_green_ABB1Bb);
                             form_greenfaces.add(Form_greendash_ABB1B);

                          //BAB intersect AAB

                             var Vec_tri_BAB = Cal_Vec_2 (ForceP_AB,ForceP_B_2,ForceP_B,1.2);   
                             var FormG_BAB = new THREE.Vector3(FormG_ABB1B.x-1.2*Vec_tri_BAB.x,FormG_ABB1B.y-1.2*Vec_tri_BAB.y,FormG_ABB1B.z-1.2*Vec_tri_BAB.z);

                             var Vec_tri_AAB = Cal_Vec_2 (ForceP_AB,ForceP_A_2,ForceP_A,1.2);   
                             var FormG_AAB = new THREE.Vector3(FormG_AA1AB.x-1.2*Vec_tri_AAB.x,FormG_AA1AB.y-1.2*Vec_tri_AAB.y,FormG_AA1AB.z-1.2*Vec_tri_AAB.z);

                             var FormG_AABB = create_form_intec(FormG_ABB1B,FormG_BAB,FormG_AA1AB,FormG_AAB)
                             var FormG_AABBb = new THREE.Vector3(FormG_AABB.x,FormG_AABB.y,-1.5)

                             var Form_green_AABBa = create_form_greenfaces(FormG_AABB,FormG_AABBb,FormG_ABB1Bb,FormG_ABB1B);
                             var Form_green_AABBb = create_form_greenfaces(FormG_AA1AB,FormG_AA1ABb,FormG_AABBb,FormG_AABB);
                             var Form_greendash_AABB= create_form_greenface_dashlines(FormG_AABB ,FormG_AABBb);
                             var Form_arrow_AABB = create_form_applyload(FormG_AABB);

                             form_greenfaces.add(Form_green_AABBa);
                             form_greenfaces.add(Form_green_AABBb);
                             form_greenfaces.add(Form_greendash_AABB);


                         //connect Force_G1

                             var Form_green_G1 = create_form_greenfaces(FormG_AABB,FormG_AABBb,FormG_1B,FormG_1);
                             var Form_greendash_G1= create_form_greenface_dashlines(FormG_1B ,FormG_1);

                            //  form_greenfaces.add(Form_greendash_G1);
                             form_greenfaces.add(Form_green_G1);


                //create trial form

                             var trial_S1 = new THREE.Vector3(FormG_3.x,FormG_3.y,triP3.z)

                             var trial_P1 = create_trial_intec (trial_S1,ForceP_A,TrialP_O,ForceP_C,FormG_AC,FormG_ACb);
                             var trial_P2 = create_trial_intec (trial_P1,ForceP_AC,TrialP_O,ForceP_C,FormG_ACC,FormG_ACCb);
                             var trial_P3 = create_trial_intec (trial_P1,ForceP_AC,TrialP_O,ForceP_A,FormG_AACA1,FormG_AACA1b);
                             var trial_P4 = create_trial_intec (trial_P2,ForceP_AC,TrialP_O,ForceP_C_1,FormG_C1AC,FormG_C1ACb);
                             var trial_P5 = create_trial_intec (trial_P3,ForceP_A_1,TrialP_O,ForceP_A,FormG_AA1AB,FormG_AA1ABb);
                             var trial_P6 = create_trial_intec (trial_P2,ForceP_C_1,TrialP_O,ForceP_C,FormG_C1C,FormG_C1Cb);
                             var trial_P7 = create_trial_intec (trial_P4,ForceP_A_1,TrialP_O,ForceP_C_1,FormG_A1C1B1,FormG_A1C1B1b);
                             var trial_P8 = create_trial_intec (trial_P6,ForceP_BC,TrialP_O,ForceP_C,FormG_BCCB,FormG_BCCBb);
                             var trial_P9 = create_trial_intec (trial_P8,ForceP_B,TrialP_O,ForceP_C,FormG_2,FormG_2B);
                             var trial_P10 = create_trial_intec (trial_P6,ForceP_BC,TrialP_O,ForceP_C_1,FormG_C1BC,FormG_C1BCb);
                             var trial_P11 = create_trial_intec (trial_P7,ForceP_B_1,TrialP_O,ForceP_A_1,FormG_A1B1,FormG_A1B1b);
                             var trial_P12= create_trial_intec (trial_P10,ForceP_B_1,TrialP_O,ForceP_BC,FormG_B1BCB,FormG_B1BCBb);
                             var trial_P13= create_trial_intec (trial_P11,ForceP_B_1,TrialP_O,ForceP_AB,FormG_ABB1B,FormG_ABB1Bb);
                             var trial_P14= create_trial_intec (trial_P5,ForceP_A,TrialP_O,ForceP_AB,FormG_AABB,FormG_AABBb);
                             var trial_P15= create_trial_intec (trial_P14,ForceP_A,TrialP_O,ForceP_B,FormG_1,FormG_1B);
                            //  var trial_o2 = create_trial_intec (trial_P3,ForceP_C,TrialP_O,ForceP_B,FormP_O2,FormP_O2B);
                            //  var trial_P4 = create_trial_intec (trial_o2,ForceP_A,TrialP_O,ForceP_B,FormP_4,FormP_4B);
                            //  var trial_o1 = create_trial_intec (trial_o2,ForceP_C,TrialP_O,ForceP_A,FormP_O1,FormP_O1B);
                            //  var trial_P2 = create_trial_intec (trial_o1,ForceP_C,TrialP_O,ForceP_D,FormP_2,FormP_2B);
                            //  var trial_P1 = create_trial_intec (trial_o1,ForceP_A,TrialP_O,ForceP_D,FormP_1,FormP_1B);
                             
                             var trial_mesh_1 = createCylinderMesh(trial_S1,trial_P1,DragPointMat,0.02,0.02);
                             var trial_mesh_2 = createCylinderMesh(trial_P1,trial_P2,DragPointMat,0.02,0.02);
                             var trial_mesh_3 = createCylinderMesh(trial_P1,trial_P3,DragPointMat,0.02,0.02);
                             var trial_mesh_4 = createCylinderMesh(trial_P2,trial_P4,DragPointMat,0.02,0.02);
                             var trial_mesh_5 = createCylinderMesh(trial_P3,trial_P4,DragPointMat,0.02,0.02);
                             var trial_mesh_6 = createCylinderMesh(trial_P3,trial_P5,DragPointMat,0.02,0.02);
                             var trial_mesh_7 = createCylinderMesh(trial_P2,trial_P6,DragPointMat,0.02,0.02);
                             var trial_mesh_8 = createCylinderMesh(trial_P4,trial_P7,DragPointMat,0.02,0.02);
                             var trial_mesh_9 = createCylinderMesh(trial_P6,trial_P8,DragPointMat,0.02,0.02);
                             var trial_mesh_10 = createCylinderMesh(trial_P8,trial_P9,DragPointMat,0.02,0.02);
                             var trial_mesh_11 = createCylinderMesh(trial_P6,trial_P10,DragPointMat,0.02,0.02);
                             var trial_mesh_12 = createCylinderMesh(trial_P7,trial_P10,DragPointMat,0.02,0.02);
                             var trial_mesh_13 = createCylinderMesh(trial_P7,trial_P11,DragPointMat,0.02,0.02);
                             var trial_mesh_14 = createCylinderMesh(trial_P5,trial_P11,DragPointMat,0.02,0.02);
                             var trial_mesh_15 = createCylinderMesh(trial_P10,trial_P12,DragPointMat,0.02,0.02);
                             var trial_mesh_16 = createCylinderMesh(trial_P11,trial_P13,DragPointMat,0.02,0.02);
                             var trial_mesh_17 = createCylinderMesh(trial_P5,trial_P14,DragPointMat,0.02,0.02);
                             var trial_mesh_18 = createCylinderMesh(trial_P8,trial_P12,DragPointMat,0.02,0.02);
                             var trial_mesh_19 = createCylinderMesh(trial_P12,trial_P13,DragPointMat,0.02,0.02);
                             var trial_mesh_20 = createCylinderMesh(trial_P13,trial_P14,DragPointMat,0.02,0.02);
                             var trial_mesh_21 = createCylinderMesh(trial_P14,trial_P15,DragPointMat,0.02,0.02);
                            //  var trial_mesh_p4o2 = createCylinderMesh(trial_o2,trial_P4,DragPointMat,0.02,0.02);
                            //  var trial_mesh_o1o2 = createCylinderMesh(trial_o2,trial_o1,DragPointMat,0.02,0.02);
                            //  var trial_mesh_p2o1 = createCylinderMesh(trial_o1,trial_P2,DragPointMat,0.02,0.02);
                            //  var trial_mesh_p1o1 = createCylinderMesh(trial_o1,trial_P1,DragPointMat,0.02,0.02);
                             
                             
                             form_trial.add(trial_mesh_1)
                             form_trial.add(trial_mesh_2)
                             form_trial.add(trial_mesh_3)
                             form_trial.add(trial_mesh_4)
                             form_trial.add(trial_mesh_5)
                             form_trial.add(trial_mesh_6)
                             form_trial.add(trial_mesh_7)
                             form_trial.add(trial_mesh_8)
                             form_trial.add(trial_mesh_9)
                             form_trial.add(trial_mesh_10)
                             form_trial.add(trial_mesh_11)
                             form_trial.add(trial_mesh_12)
                             form_trial.add(trial_mesh_13)
                             form_trial.add(trial_mesh_14)
                             form_trial.add(trial_mesh_15)
                             form_trial.add(trial_mesh_16)
                             form_trial.add(trial_mesh_17)
                             form_trial.add(trial_mesh_18)
                             form_trial.add(trial_mesh_19)
                             form_trial.add(trial_mesh_20)
                             form_trial.add(trial_mesh_21)
                             //    form_trial.add(trial_mesh_p4o2)
                             //    form_trial.add(trial_mesh_o1o2)
                             //    form_trial.add(trial_mesh_p2o1)
                             //    form_trial.add(trial_mesh_p1o1)
                             
            //trial form closing plane
                             
                             
                             
                             var vertices = [
                             trial_S1,trial_P15,trial_P9
                             ];
                             
                             var faces = [
                                     new THREE.Face3(0, 1, 2),
                                    
                                 ];
                             
                             var geom = new THREE.Geometry();
                             geom.vertices = vertices;
                             geom.faces = faces;
                             geom.computeFaceNormals();
                             var material_trial_closingplane = [
                             //new THREE.MeshLambertMaterial({color: 0x4d4dff, transparent: true}),
                             new THREE.MeshBasicMaterial({color: "black", wireframe:false, transparent: true,opacity:0.4}),
                             new THREE.MeshPhongMaterial({
                             color: "darkgrey",transparent: true,opacity:0.5,side:THREE.DoubleSide,depthWrite:false
                             } )
                             ];
                             
                             var trial_closingplane = THREE.SceneUtils.createMultiMaterialObject(geom, material_trial_closingplane);
                             
                             form_trial.add(trial_closingplane);

                             
                       var trial_linep1p2 = createdashline ( trial_S1,  trial_P15,trialline_dash)
                       var trial_linep1p3 = createdashline ( trial_S1,  trial_P9,trialline_dash)
                       var trial_linep2p3 = createdashline ( trial_P9,  trial_P15,trialline_dash)
                      


                       form_trial.add(trial_linep1p2);
                       form_trial.add(trial_linep1p3);                     
                       form_trial.add(trial_linep2p3);
                      
                       
                       //face nromals

                       var mid_p1p2p3 = new THREE.Vector3((trial_S1.x+trial_P15.x+trial_P9.x)/3,(trial_S1.y+trial_P15.y+trial_P9.y)/3,(trial_S1.z+trial_P15.z+trial_P9.z)/3 )
                       var vec_p1p2p3_temp = Cal_Vec_2 (trial_S1,trial_P15,trial_P9,1.2)
                       var trialnormal_p1p2p3 = new THREE.Vector3(mid_p1p2p3.x-0.2*vec_p1p2p3_temp.x, mid_p1p2p3.y-0.2*vec_p1p2p3_temp.y, mid_p1p2p3.z-0.2*vec_p1p2p3_temp.z)

                       var trial_normal_material = new THREE.MeshPhongMaterial({color:"red"})
                       var trial_normal_outlinematerial = new THREE.MeshPhongMaterial({color:"white", side:THREE.BackSide})

                       var trial_normal_1 = createCylinderArrowMesh(mid_p1p2p3,trialnormal_p1p2p3,trial_normal_material,0.015,0.035,0.55);
                       var trial_normal_1_outline = createCylinderArrowMesh(mid_p1p2p3,trialnormal_p1p2p3,trial_normal_outlinematerial,0.018,0.038,0.54);

                       form_trial.add(trial_normal_1);
                       form_trial.add(trial_normal_1_outline);
                       trial_normal_1_outline.scale.multiplyScalar(1.05);

            // location of supports


                       var FormCP1 = new THREE.Vector3(FormG_1.x,FormG_1.y,cp1.z); 
                       var FormCP2 = new THREE.Vector3(FormG_2.x,FormG_2.y,cp2.z);
                       var FormCP3 = new THREE.Vector3(FormG_3.x,FormG_3.y,cp3.z);
                    //    var FormCP4 = new THREE.Vector3(FormP_4.x,FormP_4.y,cp4.z);

                       var vertices = [
                       FormCP1,FormCP2,FormCP3//FormCP4
                       ];

                       var faces = [
                               new THREE.Face3(0, 1, 2),
                             //  new THREE.Face3(0, 2, 3),
                              

                           ];

                       var geom = new THREE.Geometry();
                       geom.vertices = vertices;
                       geom.faces = faces;
                       geom.computeFaceNormals();
                       var material_step_1 = [
                       //new THREE.MeshLambertMaterial({color: 0x4d4dff, transparent: true}),
                       new THREE.MeshBasicMaterial({color: "white", wireframe: true, transparent: true,opacity:0.1}),
                       new THREE.MeshPhongMaterial({
                       color: "white",transparent: true,opacity:0.6,side:THREE.DoubleSide,depthWrite:false
                       } )
                       ];

                       var form_closingmesh= THREE.SceneUtils.createMultiMaterialObject(geom, material_step_1);
                       form_closingplane.add(form_closingmesh);

                       //dash edges

                       var form_linep1p2 = createdashline ( FormCP1,  FormCP2,trialline_dash)
                       var form_linep1p3 = createdashline ( FormCP1,  FormCP3,trialline_dash)                    
                       var form_linep2p3 = createdashline ( FormCP2,  FormCP3,trialline_dash)
                       


                       form_closingplane.add(form_linep1p2);
                       form_closingplane.add(form_linep1p3);
                       form_closingplane.add(form_linep2p3);
                 

                       //face nromals

                       var mid_p1p2p3 = new THREE.Vector3((FormCP1.x+FormCP2.x+FormCP3.x)/3,(FormCP1.y+FormCP2.y+FormCP3.y)/3,(FormCP1.z+FormCP2.z+FormCP3.z)/3 )
                       var vec_p1p2p3_temp = Cal_Vec_2 (FormCP1,FormCP2,FormCP3,1.2)
                       var normal_p1p2p3 = new THREE.Vector3(mid_p1p2p3.x-0.2*vec_p1p2p3_temp.x, mid_p1p2p3.y-0.2*vec_p1p2p3_temp.y, mid_p1p2p3.z-0.2*vec_p1p2p3_temp.z)

                       var form_normal_material2 = new THREE.MeshPhongMaterial({color:"red"})
                       var form_normal_outlinematerial = new THREE.MeshPhongMaterial({color:"white", side:THREE.BackSide})

                       var form_normal_1 = createCylinderArrowMesh(mid_p1p2p3,normal_p1p2p3,form_normal_material2,0.015,0.035,0.55);
                       var form_normal_1_outline = createCylinderArrowMesh(mid_p1p2p3,normal_p1p2p3,form_normal_outlinematerial,0.018,0.038,0.54);

                       form_closingplane.add(form_normal_1);
                       form_closingplane.add(form_normal_1_outline);


                   



            //location of x1 

                       //find x1

                    //    trial_S1,trial_P15,trial_P9

                       var ForceX1_vec = Cal_Vec_2 (trial_S1,trial_P15,trial_P9,0.5);
                       var ForceX1_temp = new THREE.Vector3(TrialP_O.x-1.2*ForceX1_vec.x, TrialP_O.y-1.2*ForceX1_vec.y,TrialP_O.z-1.2*ForceX1_vec.z);   
                     
                       //define intersection point x1
                       var intersect_x1_vec = new THREE.Vector3(ForceX1_temp.x-TrialP_O.x,ForceX1_temp.y-TrialP_O.y,ForceX1_temp.z-TrialP_O.z);
                       var applyplanevec = Cal_Vec_2 (ForceP_A,ForceP_B,ForceP_C,0.5);
                       var ForceX1 = Cal_Plane_Line_Intersect_Point(TrialP_O,intersect_x1_vec,ForceP_B,applyplanevec);
           
                       var line_ox1 = [];
                       line_ox1.push(TrialP_O);
                       line_ox1.push(ForceX1);
   
                       var line_ox1_geo = new THREE.Geometry().setFromPoints( line_ox1 );
   
                       var applyline_1 = new THREE.LineDashedMaterial({
                                    color: "black",//color
                                    dashSize: 0.2,
                                   gapSize: 0.03,
                                   linewidth: 1
   
                                    });
   
                       var applylineox1 = new THREE.LineSegments(line_ox1_geo,applyline_1);
                       applylineox1.computeLineDistances();//compute
                       trial_force.add(applylineox1);

                       //add x1 arrow

                       var TrialP_O_sp1 = new THREE.Sphere(new THREE.Vector3(TrialP_O.x,TrialP_O.y,TrialP_O.z),0.42);
                       var x1_closeP1 = TrialP_O_sp1.clampPoint(ForceX1);

                       var TrialP_O_sp2 = new THREE.Sphere(new THREE.Vector3(TrialP_O.x,TrialP_O.y,TrialP_O.z),0.64);
                       var x1_closeP2 = TrialP_O_sp2.clampPoint(ForceX1);

                       var x1_arrow = createCylinderArrowMesh(x1_closeP1,x1_closeP2,trial_normal_material,0.012,0.025,0.55);

                       trial_force.add(x1_arrow);

                       //find constrain point o1

                       var ForceO1_temp = Cal_Vec_2 (FormCP3,FormCP2,FormCP1,0.5);
                       var ForceO1 = new THREE.Vector3(ForceX1.x-o1.l*ForceO1_temp.x, ForceX1.y-o1.l*ForceO1_temp.y,ForceX1.z-o1.l*ForceO1_temp.z);   

                       var line_o1x1_temp = [];
                       line_o1x1_temp.push(ForceX1);
                       line_o1x1_temp.push(ForceO1);

                       var line_o1x1_geo = new THREE.Geometry().setFromPoints( line_o1x1_temp );

                       var line_o1x1 = new THREE.LineSegments(line_o1x1_geo,applyline_1);
                       line_o1x1.computeLineDistances();//compute
                       trial_force.add(line_o1x1);

                       //add o1 arrow

                       var ForceO1_sp1 = new THREE.Sphere(new THREE.Vector3(ForceO1.x,ForceO1.y,ForceO1.z),0.42);
                       var ForceO1_closeP1 = ForceO1_sp1.clampPoint(ForceX1);

                       var ForceO1_sp2 = new THREE.Sphere(new THREE.Vector3(ForceO1.x,ForceO1.y,ForceO1.z),0.64);
                       var ForceO1_closeP2 = ForceO1_sp2.clampPoint(ForceX1);

                       var ForceO1_arrow = createCylinderArrowMesh(ForceO1_closeP1,ForceO1_closeP2,trial_normal_material,0.012,0.025,0.55);

                       trial_force.add(ForceO1_arrow);


                       //add x1 sphere
                       var materialpointx = new THREE.MeshPhongMaterial({color: "lightgrey", transparent: false});
                          
                       var spforcePointx = new THREE.SphereGeometry(0.01);
                       var new_forcePointx = new THREE.Mesh(spforcePointx, materialpointx);
                       
                       new_forcePointx.position.copy(ForceX1);
                     
                       
                          //Ctrl_tubes.push(sp_Tube0);
                       
                       var outlineMaterialx = new THREE.MeshBasicMaterial( { color: "red", transparent: false, side: THREE.BackSide } );
                       var outlineMeshnewx = new THREE.Mesh( spforcePointx, outlineMaterialx );
                       outlineMeshnewx.position.copy(ForceX1);
                       outlineMeshnewx.scale.multiplyScalar(1.55);
               
                       trial_force.add(new_forcePointx); 
                       trial_force.add(outlineMeshnewx); 



            //final force diagram

                       function create_force_plane(vertice1,vertice2){

                          var vertices = [
                          vertice1,vertice2,ForceO1
                          ];
                          
                          var faces = [
                                  new THREE.Face3(0, 1, 2),                           
                              ];
                          
                          var geom = new THREE.Geometry();
                          geom.vertices = vertices;
                          geom.faces = faces;
                          geom.computeFaceNormals();
                          
                          var material_trial = [
                          //new THREE.MeshLambertMaterial({color: 0x4d4dff, transparent: true}),
                          new THREE.MeshBasicMaterial({color: "white", wireframe: true, transparent: true,opacity:0.1}),
                          new THREE.MeshPhongMaterial({
                          color: 0x009600,transparent: true,opacity:0.2,side:THREE.DoubleSide,depthWrite:false
                          } )
                          ];
                          
                          var trial_faces = THREE.SceneUtils.createMultiMaterialObject(geom, material_trial);
                          return trial_faces
                          
                          }
                          
                   //force faces - Part 1 - A A1 B1 B
                          
                          var Force_AB = create_force_plane(ForceP_A,ForceP_B);
                          var Force_AAB = create_force_plane(ForceP_A,ForceP_AB);
                          var Force_ABB = create_force_plane(ForceP_AB,ForceP_B);
                          var Force_ABB1 = create_force_plane(ForceP_AB,ForceP_B_1);
                          var Force_ABA1 = create_force_plane(ForceP_AB,ForceP_A_1);
                          var Force_A1A = create_force_plane(ForceP_A_1,ForceP_A);
                          var Force_B1B = create_force_plane(ForceP_B_1,ForceP_B);
                          var Force_A1B1 = create_force_plane(ForceP_A_1,ForceP_B_1);
                          
                          force_group.add(Force_AB) 
                          force_group.add(Force_AAB) 
                          force_group.add(Force_ABB) 
                          force_group.add(Force_ABB1)
                          force_group.add(Force_ABA1)
                          force_group.add(Force_A1A) 
                          force_group.add(Force_B1B) 
                          force_group.add(Force_A1B1)

                          Force_AB.children[0].castShadow = true
                          Force_AAB.children[0].castShadow = true
                          Force_ABB.children[0].castShadow = true 
                          Force_ABB1.children[0].castShadow = true
                          Force_ABA1.children[0].castShadow = true
                          Force_A1A.children[0].castShadow = true 
                          Force_B1B.children[0].castShadow = true
                          Force_A1B1.children[0].castShadow = true

                   //force faces - Part 2 - A A1 C1 C

                        var Force_AC = create_force_plane(ForceP_A,ForceP_C);
                        var Force_AAC = create_force_plane(ForceP_A,ForceP_AC);
                        var Force_ACC = create_force_plane(ForceP_AC,ForceP_C);
                        var Force_ACC1 = create_force_plane(ForceP_AC,ForceP_C_1);
                        var Force_ACA1 = create_force_plane(ForceP_AB,ForceP_A_1);
                        var Force_C1C = create_force_plane(ForceP_C_1,ForceP_C);
                        var Force_A1C1 = create_force_plane(ForceP_A_1,ForceP_C_1);

                        force_group.add(Force_AC) 
                        force_group.add(Force_AAC) 
                        force_group.add(Force_ACC) 
                        force_group.add(Force_ACC1)
                        force_group.add(Force_ACA1)
                        force_group.add(Force_C1C) 
                        force_group.add(Force_A1C1)

                          Force_AC.children[0].castShadow = true
                          Force_AAC.children[0].castShadow = true
                          Force_ACC.children[0].castShadow = true 
                          Force_ACC1.children[0].castShadow = true
                          Force_ACA1.children[0].castShadow = true
                          Force_C1C.children[0].castShadow = true 
                          Force_A1C1.children[0].castShadow = true
                          

                   //force faces - Part 3 - B B1 C1 C

                        var Force_BC = create_force_plane(ForceP_B,ForceP_C);
                        var Force_BBC = create_force_plane(ForceP_B,ForceP_BC);
                        var Force_BCC = create_force_plane(ForceP_BC,ForceP_C);
                        var Force_BCC1 = create_force_plane(ForceP_BC,ForceP_C_1);
                        var Force_BCB1 = create_force_plane(ForceP_BC,ForceP_B_1);
                        var Force_B1C1 = create_force_plane(ForceP_B_1,ForceP_C_1);

                        force_group.add(Force_BC) 
                        force_group.add(Force_BBC) 
                        force_group.add(Force_BCC) 
                        force_group.add(Force_BCC1)
                        force_group.add(Force_BCB1)
                        force_group.add(Force_B1C1)

                        
                          Force_BC.children[0].castShadow = true
                          Force_BBC.children[0].castShadow = true
                          Force_BCC.children[0].castShadow = true 
                          Force_BCC1.children[0].castShadow = true
                          Force_BCB1.children[0].castShadow = true
                          Force_B1C1.children[0].castShadow = true
                  
            // cal force face areas 

                     function create_force_face_area(point1,point2,pointO){
                        var face_area = new THREE.Vector3().crossVectors(
                           new THREE.Vector3().subVectors( point1, pointO ),
                           new THREE.Vector3().subVectors( point2, pointO ),
                           ).length()/2
                       
                        return face_area
                     }

                          var Force_area_AB = create_force_face_area(ForceP_A,ForceP_B,ForceO1);
                          var Force_area_AAB = create_force_face_area(ForceP_A,ForceP_AB,ForceO1);
                          var Force_area_ABB = create_force_face_area(ForceP_AB,ForceP_B,ForceO1);
                          var Force_area_ABB1 = create_force_face_area(ForceP_AB,ForceP_B_1,ForceO1);
                          var Force_area_ABA1 = create_force_face_area(ForceP_AB,ForceP_A_1,ForceO1);
                          var Force_area_A1A = create_force_face_area(ForceP_A_1,ForceP_A,ForceO1);
                          var Force_area_B1B = create_force_face_area(ForceP_B_1,ForceP_B,ForceO1);
                          var Force_area_A1B1 = create_force_face_area(ForceP_A_1,ForceP_B_1,ForceO1);

                          var Force_area_AC = create_force_face_area(ForceP_A,ForceP_C,ForceO1);
                          var Force_area_AAC = create_force_face_area(ForceP_A,ForceP_AC,ForceO1);
                          var Force_area_ACC = create_force_face_area(ForceP_AC,ForceP_C,ForceO1);
                          var Force_area_ACC1 = create_force_face_area(ForceP_AC,ForceP_C_1,ForceO1);
                          var Force_area_ACA1 = create_force_face_area(ForceP_AB,ForceP_A_1,ForceO1);
                          var Force_area_C1C = create_force_face_area(ForceP_C_1,ForceP_C,ForceO1);
                          var Force_area_A1C1 = create_force_face_area(ForceP_A_1,ForceP_C_1,ForceO1);

                          var Force_area_BC = create_force_face_area(ForceP_B,ForceP_C,ForceO1);
                          var Force_area_BBC = create_force_face_area(ForceP_B,ForceP_BC,ForceO1);
                          var Force_area_BCC = create_force_face_area(ForceP_BC,ForceP_C,ForceO1);
                          var Force_area_BCC1 = create_force_face_area(ForceP_BC,ForceP_C_1,ForceO1);
                          var Force_area_BCB1 = create_force_face_area(ForceP_BC,ForceP_B_1,ForceO1);
                          var Force_area_B1C1 = create_force_face_area(ForceP_B_1,ForceP_C_1,ForceO1);
     
                          var max = Math.max(
                               Force_area_AB,
                               Force_area_AAB,
                               Force_area_ABB, 
                               Force_area_ABB1, 
                               Force_area_ABA1, 
                               Force_area_A1A, 
                               Force_area_B1B, 
                               Force_area_A1B1,   

                               Force_area_AC,
                               Force_area_AAC, 
                               Force_area_ACC, 
                               Force_area_ACC1, 
                               Force_area_ACA1, 
                               Force_area_C1C, 
                               Force_area_A1C1,     

                               Force_area_BC,
                               Force_area_BBC, 
                               Force_area_BCC, 
                               Force_area_BCC1, 
                               Force_area_BCB1, 
                               Force_area_B1C1 
                          
                          )

                          function create_form_tubes(face_area,face_area_max,scale,startPoint,targetPoint,PointO){
                            var form_mesh = face_area/face_area_max
                            tt = scale*face_area
                           
                            var Sphere_Point = new THREE.Sphere(new THREE.Vector3(targetPoint.x,targetPoint.y,targetPoint.z),0.06);
                            var Close_Point = Sphere_Point.clampPoint(startPoint);

                            var Sphere_Point2 = new THREE.Sphere(new THREE.Vector3(startPoint.x,startPoint.y,startPoint.z),0.06);
                            var Close_Point2 = Sphere_Point2.clampPoint(targetPoint);


                            if (PointO.z<=ForceP_A.z){

                                    if (form_mesh<0.25 & form_mesh>=0)
                                      { var Colorbar_blue_1 = new THREE.MeshPhongMaterial( {
                                                          color: 0x5B84AE
                                                      } );
                                     var spGeom_Point = new THREE.SphereGeometry(tt-0.001);
                                     var sp_Point = new THREE.Mesh(spGeom_Point, Colorbar_blue_1);
                                     var sp_Point2 = new THREE.Mesh(spGeom_Point, Colorbar_blue_1);
                                     sp_Point.position.copy(Close_Point);
                                     sp_Point2.position.copy(Close_Point2);
                                     var tubeMesh=createCylinderMesh(Close_Point2,Close_Point,Colorbar_blue_1,tt,tt);
                                     //var tube_arrow_3o2=createCylinderArrowMesh(newArrowP3O2 ,FormCP3,Colorbar_blue_1,0.02,0.05,0.6);
                                                    }
                                    if (form_mesh<0.5 & form_mesh>=0.25)
                                    {  var Colorbar_blue_2 = new THREE.MeshPhongMaterial( {
                                                          color: 0x376D9B
                                                      } );
                                     var spGeom_Point = new THREE.SphereGeometry(tt-0.001);
                                     var sp_Point = new THREE.Mesh(spGeom_Point, Colorbar_blue_2);
                                     var sp_Point2 = new THREE.Mesh(spGeom_Point, Colorbar_blue_2);
                                     sp_Point.position.copy(Close_Point);
                                     sp_Point2.position.copy(Close_Point2);
                                     var tubeMesh=createCylinderMesh(Close_Point2,Close_Point,Colorbar_blue_2,tt,tt);
                                    // var tube_arrow_3o2=createCylinderArrowMesh(newArrowP3O2 ,FormCP3,Colorbar_blue_2,0.02,0.05,0.6);
                                                    }
                                    if (form_mesh<0.75 & form_mesh>=0.5)
                                    {  var Colorbar_blue_3 = new THREE.MeshPhongMaterial( {
                                                          color: 0x05416D
                                                      } );
                                     var spGeom_Point = new THREE.SphereGeometry(tt-0.001);
                                     var sp_Point = new THREE.Mesh(spGeom_Point, Colorbar_blue_3);
                                     var sp_Point2 = new THREE.Mesh(spGeom_Point, Colorbar_blue_3);
                                     sp_Point.position.copy(Close_Point);
                                     sp_Point2.position.copy(Close_Point2);
                                     var tubeMesh=createCylinderMesh(Close_Point2,Close_Point,Colorbar_blue_3,tt,tt);
                                     //var tube_arrow_3o2=createCylinderArrowMesh(newArrowP3O2,FormCP3,Colorbar_blue_3,0.02,0.05,0.6);
                                    }
          
                                    if (form_mesh>=0.75)
                                    {  var Colorbar_blue_4 = new THREE.MeshPhongMaterial( {
                                                          color: 0x0F3150
                                                      } );
                                     var spGeom_Point = new THREE.SphereGeometry(tt-0.001);
                                     var sp_Point = new THREE.Mesh(spGeom_Point, Colorbar_blue_4);
                                     var sp_Point2 = new THREE.Mesh(spGeom_Point, Colorbar_blue_4);
                                     sp_Point.position.copy(Close_Point);
                                     sp_Point2.position.copy(Close_Point2);
                                     var tubeMesh=createCylinderMesh(Close_Point2,Close_Point,Colorbar_blue_4,tt,tt);
                                     //var tube_arrow_3o2=createCylinderArrowMesh(newArrowP3O2,FormCP3,Colorbar_blue_4,0.02,0.05,0.6);
                                    }
                                    form_group.add(sp_Point); 
                                form_group.add(sp_Point2);
                                form_group.add(tubeMesh); 
                                // form_group.add(tube_arrow_3o2); 
                                sp_Point.castShadow=true;
                                sp_Point2.castShadow=true;
                                tubeMesh.castShadow=true;
                
                            }

                           else if(PointO.z>ForceP_A.z){

                                if (form_mesh<0.25 & form_mesh>=0)
                                { var Colorbar_red_1 = new THREE.MeshPhongMaterial( {
                                                     color: 0xD72F62
                                                 } );
                                     var spGeom_Point = new THREE.SphereGeometry(tt-0.001);
                                     var sp_Point = new THREE.Mesh(spGeom_Point, Colorbar_red_1);
                                     var sp_Point2 = new THREE.Mesh(spGeom_Point, Colorbar_red_1);
                                     sp_Point.position.copy(Close_Point);
                                     sp_Point2.position.copy(Close_Point2);
                                     var tubeMesht=createCylinderMesh(Close_Point2,Close_Point,Colorbar_red_1,tt,tt);
                                     //var tube_arrow2=createCylinderArrowMesh(TubePoints2[1],new THREE.Vector3(1.22*TubePoints2[1].x,1.22*TubePoints2[1].y,1.22*TubePoints2[1].z),Colorbar_red_1,0.02,0.05,0.6);
                                               }
                               if (form_mesh<0.5 & form_mesh>=0.25)
                               {  var Colorbar_red_2 = new THREE.MeshPhongMaterial( {
                                                     color: 0xCC0549
                                                 } );
                                     var spGeom_Point = new THREE.SphereGeometry(tt-0.001);
                                     var sp_Point = new THREE.Mesh(spGeom_Point, Colorbar_red_2);
                                     var sp_Point2 = new THREE.Mesh(spGeom_Point, Colorbar_red_2);
                                     sp_Point.position.copy(Close_Point);
                                     sp_Point2.position.copy(Close_Point2);
                                     var tubeMesht=createCylinderMesh(Close_Point2,Close_Point,Colorbar_red_2,tt,tt);
                                      //var tube_arrow2=createCylinderArrowMesh(TubePoints2[1],new THREE.Vector3(1.22*TubePoints2[1].x,1.22*TubePoints2[1].y,1.22*TubePoints2[1].z),Colorbar_red_2,0.02,0.05,0.6);
                                               }
                               if (form_mesh<0.75 & form_mesh>=0.5)
                               {  var Colorbar_red_3 = new THREE.MeshPhongMaterial( {
                                                     color: 0x940041
                                                 } );
                                     var spGeom_Point = new THREE.SphereGeometry(tt-0.001);
                                     var sp_Point = new THREE.Mesh(spGeom_Point, Colorbar_red_3);
                                     var sp_Point2 = new THREE.Mesh(spGeom_Point, Colorbar_red_3);
                                     sp_Point.position.copy(Close_Point);
                                     sp_Point2.position.copy(Close_Point2);
                                     var tubeMesht=createCylinderMesh(Close_Point2,Close_Point,Colorbar_red_3,tt,tt);
                                     //var tube_arrow2=createCylinderArrowMesh(TubePoints2[1],new THREE.Vector3(1.22*TubePoints2[1].x,1.22*TubePoints2[1].y,1.22*TubePoints2[1].z),Colorbar_red_3,0.02,0.05,0.6);
                               }
               
                               if (form_mesh>=0.75)
                               {  var Colorbar_red_4 = new THREE.MeshPhongMaterial( {
                                                     color: 0x80002F
                                                 } );
                                     var spGeom_Point = new THREE.SphereGeometry(tt-0.001);
                                     var sp_Point = new THREE.Mesh(spGeom_Point, Colorbar_red_4);
                                     var sp_Point2 = new THREE.Mesh(spGeom_Point, Colorbar_red_4);
                                     sp_Point.position.copy(Close_Point);
                                     sp_Point2.position.copy(Close_Point2);
                                     var tubeMesht=createCylinderMesh(Close_Point2,Close_Point,Colorbar_red_4,tt,tt);
                                //var tube_arrow2=createCylinderArrowMesh(TubePoints2[1],new THREE.Vector3(1.22*TubePoints2[1].x,1.22*TubePoints2[1].y,1.22*TubePoints2[1].z),Colorbar_red_4,0.02,0.05,0.6);
                               }
                               form_group.add(sp_Point); 
                                form_group.add(sp_Point2);
                                form_group.add(tubeMesht); 
                                // form_group.add(tube_arrow_3o2); 
                                sp_Point.castShadow=true;
                                sp_Point2.castShadow=true;
                                tubeMesht.castShadow=true;
                                                     
                                               }



                          }

                          function create_form_tubes_white(face_area,face_area_max,scale,startPoint,targetPoint,PointO){
                            var form_mesh = face_area/face_area_max
                            tt = scale*face_area
                           
                            var Sphere_Point = new THREE.Sphere(new THREE.Vector3(targetPoint.x,targetPoint.y,targetPoint.z),0.06);
                            var Close_Point = Sphere_Point.clampPoint(startPoint);

                            var Sphere_Point2 = new THREE.Sphere(new THREE.Vector3(startPoint.x,startPoint.y,startPoint.z),0.06);
                            var Close_Point2 = Sphere_Point2.clampPoint(targetPoint);


                            if (PointO.z<=ForceP_A.z){

                                    if (form_mesh<0.25 & form_mesh>=0)
                                      { var Colorbar_blue_1 = new THREE.MeshPhongMaterial( {
                                                          color: 0xececec
                                                      } );
                                     var spGeom_Point = new THREE.SphereGeometry(tt-0.001);
                                     var sp_Point = new THREE.Mesh(spGeom_Point, Colorbar_blue_1);
                                     var sp_Point2 = new THREE.Mesh(spGeom_Point, Colorbar_blue_1);
                                     sp_Point.position.copy(Close_Point);
                                     sp_Point2.position.copy(Close_Point2);
                                     var tubeMesh=createCylinderMesh(Close_Point2,Close_Point,Colorbar_blue_1,tt,tt);
                                     //var tube_arrow_3o2=createCylinderArrowMesh(newArrowP3O2 ,FormCP3,Colorbar_blue_1,0.02,0.05,0.6);
                                                    }
                                    if (form_mesh<0.5 & form_mesh>=0.25)
                                    {  var Colorbar_blue_2 = new THREE.MeshPhongMaterial( {
                                                          color: 0xececec
                                                      } );
                                     var spGeom_Point = new THREE.SphereGeometry(tt-0.001);
                                     var sp_Point = new THREE.Mesh(spGeom_Point, Colorbar_blue_2);
                                     var sp_Point2 = new THREE.Mesh(spGeom_Point, Colorbar_blue_2);
                                     sp_Point.position.copy(Close_Point);
                                     sp_Point2.position.copy(Close_Point2);
                                     var tubeMesh=createCylinderMesh(Close_Point2,Close_Point,Colorbar_blue_2,tt,tt);
                                    // var tube_arrow_3o2=createCylinderArrowMesh(newArrowP3O2 ,FormCP3,Colorbar_blue_2,0.02,0.05,0.6);
                                                    }
                                    if (form_mesh<0.75 & form_mesh>=0.5)
                                    {  var Colorbar_blue_3 = new THREE.MeshPhongMaterial( {
                                                          color: 0xececec
                                                      } );
                                     var spGeom_Point = new THREE.SphereGeometry(tt-0.001);
                                     var sp_Point = new THREE.Mesh(spGeom_Point, Colorbar_blue_3);
                                     var sp_Point2 = new THREE.Mesh(spGeom_Point, Colorbar_blue_3);
                                     sp_Point.position.copy(Close_Point);
                                     sp_Point2.position.copy(Close_Point2);
                                     var tubeMesh=createCylinderMesh(Close_Point2,Close_Point,Colorbar_blue_3,tt,tt);
                                     //var tube_arrow_3o2=createCylinderArrowMesh(newArrowP3O2,FormCP3,Colorbar_blue_3,0.02,0.05,0.6);
                                    }
          
                                    if (form_mesh>=0.75)
                                    {  var Colorbar_blue_4 = new THREE.MeshPhongMaterial( {
                                                          color: 0xececec
                                                      } );
                                     var spGeom_Point = new THREE.SphereGeometry(tt-0.001);
                                     var sp_Point = new THREE.Mesh(spGeom_Point, Colorbar_blue_4);
                                     var sp_Point2 = new THREE.Mesh(spGeom_Point, Colorbar_blue_4);
                                     sp_Point.position.copy(Close_Point);
                                     sp_Point2.position.copy(Close_Point2);
                                     var tubeMesh=createCylinderMesh(Close_Point2,Close_Point,Colorbar_blue_4,tt,tt);
                                     //var tube_arrow_3o2=createCylinderArrowMesh(newArrowP3O2,FormCP3,Colorbar_blue_4,0.02,0.05,0.6);
                                    }
                                    form_group.add(sp_Point); 
                                form_group.add(sp_Point2);
                                form_group.add(tubeMesh); 
                                // form_group.add(tube_arrow_3o2); 
                                sp_Point.castShadow=true;
                                sp_Point2.castShadow=true;
                                tubeMesh.castShadow=true;
                
                            }

                           else if(PointO.z>ForceP_A.z){

                                if (form_mesh<0.25 & form_mesh>=0)
                                { var Colorbar_red_1 = new THREE.MeshPhongMaterial( {
                                                     color: 0xececec
                                                 } );
                                     var spGeom_Point = new THREE.SphereGeometry(tt-0.001);
                                     var sp_Point = new THREE.Mesh(spGeom_Point, Colorbar_red_1);
                                     var sp_Point2 = new THREE.Mesh(spGeom_Point, Colorbar_red_1);
                                     sp_Point.position.copy(Close_Point);
                                     sp_Point2.position.copy(Close_Point2);
                                     var tubeMesht=createCylinderMesh(Close_Point2,Close_Point,Colorbar_red_1,tt,tt);
                                     //var tube_arrow2=createCylinderArrowMesh(TubePoints2[1],new THREE.Vector3(1.22*TubePoints2[1].x,1.22*TubePoints2[1].y,1.22*TubePoints2[1].z),Colorbar_red_1,0.02,0.05,0.6);
                                               }
                               if (form_mesh<0.5 & form_mesh>=0.25)
                               {  var Colorbar_red_2 = new THREE.MeshPhongMaterial( {
                                                     color: 0xececec
                                                 } );
                                     var spGeom_Point = new THREE.SphereGeometry(tt-0.001);
                                     var sp_Point = new THREE.Mesh(spGeom_Point, Colorbar_red_2);
                                     var sp_Point2 = new THREE.Mesh(spGeom_Point, Colorbar_red_2);
                                     sp_Point.position.copy(Close_Point);
                                     sp_Point2.position.copy(Close_Point2);
                                     var tubeMesht=createCylinderMesh(Close_Point2,Close_Point,Colorbar_red_2,tt,tt);
                                      //var tube_arrow2=createCylinderArrowMesh(TubePoints2[1],new THREE.Vector3(1.22*TubePoints2[1].x,1.22*TubePoints2[1].y,1.22*TubePoints2[1].z),Colorbar_red_2,0.02,0.05,0.6);
                                               }
                               if (form_mesh<0.75 & form_mesh>=0.5)
                               {  var Colorbar_red_3 = new THREE.MeshPhongMaterial( {
                                                     color: 0xececec
                                                 } );
                                     var spGeom_Point = new THREE.SphereGeometry(tt-0.001);
                                     var sp_Point = new THREE.Mesh(spGeom_Point, Colorbar_red_3);
                                     var sp_Point2 = new THREE.Mesh(spGeom_Point, Colorbar_red_3);
                                     sp_Point.position.copy(Close_Point);
                                     sp_Point2.position.copy(Close_Point2);
                                     var tubeMesht=createCylinderMesh(Close_Point2,Close_Point,Colorbar_red_3,tt,tt);
                                     //var tube_arrow2=createCylinderArrowMesh(TubePoints2[1],new THREE.Vector3(1.22*TubePoints2[1].x,1.22*TubePoints2[1].y,1.22*TubePoints2[1].z),Colorbar_red_3,0.02,0.05,0.6);
                               }
               
                               if (form_mesh>=0.75)
                               {  var Colorbar_red_4 = new THREE.MeshPhongMaterial( {
                                                     color: 0xececec
                                                 } );
                                     var spGeom_Point = new THREE.SphereGeometry(tt-0.001);
                                     var sp_Point = new THREE.Mesh(spGeom_Point, Colorbar_red_4);
                                     var sp_Point2 = new THREE.Mesh(spGeom_Point, Colorbar_red_4);
                                     sp_Point.position.copy(Close_Point);
                                     sp_Point2.position.copy(Close_Point2);
                                     var tubeMesht=createCylinderMesh(Close_Point2,Close_Point,Colorbar_red_4,tt,tt);
                                //var tube_arrow2=createCylinderArrowMesh(TubePoints2[1],new THREE.Vector3(1.22*TubePoints2[1].x,1.22*TubePoints2[1].y,1.22*TubePoints2[1].z),Colorbar_red_4,0.02,0.05,0.6);
                               }
                               form_group.add(sp_Point); 
                                form_group.add(sp_Point2);
                                form_group.add(tubeMesht); 
                                // form_group.add(tube_arrow_3o2); 
                                sp_Point.castShadow=true;
                                sp_Point2.castShadow=true;
                                tubeMesht.castShadow=true;
                                                     
                                               }



                          }


                            //  var trial_P1 = create_trial_intec (trial_S1,ForceP_A,TrialP_O,ForceP_C,FormG_AC,FormG_ACb);
                            var Form_P1 = create_trial_intec (FormCP3,ForceP_A,ForceO1,ForceP_C,FormG_AC,FormG_ACb);
                            //  var trial_P2 = create_trial_intec (trial_P1,ForceP_AC,TrialP_O,ForceP_C,FormG_ACC,FormG_ACCb);
                            var Form_P2 = create_trial_intec (Form_P1,ForceP_AC,ForceO1,ForceP_C,FormG_ACC,FormG_ACCb);
                            //  var trial_P3 = create_trial_intec (trial_P1,ForceP_AC,TrialP_O,ForceP_A,FormG_AACA1,FormG_AACA1b);
                            var Form_P3 = create_trial_intec (Form_P1,ForceP_AC,ForceO1,ForceP_A,FormG_AACA1,FormG_AACA1b);
                            //  var trial_P4 = create_trial_intec (trial_P2,ForceP_AC,TrialP_O,ForceP_C_1,FormG_C1AC,FormG_C1ACb);
                            var Form_P4 = create_trial_intec (Form_P2,ForceP_AC,ForceO1,ForceP_C_1,FormG_C1AC,FormG_C1ACb);
                            //  var trial_P5 = create_trial_intec (trial_P3,ForceP_A_1,TrialP_O,ForceP_A,FormG_AA1AB,FormG_AA1ABb);
                            var Form_P5 = create_trial_intec (Form_P3,ForceP_A_1,ForceO1,ForceP_A,FormG_AA1AB,FormG_AA1ABb);
                            //  var trial_P6 = create_trial_intec (trial_P2,ForceP_C_1,TrialP_O,ForceP_C,FormG_C1C,FormG_C1Cb);
                            var Form_P6 = create_trial_intec (Form_P2,ForceP_C_1,ForceO1,ForceP_C,FormG_C1C,FormG_C1Cb);
                            //  var trial_P7 = create_trial_intec (trial_P4,ForceP_A_1,TrialP_O,ForceP_C_1,FormG_A1C1B1,FormG_A1C1B1b);
                            var Form_P7 = create_trial_intec (Form_P4,ForceP_A_1,ForceO1,ForceP_C_1,FormG_A1C1B1,FormG_A1C1B1b);
                            //  var trial_P8 = create_trial_intec (trial_P6,ForceP_BC,TrialP_O,ForceP_C,FormG_BCCB,FormG_BCCBb);
                            var Form_P8 = create_trial_intec (Form_P6,ForceP_BC,ForceO1,ForceP_C,FormG_BCCB,FormG_BCCBb);
                            //  var trial_P9 = create_trial_intec (trial_P8,ForceP_B,TrialP_O,ForceP_C,FormG_2,FormG_2B);
                            var Form_P9 = create_trial_intec (Form_P8,ForceP_B,ForceO1,ForceP_C,FormG_2,FormG_2B);
                            //  var trial_P10 = create_trial_intec (trial_P6,ForceP_BC,TrialP_O,ForceP_C_1,FormG_C1BC,FormG_C1BCb);
                            var Form_P10 = create_trial_intec (Form_P6,ForceP_BC,ForceO1,ForceP_C_1,FormG_C1BC,FormG_C1BCb);
                            //  var trial_P11 = create_trial_intec (trial_P7,ForceP_B_1,TrialP_O,ForceP_A_1,FormG_A1B1,FormG_A1B1b);
                            var Form_P11 = create_trial_intec (Form_P7,ForceP_B_1,ForceO1,ForceP_A_1,FormG_A1B1,FormG_A1B1b);
                            //  var trial_P12= create_trial_intec (trial_P10,ForceP_B_1,TrialP_O,ForceP_BC,FormG_B1BCB,FormG_B1BCBb);
                            var Form_P12= create_trial_intec (Form_P10,ForceP_B_1,ForceO1,ForceP_BC,FormG_B1BCB,FormG_B1BCBb);
                            //  var trial_P13= create_trial_intec (trial_P11,ForceP_B_1,TrialP_O,ForceP_AB,FormG_ABB1B,FormG_ABB1Bb);
                            var Form_P13= create_trial_intec (Form_P11,ForceP_B_1,ForceO1,ForceP_AB,FormG_ABB1B,FormG_ABB1Bb);
                            //  var trial_P14= create_trial_intec (trial_P5,ForceP_A,TrialP_O,ForceP_AB,FormG_AABB,FormG_AABBb);
                            var Form_P14= create_trial_intec (Form_P5,ForceP_A,ForceO1,ForceP_AB,FormG_AABB,FormG_AABBb);
                            //  var trial_P15= create_trial_intec (trial_P14,ForceP_A,TrialP_O,ForceP_B,FormG_1,FormG_1B);
                            var Form_P15= create_trial_intec (Form_P14,ForceP_A,ForceO1,ForceP_B,FormG_1,FormG_1B);
                  
                            //  var trial_mesh_1 = createCylinderMesh(trial_S1,trial_P1,DragPointMat,0.02,0.02);
                            //  var trial_mesh_2 = createCylinderMesh(trial_P1,trial_P2,DragPointMat,0.02,0.02);
                            //  var trial_mesh_3 = createCylinderMesh(trial_P1,trial_P3,DragPointMat,0.02,0.02);
                            //  var trial_mesh_4 = createCylinderMesh(trial_P2,trial_P4,DragPointMat,0.02,0.02);
                            //  var trial_mesh_5 = createCylinderMesh(trial_P3,trial_P4,DragPointMat,0.02,0.02);
                            //  var trial_mesh_6 = createCylinderMesh(trial_P3,trial_P5,DragPointMat,0.02,0.02);
                            //  var trial_mesh_7 = createCylinderMesh(trial_P2,trial_P6,DragPointMat,0.02,0.02);
                            //  var trial_mesh_8 = createCylinderMesh(trial_P4,trial_P7,DragPointMat,0.02,0.02);
                            //  var trial_mesh_9 = createCylinderMesh(trial_P6,trial_P8,DragPointMat,0.02,0.02);
                            //  var trial_mesh_10 = createCylinderMesh(trial_P8,trial_P9,DragPointMat,0.02,0.02);
                            //  var trial_mesh_11 = createCylinderMesh(trial_P6,trial_P10,DragPointMat,0.02,0.02);
                            //  var trial_mesh_12 = createCylinderMesh(trial_P7,trial_P10,DragPointMat,0.02,0.02);
                            //  var trial_mesh_13 = createCylinderMesh(trial_P7,trial_P11,DragPointMat,0.02,0.02);
                            //  var trial_mesh_14 = createCylinderMesh(trial_P5,trial_P11,DragPointMat,0.02,0.02);
                            //  var trial_mesh_15 = createCylinderMesh(trial_P10,trial_P12,DragPointMat,0.02,0.02);
                            //  var trial_mesh_16 = createCylinderMesh(trial_P11,trial_P13,DragPointMat,0.02,0.02);
                            //  var trial_mesh_17 = createCylinderMesh(trial_P5,trial_P14,DragPointMat,0.02,0.02);
                            //  var trial_mesh_18 = createCylinderMesh(trial_P8,trial_P12,DragPointMat,0.02,0.02);
                            //  var trial_mesh_19 = createCylinderMesh(trial_P12,trial_P13,DragPointMat,0.02,0.02);
                            //  var trial_mesh_20 = createCylinderMesh(trial_P13,trial_P14,DragPointMat,0.02,0.02);
                            //  var trial_mesh_21 = createCylinderMesh(trial_P14,trial_P15,DragPointMat,0.02,0.02);
                          
                         //   create_form_tubes(face_area,face_area_max,scale,startPoint,targetPoint,PointO)
                          var form_mesh_1 = create_form_tubes( Force_area_AC,max,0.025,FormCP3,Form_P1,ForceO1);
                          var form_mesh_2 = create_form_tubes( Force_area_ACC,max,0.03,Form_P1,Form_P2,ForceO1);
                          var form_mesh_3 = create_form_tubes( Force_area_AAC,max,0.03,Form_P1,Form_P3,ForceO1);
                          var form_mesh_4 = create_form_tubes( Force_area_ACC1,max,0.03,Form_P2,Form_P4,ForceO1);
                          var form_mesh_5 = create_form_tubes( Force_area_ACA1,max,0.03,Form_P3,Form_P4,ForceO1);
                          var form_mesh_6 = create_form_tubes( Force_area_A1A,max,0.03,Form_P3,Form_P5,ForceO1);
                          var form_mesh_7 = create_form_tubes( Force_area_C1C,max,0.03,Form_P2,Form_P6,ForceO1);
                          var form_mesh_8 = create_form_tubes( Force_area_A1C1,max,0.03,Form_P4,Form_P7,ForceO1);
                          var form_mesh_9 = create_form_tubes( Force_area_BCC,max,0.03,Form_P6,Form_P8,ForceO1);
                          var form_mesh_10 = create_form_tubes( Force_area_BC,max,0.025,Form_P8,Form_P9,ForceO1);
                          var form_mesh_11 = create_form_tubes( Force_area_BCC1,max,0.03,Form_P6,Form_P10,ForceO1);
                          var form_mesh_12 = create_form_tubes( Force_area_B1C1,max,0.03,Form_P7,Form_P10,ForceO1);
                          var form_mesh_13 = create_form_tubes( Force_area_A1B1,max,0.03,Form_P7,Form_P11,ForceO1);
                          var form_mesh_14 = create_form_tubes( Force_area_ABA1,max,0.03,Form_P5,Form_P11,ForceO1);
                          var form_mesh_15 = create_form_tubes( Force_area_BCB1,max,0.03,Form_P10,Form_P12,ForceO1);
                          var form_mesh_16 = create_form_tubes( Force_area_ABB1,max,0.03,Form_P11,Form_P13,ForceO1);
                          var form_mesh_17 = create_form_tubes( Force_area_AAB,max,0.03,Form_P5,Form_P14,ForceO1);
                          var form_mesh_18 = create_form_tubes( Force_area_BBC,max,0.03,Form_P8,Form_P12,ForceO1);
                          var form_mesh_19 = create_form_tubes( Force_area_B1B,max,0.03,Form_P12,Form_P13,ForceO1);
                          var form_mesh_20 = create_form_tubes( Force_area_ABB,max,0.03,Form_P13,Form_P14,ForceO1);
                          var form_mesh_21 = create_form_tubes( Force_area_AB,max,0.025,Form_P14,Form_P15,ForceO1);
         

           //add form nodes

                          function create_form_node(point,size){
                         
                          var materialpointo = new THREE.MeshPhongMaterial({color: "lightgrey", transparent: false});
                          
                          var spformPoints = new THREE.SphereGeometry(size);
                          var new_formNodes = new THREE.Mesh(spformPoints, materialpointo);
                        
                          new_formNodes.position.copy(point);
                          new_formNodes.castShadow=true;
                        
                             //Ctrl_tubes.push(sp_Tube0);
                        
                          var outlineMaterial1 = new THREE.MeshBasicMaterial( { color: "black", transparent: false, side: THREE.BackSide } );
                          var outlineMeshnew1 = new THREE.Mesh( spformPoints, outlineMaterial1 );
                          outlineMeshnew1.position.copy(point);
                          outlineMeshnew1.scale.multiplyScalar(1.55);
                        
                         form_group.add(new_formNodes); 
                         form_group.add(outlineMeshnew1); 
                          }

                          var Form_P1_Node = create_form_node(Form_P1,0.03);
                          var Form_P2_Node = create_form_node(Form_P2,0.03);
                          var Form_P3_Node = create_form_node(Form_P3,0.03);
                          var Form_P4_Node = create_form_node(Form_P4,0.03);
                          var Form_P5_Node = create_form_node(Form_P5,0.03);
                          var Form_P6_Node = create_form_node(Form_P6,0.03);
                          var Form_P7_Node = create_form_node(Form_P7,0.03);
                          var Form_P8_Node = create_form_node(Form_P8,0.03);
                          
                          var Form_P10_Node = create_form_node(Form_P10,0.03);
                          var Form_P11_Node = create_form_node(Form_P11,0.03);
                          var Form_P12_Node = create_form_node(Form_P12,0.03);
                          var Form_P13_Node = create_form_node(Form_P13,0.03);
                          var Form_P14_Node = create_form_node(Form_P14,0.03);


            // add form R arrow
                           var arrow_r2=new THREE.MeshPhongMaterial( {color: 0x009600} );
   
                           var arrow_r2_outline = new THREE.MeshBasicMaterial( { color: "white", transparent: false, side: THREE.BackSide } );

                           var arrow_r=new THREE.MeshPhongMaterial( {color: 0x009600} );
   
                           var arrow_r_outline = new THREE.MeshBasicMaterial( { color: "white", transparent: false, side: THREE.BackSide } );
                          
                        
                           var R_arrow_P1 = new THREE.Sphere(new THREE.Vector3(Form_P14.x,Form_P14.y,Form_P14.z),0.1);
                           var R_closeP1 = R_arrow_P1.clampPoint(FormCP1);
                           var R_vec1 = new THREE.Vector3(R_closeP1.x-Form_P14.x,R_closeP1.y-Form_P14.y,R_closeP1.z-Form_P14.z);
                           var R_arrow_1_a = new THREE.Vector3(FormCP1.x+2.5*R_vec1.x,FormCP1.y+2.5*R_vec1.y,FormCP1.z+2.5*R_vec1.z)
                           var R_arrow_1_b = new THREE.Vector3(FormCP1.x+2.1*R_vec1.x,FormCP1.y+2.1*R_vec1.y,FormCP1.z+2.1*R_vec1.z)
                        
                           var R_arrow_P2 = new THREE.Sphere(new THREE.Vector3(Form_P8.x,Form_P8.y,Form_P8.z),0.1);
                           var R_closeP2 = R_arrow_P2.clampPoint(FormCP2);
                           var R_vec2 = new THREE.Vector3(R_closeP2.x-Form_P8.x,R_closeP2.y-Form_P8.y,R_closeP2.z-Form_P8.z);
                           var R_arrow_2_a = new THREE.Vector3(FormCP2.x+2.5*R_vec2.x,FormCP2.y+2.5*R_vec2.y,FormCP2.z+2.5*R_vec2.z)
                           var R_arrow_2_b = new THREE.Vector3(FormCP2.x+2.1*R_vec2.x,FormCP2.y+2.1*R_vec2.y,FormCP2.z+2.1*R_vec2.z)
                        
                           var R_arrow_P3 = new THREE.Sphere(new THREE.Vector3(Form_P1.x,Form_P1.y,Form_P1.z),0.1);
                           var R_closeP3 = R_arrow_P3.clampPoint(FormCP3);
                           var R_vec3 = new THREE.Vector3(R_closeP3.x-Form_P1.x,R_closeP3.y-Form_P1.y,R_closeP3.z-Form_P1.z);
                           var R_arrow_3_a = new THREE.Vector3(FormCP3.x+2.5*R_vec3.x,FormCP3.y+2.5*R_vec3.y,FormCP3.z+2.5*R_vec3.z)
                           var R_arrow_3_b = new THREE.Vector3(FormCP3.x+2.1*R_vec3.x,FormCP3.y+2.1*R_vec3.y,FormCP3.z+2.1*R_vec3.z)
                        
                        
                           if(ForceO1.z<=ForceP_B.z){
                           var R_arrow1 = createCylinderArrowMesh(R_arrow_1_a,FormCP1,arrow_r2,0.015,0.035,0.6);
                           var R_arrow1b = createCylinderArrowMesh(R_arrow_1_a,FormCP1,arrow_r2_outline,0.02,0.035,0.57);
                           R_arrow1b.scale.multiplyScalar(1.05);
                        
                           var R_arrow2 = createCylinderArrowMesh(R_arrow_2_a,FormCP2,arrow_r2,0.015,0.035,0.6);
                           var R_arrow2b = createCylinderArrowMesh(R_arrow_2_a,FormCP2,arrow_r2_outline,0.02,0.035,0.57);
                           R_arrow2b.scale.multiplyScalar(1.05);
                        
                           var R_arrow3 = createCylinderArrowMesh(R_arrow_3_a,FormCP3,arrow_r2,0.015,0.035,0.6);
                           var R_arrow3b = createCylinderArrowMesh(R_arrow_3_a,FormCP3,arrow_r2_outline,0.02,0.035,0.57);
                           R_arrow3b.scale.multiplyScalar(1.05);
                        
                           form_closingplane.add(R_arrow1);
                           form_closingplane.add(R_arrow1b);
                        
                           form_closingplane.add(R_arrow2);
                           form_closingplane.add(R_arrow2b);
                        
                           form_closingplane.add(R_arrow3);
                           form_closingplane.add(R_arrow3b);
                        
                        
                           }
                        
                           
                           if(ForceO1.z>ForceP_B.z){
                           var R_arrow1 =  createCylinderArrowMesh(FormCP1,R_arrow_1_a,arrow_r2,0.015,0.035,0.6);
                           var R_arrow1b = createCylinderArrowMesh(FormCP1,R_arrow_1_a,arrow_r2_outline,0.02,0.035,0.57);
                           R_arrow1b.scale.multiplyScalar(1.05);
                        
                           var R_arrow2 =  createCylinderArrowMesh(FormCP2,R_arrow_2_a,arrow_r2,0.015,0.035,0.6);
                           var R_arrow2b = createCylinderArrowMesh(FormCP2,R_arrow_2_a,arrow_r2_outline,0.02,0.035,0.57);
                           R_arrow2b.scale.multiplyScalar(1.05);
                        
                           var R_arrow3 =  createCylinderArrowMesh(FormCP3,R_arrow_3_a,arrow_r2,0.015,0.035,0.6);
                           var R_arrow3b = createCylinderArrowMesh(FormCP3,R_arrow_3_a,arrow_r2_outline,0.02,0.035,0.57);
                           R_arrow3b.scale.multiplyScalar(1.05);
                        
                           form_closingplane.add(R_arrow1);
                           form_closingplane.add(R_arrow1b);
                        
                           form_closingplane.add(R_arrow2);
                           form_closingplane.add(R_arrow2b);
                        
                           form_closingplane.add(R_arrow3);
                           form_closingplane.add(R_arrow3b);
                        
                           }


                             // add force f1 arrow

                          var f_arrow_1 = new THREE.Vector3((ForceP_A.x+ForceP_B.x+ForceP_AB.x)/3,(ForceP_A.y+ForceP_B.y+ForceP_AB.y)/3,(ForceP_A.z+ForceP_B.z+ForceP_AB.z)/3);
                          var f_arrow_1_a = new THREE.Vector3(f_arrow_1.x,f_arrow_1.y,f_arrow_1.z+0.3)
                          var f_arrow_1_b = new THREE.Vector3(f_arrow_1.x,f_arrow_1.y,f_arrow_1.z-0.3)

                          if(ForceO1.z>ForceP_B.z){
                          var f_arrow1 =  createCylinderArrowMesh(f_arrow_1,f_arrow_1_b,arrow_r,0.015,0.035,0.6);
                          var f_arrow1b = createCylinderArrowMesh(f_arrow_1,f_arrow_1_b,arrow_r_outline,0.02,0.035,0.58);
                          f_arrow1b.scale.multiplyScalar(1.05);

                          force_group.add(f_arrow1);
                          force_group.add(f_arrow1b);
                          }

                          if(ForceO1.z<=ForceP_B.z){
                          var f_arrow1 =  createCylinderArrowMesh(f_arrow_1_a,f_arrow_1,arrow_r,0.015,0.035,0.6);
                          var f_arrow1b = createCylinderArrowMesh(f_arrow_1_a,f_arrow_1,arrow_r_outline,0.02,0.035,0.58);
                          f_arrow1b.scale.multiplyScalar(1.05);

                          force_group.add(f_arrow1);
                          force_group.add(f_arrow1b);
                          }


                   //add cell
                     
                        
                        // AABB

                        var force_cell_face_AB = create_force_cell_face1(Force_area_AB,max,ForceP_A,ForceP_B,ForceP_AB,ForceO1,o2.l)
                        var force_cell_face_AAB = create_force_cell_face1(Force_area_AAB,max,ForceP_A,ForceP_AB,ForceP_B,ForceO1,o2.l)
                        var force_cell_face_ABB = create_force_cell_face1(Force_area_ABB,max,ForceP_AB,ForceP_B,ForceP_A,ForceO1,o2.l)
                        var force_cell_face_AABB = create_force_cell_apply(ForceP_A,ForceP_B,ForceP_AB,ForceO1,o2.l)

                        // BABB1

                        var force_cell_face_ABB1 = create_force_cell_face1(Force_area_ABB1,max,ForceP_AB,ForceP_B_1,ForceP_B,ForceO1,o2.l)
                        var force_cell_face_B1B = create_force_cell_face1(Force_area_B1B,max,ForceP_B_1,ForceP_B,ForceP_AB,ForceO1,o2.l)
                        var force_cell_face_ABB = create_force_cell_face1(Force_area_ABB,max,ForceP_AB,ForceP_B,ForceP_B_1,ForceO1,o2.l)
                        var force_cell_face_ABB1B = create_force_cell_apply(ForceP_AB,ForceP_B,ForceP_B_1,ForceO1,o2.l)

                        // AABA1

                        var force_cell_face_AAB = create_force_cell_face1(Force_area_AAB,max,ForceP_A,ForceP_AB,ForceP_A_1,ForceO1,o2.l)
                        var force_cell_face_A1AB = create_force_cell_face1(Force_area_ABA1,max,ForceP_A_1,ForceP_AB,ForceP_A,ForceO1,o2.l)
                        var force_cell_face_AA1 = create_force_cell_face1(Force_area_A1A,max,ForceP_A_1,ForceP_A,ForceP_AB,ForceO1,o2.l)
                        var force_cell_face_AABA1 = create_force_cell_apply(ForceP_AB,ForceP_A,ForceP_A_1,ForceO1,o2.l)

                        // A1ABB1

                        var force_cell_face_A1AB = create_force_cell_face1(Force_area_ABA1,max,ForceP_A_1,ForceP_AB,ForceP_B_1,ForceO1,o2.l)
                        var force_cell_face_ABB1 = create_force_cell_face1(Force_area_ABB1,max,ForceP_AB,ForceP_B_1,ForceP_A_1,ForceO1,o2.l)
                        var force_cell_face_A1B1 = create_force_cell_face1(Force_area_A1B1,max,ForceP_A_1,ForceP_B_1,ForceP_AB,ForceO1,o2.l)
                        var force_cell_face_A1ABB1 = create_force_cell_apply(ForceP_AB,ForceP_A_1,ForceP_B_1,ForceO1,o2.l)

                        // BB1BC

                        var force_cell_face_BB1 = create_force_cell_face1(Force_area_B1B,max,ForceP_B_1,ForceP_B,ForceP_BC,ForceO1,o2.l)
                        var force_cell_face_B1BC = create_force_cell_face1(Force_area_BCB1,max,ForceP_BC,ForceP_B_1,ForceP_B,ForceO1,o2.l)
                        var force_cell_face_BBC = create_force_cell_face1(Force_area_BBC,max,ForceP_B,ForceP_BC,ForceP_B_1,ForceO1,o2.l)
                        var force_cell_face_BB1BC = create_force_cell_apply(ForceP_B,ForceP_B_1,ForceP_BC,ForceO1,o2.l)


                        // CBCC1

                        var force_cell_face_CBC = create_force_cell_face1(Force_area_BCC,max,ForceP_BC,ForceP_C,ForceP_C_1,ForceO1,o2.l)
                        var force_cell_face_BCC1 = create_force_cell_face1(Force_area_BCC1,max,ForceP_BC,ForceP_C_1,ForceP_C,ForceO1,o2.l)
                        var force_cell_face_CC1 = create_force_cell_face1(Force_area_C1C,max,ForceP_C,ForceP_C_1,ForceP_BC,ForceO1,o2.l)
                        var force_cell_face_CBCC1 = create_force_cell_apply(ForceP_C,ForceP_C_1,ForceP_BC,ForceO1,o2.l)

                        // BCBC

                        var force_cell_face_BBC = create_force_cell_face1(Force_area_BBC,max,ForceP_B,ForceP_BC,ForceP_C,ForceO1,o2.l)
                        var force_cell_face_BCC = create_force_cell_face1(Force_area_BCC,max,ForceP_BC,ForceP_C,ForceP_B,ForceO1,o2.l)
                        var force_cell_face_BC = create_force_cell_face1(Force_area_BC,max,ForceP_B,ForceP_C,ForceP_BC,ForceO1,o2.l)
                        var force_cell_face_BCBC = create_force_cell_apply(ForceP_C,ForceP_B,ForceP_BC,ForceO1,o2.l)

                        // B1BCC1

                        var force_cell_face_B1BC = create_force_cell_face1(Force_area_BCB1,max,ForceP_BC,ForceP_B_1,ForceP_C_1,ForceO1,o2.l)
                        var force_cell_face_B1C1 = create_force_cell_face1(Force_area_B1C1,max,ForceP_B_1,ForceP_C_1,ForceP_BC,ForceO1,o2.l)
                        var force_cell_face_BCC1 = create_force_cell_face1(Force_area_BCC1,max,ForceP_BC,ForceP_C_1,ForceP_B_1,ForceO1,o2.l)
                        var force_cell_face_B1BCC1 = create_force_cell_apply(ForceP_C_1,ForceP_B_1,ForceP_BC,ForceO1,o2.l)

                        // ACCC1

                        var force_cell_face_ACC = create_force_cell_face1(Force_area_ACC,max,ForceP_AC,ForceP_C,ForceP_C_1,ForceO1,o2.l)
                        var force_cell_face_CC1 = create_force_cell_face1(Force_area_C1C,max,ForceP_C_1,ForceP_C,ForceP_AC,ForceO1,o2.l)
                        var force_cell_face_ACC1 = create_force_cell_face1(Force_area_ACC1,max,ForceP_AC,ForceP_C_1,ForceP_C,ForceO1,o2.l)
                        var force_cell_face_ACCC1 = create_force_cell_apply(ForceP_C_1,ForceP_C,ForceP_AC,ForceO1,o2.l)

                        // ACA1C1

                        var force_cell_face_ACC1 = create_force_cell_face1(Force_area_ACC1,max,ForceP_AC,ForceP_C_1,ForceP_A_1,ForceO1,o2.l)
                        var force_cell_face_C1A1 = create_force_cell_face1(Force_area_A1C1,max,ForceP_A_1,ForceP_C_1,ForceP_AC,ForceO1,o2.l)
                        var force_cell_face_ACA1 = create_force_cell_face1(Force_area_ACA1,max,ForceP_AC,ForceP_A_1,ForceP_C_1,ForceO1,o2.l)
                        var force_cell_face_ACA1C1 = create_force_cell_apply(ForceP_A_1,ForceP_C_1,ForceP_AC,ForceO1,o2.l)
 
                        // ACCA

                        var force_cell_face_ACC = create_force_cell_face1(Force_area_ACC,max,ForceP_AC,ForceP_C,ForceP_A,ForceO1,o2.l)
                        var force_cell_face_ACA = create_force_cell_face1(Force_area_AAC,max,ForceP_A,ForceP_AC,ForceP_C,ForceO1,o2.l)
                        var force_cell_face_AC = create_force_cell_face1(Force_area_AC,max,ForceP_A,ForceP_C,ForceP_AC,ForceO1,o2.l)
                        var force_cell_face_ACCA = create_force_cell_apply(ForceP_A,ForceP_C,ForceP_AC,ForceO1,o2.l)

                        // AACA1

                        var force_cell_face_AAC = create_force_cell_face1(Force_area_AAC,max,ForceP_A,ForceP_AC,ForceP_A_1,ForceO1,o2.l)
                        var force_cell_face_ACA1 = create_force_cell_face1(Force_area_ACA1,max,ForceP_AC,ForceP_A_1,ForceP_A,ForceO1,o2.l)
                        var force_cell_face_AA1 = create_force_cell_face1(Force_area_A1A,max,ForceP_A_1,ForceP_A,ForceP_AC,ForceO1,o2.l)
                        var force_cell_face_AACA1 = create_force_cell_apply(ForceP_A,ForceP_A_1,ForceP_AC,ForceO1,o2.l)
 
                        // A1B1C1

                        var force_cell_face_A1B1 = create_force_cell_face1(Force_area_A1B1,max,ForceP_A_1,ForceP_B_1,ForceP_C_1,ForceO1,o2.l)
                        var force_cell_face_B1C1 = create_force_cell_face1(Force_area_B1C1,max,ForceP_B_1,ForceP_C_1,ForceP_A_1,ForceO1,o2.l)
                        var force_cell_face_A1C1 = create_force_cell_face1(Force_area_A1C1,max,ForceP_A_1,ForceP_C_1,ForceP_B_1,ForceO1,o2.l)
                        var force_cell_face_A1B1C1 = create_force_cell_apply(ForceP_A_1,ForceP_B_1,ForceP_C_1,ForceO1,o2.l)
 

                        // minkowski

                        // var minkowski_test_1a = create_minkowski_face(Form_P14,Form_P15,ForceP_A,ForceP_B,ForceO1,o2.l)
                        // var minkowski_test_1b = create_minkowski_face(Form_P14,Form_P15,ForceP_AB,ForceP_B,ForceO1,o2.l)
                        // var minkowski_test_1c = create_minkowski_face(Form_P14,Form_P15,ForceP_AB,ForceP_A,ForceO1,o2.l)
                        
                        // form_group.add(minkowski_test_1a);
                        // form_group.add(minkowski_test_1b);
                        // form_group.add(minkowski_test_1c);







 
                //add text 

                      //Form closing plane

                          var TXMeshf1=create_supports_Text_P("1",FormCP1);
                          var TXMeshf2=create_supports_Text_P("2",FormCP2);
                          var TXMeshf3=create_supports_Text_P("3",FormCP3);
                          var TXMeshf5=create_supports_Text_Normal("ncp",normal_p1p2p3);
                          var TXMeshf6=create_trial_Text_Normal("f1",new THREE.Vector3(FormG_AABB.x,FormG_AABB.y,FormG_AABB.z-0.2));
                         
                         

                          text_closingplane_group.add(TXMeshf1);
                          text_closingplane_group.add(TXMeshf2);
                          text_closingplane_group.add(TXMeshf3);
                          text_closingplane_group.add(TXMeshf5);
                          text_closingplane_group.add(TXMeshf6);

                          trial_S1,trial_P15,trial_P9
                          
                          var TXMesht1=create_trial_Text_P_2("1'",trial_P15);
                          var TXMesht2=create_trial_Text_P_2("2'",trial_P9);
                          var TXMesht3=create_trial_Text_P_2("3'",trial_S1);
                          var TXMesht4=create_trial_Text_Normal("ncp'",trialnormal_p1p2p3);
                          var TXMesht6=create_trial_Text_Normal("ncp'",x1_closeP2);
                          

                          if(ForceO1.z>ForceP_B.z){
                          var TXMesht5=create_trial_Text_Normal("f1",f_arrow_1_b);
                          force_group.add(TXMesht5)
                          }

                          if(ForceO1.z<=ForceP_B.z){
                          var TXMesht5=create_trial_Text_Normal("f1",f_arrow_1_a);
                          force_group.add(TXMesht5)
                          }
                         
                          var TXMesht5a=create_trial_Text_P_3("A",ForceP_A);
                          var TXMesht5b=create_trial_Text_P_3("B",ForceP_B);
                          var TXMesht5c=create_trial_Text_P_3("C",ForceP_C);
                          force_group.add(TXMesht5a)
                          force_group.add(TXMesht5b)
                          force_group.add(TXMesht5c)


                          var TXMesht6=create_trial_Text_Normal("ncp'",x1_closeP2);
                          var TXMesht6b=create_supports_Text_Normal("ncp",ForceO1_closeP2);
                          var TXMesht7=create_trial_force_l("l'",x1_closeP1);
                          var TXMesht8=create_trial_force_l("l",ForceO1_closeP1);
                          var TXMesht9=create_trial_Text_P_2("O'",TrialP_O);
                          var TXMesht9b=create_trial_Text_P_2("O",ForceO1);
                          var TXMesht10=create_trial_force_x("x",ForceX1);


                          text_closingplane_trial_group.add(TXMesht1);
                          text_closingplane_trial_group.add(TXMesht2);
                          text_closingplane_trial_group.add(TXMesht3);
                          text_closingplane_trial_group.add(TXMesht4);


                          text_force_trial_group.add(TXMesht6);
                          text_force_trial_group.add(TXMesht6b);
                          text_force_trial_group.add(TXMesht7);
                          text_force_trial_group.add(TXMesht8);
                          text_force_trial_group.add(TXMesht9);
                          text_force_trial_group.add(TXMesht9b);
                          text_force_trial_group.add(TXMesht10);


                         
           
    // testing on / off

                        //  3d trial
                          for(i=0;i<=3;i++){
                          text_closingplane_trial_group.children[i].visible=false;
                          }

                          for(i=0;i<=6;i++){
                          text_force_trial_group.children[i].visible=false;
                          }

                          form_trial.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =false;
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =false;
                                }
                            });

                          trial_force.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =false;
                                }
                                if (obj.type === "LineSegments") {
                                    obj.material.visible =false;
                                }
                            });

                            form_greenfaces

                            form_greenfaces.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =false;
                                }
                                // if (obj.type === "LineSegments") {
                                //     obj.material.visible =false;
                                // }
                            });


                        // force cell

                        force_cell.traverse(function(obj) {
                                if (obj.type === "Mesh") {
                                    obj.material.visible =false;
                                }
                            
                            });                     






                      function create_supports_Text_P(text,pos){
                           
                                var canvas = document.createElement("canvas");
                                canvas.width=240;
                                canvas.height=240;
                                var ctx = canvas.getContext("2d");
                                ctx.fillStyle = "black";
                                ctx.font = "80px Palatino";
                                ctx.lineWidth = 2;
                                ctx.fillText(text.charAt(0),150,150);
                                ctx.fillStyle = "black";
                                ctx.font = "50px Palatino";
                                ctx.lineWidth = 2;
                                ctx.fillText(text.charAt(1),190,170);
                               
                                var texture = new THREE.Texture(canvas);
                                texture.needsUpdate = true;
                               
                            
                                var material = new THREE.SpriteMaterial({map:texture,depthWrite:false});
                                var textObj = new THREE.Sprite(material);
                                 textObj.scale.set(0.5, 0.5, 0.5);
                               
                               
                                  //textObj.position.set(pos1);
                               
                                  var posdir=Pnt_copy(pos);
                     
                                posdir.normalize();
                     
                             textObj.position.x =pos.x; //* (fontGeometry.boundingBox.max.x - fontGeometry.boundingBox.min.x);
                             textObj.position.y =pos.y;
                             textObj.position.z =pos.z-0.1;
                     
                     
                             return textObj;
                           }
                     
                      function create_trial_Text_P_2(text,pos){
                           
                           var canvas = document.createElement("canvas");
                           canvas.width=240;
                           canvas.height=240;
                           var ctx = canvas.getContext("2d");
                           ctx.fillStyle = "black";
                           ctx.font = "80px Palatino";
                           ctx.lineWidth = 2;
                           ctx.fillText(text.charAt(0),150,150);
                           ctx.fillStyle = "black";
                           ctx.font = "50px Palatino";
                           ctx.lineWidth = 2;
                           ctx.fillText(text.charAt(1),200,120);
                           ctx.fillStyle = "black";
                           ctx.font = "50px Palatino";
                           ctx.lineWidth = 2;
                           ctx.fillText(text.charAt(2),210,120);
                      
                          
                           var texture = new THREE.Texture(canvas);
                           texture.needsUpdate = true;
                          
                       
                           var material = new THREE.SpriteMaterial({map:texture,depthWrite:false});
                           var textObj = new THREE.Sprite(material);
                            textObj.scale.set(0.5, 0.5, 0.5);
                          
                          
                             //textObj.position.set(pos1);
                          
                             var posdir=Pnt_copy(pos);
                     
                           posdir.normalize();
                     
                        textObj.position.x =pos.x; //* (fontGeometry.boundingBox.max.x - fontGeometry.boundingBox.min.x);
                        textObj.position.y =pos.y;
                        textObj.position.z =pos.z-0.1;
                     
                     
                        return textObj;
                      }

                      function create_trial_Text_P_3(text,pos){
                           
                           var canvas = document.createElement("canvas");
                           canvas.width=240;
                           canvas.height=240;
                           var ctx = canvas.getContext("2d");
                           ctx.fillStyle = "black";
                           ctx.font = "80px Palatino";
                           ctx.lineWidth = 2;
                           ctx.fillText(text.charAt(0),150,150);
                           ctx.fillStyle = "black";
                           ctx.font = "50px Palatino";
                           ctx.lineWidth = 2;
                           ctx.fillText(text.charAt(1),200,120);
                           ctx.fillStyle = "black";
                           ctx.font = "50px Palatino";
                           ctx.lineWidth = 2;
                           ctx.fillText(text.charAt(2),210,120);
                      
                          
                           var texture = new THREE.Texture(canvas);
                           texture.needsUpdate = true;
                          
                       
                           var material = new THREE.SpriteMaterial({map:texture,depthWrite:false});
                           var textObj = new THREE.Sprite(material);
                            textObj.scale.set(0.5, 0.5, 0.5);
                          
                          
                             //textObj.position.set(pos1);
                          
                             var posdir=Pnt_copy(pos);
                     
                           posdir.normalize();
                     
                        textObj.position.x =pos.x; //* (fontGeometry.boundingBox.max.x - fontGeometry.boundingBox.min.x);
                        textObj.position.y =pos.y;
                        textObj.position.z =pos.z+0.15;
                     
                     
                        return textObj;
                      }
                     
                      function create_trial_Text_P(text,pos){
                           
                           var canvas = document.createElement("canvas");
                           canvas.width=240;
                           canvas.height=240;
                           var ctx = canvas.getContext("2d");
                           ctx.fillStyle = "black";
                           ctx.font = "80px Palatino";
                           ctx.lineWidth = 2;
                           ctx.fillText(text.charAt(0),150,150);
                           ctx.fillStyle = "black";
                           ctx.font = "50px Palatino";
                           ctx.lineWidth = 2;
                           ctx.fillText(text.charAt(1),200,120);
                        
                      
                          
                           var texture = new THREE.Texture(canvas);
                           texture.needsUpdate = true;
                          
                       
                           var material = new THREE.SpriteMaterial({map:texture,depthWrite:false});
                           var textObj = new THREE.Sprite(material);
                            textObj.scale.set(0.5, 0.5, 0.5);
                          
                          
                             //textObj.position.set(pos1);
                          
                             var posdir=Pnt_copy(pos);
                     
                           posdir.normalize();
                     
                        textObj.position.x =pos.x; //* (fontGeometry.boundingBox.max.x - fontGeometry.boundingBox.min.x);
                        textObj.position.y =pos.y;
                        textObj.position.z =pos.z-0.1;
                     
                     
                        return textObj;
                      }
                     
                      function create_trial_Text_P_2d(text,pos){
                           
                           var canvas = document.createElement("canvas");
                           canvas.width=240;
                           canvas.height=240;
                           var ctx = canvas.getContext("2d");
                           ctx.fillStyle = "black";
                           ctx.font = "80px Palatino";
                           ctx.lineWidth = 2;
                           ctx.fillText(text.charAt(0),150,150);
                           ctx.fillStyle = "black";
                           ctx.font = "50px Palatino";
                           ctx.lineWidth = 2;
                           ctx.fillText(text.charAt(1),200,120);
                        
                      
                          
                           var texture = new THREE.Texture(canvas);
                           texture.needsUpdate = true;
                          
                       
                           var material = new THREE.SpriteMaterial({map:texture,depthWrite:false});
                           var textObj = new THREE.Sprite(material);
                            textObj.scale.set(0.5, 0.5, 0.5);
                          
                          
                             //textObj.position.set(pos1);
                          
                             var posdir=Pnt_copy(pos);
                     
                           posdir.normalize();
                     
                        textObj.position.x =pos.x; //* (fontGeometry.boundingBox.max.x - fontGeometry.boundingBox.min.x);
                        textObj.position.y =pos.y;
                        textObj.position.z =pos.z+0.1;
                     
                     
                        return textObj;
                      }
                     
                      function create_trial_force_x(text,pos){
                           
                           var canvas = document.createElement("canvas");
                           canvas.width=240;
                           canvas.height=240;
                           var ctx = canvas.getContext("2d");
                           ctx.fillStyle = "black";
                           ctx.font = "80px Gabriola";
                           ctx.lineWidth = 2;
                           ctx.fillText(text.charAt(0),150,150);
                           ctx.fillStyle = "black";
                           ctx.font = "50px Palatino";
                           ctx.lineWidth = 2;
                           ctx.fillText(text.charAt(1),170,120);
                        
                      
                          
                           var texture = new THREE.Texture(canvas);
                           texture.needsUpdate = true;
                          
                       
                           var material = new THREE.SpriteMaterial({map:texture,depthWrite:false});
                           var textObj = new THREE.Sprite(material);
                            textObj.scale.set(0.5, 0.5, 0.5);
                          
                          
                             //textObj.position.set(pos1);
                          
                             var posdir=Pnt_copy(pos);
                     
                           posdir.normalize();
                     
                        textObj.position.x =pos.x; //* (fontGeometry.boundingBox.max.x - fontGeometry.boundingBox.min.x);
                        textObj.position.y =pos.y;
                        textObj.position.z =pos.z+0.1;
                     
                     
                        return textObj;
                      }
                     
                      function create_trial_force_l(text,pos){
                           
                           var canvas = document.createElement("canvas");
                           canvas.width=240;
                           canvas.height=240;
                           var ctx = canvas.getContext("2d");
                           ctx.fillStyle = "black";
                           ctx.font = "80px Gabriola";
                           ctx.lineWidth = 2;
                           ctx.fillText(text.charAt(0),150,150);
                           ctx.fillStyle = "black";
                           ctx.font = "50px Palatino";
                           ctx.lineWidth = 2;
                           ctx.fillText(text.charAt(1),170,120);
                        
                      
                          
                           var texture = new THREE.Texture(canvas);
                           texture.needsUpdate = true;
                          
                       
                           var material = new THREE.SpriteMaterial({map:texture,depthWrite:false});
                           var textObj = new THREE.Sprite(material);
                            textObj.scale.set(0.5, 0.5, 0.5);
                          
                          
                             //textObj.position.set(pos1);
                          
                             var posdir=Pnt_copy(pos);
                     
                           posdir.normalize();
                     
                        textObj.position.x =pos.x; //* (fontGeometry.boundingBox.max.x - fontGeometry.boundingBox.min.x);
                        textObj.position.y =pos.y;
                        textObj.position.z =pos.z-0.1;
                     
                     
                        return textObj;
                      }
                     
                      function create_supports_Text_Normal(text,pos){
                           
                           var canvas = document.createElement("canvas");
                           canvas.width=240;
                           canvas.height=240;
                           var ctx = canvas.getContext("2d");
                           ctx.fillStyle = "black";
                           ctx.font = "Bold 80px Palatino";
                           ctx.lineWidth = 2;
                           ctx.fillText(text.charAt(0),150,150);
                           ctx.fillStyle = "black";
                           ctx.font = "50px Palatino";
                           ctx.lineWidth = 2;
                           ctx.fillText(text.charAt(1),190,170);
                           ctx.fillStyle = "black";
                           ctx.font = "50px Palatino";
                           ctx.lineWidth = 2;
                           ctx.fillText(text.charAt(2),210,170);
                          
                           var texture = new THREE.Texture(canvas);
                           texture.needsUpdate = true;
                          
                       
                           var material = new THREE.SpriteMaterial({map:texture,depthWrite:false});
                           var textObj = new THREE.Sprite(material);
                            textObj.scale.set(0.5, 0.5, 0.5);
                          
                          
                             //textObj.position.set(pos1);
                          
                             var posdir=Pnt_copy(pos);
                     
                           posdir.normalize();
                     
                        textObj.position.x =pos.x+0.1*posdir.x; //* (fontGeometry.boundingBox.max.x - fontGeometry.boundingBox.min.x);
                        textObj.position.y =pos.y+0.1*posdir.y;
                        textObj.position.z =pos.z+0.1*posdir.z;
                     
                     
                        return textObj;
                      }
                     
                      function create_trial_Text_Normal(text,pos){
                           
                           var canvas = document.createElement("canvas");
                           canvas.width=240;
                           canvas.height=240;
                           var ctx = canvas.getContext("2d");
                           ctx.fillStyle = "black";
                           ctx.font = "Bold 80px Palatino";
                           ctx.lineWidth = 2;
                           ctx.fillText(text.charAt(0),150,150);
                           ctx.fillStyle = "black";
                           ctx.font = "50px Palatino";
                           ctx.lineWidth = 2;
                           ctx.fillText(text.charAt(1),190,170);
                           ctx.fillStyle = "black";
                           ctx.font = "50px Palatino";
                           ctx.lineWidth = 2;
                           ctx.fillText(text.charAt(2),210,170);
                           ctx.fillStyle = "black";
                           ctx.font = "50px Palatino";
                           ctx.lineWidth = 2;
                           ctx.fillText(text.charAt(3),230,170);
                          
                           var texture = new THREE.Texture(canvas);
                           texture.needsUpdate = true;
                          
                       
                           var material = new THREE.SpriteMaterial({map:texture,depthWrite:false});
                           var textObj = new THREE.Sprite(material);
                            textObj.scale.set(0.5, 0.5, 0.5);
                          
                          
                             //textObj.position.set(pos1);
                          
                             var posdir=Pnt_copy(pos);
                     
                           posdir.normalize();
                     
                        textObj.position.x =pos.x+0.05*posdir.x; //* (fontGeometry.boundingBox.max.x - fontGeometry.boundingBox.min.x);
                        textObj.position.y =pos.y+0.05*posdir.y;
                        textObj.position.z =pos.z+0.1*posdir.z;
                     
                     
                        return textObj;
                      }
                     
                      function create_trial_Text_Normal_2d(text,pos){
                           
                           var canvas = document.createElement("canvas");
                           canvas.width=240;
                           canvas.height=240;
                           var ctx = canvas.getContext("2d");
                           ctx.fillStyle = "black";
                           ctx.font = "Bold 80px Palatino";
                           ctx.lineWidth = 2;
                           ctx.fillText(text.charAt(0),150,150);
                           ctx.fillStyle = "black";
                           ctx.font = "50px Palatino";
                           ctx.lineWidth = 2;
                           ctx.fillText(text.charAt(1),190,170);
                           ctx.fillStyle = "black";
                           ctx.font = "50px Palatino";
                           ctx.lineWidth = 2;
                           ctx.fillText(text.charAt(2),210,170);
                           ctx.fillStyle = "black";
                           ctx.font = "50px Palatino";
                           ctx.lineWidth = 2;
                           ctx.fillText(text.charAt(3),230,170);
                          
                           var texture = new THREE.Texture(canvas);
                           texture.needsUpdate = true;
                          
                       
                           var material = new THREE.SpriteMaterial({map:texture,depthWrite:false});
                           var textObj = new THREE.Sprite(material);
                            textObj.scale.set(0.5, 0.5, 0.5);
                          
                          
                             //textObj.position.set(pos1);
                          
                             var posdir=Pnt_copy(pos);
                     
                           posdir.normalize();
                     
                        textObj.position.x =pos.x //* (fontGeometry.boundingBox.max.x - fontGeometry.boundingBox.min.x);
                        textObj.position.y =pos.y
                        textObj.position.z =pos.z+0.1;
                     
                     
                        return textObj;
                      }
                     
                      function create_force_cell_apply(point1,point2,point3,point4,scale){

                            var centroid = new THREE.Vector3((point1.x+point2.x+point3.x+point4.x)/4,(point1.y+point2.y+point3.y+point4.y)/4,(point1.z+point2.z+point3.z+point4.z)/4);
                            
                            
                            var scale_point1 = new THREE.Vector3(centroid.x + (point1.x - centroid.x)*scale, centroid.y + (point1.y - centroid.y)*scale, centroid.z + (point1.z - centroid.z)*scale );
                            
                            
                            var scale_point2 = new THREE.Vector3(centroid.x + (point2.x - centroid.x)*scale, centroid.y + (point2.y - centroid.y)*scale, centroid.z + (point2.z - centroid.z)*scale );
                            
                            
                            var scale_point3 = new THREE.Vector3(centroid.x + (point3.x - centroid.x)*scale, centroid.y + (point3.y - centroid.y)*scale, centroid.z + (point3.z - centroid.z)*scale );
                            
                            
                            var scale_point4 = new THREE.Vector3(centroid.x + (point4.x - centroid.x)*scale, centroid.y + (point4.y - centroid.y)*scale, centroid.z + (point4.z - centroid.z)*scale );
                            
                            var vertices = [
                            scale_point1,scale_point2,scale_point3
                            ];
                            
                            var faces = [
                                    new THREE.Face3(0, 1, 2),
              
                                ];
                            
                            var geom = new THREE.Geometry();
                            geom.vertices = vertices;
                            geom.faces = faces;
                            geom.computeFaceNormals();
                            var material_step_1 = [
                            //new THREE.MeshLambertMaterial({color: 0x4d4dff, transparent: true}),
                            new THREE.MeshBasicMaterial({color: "white", wireframe: true, transparent: true,opacity:0.1}),
                            new THREE.MeshPhongMaterial({
                            color: 0x009600,side:THREE.DoubleSide
                            } )
                            ];
                            
                            var force_cell2 = THREE.SceneUtils.createMultiMaterialObject(geom, material_step_1);
                            
                            
                            force_cell.add(force_cell2)
                            force_cell2.children[0].castShadow = true;
                            }                
                     
                      function create_force_cell_face1(face_area,face_area_max,point1,point2,point3,point4,scale){
                            var form_mesh = face_area/face_area_max
                                  
                            var centroid = new THREE.Vector3((point1.x+point2.x+point3.x+point4.x)/4,(point1.y+point2.y+point3.y+point4.y)/4,(point1.z+point2.z+point3.z+point4.z)/4);
                                  
                                  
                                  var scale_point1 = new THREE.Vector3(centroid.x + (point1.x - centroid.x)*scale, centroid.y + (point1.y - centroid.y)*scale, centroid.z + (point1.z - centroid.z)*scale );
                                  
                                  
                                  var scale_point2 = new THREE.Vector3(centroid.x + (point2.x - centroid.x)*scale, centroid.y + (point2.y - centroid.y)*scale, centroid.z + (point2.z - centroid.z)*scale );
                                  
                                  
                                  var scale_point3 = new THREE.Vector3(centroid.x + (point3.x - centroid.x)*scale, centroid.y + (point3.y - centroid.y)*scale, centroid.z + (point3.z - centroid.z)*scale );
                                  
                                  
                                  var scale_point4 = new THREE.Vector3(centroid.x + (point4.x - centroid.x)*scale, centroid.y + (point4.y - centroid.y)*scale, centroid.z + (point4.z - centroid.z)*scale );

                                  var vertices = [
                                  scale_point1,scale_point2,scale_point4
                                  ];
                                  
                                  var faces = [
                                          new THREE.Face3(0, 1, 2),
                                                         
                                      ];
                                  
                                  var geom = new THREE.Geometry();
                                  geom.vertices = vertices;
                                  geom.faces = faces;
                                  geom.computeFaceNormals();

                                  if (ForceO1.z<=ForceP_B.z){

                                       if (form_mesh<0.25 & form_mesh>=0)
                                         { 
                                         var material_step_1 = [
                                         //new THREE.MeshLambertMaterial({color: 0x4d4dff, transparent: true}),
                                         new THREE.MeshBasicMaterial({color: "white", wireframe: true, transparent: true,opacity:0.1}),
                                         new THREE.MeshPhongMaterial({
                                         color: 0x5B84AE,side:THREE.DoubleSide
                                         } )
                                         ];
                                         var force_cell2 = THREE.SceneUtils.createMultiMaterialObject(geom, material_step_1);
                                        }

                                        if (form_mesh<0.5 & form_mesh>=0.25)
                                        {  
                                             
                                         var material_step_1 = [
                                         //new THREE.MeshLambertMaterial({color: 0x4d4dff, transparent: true}),
                                         new THREE.MeshBasicMaterial({color: "white", wireframe: true, transparent: true,opacity:0.1}),
                                         new THREE.MeshPhongMaterial({
                                         color: 0x376D9B,side:THREE.DoubleSide
                                         } )
                                         ];
                                         var force_cell2 = THREE.SceneUtils.createMultiMaterialObject(geom, material_step_1);
                                        }

                                        if (form_mesh<0.75 & form_mesh>=0.5)
                                        {  
                                         var material_step_1 = [
                                         //new THREE.MeshLambertMaterial({color: 0x4d4dff, transparent: true}),
                                         new THREE.MeshBasicMaterial({color: "white", wireframe: true, transparent: true,opacity:0.1}),
                                         new THREE.MeshPhongMaterial({
                                         color: 0x05416D,side:THREE.DoubleSide
                                         } )
                                         ];
                                         var force_cell2 = THREE.SceneUtils.createMultiMaterialObject(geom, material_step_1);
                                        }
          
                                        if (form_mesh>=0.75)                                   
                                        {  
                                            
                                         var material_step_1 = [
                                         //new THREE.MeshLambertMaterial({color: 0x4d4dff, transparent: true}),
                                         new THREE.MeshBasicMaterial({color: "white", wireframe: true, transparent: true,opacity:0.1}),
                                         new THREE.MeshPhongMaterial({
                                         color: 0x0F3150,side:THREE.DoubleSide
                                         } )
                                         ];
                                         var force_cell2 = THREE.SceneUtils.createMultiMaterialObject(geom, material_step_1);
                                        }
                                    }

                                  else if(ForceO1.z>ForceP_B.z){

                                        if (form_mesh<0.25 & form_mesh>=0)
                                        { 
                                         var material_step_1 = [
                                         //new THREE.MeshLambertMaterial({color: 0x4d4dff, transparent: true}),
                                         new THREE.MeshBasicMaterial({color: "white", wireframe: true, transparent: true,opacity:0.1}),
                                         new THREE.MeshPhongMaterial({
                                         color: 0xD72F62,side:THREE.DoubleSide
                                         } )
                                         ];
                                         var force_cell2 = THREE.SceneUtils.createMultiMaterialObject(geom, material_step_1);
                                        }

                                        if (form_mesh<0.5 & form_mesh>=0.25)
                                        { 
                                         var material_step_1 = [
                                         //new THREE.MeshLambertMaterial({color: 0x4d4dff, transparent: true}),
                                         new THREE.MeshBasicMaterial({color: "white", wireframe: true, transparent: true,opacity:0.1}),
                                         new THREE.MeshPhongMaterial({
                                         color: 0xCC0549,side:THREE.DoubleSide
                                         } )
                                         ];
                                         var force_cell2 = THREE.SceneUtils.createMultiMaterialObject(geom, material_step_1);
                                        }

                                        if (form_mesh<0.75 & form_mesh>=0.5)
                                        { 
                                         var material_step_1 = [
                                         //new THREE.MeshLambertMaterial({color: 0x4d4dff, transparent: true}),
                                         new THREE.MeshBasicMaterial({color: "white", wireframe: true, transparent: true,opacity:0.1}),
                                         new THREE.MeshPhongMaterial({
                                         color: 0x940041,side:THREE.DoubleSide
                                         } )
                                         ];
                                         var force_cell2 = THREE.SceneUtils.createMultiMaterialObject(geom, material_step_1);
                                        }

                                        if (form_mesh>=0.75)
                                        { 
                                         var material_step_1 = [
                                         //new THREE.MeshLambertMaterial({color: 0x4d4dff, transparent: true}),
                                         new THREE.MeshBasicMaterial({color: "white", wireframe: true, transparent: true,opacity:0.1}),
                                         new THREE.MeshPhongMaterial({
                                         color: 0x80002F,side:THREE.DoubleSide
                                         } )
                                         ];
                                         var force_cell2 = THREE.SceneUtils.createMultiMaterialObject(geom, material_step_1);
                                        }
                                    }
                                         
                                         force_cell.add(force_cell2)


                                  

                         } 
                                                 
                      function create_minkowski_cell(cenPoint,point1,point2,point3,point4,scale){

                                                                   
                                  var scale_point1 = new THREE.Vector3(cenPoint.x + (point2.x - point1.x)*scale, cenPoint.y + (point2.y - point1.y)*scale, cenPoint.z + (point2.z - point1.z)*scale );
                                  
                                  
                                  var scale_point2 = new THREE.Vector3(cenPoint.x + (point3.x - point1.x)*scale, cenPoint.y + (point3.y - point1.y)*scale, cenPoint.z + (point3.z - point1.z)*scale );
                                  
                                  
                                  var scale_point3 = new THREE.Vector3(cenPoint.x + (point4.x - point1.x)*scale, cenPoint.y + (point4.y - point1.y)*scale, cenPoint.z + (point4.z - point1.z)*scale );

                                  var centroid = new THREE.Vector3((cenPoint.x+scale_point1.x+scale_point2.x+scale_point3.x)/4,(cenPoint.y+scale_point1.y+scale_point2.y+scale_point3.y)/4,(cenPoint.z+scale_point1.z+scale_point2.z+scale_point3.z)/4);

                                  var scale_point1b = new THREE.Vector3(centroid.x + (cenPoint.x - centroid.x)*scale, centroid.y + (cenPoint.y - centroid.y)*scale, centroid.z + (cenPoint.z - centroid.z)*scale );
                            
                            
                                  var scale_point2b = new THREE.Vector3(centroid.x + (scale_point1.x - centroid.x)*scale, centroid.y + (scale_point1.y - centroid.y)*scale, centroid.z + (scale_point1.z - centroid.z)*scale );
                                  
                                  
                                  var scale_point3b = new THREE.Vector3(centroid.x + (scale_point2.x - centroid.x)*scale, centroid.y + (scale_point2.y - centroid.y)*scale, centroid.z + (scale_point2.z - centroid.z)*scale );
                                  
                                  
                                  var scale_point4b = new THREE.Vector3(centroid.x + (scale_point3.x - centroid.x)*scale, centroid.y + (scale_point3.y - centroid.y)*scale, centroid.z + (scale_point3.z - centroid.z)*scale );
                                  
                                  var vertices = [
                                  scale_point1b,scale_point2b,scale_point3b,scale_point4b
                                  ];
                                  
                                  var faces = [
                                          new THREE.Face3(0, 1, 2),
                                          new THREE.Face3(0, 1, 3),
                                          new THREE.Face3(1, 2, 3),
                                          new THREE.Face3(0, 2, 3),
                                                         
                                      ];
                                  
                                  var geom = new THREE.Geometry();
                                  geom.vertices = vertices;
                                  geom.faces = faces;
                                  geom.computeFaceNormals();

                                  var material = [
                                  //new THREE.MeshLambertMaterial({color: 0x4d4dff, transparent: true}),
                                  new THREE.MeshBasicMaterial({color: "white", wireframe: true, transparent: true,opacity:0.1}),
                                  new THREE.MeshPhongMaterial({
                                  color: 0x5B84AE,transparent:true, opacity:0.5, side:THREE.DoubleSide
                                  } )
                                  ];
                                  var minkowski_1 = THREE.SceneUtils.createMultiMaterialObject(geom, material);
                                  return minkowski_1                               
                                }

                      function create_minkowski_cell_2(cenPoint,point1,point2,point3,point4,scale){

                                    var centroid = new THREE.Vector3((point1.x+point2.x+point3.x+point4.x)/4,(point1.y+point2.y+point3.y+point4.y)/4,(point1.z+point2.z+point3.z+point4.z)/4);
                            
                            
                                    var scale_point1 = new THREE.Vector3(cenPoint.x + (point1.x - centroid.x)*scale, cenPoint.y + (point1.y - centroid.y)*scale, cenPoint.z + (point1.z - centroid.z)*scale );
                                    
                                    
                                    var scale_point2 = new THREE.Vector3(cenPoint.x + (point2.x - centroid.x)*scale, cenPoint.y + (point2.y - centroid.y)*scale, cenPoint.z + (point2.z - centroid.z)*scale );
                                    
                                    
                                    var scale_point3 = new THREE.Vector3(cenPoint.x + (point3.x - centroid.x)*scale, cenPoint.y + (point3.y - centroid.y)*scale, cenPoint.z + (point3.z - centroid.z)*scale );
                                    
                                    
                                    var scale_point4 = new THREE.Vector3(cenPoint.x + (point4.x - centroid.x)*scale, cenPoint.y + (point4.y - centroid.y)*scale, cenPoint.z + (point4.z - centroid.z)*scale );

                                    // var scale_point1b = new THREE.Vector3(centerP.x + (scale_point1.x - centerP.x)*scale, centerP.y + (scale_point1.y - centerP.y)*scale, centerP.z + (scale_point1.z - centerP.z)*scale );
                                    
                                    
                                    // var scale_point2b = new THREE.Vector3(centerP.x + (scale_point2.x - centerP.x)*scale, centerP.y + (scale_point2.y - centerP.y)*scale, centerP.z + (scale_point2.z - centerP.z)*scale );
                                    
                                    
                                    // var scale_point3b = new THREE.Vector3(centerP.x + (scale_point3.x - centerP.x)*scale, centerP.y + (scale_point3.y - centerP.y)*scale, centerP.z + (scale_point3.z - centerP.z)*scale );
                                    
                                    
                                    // var scale_point4b = new THREE.Vector3(centerP.x + (scale_point4.x - centerP.x)*scale, centerP.y + (scale_point4.y - centerP.y)*scale, centerP.z + (scale_point4.z - centerP.z)*scale );
                                     
                                     var vertices = [
                                     scale_point1,scale_point2,scale_point3,scale_point4
                                     ];
                                     
                                     var faces = [
                                             new THREE.Face3(0, 1, 2),
                                             new THREE.Face3(0, 1, 3),
                                             new THREE.Face3(1, 2, 3),
                                             new THREE.Face3(0, 2, 3),
                                                            
                                         ];
                                     
                                     var geom = new THREE.Geometry();
                                     geom.vertices = vertices;
                                     geom.faces = faces;
                                     geom.computeFaceNormals();
                                     
                                     var material = [
                                     //new THREE.MeshLambertMaterial({color: 0x4d4dff, transparent: true}),
                                     new THREE.MeshBasicMaterial({color: "white", wireframe: true, transparent: true,opacity:0.1}),
                                     new THREE.MeshPhongMaterial({
                                     color: 0x5B84AE,transparent:true, opacity:0.5, side:THREE.DoubleSide
                                     } )
                                     ];
                                     var minkowski_1 = THREE.SceneUtils.createMultiMaterialObject(geom, material);
                                     return minkowski_1                               
                                     }

                                
                      function create_minkowski_cell_3(cenPoint,point1,point2,point3,point4,scale){

                                                                          
                                          var scale_point1 = new THREE.Vector3(cenPoint.x + (point2.x - point1.x)*scale, cenPoint.y + (point2.y - point1.y)*scale, cenPoint.z + (point2.z - point1.z)*scale );
                                          
                                          
                                          var scale_point2 = new THREE.Vector3(cenPoint.x + (point3.x - point1.x)*scale, cenPoint.y + (point3.y - point1.y)*scale, cenPoint.z + (point3.z - point1.z)*scale );
                                          
                                          
                                          var scale_point3 = new THREE.Vector3(cenPoint.x + (point4.x - point1.x)*scale, cenPoint.y + (point4.y - point1.y)*scale, cenPoint.z + (point4.z - point1.z)*scale );

                                        //   var centroid = new THREE.Vector3((point1.x+point2.x+point3.x+point4.x)/4,(point1.y+point2.y+point3.y+point4.y)/4,(point1.z+point2.z+point3.z+point4.z)/4);
                                          
                                          
                                        //   var scale_point1 = new THREE.Vector3(cenPoint.x + (point1.x - centroid.x)*scale, cenPoint.y + (point1.y - centroid.y)*scale, cenPoint.z + (point1.z - centroid.z)*scale );
                                          
                                          
                                        //   var scale_point2 = new THREE.Vector3(cenPoint.x + (point2.x - centroid.x)*scale, cenPoint.y + (point2.y - centroid.y)*scale, cenPoint.z + (point2.z - centroid.z)*scale );
                                          
                                          
                                        //   var scale_point3 = new THREE.Vector3(cenPoint.x + (point3.x - centroid.x)*scale, cenPoint.y + (point3.y - centroid.y)*scale, cenPoint.z + (point3.z - centroid.z)*scale );
                                          
                                          
                                        //   var scale_point4 = new THREE.Vector3(cenPoint.x + (point4.x - centroid.x)*scale, cenPoint.y + (point4.y - centroid.y)*scale, cenPoint.z + (point4.z - centroid.z)*scale );
                                          
                                          var scale_point1b = new THREE.Vector3(centerP.x + (scale_point1.x - centerP.x)*scale, centerP.y + (scale_point1.y - centerP.y)*scale, centerP.z + (scale_point1.z - centerP.z)*scale );
                                          
                                          
                                          var scale_point2b = new THREE.Vector3(centerP.x + (scale_point2.x - centerP.x)*scale, centerP.y + (scale_point2.y - centerP.y)*scale, centerP.z + (scale_point2.z - centerP.z)*scale );
                                          
                                          
                                          var scale_point3b = new THREE.Vector3(centerP.x + (scale_point3.x - centerP.x)*scale, centerP.y + (scale_point3.y - centerP.y)*scale, centerP.z + (scale_point3.z - centerP.z)*scale );
                                          
                                          
                                          var scale_point4b = new THREE.Vector3(centerP.x + (cenPoint.x - centerP.x)*scale, centerP.y + (cenPoint.y - centerP.y)*scale, centerP.z + (cenPoint.z - centerP.z)*scale );
                                           
                                           var vertices = [
                                           scale_point1b,scale_point2b,scale_point3b,scale_point4b
                                           ];
                                           
                                           var faces = [
                                                   new THREE.Face3(0, 1, 2),
                                                   new THREE.Face3(0, 1, 3),
                                                   new THREE.Face3(1, 2, 3),
                                                   new THREE.Face3(0, 2, 3),
                                                                  
                                               ];
                                           
                                           var geom = new THREE.Geometry();
                                           geom.vertices = vertices;
                                           geom.faces = faces;
                                           geom.computeFaceNormals();
                                           
                                           var material = [
                                           //new THREE.MeshLambertMaterial({color: 0x4d4dff, transparent: true}),
                                           new THREE.MeshBasicMaterial({color: "white", wireframe: true, transparent: true,opacity:0.1}),
                                           new THREE.MeshPhongMaterial({
                                           color: 0x5B84AE,transparent:true, opacity:0.5, side:THREE.DoubleSide
                                           } )
                                           ];
                                           var minkowski_1 = THREE.SceneUtils.createMultiMaterialObject(geom, material);
                                           return minkowski_1                               
                                           }        
                     

                      function create_minkowski_face(cenPoint1,cenPoint2,point1,point2,point3,scale){

                                  var centroid = new THREE.Vector3((point1.x+point2.x+point3.x)/3,(point1.y+point2.y+point3.y)/3,(point1.z+point2.z+point3.z)/3);
                                                                   
                                  var scale_point1 = new THREE.Vector3(cenPoint1.x + (point1.x - centroid.x)*scale, cenPoint1.y + (point1.y - centroid.y)*scale, cenPoint1.z + (point1.z - centroid.z)*scale );
                                  
                                  
                                  var scale_point2 = new THREE.Vector3(cenPoint1.x + (point2.x - centroid.x)*scale, cenPoint1.y + (point2.y - centroid.y)*scale, cenPoint1.z + (point2.z - centroid.z)*scale );
                                  
                                  
                                  var scale_point3 = new THREE.Vector3(cenPoint1.x + (point3.x - centroid.x)*scale, cenPoint1.y + (point3.y - centroid.y)*scale, cenPoint1.z + (point3.z - centroid.z)*scale );

                                  var scale_point1b = new THREE.Vector3(cenPoint2.x + (point1.x - centroid.x)*scale, cenPoint2.y + (point1.y - centroid.y)*scale, cenPoint2.z + (point1.z - centroid.z)*scale );
                                  
                                  
                                  var scale_point2b = new THREE.Vector3(cenPoint2.x + (point2.x - centroid.x)*scale, cenPoint2.y + (point2.y - centroid.y)*scale, cenPoint2.z + (point2.z - centroid.z)*scale );
                                  
                                  
                                  var scale_point3b = new THREE.Vector3(cenPoint2.x + (point3.x - centroid.x)*scale, cenPoint2.y + (point3.y - centroid.y)*scale, cenPoint2.z + (point3.z - centroid.z)*scale );

                                  
                                  var vertices = [
                                  scale_point1,scale_point2,scale_point3,
                                  scale_point1b,scale_point2b,scale_point3b,
                                  ];
                                  
                                  var faces = [
                                          new THREE.Face3(0, 1, 2),
                                          new THREE.Face3(3, 4, 5),
                                                    
                                      ];
                                  
                                  var geom = new THREE.Geometry();
                                  geom.vertices = vertices;
                                  geom.faces = faces;
                                  geom.computeFaceNormals();
                                  
                                  var material = [
                                  //new THREE.MeshLambertMaterial({color: 0x4d4dff, transparent: true}),
                                  new THREE.MeshBasicMaterial({color: "white", wireframe: true, transparent: true,opacity:0.1}),
                                  new THREE.MeshPhongMaterial({
                                  color: 0x5B84AE,transparent:true, opacity:0.5, side:THREE.DoubleSide
                                  } )
                                  ];
                                  var minkowski_1 = THREE.SceneUtils.createMultiMaterialObject(geom, material);
                                  return minkowski_1                               
                                  }

                      function create_minkowski_face_2d(cenPoint,point1,point2,point3,scale){

                                  var centroid = new THREE.Vector3((point1.x+point2.x+point3.x)/3,(point1.y+point2.y+point3.y)/3,(point1.z+point2.z+point3.z)/3);
                                                                   
                                  var scale_point1 = new THREE.Vector3(cenPoint.x + (point2.x - point1.x)*scale, cenPoint.y + (point2.y - point1.y)*scale, cenPoint.z + (point1.z - point1.z)*scale );
                                  
                                  
                                  var scale_point2 = new THREE.Vector3(cenPoint.x + (point3.x - point1.x)*scale, cenPoint.y + (point3.y - point1.y)*scale, cenPoint.z + (point3.z - point1.z)*scale );
                                  
                                  var vertices = [
                                  cenPoint,scale_point1,scale_point2
                                  ];
                                  
                                  var faces = [
                                          new THREE.Face3(0, 1, 2),
                                                    
                                      ];
                                  
                                  var geom = new THREE.Geometry();
                                  geom.vertices = vertices;
                                  geom.faces = faces;
                                  geom.computeFaceNormals();
                                  
                                  var material = [
                                  //new THREE.MeshLambertMaterial({color: 0x4d4dff, transparent: true}),
                                  new THREE.MeshBasicMaterial({color: "white", wireframe: true, transparent: true,opacity:0.1}),
                                  new THREE.MeshPhongMaterial({
                                  color: 0x5B84AE,transparent:true, opacity:0.5, side:THREE.DoubleSide
                                  } )
                                  ];
                                  var minkowski_1 = THREE.SceneUtils.createMultiMaterialObject(geom, material);
                                  return minkowski_1                               
                                  }




















                                // ****************************************************************************************************************************** end *****************************










       
                       var FormP_O1 = new THREE.Vector3(-0.5,-0.5,1);

                    // find point O2 from triangle ACC2, c2=c.z-1

                       //let ForceP_C_2 = new THREE.Vector3(ForceP_C.x,ForceP_C.y,ForceP_C.z-1);

                       var Vec_tri_ACC2 = Cal_Vec_2 (ForceP_A,ForceP_C_2,ForceP_C,1.2);
                       var FormP_O2 = new THREE.Vector3(FormP_O1.x-formo2.l*Vec_tri_ACC2.x,FormP_O1.y-formo2.l*Vec_tri_ACC2.y,FormP_O1.z-formo2.l*Vec_tri_ACC2.z);

                       //add sphere ?

                    // find FormP_O1, FormP_O2
                       var FormP_O1B = new THREE.Vector3(-0.5,-0.5,-1.5);
                       var FormP_O2B = new THREE.Vector3(FormP_O2.x,FormP_O2.y,-1.5);

                    // add apply loads arrows
                       
                    
                       var arrow_apply=new THREE.MeshPhongMaterial( {color: 0x009600} );

                       var arrow_apply_outline = new THREE.MeshBasicMaterial( { color: "white", transparent: false, side: THREE.BackSide } );

                      
                       var apply_arrow1=createCylinderArrowMesh(FormP_O1,new THREE.Vector3(FormP_O1.x,FormP_O1.y,FormP_O1.z-0.4),arrow_apply,0.02,0.05,0.6);
                       var apply_arrow2=createCylinderArrowMesh(FormP_O2,new THREE.Vector3(FormP_O2.x,FormP_O2.y,FormP_O2.z-0.4),arrow_apply,0.02,0.05,0.6);

                      // form_group.add(apply_arrow1);
                      // form_group.add(apply_arrow2);
                      
                       var apply_arrow12=createCylinderArrowMesh(new THREE.Vector3(FormP_O1.x,FormP_O1.y,FormP_O1.z-0.03),new THREE.Vector3(FormP_O1.x,FormP_O1.y,FormP_O1.z-0.4),arrow_apply_outline,0.025,0.05,0.57);
                       var apply_arrow22=createCylinderArrowMesh(new THREE.Vector3(FormP_O2.x,FormP_O2.y,FormP_O2.z-0.03),new THREE.Vector3(FormP_O2.x,FormP_O2.y,FormP_O2.z-0.4),arrow_apply_outline,0.025,0.05,0.57);
                    
                      // form_group.add(apply_arrow22);
                       apply_arrow22.scale.multiplyScalar(1.2);

                      // form_group.add(apply_arrow12);
                       apply_arrow12.scale.multiplyScalar(1.2);
                    
                    // add dash lines o1o1B, o2o2B
                       var apply_o1o1B = [];
                       apply_o1o1B.push(FormP_O1);
                       apply_o1o1B.push(FormP_O1B);
   
                       var apply_1_geo = new THREE.Geometry().setFromPoints( apply_o1o1B );
   
                       var applyline_dash = new THREE.LineDashedMaterial({
                                    color: 0x009600,//color
                                    dashSize: 0.05,
                                   gapSize: 0.03,
                                   linewidth: 1
   
                                    });
   
                       var applyline_o1B = new THREE.LineSegments(apply_1_geo,applyline_dash);
                       applyline_o1B.computeLineDistances();//compute
                    //   form_group.add(applyline_o1B);

                       var apply_o2o2B = [];
                       apply_o2o2B.push(FormP_O2);
                       apply_o2o2B.push(FormP_O2B);
   
                       var apply_2_geo = new THREE.Geometry().setFromPoints( apply_o2o2B );
   
                       var applyline_o2B = new THREE.LineSegments(apply_2_geo,applyline_dash);
                       applyline_o2B.computeLineDistances();//compute
                     //  form_group.add(applyline_o2B);

                    // green faces : o1 o2

                       var vertices = [
                       FormP_O1,FormP_O1B,FormP_O2B,FormP_O2
                       ];
   
                       var faces = [
                               new THREE.Face3(2, 1, 0),
                               new THREE.Face3(3, 2, 0),
                              
                           ];
   
                       var geom = new THREE.Geometry();
                       geom.vertices = vertices;
                       geom.faces = faces;
                       geom.computeFaceNormals();
                       var material_greenfaces = [
                       //new THREE.MeshLambertMaterial({color: 0x4d4dff, transparent: true}),
                       new THREE.MeshBasicMaterial({color: "black", wireframe:false, transparent: true,opacity:0.4}),
                       new THREE.MeshPhongMaterial({
                       color: 0x009600,transparent: true,opacity:0.3,side:THREE.DoubleSide,depthWrite:false
                       } )
                       ];
   
                       var greenface_O1O2 = THREE.SceneUtils.createMultiMaterialObject(geom, material_greenfaces);

                      // form_greenfaces.add(greenface_O1O2);
                    
                    
                    // green faces : o2 o2B point3 (perpendicular to BC)

                       var Vec_tri_BCC2 = Cal_Vec_2 (ForceP_B,ForceP_C_2,ForceP_C,1.2);

                       var FormP_3_temp = new THREE.Vector3(FormP_O2.x-1.2*Vec_tri_BCC2.x,FormP_O2.y-1.2*Vec_tri_BCC2.y,FormP_O2.z-1.2*Vec_tri_BCC2.z);
                       var oldlen = FormP_O2.distanceTo(FormP_3_temp);
                       var newlen = oldlen - Dlen1.l*oldlen;
                      
                       var FormP_3 = new THREE.Vector3(FormP_O2.x+(FormP_3_temp.x-FormP_O2.x)*newlen/oldlen, FormP_O2.y+(FormP_3_temp.y-FormP_O2.y)*newlen/oldlen, FormP_O2.z+(FormP_3_temp.z-FormP_O2.z)*newlen/oldlen);
                       var FormP_3B = new THREE.Vector3(FormP_3.x, FormP_3.y,-1.5);

                       var vertices = [
                       FormP_O2,FormP_O2B,FormP_3B,FormP_3
                       ];
   
                       var faces = [
                               new THREE.Face3(2, 1, 0),
                               new THREE.Face3(3, 2, 0),
                              
                           ];
   
                       var geom = new THREE.Geometry();
                       geom.vertices = vertices;
                       geom.faces = faces;
                       geom.computeFaceNormals();
                       var material_greenfaces = [
                       //new THREE.MeshLambertMaterial({color: 0x4d4dff, transparent: true}),
                       new THREE.MeshBasicMaterial({color: "black", wireframe:false, transparent: true,opacity:0.4}),
                       new THREE.MeshPhongMaterial({
                       color: 0x009600,transparent: true,opacity:0.3,side:THREE.DoubleSide,depthWrite:false
                       } )
                       ];
   
                       var greenface_O2P3 = THREE.SceneUtils.createMultiMaterialObject(geom, material_greenfaces);

                     //  form_greenfaces.add(greenface_O2P3);

                       var green_p3 = [];
                       green_p3.push(FormP_3);
                       green_p3.push(FormP_3B);
   
                       var green_p3_geo = new THREE.Geometry().setFromPoints( green_p3 );
   
                       var dashline_p3 = new THREE.LineSegments(green_p3_geo,applyline_dash);
                       dashline_p3.computeLineDistances();//compute
                    //   form_greenfaces.add(dashline_p3);

                    // green faces : o2 o2B point4 (perpendicular to AB)

                       var ForceP_A_2 = new THREE.Vector3(ForceP_A.x,ForceP_A.y,ForceP_A.z-1);
                       var Vec_tri_AA2B = Cal_Vec_2 (ForceP_A,ForceP_A_2,ForceP_B,1.2);
   
                       var FormP_4_temp = new THREE.Vector3(FormP_O2.x-1.2*Vec_tri_AA2B.x,FormP_O2.y-1.2*Vec_tri_AA2B.y,FormP_O2.z-1.2*Vec_tri_AA2B.z);
                       var oldlen = FormP_O2.distanceTo(FormP_4_temp);
                       var newlen = oldlen - Dlen2.l*oldlen;
                       
                       var FormP_4 = new THREE.Vector3(FormP_O2.x+(FormP_4_temp.x-FormP_O2.x)*newlen/oldlen, FormP_O2.y+(FormP_4_temp.y-FormP_O2.y)*newlen/oldlen, FormP_O2.z+(FormP_4_temp.z-FormP_O2.z)*newlen/oldlen);
                       var FormP_4B = new THREE.Vector3(FormP_4.x, FormP_4.y,-1.5);

                       var vertices = [
                       FormP_O2,FormP_O2B,FormP_4B,FormP_4
                       ];
   
                       var faces = [
                               new THREE.Face3(2, 1, 0),
                               new THREE.Face3(3, 2, 0),
                              
                           ];
   
                       var geom = new THREE.Geometry();
                       geom.vertices = vertices;
                       geom.faces = faces;
                       geom.computeFaceNormals();
                       var material_greenfaces = [
                       //new THREE.MeshLambertMaterial({color: 0x4d4dff, transparent: true}),
                       new THREE.MeshBasicMaterial({color: "black", wireframe:false, transparent: true,opacity:0.4}),
                       new THREE.MeshPhongMaterial({
                       color: 0x009600,transparent: true,opacity:0.3,side:THREE.DoubleSide,depthWrite:false
                       } )
                       ];
   
                       var greenface_O2P4 = THREE.SceneUtils.createMultiMaterialObject(geom, material_greenfaces);

                    //   form_greenfaces.add(greenface_O2P4);

                       var green_p4 = [];
                       green_p4.push(FormP_4);
                       green_p4.push(FormP_4B);
   
                       var green_p4_geo = new THREE.Geometry().setFromPoints( green_p4 );
   
                       var dashline_p4 = new THREE.LineSegments(green_p4_geo,applyline_dash);
                       dashline_p4.computeLineDistances();//compute
                     //  form_greenfaces.add(dashline_p4);

                    // green faces : o1 o1B point2 (perpendicular to CD)

                       var Vec_tri_CC2D = Cal_Vec_2 (ForceP_C,ForceP_C_2,ForceP_D,1.2);
   
                       var FormP_2_temp = new THREE.Vector3(FormP_O1.x-1.2*Vec_tri_CC2D.x,FormP_O1.y-1.2*Vec_tri_CC2D.y,FormP_O1.z-1.2*Vec_tri_CC2D.z);
                       var oldlen = FormP_O1.distanceTo(FormP_2_temp);
                       var newlen = oldlen - Dlen4.l*oldlen;
                       
                       var FormP_2 = new THREE.Vector3(FormP_O1.x+(FormP_2_temp.x-FormP_O1.x)*newlen/oldlen, FormP_O1.y+(FormP_2_temp.y-FormP_O1.y)*newlen/oldlen, FormP_O1.z+(FormP_2_temp.z-FormP_O1.z)*newlen/oldlen);
                       var FormP_2B = new THREE.Vector3(FormP_2.x, FormP_2.y,-1.5);

                       var vertices = [
                       FormP_O1,FormP_O1B,FormP_2B,FormP_2
                       ];
   
                       var faces = [
                               new THREE.Face3(0, 1, 2),
                               new THREE.Face3(0, 2, 3),
                              
                           ];
   
                       var geom = new THREE.Geometry();
                       geom.vertices = vertices;
                       geom.faces = faces;
                       geom.computeFaceNormals();
                       var material_greenfaces = [
                       //new THREE.MeshLambertMaterial({color: 0x4d4dff, transparent: true}),
                       new THREE.MeshBasicMaterial({color: "black", wireframe:false, transparent: true,opacity:0.4}),
                       new THREE.MeshPhongMaterial({
                       color: 0x009600,transparent: true,opacity:0.3,side:THREE.DoubleSide,depthWrite:false
                       } )
                       ];
   
                       var greenface_O1P2 = THREE.SceneUtils.createMultiMaterialObject(geom, material_greenfaces);

                    //   form_greenfaces.add(greenface_O1P2);

                       var green_p2 = [];
                       green_p2.push(FormP_2);
                       green_p2.push(FormP_2B);
   
                       var green_p2_geo = new THREE.Geometry().setFromPoints( green_p2 );
   
                       var dashline_p2 = new THREE.LineSegments(green_p2_geo,applyline_dash);
                       dashline_p2.computeLineDistances();//compute
                    //   form_greenfaces.add(dashline_p2);

                    // green faces : o1 o1B point1 (perpendicular to AD)

                       var Vec_tri_AA2D = Cal_Vec_2 (ForceP_D,ForceP_A_2,ForceP_A,1.2);
   
                       var FormP_1_temp = new THREE.Vector3(FormP_O1.x-1.2*Vec_tri_AA2D.x,FormP_O1.y-1.2*Vec_tri_AA2D.y,FormP_O1.z-1.2*Vec_tri_AA2D.z);
                       var oldlen = FormP_O1.distanceTo(FormP_1_temp);
                       var newlen = oldlen - Dlen3.l*oldlen;
                       
                       var FormP_1 = new THREE.Vector3(FormP_O1.x+(FormP_1_temp.x-FormP_O1.x)*newlen/oldlen, FormP_O1.y+(FormP_1_temp.y-FormP_O1.y)*newlen/oldlen, FormP_O1.z+(FormP_1_temp.z-FormP_O1.z)*newlen/oldlen);
                       var FormP_1B = new THREE.Vector3(FormP_1.x, FormP_1.y,-1.5);
                    
                       var vertices = [
                       FormP_O1,FormP_O1B,FormP_1B,FormP_1
                       ];
                    
                       var faces = [
                               new THREE.Face3(0, 1, 2),
                               new THREE.Face3(0, 2, 3),
                              
                           ];
                    
                       var geom = new THREE.Geometry();
                       geom.vertices = vertices;
                       geom.faces = faces;
                       geom.computeFaceNormals();
                       var material_greenfaces = [
                       //new THREE.MeshLambertMaterial({color: 0x4d4dff, transparent: true}),
                       new THREE.MeshBasicMaterial({color: "black", wireframe:false, transparent: true,opacity:0.4}),
                       new THREE.MeshPhongMaterial({
                       color: 0x009600,transparent: true,opacity:0.3,side:THREE.DoubleSide,depthWrite:false
                       } )
                       ];
                    
                       var greenface_O1P1 = THREE.SceneUtils.createMultiMaterialObject(geom, material_greenfaces);
                    
                    //   form_greenfaces.add(greenface_O1P1);
                    
                       var green_p1 = [];
                       green_p1.push(FormP_1);
                       green_p1.push(FormP_1B);
                    
                       var green_p1_geo = new THREE.Geometry().setFromPoints( green_p1 );
                    
                       var dashline_p1 = new THREE.LineSegments(green_p1_geo,applyline_dash);
                       dashline_p1.computeLineDistances();//compute
                    //   form_greenfaces.add(dashline_p1);

               //trial form 
                       
            
                       function create_trial_intec (startpoint,forceP1,forceP2,forceP3,intecP1,intecP1B){
                            
                            var startpoint 
                            
                            var trial_startpoint_vec = Cal_Vec_2 (forceP1,forceP2,forceP3,0.5);
                            var trial_startpoint_intec_temp = new THREE.Vector3(startpoint.x-1.2*trial_startpoint_vec.x, startpoint.y-1.2*trial_startpoint_vec.y,startpoint.z-1.2*trial_startpoint_vec.z);   
                            
                            var dirtsP = new THREE.Vector3(); // create once an reuse it
                            
                            dirtsP.subVectors( startpoint,trial_startpoint_intec_temp ).normalize();
                            
                            var dirto = new THREE.Vector3(); // create once an reuse it
                            
                            dirto.subVectors( intecP1,intecP1B).normalize();
                            
                            var trial_intec = LinesSectPt(dirtsP,startpoint,dirto,intecP1);
                            return  trial_intec

                       }

                       var trial_P3 = new THREE.Vector3(FormP_3.x,FormP_3.y,triP3.z)

                       var trial_o2 = create_trial_intec (trial_P3,ForceP_C,TrialP_O,ForceP_B,FormP_O2,FormP_O2B);
                       var trial_P4 = create_trial_intec (trial_o2,ForceP_A,TrialP_O,ForceP_B,FormP_4,FormP_4B);
                       var trial_o1 = create_trial_intec (trial_o2,ForceP_C,TrialP_O,ForceP_A,FormP_O1,FormP_O1B);
                       var trial_P2 = create_trial_intec (trial_o1,ForceP_C,TrialP_O,ForceP_D,FormP_2,FormP_2B);
                       var trial_P1 = create_trial_intec (trial_o1,ForceP_A,TrialP_O,ForceP_D,FormP_1,FormP_1B);

                       var trial_mesh_p3o2 = createCylinderMesh(trial_o2,trial_P3,DragPointMat,0.02,0.02);
                       var trial_mesh_p4o2 = createCylinderMesh(trial_o2,trial_P4,DragPointMat,0.02,0.02);
                       var trial_mesh_o1o2 = createCylinderMesh(trial_o2,trial_o1,DragPointMat,0.02,0.02);
                       var trial_mesh_p2o1 = createCylinderMesh(trial_o1,trial_P2,DragPointMat,0.02,0.02);
                       var trial_mesh_p1o1 = createCylinderMesh(trial_o1,trial_P1,DragPointMat,0.02,0.02);


                    //    form_trial.add(trial_mesh_p3o2)
                    //    form_trial.add(trial_mesh_p4o2)
                    //    form_trial.add(trial_mesh_o1o2)
                    //    form_trial.add(trial_mesh_p2o1)
                    //    form_trial.add(trial_mesh_p1o1)

              //trial form closing plane
                  
                       //plane mesh
                       
                       var vertices = [
                       trial_P1,trial_P2,trial_P3,trial_P4
                       ];
                    
                       var faces = [
                               new THREE.Face3(2, 1, 0),
                               new THREE.Face3(3, 2, 0),
                              
                           ];
                    
                       var geom = new THREE.Geometry();
                       geom.vertices = vertices;
                       geom.faces = faces;
                       geom.computeFaceNormals();
                       var material_trial_closingplane = [
                       //new THREE.MeshLambertMaterial({color: 0x4d4dff, transparent: true}),
                       new THREE.MeshBasicMaterial({color: "black", wireframe:false, transparent: true,opacity:0.4}),
                       new THREE.MeshPhongMaterial({
                       color: "darkgrey",transparent: true,opacity:0.5,side:THREE.DoubleSide,depthWrite:false
                       } )
                       ];
                    
                       var trial_closingplane = THREE.SceneUtils.createMultiMaterialObject(geom, material_trial_closingplane);
                    
                 //      form_trial.add(trial_closingplane);

                       var trialline_dash = new THREE.LineDashedMaterial({
                                        color: "black",//color
                                        dashSize: 0.1,
                                       gapSize: 0.03,
                                       linewidth: 1
   
                                        });
   
                       //dash edges
                       function createdashline (point1, point2,trialline_dash){

                           var dashline = [];
                           dashline.push(point1);
                           dashline.push(point2);
                          
   
                           var dashline_geo = new THREE.Geometry().setFromPoints( dashline );
   
                           var trialline_dash = new THREE.LineDashedMaterial({
                                        color: "black",//color
                                        dashSize: 0.1,
                                       gapSize: 0.03,
                                       linewidth: 1
   
                                        });
   
                           var dashline_edges = new THREE.LineSegments(dashline_geo,trialline_dash);
                           dashline_edges.computeLineDistances();//compute
                           return dashline_edges
                       }

                       var trial_linep1p2 = createdashline ( trial_P1,  trial_P2,trialline_dash)
                       var trial_linep1p3 = createdashline ( trial_P1,  trial_P3,trialline_dash)
                       var trial_linep1p4 = createdashline ( trial_P1,  trial_P4,trialline_dash)
                       var trial_linep2p3 = createdashline ( trial_P2,  trial_P3,trialline_dash)
                       var trial_linep3p4 = createdashline ( trial_P3,  trial_P4,trialline_dash)


                    //    form_trial.add(trial_linep1p2);
                    //    form_trial.add(trial_linep1p3);
                    //    form_trial.add(trial_linep1p4);
                    //    form_trial.add(trial_linep2p3);
                    //    form_trial.add(trial_linep3p4);
                       
                       //face nromals

                       var mid_p1p2p3 = new THREE.Vector3((trial_P1.x+trial_P2.x+trial_P3.x)/3,(trial_P1.y+trial_P2.y+trial_P3.y)/3,(trial_P1.z+trial_P2.z+trial_P3.z)/3 )
                       var vec_p1p2p3_temp = Cal_Vec_2 (trial_P3,trial_P2,trial_P1,1.2)
                       var normal_p1p2p3 = new THREE.Vector3(mid_p1p2p3.x-0.2*vec_p1p2p3_temp.x, mid_p1p2p3.y-0.2*vec_p1p2p3_temp.y, mid_p1p2p3.z-0.2*vec_p1p2p3_temp.z)

                       var trial_normal_material = new THREE.MeshPhongMaterial({color:"red"})
                       var trial_normal_outlinematerial = new THREE.MeshPhongMaterial({color:"white", side:THREE.BackSide})

                       var trial_normal_1 = createCylinderArrowMesh(mid_p1p2p3,normal_p1p2p3,trial_normal_material,0.015,0.035,0.55);
                       var trial_normal_1_outline = createCylinderArrowMesh(mid_p1p2p3,normal_p1p2p3,trial_normal_outlinematerial,0.018,0.038,0.54);

                    //    form_trial.add(trial_normal_1);
                    //    form_trial.add(trial_normal_1_outline);
                       trial_normal_1_outline.scale.multiplyScalar(1.05);

                       var mid_p1p3p4 = new THREE.Vector3((trial_P1.x+trial_P3.x+trial_P4.x)/3,(trial_P1.y+trial_P3.y+trial_P4.y)/3,(trial_P1.z+trial_P3.z+trial_P4.z)/3 )
                       var vec_p1p3p4_temp = Cal_Vec_2 (trial_P1,trial_P4,trial_P3,1.2)
                       var normal_p1p3p4 = new THREE.Vector3(mid_p1p3p4.x-0.2*vec_p1p3p4_temp.x, mid_p1p3p4.y-0.2*vec_p1p3p4_temp.y, mid_p1p3p4.z-0.2*vec_p1p3p4_temp.z)

                       var trial_normal_2 = createCylinderArrowMesh(mid_p1p3p4,normal_p1p3p4,trial_normal_material,0.015,0.035,0.55);
                       var trial_normal_2_outline = createCylinderArrowMesh(mid_p1p3p4,normal_p1p3p4,trial_normal_outlinematerial,0.018,0.038,0.54);

                    //    form_trial.add(trial_normal_2);
                    //    form_trial.add(trial_normal_2_outline);
                       trial_normal_2_outline.scale.multiplyScalar(1.05);

               //location of supports

                       //plane mesh
                       var FormCP1 = new THREE.Vector3(FormP_1.x,FormP_1.y,cp1.z);
                       var FormCP2 = new THREE.Vector3(FormP_2.x,FormP_2.y,cp2.z);
                       var FormCP3 = new THREE.Vector3(FormP_3.x,FormP_3.y,cp3.z);
                       var FormCP4 = new THREE.Vector3(FormP_4.x,FormP_4.y,cp4.z);

                       var vertices = [
                       FormCP1,FormCP2,FormCP3,FormCP4
                       ];

                       var faces = [
                               new THREE.Face3(0, 1, 2),
                               new THREE.Face3(0, 2, 3),
                              

                           ];

                       var geom = new THREE.Geometry();
                       geom.vertices = vertices;
                       geom.faces = faces;
                       geom.computeFaceNormals();
                       var material_step_1 = [
                       //new THREE.MeshLambertMaterial({color: 0x4d4dff, transparent: true}),
                       new THREE.MeshBasicMaterial({color: "white", wireframe: true, transparent: true,opacity:0.1}),
                       new THREE.MeshPhongMaterial({
                       color: "white",transparent: true,opacity:0.6,side:THREE.DoubleSide,depthWrite:false
                       } )
                       ];

                       var form_closingmesh= THREE.SceneUtils.createMultiMaterialObject(geom, material_step_1);
                    //   form_closingplane.add(form_closingmesh);

                       //dash edges

                       var form_linep1p2 = createdashline ( FormCP1,  FormCP2,trialline_dash)
                       var form_linep1p3 = createdashline ( FormCP1,  FormCP3,trialline_dash)
                       var form_linep1p4 = createdashline ( FormCP1,  FormCP4,trialline_dash)
                       var form_linep2p3 = createdashline ( FormCP2,  FormCP3,trialline_dash)
                       var form_linep3p4 = createdashline ( FormCP3,  FormCP4,trialline_dash)


                    //    form_closingplane.add(form_linep1p2);
                    //    form_closingplane.add(form_linep1p3);
                    //    form_closingplane.add(form_linep1p4);
                    //    form_closingplane.add(form_linep2p3);
                    //    form_closingplane.add(form_linep3p4);                    

                       //face nromals

                       var mid_p1p2p3 = new THREE.Vector3((FormCP1.x+FormCP2.x+FormCP3.x)/3,(FormCP1.y+FormCP2.y+FormCP3.y)/3,(FormCP1.z+FormCP2.z+FormCP3.z)/3 )
                       var vec_p1p2p3_temp = Cal_Vec_2 (FormCP3,FormCP2,FormCP1,1.2)
                       var normal_p1p2p3 = new THREE.Vector3(mid_p1p2p3.x-0.2*vec_p1p2p3_temp.x, mid_p1p2p3.y-0.2*vec_p1p2p3_temp.y, mid_p1p2p3.z-0.2*vec_p1p2p3_temp.z)

                       var form_normal_material = new THREE.MeshPhongMaterial({color:"red"})
                       var form_normal_outlinematerial = new THREE.MeshPhongMaterial({color:"white", side:THREE.BackSide})

                       var form_normal_1 = createCylinderArrowMesh(mid_p1p2p3,normal_p1p2p3,form_normal_material,0.015,0.035,0.55);
                       var form_normal_1_outline = createCylinderArrowMesh(mid_p1p2p3,normal_p1p2p3,form_normal_outlinematerial,0.018,0.038,0.54);

                    //    form_closingplane.add(form_normal_1);
                    //    form_closingplane.add(form_normal_1_outline);
                       form_normal_1_outline.scale.multiplyScalar(1.05);

                       var mid_p1p3p4 = new THREE.Vector3((FormCP1.x+FormCP3.x+FormCP4.x)/3,(FormCP1.y+FormCP3.y+FormCP4.y)/3,(FormCP1.z+FormCP3.z+FormCP4.z)/3 )
                       var vec_p1p3p4_temp = Cal_Vec_2 (FormCP1,FormCP4,FormCP3,1.2)
                       var normal_p1p3p4 = new THREE.Vector3(mid_p1p3p4.x-0.2*vec_p1p3p4_temp.x, mid_p1p3p4.y-0.2*vec_p1p3p4_temp.y, mid_p1p3p4.z-0.2*vec_p1p3p4_temp.z)

                       var form_normal_2 = createCylinderArrowMesh(mid_p1p3p4,normal_p1p3p4,form_normal_material,0.015,0.035,0.55);
                       var form_normal_2_outline = createCylinderArrowMesh(mid_p1p3p4,normal_p1p3p4,form_normal_outlinematerial,0.018,0.038,0.54);

                    //    form_closingplane.add(form_normal_2);
                    //    form_closingplane.add(form_normal_2_outline);
                       form_normal_2_outline.scale.multiplyScalar(1.05);

            //location of x1 x2

                       //find x1

                       var ForceX1_vec = Cal_Vec_2 (trial_P3,trial_P2,trial_P1,0.5);
                       var ForceX1_temp = new THREE.Vector3(TrialP_O.x-1.2*ForceX1_vec.x, TrialP_O.y-1.2*ForceX1_vec.y,TrialP_O.z-1.2*ForceX1_vec.z);   
                     
                       //define function mesh IntersectPoint
                       function Cal_Plane_Line_Intersect_Point(Point_online,LineVec,Point_onPlane,PlaneVec){
   
                           var IntersectPoint = new THREE.Vector3(
                               //x
                               Point_online.x+LineVec.x*((Point_onPlane.x - Point_online.x)*PlaneVec.x+(Point_onPlane.y - Point_online.y)*PlaneVec.y+(Point_onPlane.z - Point_online.z)*PlaneVec.z) / (PlaneVec.x* LineVec.x+ PlaneVec.y* LineVec.y+ PlaneVec.z* LineVec.z), 
                               //y
                               Point_online.y+LineVec.y*((Point_onPlane.x - Point_online.x)*PlaneVec.x+(Point_onPlane.y - Point_online.y)*PlaneVec.y+(Point_onPlane.z - Point_online.z)*PlaneVec.z) / (PlaneVec.x* LineVec.x+ PlaneVec.y* LineVec.y+ PlaneVec.z* LineVec.z),
                               //z
                               Point_online.z+LineVec.z*((Point_onPlane.x - Point_online.x)*PlaneVec.x+(Point_onPlane.y - Point_online.y)*PlaneVec.y+(Point_onPlane.z - Point_online.z)*PlaneVec.z) / (PlaneVec.x* LineVec.x+ PlaneVec.y* LineVec.y+ PlaneVec.z* LineVec.z))
   
                          return IntersectPoint;
                       }
                       //define intersection point x1
                       var intersect_x1_vec = new THREE.Vector3(ForceX1_temp.x-TrialP_O.x,ForceX1_temp.y-TrialP_O.y,ForceX1_temp.z-TrialP_O.z);
                       var applyplanevec = Cal_Vec_2 (ForceP_A,ForceP_B,ForceP_C,0.5);
                       var ForceX1 = Cal_Plane_Line_Intersect_Point(TrialP_O,intersect_x1_vec,ForceP_B,applyplanevec);
           
                       var line_ox1 = [];
                       line_ox1.push(TrialP_O);
                       line_ox1.push(ForceX1);
   
                       var line_ox1_geo = new THREE.Geometry().setFromPoints( line_ox1 );
   
                       var applyline_1 = new THREE.LineDashedMaterial({
                                    color: "black",//color
                                    dashSize: 0.2,
                                   gapSize: 0.03,
                                   linewidth: 1
   
                                    });
   
                       var applylineox1 = new THREE.LineSegments(line_ox1_geo,applyline_1);
                       applylineox1.computeLineDistances();//compute
                   //    trial_force.add(applylineox1);

                    
                       //find x2

                       var ForceX2_vec = Cal_Vec_2 (trial_P1,trial_P4,trial_P3,0.5);
                       var ForceX2_temp = new THREE.Vector3(TrialP_O.x-1.2*ForceX2_vec.x, TrialP_O.y-1.2*ForceX2_vec.y,TrialP_O.z-1.2*ForceX2_vec.z);   

                       var intersect_x2_vec = new THREE.Vector3(ForceX2_temp.x-TrialP_O.x,ForceX2_temp.y-TrialP_O.y,ForceX2_temp.z-TrialP_O.z);
                       var ForceX2 = Cal_Plane_Line_Intersect_Point(TrialP_O,intersect_x2_vec,ForceP_B,applyplanevec);
           
                       var line_ox2 = [];
                       line_ox2.push(TrialP_O);
                       line_ox2.push(ForceX2);
   
                       var line_ox2_geo = new THREE.Geometry().setFromPoints( line_ox2 );
                       var applylineox2 = new THREE.LineSegments(line_ox2_geo,applyline_1);
                       applylineox2.computeLineDistances();//compute
                     //  trial_force.add(applylineox2);

                       //add x1 x2 arrow

                       var TrialP_O_sp1 = new THREE.Sphere(new THREE.Vector3(TrialP_O.x,TrialP_O.y,TrialP_O.z),0.42);
                       var x1_closeP1 = TrialP_O_sp1.clampPoint(ForceX1);

                       var TrialP_O_sp2 = new THREE.Sphere(new THREE.Vector3(TrialP_O.x,TrialP_O.y,TrialP_O.z),0.64);
                       var x1_closeP2 = TrialP_O_sp2.clampPoint(ForceX1);

                       var x1_arrow = createCylinderArrowMesh(x1_closeP1,x1_closeP2,form_normal_material,0.012,0.025,0.55);

                     //  trial_force.add(x1_arrow);

                       var x2_closeP1 = TrialP_O_sp1.clampPoint(ForceX2);

                       var x2_closeP2 = TrialP_O_sp2.clampPoint(ForceX2);

                       var x2_arrow = createCylinderArrowMesh(x2_closeP1,x2_closeP2,form_normal_material,0.012,0.025,0.55);

                     //  trial_force.add(x2_arrow);

                       //draw x1o1, x2o2

                       //find constrain point o1

                       var ForceO1_temp = Cal_Vec_2 (FormCP1,FormCP2,FormCP3,0.5);
                       var ForceO1 = new THREE.Vector3(ForceX1.x-o1.l*ForceO1_temp.x, ForceX1.y-o1.l*ForceO1_temp.y,ForceX1.z-o1.l*ForceO1_temp.z);   

                       var line_o1x1_temp = [];
                       line_o1x1_temp.push(ForceX1);
                       line_o1x1_temp.push(ForceO1);

                       var line_o1x1_geo = new THREE.Geometry().setFromPoints( line_o1x1_temp );

                       var line_o1x1 = new THREE.LineSegments(line_o1x1_geo,applyline_1);
                       line_o1x1.computeLineDistances();//compute
                    //   trial_force.add(line_o1x1);

                       //find constrain point o2

                       var ForceO2_temp = Cal_Vec_2 (FormCP3,FormCP4,FormCP1,0.5);
                       var ForceO2 = new THREE.Vector3(ForceX2.x-o2.l*ForceO2_temp.x, ForceX2.y-o2.l*ForceO2_temp.y,ForceX2.z-o2.l*ForceO2_temp.z);   

                       var line_o2x2_temp = [];
                       line_o2x2_temp.push(ForceX2);
                       line_o2x2_temp.push(ForceO2);

                       var line_o2x2_geo = new THREE.Geometry().setFromPoints( line_o2x2_temp );

                       var applyline_2 = new THREE.LineDashedMaterial({
                                    color: "red",//color
                                    dashSize: 0.2,
                                   gapSize: 0.03,
                                   linewidth: 1
   
                                    });

                       var line_o2x2 = new THREE.LineSegments(line_o2x2_geo,applyline_2);
                       line_o2x2.computeLineDistances();//compute
                   //    trial_force.add(line_o2x2);
                    
                       
            //final force diagram

                       var vertices = [
                       ForceP_A,ForceP_B,ForceP_C,ForceP_D,ForceO1,ForceO2
                       ];
   
                       var faces = [
                               new THREE.Face3(0, 1, 5),//ABO2
                               new THREE.Face3(1, 2, 5),//BCO2
                               new THREE.Face3(0, 2, 5),//ACO2
   
                               new THREE.Face3(0, 3, 4),//ADO1
                               new THREE.Face3(2, 3, 4),//CDO1
                               new THREE.Face3(0, 2, 4),//ACO1
   
                               new THREE.Face3(2, 4, 5),//Co1O2
                               new THREE.Face3(0, 4, 5),//Ao1O2
                      
                              
   
                           ];
   
                       var geom = new THREE.Geometry();
                       geom.vertices = vertices;
                       geom.faces = faces;
                       geom.computeFaceNormals();

                       var force_exfaces = THREE.SceneUtils.createMultiMaterialObject(geom, material_AL);
                    //   force_group.add(force_exfaces);


                       // add reaction forces







            //force cell offset 

                       function create_force_cell(point1,point2,point3,point4,scale){

                        var centroid = new THREE.Vector3((point1.x+point2.x+point3.x+point4.x)/4,(point1.y+point2.y+point3.y+point4.y)/4,(point1.z+point2.z+point3.z+point4.z)/4);
                        
                 
                        var scale_point1 = new THREE.Vector3(centroid.x + (point1.x - centroid.x)*scale, centroid.y + (point1.y - centroid.y)*scale, centroid.z + (point1.z - centroid.z)*scale );

                     
                        var scale_point2 = new THREE.Vector3(centroid.x + (point2.x - centroid.x)*scale, centroid.y + (point2.y - centroid.y)*scale, centroid.z + (point2.z - centroid.z)*scale );

                      
                        var scale_point3 = new THREE.Vector3(centroid.x + (point3.x - centroid.x)*scale, centroid.y + (point3.y - centroid.y)*scale, centroid.z + (point3.z - centroid.z)*scale );

                      
                        var scale_point4 = new THREE.Vector3(centroid.x + (point4.x - centroid.x)*scale, centroid.y + (point4.y - centroid.y)*scale, centroid.z + (point4.z - centroid.z)*scale );

                        var vertices = [
                        scale_point1,scale_point2,scale_point3,scale_point4
                        ];
                        
                        var faces = [
                                new THREE.Face3(0, 1, 2),//ABO
                                new THREE.Face3(0, 1, 3),//BCO
                                new THREE.Face3(0, 2, 3),//ACO  
                                new THREE.Face3(1, 2, 3),//ACO                   
                            ];
                        
                        var geom = new THREE.Geometry();
                        geom.vertices = vertices;
                        geom.faces = faces;
                        geom.computeFaceNormals();
                        var material_step_1 = [
                        //new THREE.MeshLambertMaterial({color: 0x4d4dff, transparent: true}),
                        new THREE.MeshBasicMaterial({color: "white", wireframe: true, transparent: true,opacity:0.1}),
                        new THREE.MeshPhongMaterial({
                        color: "grey",transparent: true,opacity:0.2,side:THREE.DoubleSide,depthWrite:false
                        } )
                        ];
                        
                        var force_cell = THREE.SceneUtils.createMultiMaterialObject(geom, material_step_1);

                        return force_cell

                       }
                        
                        //cell ABCO2

                        var force_cell_ABCO2 = create_force_cell(ForceP_A,ForceP_B,ForceP_C,ForceO2,foffset.l)
                   //     force_cell.add(force_cell_ABCO2)

                        //cell ACDO1

                        var force_cell_ACDO1 = create_force_cell(ForceP_A,ForceP_C,ForceP_D,ForceO1,foffset.l)
                    //    force_cell.add(force_cell_ACDO1)

                         //cell ACO1O2

                         var force_cell_ACO1O2 = create_force_cell(ForceP_A,ForceP_C,ForceO1,ForceO2,foffset.l)
                     //   force_cell.add(force_cell_ACO1O2)
                
                
                //force cell offset point
                    

                       function create_offset_point(point1,point2,point3,point4,scale){

                                 var centroid = new THREE.Vector3((point1.x+point2.x+point3.x+point4.x)/4,(point1.y+point2.y+point3.y+point4.y)/4,(point1.z+point2.z+point3.z+point4.z)/4);                              
                                 var scale_point = new THREE.Vector3(centroid.x + (point1.x - centroid.x)*scale, centroid.y + (point1.y - centroid.y)*scale, centroid.z + (point1.z - centroid.z)*scale );
                                 return scale_point
                       }
                      //cell ABCO2
                    
                       //point A
                       var offset_FP_A = create_offset_point(ForceP_A,ForceP_B,ForceP_C,ForceO2,foffset.l)
                       //point B
                       var offset_FP_B = create_offset_point(ForceP_B,ForceP_A,ForceP_C,ForceO2,foffset.l)
                       //point C
                       var offset_FP_C = create_offset_point(ForceP_C,ForceP_A,ForceP_B,ForceO2,foffset.l)
                       //point o2
                       var offset_FP_O2 = create_offset_point(ForceO2,ForceP_A,ForceP_B,ForceP_C,foffset.l)

                       var offset_FP_BA = new THREE.Vector3().subVectors(offset_FP_B, offset_FP_A);
                       var offset_FP_CB=new THREE.Vector3().subVectors(offset_FP_C, offset_FP_B);
                       var offset_FV1=cross(offset_FP_BA,offset_FP_CB);

                       offset_force_ABC=create_Tri_FaceMesh(offset_FP_A,offset_FP_B,offset_FP_C,offset_FV1,true,TubePoints1[1].z,'n1')

                    //   force_cell.add(offset_force_ABC)

                       var offset_FP_BO2 = new THREE.Vector3().subVectors(offset_FP_B, offset_FP_O2);
                       var offset_FP_CB=new THREE.Vector3().subVectors(offset_FP_C, offset_FP_B);
                       var offset_FV2=cross(offset_FP_CB,offset_FP_BO2);

                       offset_force_BCO2=create_Tri_FaceMesh(offset_FP_B,offset_FP_O2,offset_FP_C,offset_FV2,false,TubePoints1[1].z,'n1')

                     //  force_cell.add(offset_force_BCO2)

                       var offset_FP_BO2 = new THREE.Vector3().subVectors(offset_FP_O2, offset_FP_B);
                       var offset_FP_AB=new THREE.Vector3().subVectors(offset_FP_B, offset_FP_A);
                       var offset_FV3=cross(offset_FP_BO2,offset_FP_AB);

                       offset_force_ABO2=create_Tri_FaceMesh(offset_FP_B,offset_FP_A,offset_FP_O2,offset_FV3,false,TubePoints1[1].z,'n1')

                    //   force_cell.add(offset_force_ABO2)

                       var offset_FP_AO2 = new THREE.Vector3().subVectors(offset_FP_O2, offset_FP_A);
                       var offset_FP_AC=new THREE.Vector3().subVectors(offset_FP_A, offset_FP_C);
                       var offset_FV4=cross(offset_FP_AO2,offset_FP_AC);

                       offset_force_ACO2=create_Tri_FaceMesh(offset_FP_A,offset_FP_C,offset_FP_O2,offset_FV4,false,TubePoints1[1].z,'n1')

                   //    force_cell.add(offset_force_ACO2)

                      //cell ACDO1
                    
                       //point A
                       var offset_FP_A2 = create_offset_point(ForceP_A,ForceP_C,ForceP_D,ForceO1,foffset.l)
                       //point B
                       var offset_FP_C2 = create_offset_point(ForceP_C,ForceP_A,ForceP_D,ForceO1,foffset.l)
                       //point C
                       var offset_FP_D2 = create_offset_point(ForceP_D,ForceP_A,ForceP_C,ForceO1,foffset.l)
                       //point o2
                       var offset_FP_O1 = create_offset_point(ForceO1,ForceP_A,ForceP_C,ForceP_D,foffset.l)

                       var offset_FP_DA = new THREE.Vector3().subVectors(offset_FP_D2, offset_FP_A2);
                       var offset_FP_CD=new THREE.Vector3().subVectors(offset_FP_C2, offset_FP_D2);
                       var offset_FV12=cross(offset_FP_CD,offset_FP_DA);

                       offset_force_ACD=create_Tri_FaceMesh(offset_FP_C2,offset_FP_D2,offset_FP_A2,offset_FV12,true,TubePoints1[1].z,'n1')

                   //    force_cell.add(offset_force_ACD)

                       var offset_FP_DO1 = new THREE.Vector3().subVectors(offset_FP_D2, offset_FP_O1);
                       var offset_FP_CD=new THREE.Vector3().subVectors(offset_FP_C2, offset_FP_D2);
                       var offset_FV22=cross(offset_FP_DO1,offset_FP_CD);

                       offset_force_CDO1=create_Tri_FaceMesh(offset_FP_C2,offset_FP_O1,offset_FP_D2,offset_FV22,false,TubePoints1[1].z,'n1')

                   //    force_cell.add(offset_force_CDO1)

                       var offset_FP_DO1 = new THREE.Vector3().subVectors(offset_FP_O1, offset_FP_D2);
                       var offset_FP_AD=new THREE.Vector3().subVectors(offset_FP_D2, offset_FP_A2);
                       var offset_FV32=cross(offset_FP_AD,offset_FP_DO1);

                       offset_force_ADO1=create_Tri_FaceMesh(offset_FP_O1,offset_FP_A2,offset_FP_D2,offset_FV32,false,TubePoints1[1].z,'n1')

                    //   force_cell.add(offset_force_ADO1)

                       var offset_FP_AO1 = new THREE.Vector3().subVectors(offset_FP_O1, offset_FP_A2);
                       var offset_FP_AC=new THREE.Vector3().subVectors(offset_FP_A2, offset_FP_C2);
                       var offset_FV42=cross(offset_FP_AC,offset_FP_AO1);

                       offset_force_ACO1=create_Tri_FaceMesh(offset_FP_O1,offset_FP_C2,offset_FP_A2,offset_FV42,false,TubePoints1[1].z,'n1')

                    //   force_cell.add(offset_force_ACO1)

                       
                      //cell ACO1O2
                    
                       //point A
                       var offset_FP_A3 = create_offset_point(ForceP_A,ForceP_C,ForceO2,ForceO1,foffset.l)
                       //point B
                       var offset_FP_C3 = create_offset_point(ForceP_C,ForceP_A,ForceO2,ForceO1,foffset.l)
                       //point C
                       var offset_FP_O22 = create_offset_point(ForceO2,ForceP_A,ForceP_C,ForceO1,foffset.l)
                       //point o2
                       var offset_FP_O12 = create_offset_point(ForceO1,ForceP_A,ForceP_C,ForceO1,foffset.l)

                       var offset_FP_AC = new THREE.Vector3().subVectors(offset_FP_C3, offset_FP_A3);
                       var offset_FP_CO2=new THREE.Vector3().subVectors(offset_FP_C3, offset_FP_O22);
                       var offset_FV13=cross(offset_FP_AC,offset_FP_CO2);

                       offset_force_ACO2=create_Tri_FaceMesh(offset_FP_A3,offset_FP_O22,offset_FP_C3,offset_FV13,false,TubePoints1[1].z,'n1')

                    //   force_cell.add(offset_force_ACO2)

                       var offset_FP_CO1 = new THREE.Vector3().subVectors(offset_FP_C3, offset_FP_O12);
                       var offset_FP_O1O2=new THREE.Vector3().subVectors(offset_FP_O12, offset_FP_O22);
                       var offset_FV23=cross(offset_FP_O1O2,offset_FP_CO1);

                       offset_force_CO1O2=create_Tri_FaceMesh(offset_FP_C3,offset_FP_O22,offset_FP_O12,offset_FV23,false,TubePoints1[1].z,'n1')

                    //   force_cell.add(offset_force_CO1O2)

                       var offset_FP_AC = new THREE.Vector3().subVectors(offset_FP_C3, offset_FP_A3);
                       var offset_FP_CO1=new THREE.Vector3().subVectors(offset_FP_O12, offset_FP_C3);
                       var offset_FV33=cross(offset_FP_CO2,offset_FP_AC);

                       offset_force_ACO1=create_Tri_FaceMesh(offset_FP_C3,offset_FP_O12,offset_FP_A3,offset_FV33,false,TubePoints1[1].z,'n1')

                   //    force_cell.add(offset_force_ACO1)

                       var offset_FP_AO2 = new THREE.Vector3().subVectors(offset_FP_A3, offset_FP_O22);
                       var offset_FP_O1O2=new THREE.Vector3().subVectors(offset_FP_O12, offset_FP_O22);
                       var offset_FV43=cross(offset_FP_AO2,offset_FP_O1O2);

                       offset_force_AO1O2=create_Tri_FaceMesh(offset_FP_O12,offset_FP_O22,offset_FP_A3,offset_FV43,false,TubePoints1[1].z,'n1')

                   //    force_cell.add(offset_force_AO1O2)

      //form diagram construction


                // step1 : find nodeO2 (intersecting from CP3 & CP4)

                    var formPoint3 = Cal_Vec_2 (ForceP_C,ForceO2,ForceP_B,0.5);
                    var formPoint3end = new THREE.Vector3(FormCP3.x-1.2*formPoint3.x, FormCP3.y-1.2*formPoint3.y,FormCP3.z-1.2*formPoint3.z);  
                    
                    var formPoint4 = Cal_Vec_2 (ForceP_B,ForceO2,ForceP_A,0.5);
                    var formPoint4end = new THREE.Vector3(FormCP4.x-1.2*formPoint4.x, FormCP4.y-1.2*formPoint4.y,FormCP4.z-1.2*formPoint4.z);  
                    
                    //Point o2
                    var diro2 = new THREE.Vector3(); // create once an reuse it

                    diro2.subVectors( FormCP3,formPoint3end  ).normalize();

                    var diro22 = new THREE.Vector3(); // create once an reuse it

                    diro22.subVectors(FormCP4,formPoint4end  ).normalize();
                    var formPointO2 = LinesSectPt(diro2,FormCP3, diro22,FormCP4);

                    var materialpointo = new THREE.MeshPhongMaterial({color: "lightgrey", transparent: false});
   
                    var spformPointO2 = new THREE.SphereGeometry(0.05);
                    var new_formPointO2 = new THREE.Mesh(spformPointO2, materialpointo);
                  
                    new_formPointO2.position.copy(formPointO2);
                    new_formPointO2.castShadow=true;
                  
                       //Ctrl_tubes.push(sp_Tube0);
                  
                    var outlineMaterial1 = new THREE.MeshBasicMaterial( { color: "black", transparent: false, side: THREE.BackSide } );
                    var outlineMeshnew1 = new THREE.Mesh( spformPointO2, outlineMaterial1 );
                    outlineMeshnew1.position.copy(formPointO2);
                    outlineMeshnew1.scale.multiplyScalar(1.55);
                  
                   // form_group.add(new_formPointO2); 
                  //  form_group.add(outlineMeshnew1); 

                // step2 : find nodeO1 (intersecting from CP1 & CP2)


                    //Point o1
                    var formPointo3 = Cal_Vec_2 (ForceO1,ForceP_C,ForceO2,0.5);
                    var formPointo3end = new THREE.Vector3(FormCP3.x-1.2*formPointo3.x, FormCP3.y-1.2*formPointo3.y,FormCP3.z-1.2*formPointo3.z);  

                   
                    var formPoint1 = Cal_Vec_2 (ForceP_D,ForceO1,ForceP_A,0.5);
                    var formPoint1end = new THREE.Vector3(FormCP1.x-1.2*formPoint1.x, FormCP1.y-1.2*formPoint1.y,FormCP1.z-1.2*formPoint1.z);  
                    
                    
                    var formPoint2 = Cal_Vec_2 (ForceP_C,ForceO1,ForceP_D,0.5);
                    var formPoint2end = new THREE.Vector3(FormCP2.x-1.2*formPoint2.x, FormCP2.y-1.2*formPoint2.y,FormCP2.z-1.2*formPoint2.z);  
            
                    var diro1 = new THREE.Vector3(); // create once an reuse it

                    diro1.subVectors( FormCP1,formPoint1end  ).normalize();

                    var diro12 = new THREE.Vector3(); // create once an reuse it

                    diro12.subVectors( FormCP2,formPoint2end  ).normalize();
                    var formPointO1 = LinesSectPt(diro1,FormCP1, diro12,FormCP2);

                    var materialpointo = new THREE.MeshPhongMaterial({color: "lightgrey", transparent: false});
   
                    var spformPointO1 = new THREE.SphereGeometry(0.05);
                    var new_formPointO1 = new THREE.Mesh(spformPointO1, materialpointo);
                  
                    new_formPointO1.position.copy(formPointO1);
                    new_formPointO1.castShadow=true;
                  
                       //Ctrl_tubes.push(sp_Tube0);
                  
                    var outlineMaterial1 = new THREE.MeshBasicMaterial( { color: "black", transparent: false, side: THREE.BackSide } );
                    var outlineMeshnew2 = new THREE.Mesh( spformPointO1, outlineMaterial1 );
                    outlineMeshnew2.position.copy(formPointO1);
                    outlineMeshnew2.scale.multiplyScalar(1.55);
                  
                  //  form_group.add(new_formPointO1); 
                  //  form_group.add(outlineMeshnew2); 

                // step3 : find nodeO3 (intersecting from o1 & o2)

                   
                    var formPointo4 = Cal_Vec_2 (ForceO1,ForceP_A,ForceO2,0.5);
                    var formPointo4end = new THREE.Vector3(FormCP1.x-1.2*formPointo4.x, FormCP1.y-1.2*formPointo4.y,FormCP1.z-1.2*formPointo4.z);  

                    var diro5 = new THREE.Vector3(); // create once an reuse it

                    diro5.subVectors( FormCP3,formPointo3end  ).normalize();

                    var diro52 = new THREE.Vector3(); // create once an reuse it

                    diro52.subVectors( FormCP1,formPointo4end  ).normalize();
                    var formPointO5 = LinesSectPt(diro5,FormCP3, diro52,FormCP1);

                    var materialpointo = new THREE.MeshPhongMaterial({color: "lightgrey", transparent: false});
   
                    var spformPointO3 = new THREE.SphereGeometry(0.05);
                    var new_formPointO3 = new THREE.Mesh(spformPointO3, materialpointo);
                   
                    new_formPointO3.position.copy(formPointO5);
                    new_formPointO3.castShadow=true;
                   
                       //Ctrl_tubes.push(sp_Tube0);
                   
                    var outlineMaterial1 = new THREE.MeshBasicMaterial( { color: "black", transparent: false, side: THREE.BackSide } );
                    var outlineMeshnew3 = new THREE.Mesh( spformPointO3, outlineMaterial1 );
                    outlineMeshnew3.position.copy(formPointO5);
                    outlineMeshnew3.scale.multiplyScalar(1.55);
                   
                  //  form_group.add(new_formPointO3); 
                  //  form_group.add(outlineMeshnew3); 


                    
                //step4: Cal areas

                    var face_BCO2_area = new THREE.Vector3().crossVectors(
                       new THREE.Vector3().subVectors( ForceP_B, ForceO2 ),
                       new THREE.Vector3().subVectors( ForceP_C, ForceO2 ),
                       ).length()/2
     
                       var face_CO1O2_area = new THREE.Vector3().crossVectors(
                       new THREE.Vector3().subVectors( ForceO1, ForceP_C ),
                       new THREE.Vector3().subVectors( ForceO2, ForceP_C ),
                       ).length()/2
     
                       var face_CDO1_area = new THREE.Vector3().crossVectors(
                       new THREE.Vector3().subVectors(ForceP_C, ForceO1 ),
                       new THREE.Vector3().subVectors( ForceP_D, ForceO1 ),
                       ).length()/2

                       var face_ADO1_area = new THREE.Vector3().crossVectors(
                       new THREE.Vector3().subVectors(ForceP_A, ForceO1 ),
                       new THREE.Vector3().subVectors( ForceP_D, ForceO1 ),
                       ).length()/2

                       var face_AO1O2_area = new THREE.Vector3().crossVectors(
                       new THREE.Vector3().subVectors( ForceO1, ForceP_A ),
                       new THREE.Vector3().subVectors( ForceO2, ForceP_A ),
                       ).length()/2

                       var face_ABO2_area = new THREE.Vector3().crossVectors(
                       new THREE.Vector3().subVectors( ForceP_B, ForceO2 ),
                       new THREE.Vector3().subVectors( ForceP_A, ForceO2 ),
                       ).length()/2

                       var face_ACO1_area = new THREE.Vector3().crossVectors(
                       new THREE.Vector3().subVectors( ForceP_C, ForceO1 ),
                       new THREE.Vector3().subVectors( ForceP_A, ForceO1 ),
                       ).length()/2

                       var face_ACO2_area = new THREE.Vector3().crossVectors(
                       new THREE.Vector3().subVectors( ForceP_C, ForceO2 ),
                       new THREE.Vector3().subVectors( ForceP_A, ForceO2 ),
                       ).length()/2
     
     
                       var max = Math.max(face_BCO2_area, face_CO1O2_area, face_CDO1_area,face_ADO1_area, face_AO1O2_area,face_ABO2_area, face_ACO1_area,face_ACO2_area)
                    
                    //4.1 Point3 to PointO2

                       var tubeMesh_p3o2 = face_BCO2_area/max;
     
                       tt = 0.05*face_BCO2_area;

                       var oldP3O2 = formPointO2.distanceTo(FormCP3);
                       var newP3O2 = oldP3O2 - 2.5;
                       var newArrowP3O2 = new THREE.Vector3(formPointO2.x + (formPointO2.x - FormCP3.x) * -1.1 / 0.8,formPointO2.y + (formPointO2.y - FormCP3.y) * -1.1 / 0.8,formPointO2.z + (formPointO2.z - FormCP3.z) * -1.1 / 0.8 )

                       var Sphere_Point3 = new THREE.Sphere(new THREE.Vector3(formPointO2.x,formPointO2.y,formPointO2.z),0.12);
                       var Point_Point3 = Sphere_Point3.clampPoint(FormCP3);
              
     
                       if (tubeMesh_p3o2<0.25 & tubeMesh_p3o2>=0)
                         { var Colorbar_blue_1 = new THREE.MeshPhongMaterial( {
                                             color: 0x5B84AE
                                         } );
                        var spGeom_Point3 = new THREE.SphereGeometry(tt-0.001);
                        var sp_Point3_1 = new THREE.Mesh(spGeom_Point3, Colorbar_blue_1);
                        sp_Point3_1.position.copy(Point_Point3);
                        var tubeMesh_3o2=createCylinderMesh(FormCP3,Point_Point3,Colorbar_blue_1,tt,tt);
                        var tube_arrow_3o2=createCylinderArrowMesh(newArrowP3O2 ,FormCP3,Colorbar_blue_1,0.02,0.05,0.6);
                                       }
                       if (tubeMesh_p3o2<0.5 & tubeMesh_p3o2>=0.25)
                       {  var Colorbar_blue_2 = new THREE.MeshPhongMaterial( {
                                             color: 0x376D9B
                                         } );
                        var spGeom_Point3 = new THREE.SphereGeometry(tt-0.001);
                        var sp_Point3_1 = new THREE.Mesh(spGeom_Point3, Colorbar_blue_2);
                        sp_Point3_1.position.copy(Point_Point3);
                        var tubeMesh_3o2=createCylinderMesh(FormCP3,Point_Point3,Colorbar_blue_2,tt,tt);
                        var tube_arrow_3o2=createCylinderArrowMesh(newArrowP3O2 ,FormCP3,Colorbar_blue_2,0.02,0.05,0.6);
                                       }
                       if (tubeMesh_p3o2<0.75 & tubeMesh_p3o2>=0.5)
                       {  var Colorbar_blue_3 = new THREE.MeshPhongMaterial( {
                                             color: 0x05416D
                                         } );
                                         var spGeom_Point3 = new THREE.SphereGeometry(tt-0.001);
                        var sp_Point3_1 = new THREE.Mesh(spGeom_Point3, Colorbar_blue_3);
                        sp_Point3_1.position.copy(Point_Point3);
                        var tubeMesh_3o2=createCylinderMesh(FormCP3,Point_Point3,Colorbar_blue_3,tt,tt);
                        var tube_arrow_3o2=createCylinderArrowMesh(newArrowP3O2,FormCP3,Colorbar_blue_3,0.02,0.05,0.6);
                       }
     
                       if (tubeMesh_p3o2>=0.75)
                       {  var Colorbar_blue_4 = new THREE.MeshPhongMaterial( {
                                             color: 0x0F3150
                                         } );
                                         var spGeom_Point3 = new THREE.SphereGeometry(tt-0.001);
                        var sp_Point3_1 = new THREE.Mesh(spGeom_Point3, Colorbar_blue_4);
                        sp_Point3_1.position.copy(Point_Point3);
                        var tubeMesh_3o2=createCylinderMesh(FormCP3,Point_Point3,Colorbar_blue_4,tt,tt);
                        var tube_arrow_3o2=createCylinderArrowMesh(newArrowP3O2,FormCP3,Colorbar_blue_4,0.02,0.05,0.6);
                       }

                    // form_group.add(sp_Point3_1); 
                    // form_group.add(tubeMesh_3o2); 
                    // form_group.add(tube_arrow_3o2); 
                    // sp_Point3_1.castShadow=true;
                    // tubeMesh_3o2.castShadow=true;


                      //4.2 Point4 to PointO2

                      var tubeMesh_p4o2 = face_ABO2_area/max;
     
                      tt2 = 0.05*face_ABO2_area;
                  
                      var oldP4O2 = formPointO2.distanceTo(FormCP4);
                      var newP4O2 = oldP4O2 - 2.5;
                      var newArrowP4O2 = new THREE.Vector3(formPointO2.x + (formPointO2.x - FormCP4.x) * -1.1 / 0.8,formPointO2.y + (formPointO2.y - FormCP4.y) * -1.1 / 0.8,formPointO2.z + (formPointO2.z - FormCP4.z) * -1.1 / 0.8 )
                  
                      var Sphere_Point4 = new THREE.Sphere(new THREE.Vector3(formPointO2.x,formPointO2.y,formPointO2.z),0.12);
                      var Point_Point4 = Sphere_Point4.clampPoint(FormCP4);
                  
                  
                      if (tubeMesh_p4o2<0.25 & tubeMesh_p4o2>=0)
                        { var Colorbar_blue_1 = new THREE.MeshPhongMaterial( {
                                            color: 0x5B84AE
                                        } );
                       var spGeom_Point4 = new THREE.SphereGeometry(tt2-0.001);
                       var sp_Point4_1 = new THREE.Mesh(spGeom_Point4, Colorbar_blue_1);
                       sp_Point4_1.position.copy(Point_Point4);
                       var tubeMesh_4o2=createCylinderMesh(FormCP4,Point_Point4,Colorbar_blue_1,tt2,tt2);
                       var tube_arrow_4o2=createCylinderArrowMesh(newArrowP4O2 ,FormCP4,Colorbar_blue_1,0.02,0.05,0.6);
                                      }
                      if (tubeMesh_p4o2<0.5 & tubeMesh_p4o2>=0.25)
                      {  var Colorbar_blue_2 = new THREE.MeshPhongMaterial( {
                                            color: 0x376D9B
                                        } );
                       var spGeom_Point4 = new THREE.SphereGeometry(tt2-0.001);
                       var sp_Point4_1 = new THREE.Mesh(spGeom_Point4, Colorbar_blue_2);
                       sp_Point4_1.position.copy(Point_Point4);
                       var tubeMesh_4o2=createCylinderMesh(FormCP4,Point_Point4,Colorbar_blue_2,tt2,tt2);
                       var tube_arrow_4o2=createCylinderArrowMesh(newArrowP4O2 ,FormCP4,Colorbar_blue_2,0.02,0.05,0.6);
                                      }
                      if (tubeMesh_p4o2<0.75 & tubeMesh_p4o2>=0.5)
                      {  var Colorbar_blue_3 = new THREE.MeshPhongMaterial( {
                                            color: 0x05416D
                                        } );
                       var spGeom_Point4 = new THREE.SphereGeometry(tt2-0.001);
                       var sp_Point4_1 = new THREE.Mesh(spGeom_Point4, Colorbar_blue_3);
                       sp_Point4_1.position.copy(Point_Point4);
                       var tubeMesh_4o2=createCylinderMesh(FormCP4,Point_Point4,Colorbar_blue_3,tt2,tt2);
                       var tube_arrow_4o2=createCylinderArrowMesh(newArrowP4O2,FormCP4,Colorbar_blue_3,0.02,0.05,0.6);
                      }
                  
                      if (tubeMesh_p4o2>=0.75)
                      {  var Colorbar_blue_4 = new THREE.MeshPhongMaterial( {
                                            color: 0x0F3150
                                        } );
                       var spGeom_Point4 = new THREE.SphereGeometry(tt2-0.001);
                       var sp_Point4_1 = new THREE.Mesh(spGeom_Point4, Colorbar_blue_4);
                       sp_Point4_1.position.copy(Point_Point4);
                       var tubeMesh_4o2=createCylinderMesh(FormCP4,Point_Point4,Colorbar_blue_4,tt2,tt2);
                       var tube_arrow_4o2=createCylinderArrowMesh(newArrowP4O2,FormCP4,Colorbar_blue_4,0.02,0.05,0.6);
                      }
                  
                //    form_group.add(sp_Point4_1); 
                //    form_group.add(tubeMesh_4o2); 
                //    form_group.add(tube_arrow_4o2); 
                //    sp_Point4_1.castShadow = true;
                //    tubeMesh_4o2.castShadow=true;


                   //4.3 Point3 to PointO3

                      var tubeMesh_p3o3 = face_CO1O2_area/max;
     
                      tt3 = 0.05*face_CO1O2_area;
                   
                      var oldP3O3 = formPointO5.distanceTo(FormCP3);
                      var newP3O3 = oldP3O3 - 2.5;
                      var newArrowP3O3 = new THREE.Vector3(formPointO5.x + (formPointO5.x - FormCP3.x) * -0.95 / 0.8,formPointO5.y + (formPointO5.y - FormCP3.y) * -0.95 / 0.8,formPointO5.z + (formPointO5.z - FormCP3.z) * -0.95 / 0.8 )
                   
                      var Sphere_Point32 = new THREE.Sphere(new THREE.Vector3(formPointO5.x,formPointO5.y,formPointO5.z),0.1);
                      var Point_Point32 = Sphere_Point32.clampPoint(FormCP3);
                   
                   
                      if (tubeMesh_p3o3<0.25 & tubeMesh_p3o3>=0)
                        { var Colorbar_blue_1 = new THREE.MeshPhongMaterial( {
                                            color: 0x5B84AE
                                        } );
                       var spGeom_Point32 = new THREE.SphereGeometry(tt3-0.001);
                       var sp_Point32_1 = new THREE.Mesh(spGeom_Point32, Colorbar_blue_1);
                       sp_Point32_1.position.copy(Point_Point32);
                       var tubeMesh_3o3=createCylinderMesh(FormCP3,Point_Point32,Colorbar_blue_1,tt3,tt3);
                       var tube_arrow_3o3=createCylinderArrowMesh(newArrowP3O3 ,FormCP3,Colorbar_blue_1,0.02,0.05,0.6);
                                      }
                      if (tubeMesh_p3o3<0.5 & tubeMesh_p3o3>=0.25)
                      {  var Colorbar_blue_2 = new THREE.MeshPhongMaterial( {
                                            color: 0x376D9B
                                        } );
                       var spGeom_Point32 = new THREE.SphereGeometry(tt3-0.001);
                       var sp_Point32_1 = new THREE.Mesh(spGeom_Point32, Colorbar_blue_2);
                       sp_Point32_1.position.copy(Point_Point32);
                       var tubeMesh_3o3=createCylinderMesh(FormCP3,Point_Point32,Colorbar_blue_2,tt3,tt3);
                       var tube_arrow_3o3=createCylinderArrowMesh(newArrowP3O3 ,FormCP3,Colorbar_blue_2,0.02,0.05,0.6);
                                      }
                      if (tubeMesh_p3o3<0.75 & tubeMesh_p3o3>=0.5)
                      {  var Colorbar_blue_3 = new THREE.MeshPhongMaterial( {
                                            color: 0x05416D
                                        } );
                       var spGeom_Point32 = new THREE.SphereGeometry(tt3-0.001);
                       var sp_Point32_1 = new THREE.Mesh(spGeom_Point32, Colorbar_blue_3);
                       sp_Point32_1.position.copy(Point_Point32);
                       var tubeMesh_3o3=createCylinderMesh(FormCP3,Point_Point32,Colorbar_blue_3,tt3,tt3);
                       var tube_arrow_3o3=createCylinderArrowMesh(newArrowP3O3 ,FormCP3,Colorbar_blue_3,0.02,0.05,0.6);
                      }
                   
                      if (tubeMesh_p3o3>=0.75)
                      {  var Colorbar_blue_4 = new THREE.MeshPhongMaterial( {
                                            color: 0x0F3150
                                        } );
                       var spGeom_Point32 = new THREE.SphereGeometry(tt3-0.001);
                       var sp_Point32_1 = new THREE.Mesh(spGeom_Point32, Colorbar_blue_4);
                       sp_Point32_1.position.copy(Point_Point32);
                       var tubeMesh_3o3=createCylinderMesh(FormCP3,Point_Point32,Colorbar_blue_4,tt3,tt3);
                       var tube_arrow_3o3=createCylinderArrowMesh(newArrowP3O3 ,FormCP3,Colorbar_blue_4,0.02,0.05,0.6);
                      }
                   
                //    form_group.add(sp_Point32_1); 
                //    form_group.add(tubeMesh_3o3); 
                //    form_group.add(tube_arrow_3o3); 
                //    sp_Point32_1.castShadow=true;
                //    tubeMesh_3o3.castShadow=true;

                    //4.5 Point2 to PointO1

                       var tubeMesh_p2o1 = face_CDO1_area/max;
     
                       tt4 = 0.05*face_CDO1_area;
                    
                       var oldP2O1 = formPointO1.distanceTo(FormCP2);
                       var newP2O1 = oldP3O3 - 2.5;
                       var newArrowP2O1 = new THREE.Vector3(formPointO1.x + (formPointO1.x - FormCP2.x) * -1.1 / 0.8,formPointO1.y + (formPointO1.y - FormCP2.y) * -1.1 / 0.8,formPointO1.z + (formPointO1.z - FormCP2.z) * -1.1 / 0.8 )
                    
                       var Sphere_Point2 = new THREE.Sphere(new THREE.Vector3(formPointO1.x,formPointO1.y,formPointO1.z),0.12);
                       var Point_Point2 = Sphere_Point2.clampPoint(FormCP2);
                    
                    
                       if (tubeMesh_p2o1<0.25 & tubeMesh_p2o1>=0)
                         { var Colorbar_blue_1 = new THREE.MeshPhongMaterial( {
                                             color: 0x5B84AE
                                         } );
                        var spGeom_Point2 = new THREE.SphereGeometry(tt4-0.001);
                        var sp_Point2_1 = new THREE.Mesh(spGeom_Point2, Colorbar_blue_1);
                        sp_Point2_1.position.copy(Point_Point2);
                        var tubeMesh_2o1=createCylinderMesh(FormCP2,Point_Point2,Colorbar_blue_1,tt4,tt4);
                        var tube_arrow_2o1=createCylinderArrowMesh(newArrowP2O1 ,FormCP2,Colorbar_blue_1,0.02,0.05,0.6);
                                       }
                       if (tubeMesh_p2o1<0.5 & tubeMesh_p2o1>=0.25)
                       {  var Colorbar_blue_2 = new THREE.MeshPhongMaterial( {
                                             color: 0x376D9B
                                         } );
                        var spGeom_Point2 = new THREE.SphereGeometry(tt4-0.001);
                        var sp_Point2_1 = new THREE.Mesh(spGeom_Point2, Colorbar_blue_2);
                        sp_Point2_1.position.copy(Point_Point2);
                        var tubeMesh_2o1=createCylinderMesh(FormCP2,Point_Point2,Colorbar_blue_2,tt4,tt4);
                        var tube_arrow_2o1=createCylinderArrowMesh(newArrowP2O1 ,FormCP2,Colorbar_blue_2,0.02,0.05,0.6);
                                       }
                       if (tubeMesh_p2o1<0.75 & tubeMesh_p2o1>=0.5)
                       {  var Colorbar_blue_3 = new THREE.MeshPhongMaterial( {
                                             color: 0x05416D
                                         } );
                        var spGeom_Point2 = new THREE.SphereGeometry(tt4-0.001);
                        var sp_Point2_1 = new THREE.Mesh(spGeom_Point2, Colorbar_blue_3);
                        sp_Point2_1.position.copy(Point_Point2);
                        var tubeMesh_2o1=createCylinderMesh(FormCP2,Point_Point2,Colorbar_blue_3,tt4,tt4);
                        var tube_arrow_2o1=createCylinderArrowMesh(newArrowP2O1 ,FormCP2,Colorbar_blue_3,0.02,0.05,0.6);
                       }
                    
                       if (tubeMesh_p2o1>=0.75)
                       {  var Colorbar_blue_4 = new THREE.MeshPhongMaterial( {
                                             color: 0x0F3150
                                         } );
                        var spGeom_Point2 = new THREE.SphereGeometry(tt4-0.001);
                        var sp_Point2_1 = new THREE.Mesh(spGeom_Point2, Colorbar_blue_4);
                        sp_Point2_1.position.copy(Point_Point2);
                        var tubeMesh_2o1=createCylinderMesh(FormCP2,Point_Point2,Colorbar_blue_4,tt4,tt4);
                        var tube_arrow_2o1=createCylinderArrowMesh(newArrowP2O1 ,FormCP2,Colorbar_blue_4,0.02,0.05,0.6);
                       }
                    
                        // form_group.add(sp_Point2_1); 
                        // form_group.add(tubeMesh_2o1); 
                        // form_group.add(tube_arrow_2o1); 
                        // sp_Point2_1.castShadow=true;
                        // tubeMesh_2o1.castShadow=true;
                    
                     //4.6 Point1 to PointO1
                    
                        var tubeMesh_p1o1 = face_ADO1_area/max;
                    
                        tt5 = 0.05*face_ADO1_area;
                     
                        var oldP1O1 = formPointO1.distanceTo(FormCP1);
                        var newP1O1 = oldP1O1 - 2.5;
                        var newArrowP1O1 = new THREE.Vector3(formPointO1.x + (formPointO1.x - FormCP1.x) * -1.1 / 0.8,formPointO1.y + (formPointO1.y - FormCP1.y) * -1.1 / 0.8,formPointO1.z + (formPointO1.z - FormCP1.z) * -1.1 / 0.8 )
                     
                        var Sphere_Point1 = new THREE.Sphere(new THREE.Vector3(formPointO1.x,formPointO1.y,formPointO1.z),0.12);
                        var Point_Point1 = Sphere_Point1.clampPoint(FormCP1);
                     
                     
                        if (tubeMesh_p1o1<0.25 & tubeMesh_p1o1>=0)
                          { var Colorbar_blue_1 = new THREE.MeshPhongMaterial( {
                                              color: 0x5B84AE
                                          } );
                         var spGeom_Point1 = new THREE.SphereGeometry(tt5-0.001);
                         var sp_Point1_1 = new THREE.Mesh(spGeom_Point1, Colorbar_blue_1);
                         sp_Point1_1.position.copy(Point_Point1);
                         var tubeMesh_1o1=createCylinderMesh(FormCP1,Point_Point1,Colorbar_blue_1,tt5,tt5);
                         var tube_arrow_1o1=createCylinderArrowMesh(newArrowP1O1 ,FormCP1,Colorbar_blue_1,0.02,0.05,0.6);
                                        }
                        if (tubeMesh_p1o1<0.5 & tubeMesh_p1o1>=0.25)
                        {  var Colorbar_blue_2 = new THREE.MeshPhongMaterial( {
                                              color: 0x376D9B
                                          } );
                         var spGeom_Point1 = new THREE.SphereGeometry(tt5-0.001);
                         var sp_Point1_1 = new THREE.Mesh(spGeom_Point1, Colorbar_blue_2);
                         sp_Point1_1.position.copy(Point_Point1);
                         var tubeMesh_1o1=createCylinderMesh(FormCP1,Point_Point1,Colorbar_blue_2,tt5,tt5);
                         var tube_arrow_1o1=createCylinderArrowMesh(newArrowP1O1 ,FormCP1,Colorbar_blue_2,0.02,0.05,0.6);
                                        }
                        if (tubeMesh_p1o1<0.75 & tubeMesh_p1o1>=0.5)
                        {  var Colorbar_blue_3 = new THREE.MeshPhongMaterial( {
                                              color: 0x05416D
                                          } );
                         var spGeom_Point1 = new THREE.SphereGeometry(tt5-0.001);
                         var sp_Point1_1 = new THREE.Mesh(spGeom_Point1, Colorbar_blue_3);
                         sp_Point1_1.position.copy(Point_Point1);
                         var tubeMesh_1o1=createCylinderMesh(FormCP1,Point_Point1,Colorbar_blue_3,tt5,tt5);
                         var tube_arrow_1o1=createCylinderArrowMesh(newArrowP1O1 ,FormCP1,Colorbar_blue_3,0.02,0.05,0.6);
                        }
                     
                        if (tubeMesh_p1o1>=0.75)
                        {  var Colorbar_blue_4 = new THREE.MeshPhongMaterial( {
                                              color: 0x0F3150
                                          } );
                         var spGeom_Point1 = new THREE.SphereGeometry(tt5-0.001);
                         var sp_Point1_1 = new THREE.Mesh(spGeom_Point1, Colorbar_blue_4);
                         sp_Point1_1.position.copy(Point_Point1);
                         var tubeMesh_1o1=createCylinderMesh(FormCP1,Point_Point1,Colorbar_blue_4,tt5,tt5);
                         var tube_arrow_1o1=createCylinderArrowMesh(newArrowP1O1 ,FormCP1,Colorbar_blue_4,0.02,0.05,0.6);
                        }
                     
                        // form_group.add(sp_Point1_1); 
                        // form_group.add(tubeMesh_1o1); 
                        // form_group.add(tube_arrow_1o1); 
                        // sp_Point1_1.castShadow=true;
                        // tubeMesh_1o1.castShadow=true;
                    
                       //4.7 Point1 to PointO3
                    
                         var tubeMesh_p1o3 = face_AO1O2_area/max;
                    
                         tt6 = 0.15*face_AO1O2_area;
                      
                         var oldP1O3 = formPointO5.distanceTo(FormCP1);
                         var newP1O3 = oldP1O1 - 2.5;
                         var newArrowP1O3 = new THREE.Vector3(formPointO5.x + (formPointO5.x - FormCP1.x) * -1.1 / 0.8,formPointO5.y + (formPointO5.y - FormCP1.y) * -1.1 / 0.8,formPointO5.z + (formPointO5.z - FormCP1.z) * -1.1 / 0.8 )
                      
                         var Sphere_Point12 = new THREE.Sphere(new THREE.Vector3(formPointO5.x,formPointO5.y,formPointO5.z),0.12);
                         var Point_Point12 = Sphere_Point12.clampPoint(FormCP1);
                      
                      
                         if (tubeMesh_p1o3<0.25 & tubeMesh_p1o3>=0)
                           { var Colorbar_blue_1 = new THREE.MeshPhongMaterial( {
                                               color: 0x5B84AE
                                           } );
                          var spGeom_Point12 = new THREE.SphereGeometry(tt6-0.001);
                          var sp_Point12_1 = new THREE.Mesh(spGeom_Point12, Colorbar_blue_1);
                          sp_Point12_1.position.copy(Point_Point12);
                          var tubeMesh_1o3=createCylinderMesh(FormCP1,Point_Point12,Colorbar_blue_1,tt6,tt6);
                          var tube_arrow_1o3=createCylinderArrowMesh(newArrowP1O3 ,FormCP1,Colorbar_blue_1,0.02,0.05,0.6);
                                         }
                         if (tubeMesh_p1o3<0.5 & tubeMesh_p1o3>=0.25)
                         {  var Colorbar_blue_2 = new THREE.MeshPhongMaterial( {
                                               color: 0x376D9B
                                           } );
                          var spGeom_Point12 = new THREE.SphereGeometry(tt6-0.001);
                          var sp_Point12_1 = new THREE.Mesh(spGeom_Point12, Colorbar_blue_2);
                          sp_Point12_1.position.copy(Point_Point12);
                          var tubeMesh_1o3=createCylinderMesh(FormCP1,Point_Point12,Colorbar_blue_1,tt6,tt6);
                          var tube_arrow_1o3=createCylinderArrowMesh(newArrowP1O3 ,FormCP1,Colorbar_blue_2,0.02,0.05,0.6);
                                         }
                         if (tubeMesh_p1o3<0.75 & tubeMesh_p1o3>=0.5)
                         {  var Colorbar_blue_3 = new THREE.MeshPhongMaterial( {
                                               color: 0x05416D
                                           } );
                          var spGeom_Point12 = new THREE.SphereGeometry(tt6-0.001);
                          var sp_Point12_1 = new THREE.Mesh(spGeom_Point12, Colorbar_blue_3);
                          sp_Point12_1.position.copy(Point_Point12);
                          var tubeMesh_1o3=createCylinderMesh(FormCP1,Point_Point12,Colorbar_blue_3,tt6,tt6);
                          var tube_arrow_1o3=createCylinderArrowMesh(newArrowP1O3 ,FormCP1,Colorbar_blue_3,0.02,0.05,0.6);
                         }
                      
                         if (tubeMesh_p1o3>=0.75)
                         {  var Colorbar_blue_4 = new THREE.MeshPhongMaterial( {
                                               color: 0x0F3150
                                           } );
                          var spGeom_Point12 = new THREE.SphereGeometry(tt6-0.001);
                          var sp_Point12_1 = new THREE.Mesh(spGeom_Point12, Colorbar_blue_4);
                          sp_Point12_1.position.copy(Point_Point12);
                          var tubeMesh_1o3=createCylinderMesh(FormCP1,Point_Point12,Colorbar_blue_4,tt6,tt6);
                          var tube_arrow_1o3=createCylinderArrowMesh(newArrowP1O3 ,FormCP1,Colorbar_blue_4,0.02,0.05,0.6);
                         }
                      
                    //   form_group.add(sp_Point12_1); 
                    //   form_group.add(tubeMesh_1o3); 
                    //   form_group.add(tube_arrow_1o3); 
                    //   sp_Point12_1.castShadow=true;
                    //   tubeMesh_1o3.castShadow=true;
                    
                     //4.8 Pointo1 to PointO3
                    
                          var tubeMesh_o1o3 = face_ACO1_area/max;
                    
                          tt7 = 0.05*face_ACO1_area;
                       
                          var Sphere_Pointo1 = new THREE.Sphere(new THREE.Vector3(formPointO1.x,formPointO1.y,formPointO1.z),0.12);
                          var Point_Pointo1 = Sphere_Pointo1.clampPoint(formPointO5);
                    
                          var Sphere_Pointo12 = new THREE.Sphere(new THREE.Vector3(formPointO5.x,formPointO5.y,formPointO5.z),0.12);
                          var Point_Pointo12 = Sphere_Pointo12.clampPoint(formPointO1);
                       
                       
                          if (tubeMesh_o1o3<0.25 & tubeMesh_o1o3>=0)
                            { var Colorbar_blue_1 = new THREE.MeshPhongMaterial( {
                                                color: 0x5B84AE
                                            } );
                           var spGeom_Pointo1 = new THREE.SphereGeometry(tt7-0.001);
                           var sp_Pointo1_1 = new THREE.Mesh(spGeom_Pointo1, Colorbar_blue_1);
                           sp_Pointo1_1.position.copy(Point_Pointo1);
                           var spGeom_Pointo12 = new THREE.SphereGeometry(tt7-0.001);
                           var sp_Pointo12_1 = new THREE.Mesh(spGeom_Pointo12, Colorbar_blue_1);
                           sp_Pointo12_1.position.copy(Point_Pointo12);
                           var tubeMesh_o1o3=createCylinderMesh(Point_Pointo12,Point_Pointo1,Colorbar_blue_1,tt7,tt7);                           
                                          }
                          if (tubeMesh_p1o1<0.5 & tubeMesh_p1o1>=0.25)
                          {  var Colorbar_blue_2 = new THREE.MeshPhongMaterial( {
                                                color: 0x376D9B
                                            } );
                           var spGeom_Pointo1 = new THREE.SphereGeometry(tt7-0.001);
                           var sp_Pointo1_1 = new THREE.Mesh(spGeom_Pointo1, Colorbar_blue_2);
                           sp_Pointo1_1.position.copy(Point_Pointo1);
                           var spGeom_Pointo12 = new THREE.SphereGeometry(tt7-0.001);
                           var sp_Pointo12_1 = new THREE.Mesh(spGeom_Pointo12, Colorbar_blue_2);
                           sp_Pointo12_1.position.copy(Point_Pointo12);
                           var tubeMesh_o1o3=createCylinderMesh(Point_Pointo12,Point_Pointo1,Colorbar_blue_2,tt7,tt7);  
                                          }
                          if (tubeMesh_p1o1<0.75 & tubeMesh_p1o1>=0.5)
                          {  var Colorbar_blue_3 = new THREE.MeshPhongMaterial( {
                                                color: 0x05416D
                                            } );
                           var spGeom_Pointo1 = new THREE.SphereGeometry(tt7-0.001);
                           var sp_Pointo1_1 = new THREE.Mesh(spGeom_Pointo1, Colorbar_blue_3);
                           sp_Pointo1_1.position.copy(Point_Pointo1);
                           var spGeom_Pointo12 = new THREE.SphereGeometry(tt7-0.001);
                           var sp_Pointo12_1 = new THREE.Mesh(spGeom_Pointo12, Colorbar_blue_3);
                           sp_Pointo12_1.position.copy(Point_Pointo12);
                           var tubeMesh_o1o3=createCylinderMesh(Point_Pointo12,Point_Pointo1,Colorbar_blue_3,tt7,tt7);  
                          }
                       
                          if (tubeMesh_p1o1>=0.75)
                          {  var Colorbar_blue_4 = new THREE.MeshPhongMaterial( {
                                                color: 0x0F3150
                                            } );
                           var spGeom_Pointo1 = new THREE.SphereGeometry(tt7-0.001);
                           var sp_Pointo1_1 = new THREE.Mesh(spGeom_Pointo1, Colorbar_blue_4);
                           sp_Pointo1_1.position.copy(Point_Pointo1);
                           var spGeom_Pointo12 = new THREE.SphereGeometry(tt7-0.001);
                           var sp_Pointo12_1 = new THREE.Mesh(spGeom_Pointo12, Colorbar_blue_4);
                           sp_Pointo12_1.position.copy(Point_Pointo12);
                           var tubeMesh_o1o3=createCylinderMesh(Point_Pointo12,Point_Pointo1,Colorbar_blue_4,tt7,tt7);  
                          }
                       
                    //    form_group.add(sp_Pointo1_1); 
                    //    form_group.add(sp_Pointo12_1);
                    //    form_group.add(tubeMesh_o1o3); 
                       
                    //    sp_Pointo1_1.castShadow=true;
                    //    sp_Pointo12_1.castShadow=true;
                    //    tubeMesh_o1o3.castShadow=true;
                    
                    //4.9 Pointo1 to PointO3
                    
                           var tubeMesh_o2o3 = face_ACO2_area/max;
                    
                           tt8 = 0.05*face_ACO2_area;
                        
                           var Sphere_Pointo2 = new THREE.Sphere(new THREE.Vector3(formPointO2.x,formPointO2.y,formPointO2.z),0.12);
                           var Point_Pointo2 = Sphere_Pointo2.clampPoint(formPointO5);
                      
                           var Sphere_Pointo22 = new THREE.Sphere(new THREE.Vector3(formPointO5.x,formPointO5.y,formPointO5.z),0.12);
                           var Point_Pointo22 = Sphere_Pointo22.clampPoint(formPointO2);
                        
                        
                           if (tubeMesh_o2o3<0.25 & tubeMesh_o2o3>=0)
                             { var Colorbar_blue_1 = new THREE.MeshPhongMaterial( {
                                                 color: 0x5B84AE
                                             } );
                            var spGeom_Pointo2 = new THREE.SphereGeometry(tt8-0.001);
                            var sp_Pointo2_1 = new THREE.Mesh(spGeom_Pointo2, Colorbar_blue_1);
                            sp_Pointo2_1.position.copy(Point_Pointo2);
                            var spGeom_Pointo22 = new THREE.SphereGeometry(tt8-0.001);
                            var sp_Pointo22_1 = new THREE.Mesh(spGeom_Pointo22, Colorbar_blue_1);
                            sp_Pointo22_1.position.copy(Point_Pointo22);
                            var tubeMesh_o2o3=createCylinderMesh(Point_Pointo22,Point_Pointo2,Colorbar_blue_1,tt8,tt8);                           
                                           }
                           if (tubeMesh_p1o1<0.5 & tubeMesh_p1o1>=0.25)
                           {  var Colorbar_blue_2 = new THREE.MeshPhongMaterial( {
                                                 color: 0x376D9B
                                             } );
                            var spGeom_Pointo2 = new THREE.SphereGeometry(tt8-0.001);
                            var sp_Pointo2_1 = new THREE.Mesh(spGeom_Pointo2, Colorbar_blue_2);
                            sp_Pointo2_1.position.copy(Point_Pointo2);
                            var spGeom_Pointo22 = new THREE.SphereGeometry(tt8-0.001);
                            var sp_Pointo22_1 = new THREE.Mesh(spGeom_Pointo22, Colorbar_blue_2);
                            sp_Pointo22_1.position.copy(Point_Pointo22);
                            var tubeMesh_o2o3=createCylinderMesh(Point_Pointo22,Point_Pointo2,Colorbar_blue_2,tt8,tt8);    
                                           }
                           if (tubeMesh_p1o1<0.75 & tubeMesh_p1o1>=0.5)
                           {  var Colorbar_blue_3 = new THREE.MeshPhongMaterial( {
                                                 color: 0x05416D
                                             } );
                            var spGeom_Pointo2 = new THREE.SphereGeometry(tt8-0.001);
                            var sp_Pointo2_1 = new THREE.Mesh(spGeom_Pointo2, Colorbar_blue_3);
                            sp_Pointo2_1.position.copy(Point_Pointo2);
                            var spGeom_Pointo22 = new THREE.SphereGeometry(tt8-0.001);
                            var sp_Pointo22_1 = new THREE.Mesh(spGeom_Pointo22, Colorbar_blue_3);
                            sp_Pointo22_1.position.copy(Point_Pointo22);
                            var tubeMesh_o2o3=createCylinderMesh(Point_Pointo22,Point_Pointo2,Colorbar_blue_3,tt8,tt8);     
                           }
                        
                           if (tubeMesh_p1o1>=0.75)
                           {  var Colorbar_blue_4 = new THREE.MeshPhongMaterial( {
                                                 color: 0x0F3150
                                             } );
                            var spGeom_Pointo2 = new THREE.SphereGeometry(tt8-0.001);
                            var sp_Pointo2_1 = new THREE.Mesh(spGeom_Pointo2, Colorbar_blue_4);
                            sp_Pointo2_1.position.copy(Point_Pointo2);
                            var spGeom_Pointo22 = new THREE.SphereGeometry(tt8-0.001);
                            var sp_Pointo22_1 = new THREE.Mesh(spGeom_Pointo22, Colorbar_blue_4);
                            sp_Pointo22_1.position.copy(Point_Pointo22);
                            var tubeMesh_o2o3=createCylinderMesh(Point_Pointo22,Point_Pointo2,Colorbar_blue_4,tt8,tt8);     
                           }
                        
                        // form_group.add(sp_Pointo2_1); 
                        // form_group.add(sp_Pointo22_1);
                        // form_group.add(tubeMesh_o2o3); 
                        
                        // sp_Pointo2_1.castShadow=true;
                        // sp_Pointo22_1.castShadow=true;
                        // tubeMesh_o2o3.castShadow=true;
   
                 

                    // var formMesh1_1=createCylinderMesh(newCP3,formPointO2 ,material,0.02,0.02);
                    // var formMesh1_2=createCylinderMesh(newCP4,formPointO2 ,material,0.02,0.02);
                    // var formMesh1_3=createCylinderMesh(newCP1,formPointO1 ,material,0.02,0.02);
                    // var formMesh1_4=createCylinderMesh(newCP2,formPointO1 ,material,0.02,0.02);
                    // var formMesh1_5=createCylinderMesh(newCP3,formPointO5,material,0.02,0.02);
                    // var formMesh1_6=createCylinderMesh(newCP1,formPointO5,material,0.02,0.02);
                    // var formMesh1_7=createCylinderMesh(formPointO1,formPointO5,material,0.02,0.02);
                    // var formMesh1_8=createCylinderMesh(formPointO2,formPointO5,material,0.02,0.02);
      
      
        

                    
                     function Cal_Vec_2(vec1,vec2,vec3,n){

                         cb = new THREE.Vector3(),
                         ab = new THREE.Vector3(),
                         normal = new THREE.Vector3(),
                         cb.subVectors(vec1,vec2);
                         ab.subVectors(vec3, vec2);
                         ab.cross(cb);
                         normal.copy(ab).normalize();

                         
                         var newPoint = new THREE.Vector3(n*normal.x, n*normal.y, n*normal.z);
                         return newPoint;
                     }

                   
                    //define function mesh IntersectPoint
                    function Cal_Plane_Line_Intersect_Point(Point_online,LineVec,Point_onPlane,PlaneVec){

                        var IntersectPoint = new THREE.Vector3(
                            //x
                            Point_online.x+LineVec.x*((Point_onPlane.x - Point_online.x)*PlaneVec.x+(Point_onPlane.y - Point_online.y)*PlaneVec.y+(Point_onPlane.z - Point_online.z)*PlaneVec.z) / (PlaneVec.x* LineVec.x+ PlaneVec.y* LineVec.y+ PlaneVec.z* LineVec.z), 
                            //y
                            Point_online.y+LineVec.y*((Point_onPlane.x - Point_online.x)*PlaneVec.x+(Point_onPlane.y - Point_online.y)*PlaneVec.y+(Point_onPlane.z - Point_online.z)*PlaneVec.z) / (PlaneVec.x* LineVec.x+ PlaneVec.y* LineVec.y+ PlaneVec.z* LineVec.z),
                            //z
                            Point_online.z+LineVec.z*((Point_onPlane.x - Point_online.x)*PlaneVec.x+(Point_onPlane.y - Point_online.y)*PlaneVec.y+(Point_onPlane.z - Point_online.z)*PlaneVec.z) / (PlaneVec.x* LineVec.x+ PlaneVec.y* LineVec.y+ PlaneVec.z* LineVec.z))

                       return IntersectPoint;
                    }
                    //define intersection point x1
                   

               


         




                var newSphereTest2 = new THREE.Sphere(new THREE.Vector3(0,0,0),0.12);
                var newPointClose = newSphereTest2.clampPoint(new THREE.Vector3(1,1,0));

                var newSphereTest2_1 = new THREE.Sphere(new THREE.Vector3(1,1,0),0.12);
                var newPointClose2 = newSphereTest2_1.clampPoint(new THREE.Vector3(0,0,0));

                // var newPointClose2 = newSphereTest.clampPoint(new THREE.Vector3(TubePoints3[1].x,TubePoints3[1].y,TubePoints3[1].z));
                // var newPointClose3 = newSphereTest.clampPoint(new THREE.Vector3(TubePoints4[1].x,TubePoints4[1].y,TubePoints4[1].z));

                 var newsp = new THREE.SphereGeometry(0.05);
                 var new_sp_1 = new THREE.Mesh(newsp, material);
                 var new_sp_2 = new THREE.Mesh(newsp, material);
                // var new_sp3 = new THREE.Mesh(newsp, material);

                 new_sp_1.position.copy(new THREE.Vector3(newPointClose.x, newPointClose.y,newPointClose.z));
                 new_sp_2.position.copy(new THREE.Vector3(newPointClose2.x, newPointClose2.y,newPointClose2.z));
                // new_sp3.position.copy(new THREE.Vector3(newPointClose3.x, newPointClose3.y,newPointClose3.z));

                 step_group_1.add(new_sp_1);
                 step_group_1.add(new_sp_2);
                // step_group_1.add(new_sp3);

                var newtubeMesh1_1=createCylinderMesh(newPointClose2,newPointClose,material,0.05,0.05);
                // var newtubeMesh2=createCylinderMesh(TubePoints3[1],newPointClose2,material,0.05,0.05);
                // var newtubeMesh3=createCylinderMesh(TubePoints4[1],newPointClose3,material,0.05,0.05);
                 step_group_1.add(newtubeMesh1_1);
                // step_group_1.add(newtubeMesh2);
                // step_group_1.add(newtubeMesh3);

              


                var SphereTest = new THREE.Sphere(new THREE.Vector3(TubePoints1[0].x,TubePoints1[0].y,TubePoints1[0].z),0.07);
                var PointClose1 = SphereTest.clampPoint(TubePoints2[1]);
                var SphereTest2 = new THREE.Sphere(PointClose1,0.05);
                var PointClose2 = SphereTest2.clampPoint(TubePoints2[1]);
                var SphereTest3 = new THREE.Sphere(PointClose2,0.045);

                var arrow_apply_1=new THREE.MeshPhongMaterial( {
                        color:  0x009600//green
                    } );


                var SphereTest4 = new THREE.Sphere(new THREE.Vector3(TubePoints1[0].x,TubePoints1[0].y,TubePoints1[0].z),0.75);
                var PointClose3 = SphereTest4.clampPoint(TubePoints1[1]);
                var tubeMesh_apply_1=createCylinderMesh(PointClose3,TubePoints1[1],arrow_apply_1,0.01,0.01);
                //Tube_group.add(tubeMesh_apply_1);
                var apply_1 = [];
                apply_1.push(new THREE.Vector3(0,0,-1.5));
                apply_1.push(TubePoints1[1]);

                var apply_2 = [];
                apply_2.push(new THREE.Vector3(TubePoints2[1].x,TubePoints2[1].y,TubePoints1[1].z));
                apply_2.push(new THREE.Vector3(TubePoints2[1].x,TubePoints2[1].y,-1.5));

                var apply_3 = [];
                apply_3.push(new THREE.Vector3(TubePoints3[1].x,TubePoints3[1].y,TubePoints1[1].z));
                apply_3.push(new THREE.Vector3(TubePoints3[1].x,TubePoints3[1].y,-1.5));

                var apply_4 = [];
                apply_4.push(new THREE.Vector3(TubePoints4[1].x,TubePoints4[1].y,TubePoints1[1].z));
                apply_4.push(new THREE.Vector3(TubePoints4[1].x,TubePoints4[1].y,-1.5));

                var apply_1_geo = new THREE.Geometry().setFromPoints( apply_1 );

                var apply_2_geo = new THREE.Geometry().setFromPoints( apply_2 );

                var apply_3_geo = new THREE.Geometry().setFromPoints( apply_3 );

                var apply_4_geo = new THREE.Geometry().setFromPoints( apply_4 );

                var applyline_1 = new THREE.LineDashedMaterial({
                                 color: "black",//color
                                 dashSize: 0.2,
                                gapSize: 0.03,
                                linewidth: 1

                                 });

                var applyline = new THREE.LineSegments(apply_1_geo,applyline_1);
                applyline.computeLineDistances();//compute
                step_group_1.add(applyline);

                var applyline2 = new THREE.LineSegments(apply_2_geo,applyline_1);
                applyline2.computeLineDistances();//compute
                step_group_1.add(applyline2);

                var applyline3 = new THREE.LineSegments(apply_3_geo,applyline_1);
                applyline3.computeLineDistances();//compute
                step_group_1.add(applyline3);


                var applyline4 = new THREE.LineSegments(apply_4_geo,applyline_1);
                applyline4.computeLineDistances();//compute
                step_group_1.add(applyline4);


            //    var tubeMesh_pj_1=createCylinderMesh(new THREE.Vector3(TubePoints2[1].x,TubePoints2[1].y,TubePoints1[1].z),TubePoints2[1],arrow_apply_1,0.004,0.004);
            //    Tube_group.add(tubeMesh_pj_1);
            //    var tubeMesh_pj_2=createCylinderMesh(new THREE.Vector3(TubePoints2[1].x,TubePoints2[1].y,TubePoints1[1].z),TubePoints1[1],arrow_apply_1,0.004,0.004);
            //    Tube_group.add(tubeMesh_pj_2);
            //    var tubeMesh_pj_3=createCylinderMesh(TubePoints2[1],new THREE.Vector3(0,0,TubePoints2[1].z),arrow_apply_1,0.004,0.004);
            //    Tube_group.add(tubeMesh_pj_3);
            //    var tubeMesh_pj_4=createCylinderMesh(TubePoints2[0],new THREE.Vector3(0,0,TubePoints2[1].z),arrow_apply_1,0.004,0.004);
            //    Tube_group.add(tubeMesh_pj_4);

            var trailp1 = new THREE.Vector3(TubePoints2[1].x,TubePoints2[1].y,0.5);
            var trailp2 = new THREE.Vector3(TubePoints3[1].x,TubePoints3[1].y,0.2);
            var trailp3 = new THREE.Vector3(TubePoints4[1].x,TubePoints4[1].y,0.8);
            var vertices = [
                        TubePoints2[1],TubePoints3[1],TubePoints4[1]
                    ];

            var faces = [
                        new THREE.Face3(0, 1, 2),


                    ];

            var geom = new THREE.Geometry();
            geom.vertices = vertices;
            geom.faces = faces;
            geom.computeFaceNormals();
            var material_step_1 = [
                //new THREE.MeshLambertMaterial({color: 0x4d4dff, transparent: true}),
                new THREE.MeshBasicMaterial({color: "white", wireframe: false, transparent: true,opacity:0.1}),
                new THREE.MeshPhongMaterial({
                color: "black",transparent: true,opacity:0.3,side:THREE.DoubleSide
                } )
            ];

            var trail = THREE.SceneUtils.createMultiMaterialObject(geom, material_step_1);
            //step_group_1.add(trail);




            var cb = new THREE.Vector3(),
            ab = new THREE.Vector3(),
            normal1 = new THREE.Vector3();
            cb.subVectors(TubePoints2[1], TubePoints4[1]);
            ab.subVectors(TubePoints4[1], TubePoints3[1]);
            normal1 = cb.cross(ab);
            //normal1.copy(cb).normalize();

            function distanceVector( v1, v2 )
            {
              var dx = v1.x - v2.x;
              var dy = v1.y - v2.y;
              var dz = v1.z - v2.z;

              return Math.sqrt( dx * dx + dy * dy + dz * dz );
            }

            var l1 = distanceVector(P_D, normal1);
            var flength = flen.l

            var nn = new THREE.Vector3(P_D.x+(normal1.x-P_D.x)*flength/l1, P_D.y+(normal1.y-P_D.y)*flength/l1, P_D.z+(normal1.z-P_D.z)*flength/l1);
            var step1_arr2 = new THREE.MeshPhongMaterial({color:"darkblue"});
            var step1_arr3 = new THREE.MeshPhongMaterial({color:"red"});

            var spacedivide_geo1a1 = createCylinderArrowMesh(P_D,nn,step1_arr2,0.01,0.02,0.6);
            //step_group_1_1.add(spacedivide_geo1a1);

            L=3;//右边力图的比例大小

            Cal_ForcesPnt();
            Force_move();

            P_A_Right=Pnt_copy(P_A);
            P_B_Right=Pnt_copy(P_B);
            P_C_Right=Pnt_copy(P_C);
            P_D_Right=Pnt_copy(P_D);


            var vertices = [
                P_A_Right,P_B_Right,P_C_Right,nn
            ];

            var faces = [
                new THREE.Face3(0, 1, 2),
                new THREE.Face3(0, 2, 3),
                new THREE.Face3(0, 1, 3),
                new THREE.Face3(2, 3, 1)
            ];


            var geom = new THREE.Geometry();
            geom.vertices = vertices;
            geom.faces = faces;
            geom.computeFaceNormals();


            var hex=0x009600;
            geom.faces[0].color.setHex(hex);


            for (i = 1;i<geom.faces.length;i++){

                    var hex1=0x0F3150;
                    geom.faces[i].color.setHex(hex1);
                }

            var materials = [
                //new THREE.MeshLambertMaterial({color: 0x4d4dff, transparent: true}),
                new THREE.MeshBasicMaterial({color: "lightgrey", wireframe: true, transparent: true,opacity:0.001}),
                new THREE.MeshLambertMaterial({
                vertexColors: THREE.FaceColors,transparent: true,opacity:0.8,side:THREE.DoubleSide,depthWrite:false
                } )
            ];


             mesht = THREE.SceneUtils.createMultiMaterialObject(geom, materials);

            mesht.children[0].castShadow=true;
            mesht.children[0].receiveShadow=false;

           // step_group_1_1.add(mesht);
            var P_tr = new THREE.Vector3(1,1,-1.8)

            var material = new THREE.MeshPhongMaterial({color: "lightgrey", transparent: false});
            var trGeom0 = new THREE.SphereGeometry(0.02);
                var tr_Tube0 = new THREE.Mesh(trGeom0, material);


                tr_Tube0.name="sp5";
                tr_Tube0.position.copy(P_tr);
                tr_Tube0.castShadow=true;

                Ctrl_tubes.push(tr_Tube0);

            //step_group_1_1.add(tr_Tube0);
            
            var P_tr = new THREE.Vector3(1,1,-1.8)
            var verticestr = [
                P_A_Right,P_B_Right,P_C_Right,P_tr
            ];

            var facestr = [
                new THREE.Face3(0, 1, 2),
                new THREE.Face3(0, 2, 3),
                new THREE.Face3(0, 1, 3),
                new THREE.Face3(2, 3, 1)
            ];


            var geomtr = new THREE.Geometry();
            geomtr.vertices = verticestr;
            geomtr.faces = facestr;
            geomtr.computeFaceNormals();


            var hex=0x009600;
            geomtr.faces[0].color.setHex(hex);


            for (i = 1;i<geom.faces.length;i++){

                    var hex1=0x0F3150;
                    geom.faces[i].color.setHex(hex1);
                }

            var materials = [
                //new THREE.MeshLambertMaterial({color: 0x4d4dff, transparent: true}),
                new THREE.MeshBasicMaterial({color: "black", wireframe: true, transparent: true,opacity:0.5}),
                new THREE.MeshLambertMaterial({
                vertexColors: THREE.FaceColors,transparent: true,opacity:0.3,side:THREE.DoubleSide,depthWrite:false
                } )
            ];


             meshtr = THREE.SceneUtils.createMultiMaterialObject(geomtr, materials);

            meshtr.children[0].castShadow=true;
            meshtr.children[0].receiveShadow=false;

           // step_group_1_1.add(meshtr);

            var cb3 = new THREE.Vector3(),
            ab3 = new THREE.Vector3(),
            normal13 = new THREE.Vector3();
            cb3.subVectors(P_A,P_tr);
            ab3.subVectors(P_C, P_tr);
            ab3.cross(cb3);
            normal13.copy(ab3).normalize();

            var nn3 = new THREE.Vector3(0.2*normal13.x, 0.2*normal13.y, 0.2*normal13.z);
            var newP_2 = new THREE.Vector3(TubePoints2[1].x, TubePoints2[1].y, TubePoints2[1].z+1.1);

            var new2 = new THREE.Vector3(newP_2.x-1.8*nn3.x, newP_2.y-1.8*nn3.y, newP_2.z-1.8*nn3.z);
            var dir1_1 = new THREE.Vector3(); // create once an reuse it

            dir1_1.subVectors( newP_2,new2 ).normalize();

            var dir1_2 = new THREE.Vector3(); // create once an reuse it

            dir1_2.subVectors( TubePoints1[1],TubePoints1[0] ).normalize();

            var newPo = LinesSectPt(dir1_1,new2,dir1_2, TubePoints1[0]);

            var trailMaterial = new THREE.MeshBasicMaterial( { color: "black", transparent: true, opacity:0.5} );

            var newtubeMesh_tr=createCylinderMesh(newP_2,newPo,trailMaterial,0.02,0.02);
            //step_group_1.add(newtubeMesh_tr);

            var cb4 = new THREE.Vector3(),
            ab4 = new THREE.Vector3(),
            normal14 = new THREE.Vector3();
            cb4.subVectors(P_A,P_tr);
            ab4.subVectors(P_B, P_tr);
            ab4.cross(cb4);
            normal14.copy(ab4).normalize();

            var nn4 = new THREE.Vector3(0.2*normal14.x, 0.2*normal14.y, 0.2*normal14.z);

            var new2_2 = new THREE.Vector3(newPo.x-1.8*nn4.x, newPo.y-1.8*nn4.y, newPo.z-1.8*nn4.z);

            var dir2_1 = new THREE.Vector3(); // create once an reuse it

            dir2_1.subVectors( newPo,new2_2 ).normalize();

            var dir2_2 = new THREE.Vector3(); // create once an reuse it
            var newP_4 = new THREE.Vector3(TubePoints3[1].x, TubePoints3[1].y, TubePoints3[1].z+1.8);


            dir2_2.subVectors( TubePoints3[1],newP_4 ).normalize();

            var newPo_2 = LinesSectPt(dir2_1,newPo,dir2_2, TubePoints3[1]);

            var trailMaterial = new THREE.MeshBasicMaterial( { color: "black", transparent: true, opacity:0.5} );

            var newtubeMesh_tr2=createCylinderMesh(newPo_2,newPo,trailMaterial,0.02,0.02);
            //step_group_1.add(newtubeMesh_tr2);

            var cb5 = new THREE.Vector3(),
            ab5 = new THREE.Vector3(),
            normal15 = new THREE.Vector3();
            cb5.subVectors(P_C,P_tr);
            ab5.subVectors(P_B, P_tr);
            ab5.cross(cb5);
            normal15.copy(ab5).normalize();

            var nn5 = new THREE.Vector3(0.2*normal15.x, 0.2*normal15.y, 0.2*normal15.z);

            var new2_3 = new THREE.Vector3(newPo.x-1.8*nn5.x, newPo.y-1.8*nn5.y, newPo.z-1.8*nn5.z);

            var dir3_1 = new THREE.Vector3(); // create once an reuse it

            dir3_1.subVectors( newPo,new2_3 ).normalize();

            var dir3_2 = new THREE.Vector3(); // create once an reuse it
            var newP_5 = new THREE.Vector3(TubePoints4[1].x, TubePoints4[1].y, TubePoints4[1].z+1.8);


            dir3_2.subVectors( TubePoints4[1],newP_5 ).normalize();

            var newPo_3 = LinesSectPt(dir3_1,newPo,dir3_2, TubePoints4[1]);

            var trailMaterial = new THREE.MeshBasicMaterial( { color: "black", transparent: true, opacity:0.5} );

            var newtubeMesh_tr3=createCylinderMesh(newPo_3,newPo,trailMaterial,0.02,0.02);
           // step_group_1.add(newtubeMesh_tr3);


            var vertices = [
                        newP_2,newPo_2,newPo_3
                    ];

            var faces = [
                        new THREE.Face3(0, 1, 2),
                    ];

            var geom = new THREE.Geometry();
            geom.vertices = vertices;
            geom.faces = faces;
            geom.computeFaceNormals();
            var material_step_1 = [
                //new THREE.MeshLambertMaterial({color: 0x4d4dff, transparent: true}),
                new THREE.MeshBasicMaterial({color: "black", wireframe: true, transparent: true,opacity:0.5}),
                new THREE.MeshPhongMaterial({
                color: "black",transparent: true,opacity:0.2,side:THREE.DoubleSide
                } )
            ];

            var trail = THREE.SceneUtils.createMultiMaterialObject(geom, material_step_1);
            //step_group_1.add(trail);

            var facec = new THREE.Vector3((P_A_Right.x+P_B_Right.x+P_C_Right.x)/3, (P_A_Right.y+P_B_Right.y+P_C_Right.y)/3, (P_A_Right.z+P_B_Right.z+P_C_Right.z)/3);

            var newtubeMesh_tr4=createCylinderMesh(P_tr,facec,trailMaterial,0.02,0.02);
            //step_group_1_1.add(newtubeMesh_tr4);

            var tpoints = [];
            tpoints.push(P_tr);
            tpoints.push(facec);

            var dgeo = new THREE.Geometry().setFromPoints( tpoints );
            var dashline1 = new THREE.LineDashedMaterial({
                             color: "black",//color
                             dashSize: 0.2,
                            gapSize: 0.03,
                            linewidth: 1

                             });

            var Dashl = new THREE.LineSegments(dgeo,dashline1);
            Dashl.computeLineDistances();//compute
           // step_group_1_1.add(Dashl);

            var tpoints2 = [];
            tpoints2.push(nn);
            tpoints2.push(facec);

            var dgeo2 = new THREE.Geometry().setFromPoints( tpoints2 );
            var dashline1 = new THREE.LineDashedMaterial({
                             color: "black",//color
                             dashSize: 0.2,
                            gapSize: 0.03,
                            linewidth: 1

                             });

            var Dashl2 = new THREE.LineSegments(dgeo2,dashline1);
            Dashl2.computeLineDistances();//compute
            //step_group_1_1.add(Dashl2);







            //var cb2 = new THREE.Vector3((nn.x-P_A.x),(nn.y-P_A.y),(nn.z-P_A.z));
            //var ab2 = new THREE.Vector3((P_C.x-P_A.x),(P_C.y-P_A.y),(P_C.z-P_A.z));
            //var normal2 = new THREE.Vector3();

            var cb2 = new THREE.Vector3(),
            ab2 = new THREE.Vector3(),
            normal12 = new THREE.Vector3();
            cb2.subVectors(P_A,nn);
            ab2.subVectors(P_C, nn);
            ab2.cross(cb2);
            normal12.copy(ab2).normalize();

            var nn2 = new THREE.Vector3(0.2*normal12.x, 0.2*normal12.y, 0.2*normal12.z)

            var new1 = new THREE.Vector3(TubePoints2[1].x-1.8*nn2.x, TubePoints2[1].y-1.8*nn2.y, TubePoints2[1].z-1.8*nn2.z);
            var new1_1 = new THREE.Vector3(TubePoints2[1].x+1.8*nn2.x, TubePoints2[1].y+1.8*nn2.y, TubePoints2[1].z+1.8*nn2.z);

            var dir1 = new THREE.Vector3(); // create once an reuse it

            dir1.subVectors( TubePoints2[1],new1 ).normalize();

            var dir2 = new THREE.Vector3(); // create once an reuse it

            dir2.subVectors( TubePoints1[1],TubePoints1[0] ).normalize();

            var arrow_material_outline = new THREE.MeshBasicMaterial( { color: "white", transparent: false, side: THREE.BackSide } );


            var newP2 = LinesSectPt(dir1,new1,dir2, TubePoints1[0]);

            if (nn.z>P_A.z){
            var spacedivide_geo1a3 = createCylinderArrowMesh(TubePoints2[1],new1,step1_arr3,0.02,0.04,0.6)
            var spacedivide_geo1a3_ol=createCylinderArrowMesh(TubePoints2[1],new1,arrow_material_outline,0.023,0.04,0.58)}
            if (nn.z<P_A.z){
            var spacedivide_geo1a3 = createCylinderArrowMesh(new1_1,TubePoints2[1],step1_arr2,0.02,0.04,0.6)
            var spacedivide_geo1a3_ol=createCylinderArrowMesh(new1_1,TubePoints2[1],arrow_material_outline,0.023,0.04,0.58)}

            // step_group_1.add(spacedivide_geo1a3);
            // step_group_1.add(spacedivide_geo1a3_ol);

            spacedivide_geo1a3_ol.scale.multiplyScalar(1.1);

            var material = new THREE.MeshPhongMaterial({color: "lightgrey", transparent: false});

            var spGeom0 = new THREE.SphereGeometry(0.05);
            var new_Tube0 = new THREE.Mesh(spGeom0, material);


            //new_Tube0.name="sp0";
            new_Tube0.position.copy(newP2);
            new_Tube0.castShadow=true;

            Ctrl_tubes.push(sp_Tube0);

            var outlineMaterial1 = new THREE.MeshBasicMaterial( { color: "black", transparent: false, side: THREE.BackSide } );
            var outlineMeshnew = new THREE.Mesh( spGeom0, outlineMaterial1 );
            outlineMeshnew.position.copy(newP2);
            outlineMeshnew.scale.multiplyScalar(1.55);
            //step_group_1.add( outlineMeshnew );
            //scene.add(text0);
            //text0.position.copy(new THREE.vertices(0.2,0,0));
            //text_group1.add(text0);

            //step_group_1.add(new_Tube0);


            var newSphereTest = new THREE.Sphere(new THREE.Vector3(newP2.x,newP2.y,newP2.z),0.12);
            var newPointClose = newSphereTest.clampPoint(new THREE.Vector3(TubePoints2[1].x,TubePoints2[1].y,TubePoints2[1].z));
            var newPointClose2 = newSphereTest.clampPoint(new THREE.Vector3(TubePoints3[1].x,TubePoints3[1].y,TubePoints3[1].z));
            var newPointClose3 = newSphereTest.clampPoint(new THREE.Vector3(TubePoints4[1].x,TubePoints4[1].y,TubePoints4[1].z));

            var newsp = new THREE.SphereGeometry(0.05);
            var new_sp = new THREE.Mesh(newsp, material);
            var new_sp2 = new THREE.Mesh(newsp, material);
            var new_sp3 = new THREE.Mesh(newsp, material);

            new_sp.position.copy(new THREE.Vector3(newPointClose.x, newPointClose.y,newPointClose.z));
            new_sp2.position.copy(new THREE.Vector3(newPointClose2.x, newPointClose2.y,newPointClose2.z));
            new_sp3.position.copy(new THREE.Vector3(newPointClose3.x, newPointClose3.y,newPointClose3.z));

            // step_group_1.add(new_sp);
            // step_group_1.add(new_sp2);
            // step_group_1.add(new_sp3);

            var newtubeMesh1=createCylinderMesh(TubePoints2[1],newPointClose,material,0.05,0.05);
            var newtubeMesh2=createCylinderMesh(TubePoints3[1],newPointClose2,material,0.05,0.05);
            var newtubeMesh3=createCylinderMesh(TubePoints4[1],newPointClose3,material,0.05,0.05);
            // step_group_1.add(newtubeMesh1);
            // step_group_1.add(newtubeMesh2);
            // step_group_1.add(newtubeMesh3);

            var new_geo1a1 = createCylinderArrowMesh(newP2,TubePoints2[1],step1_arr2,0.01,0.02,0.6);
            //step_group_1.add(new_geo1a1);













            var step_1_face_cor1 = new THREE.Vector3(TubePoints2[1].x,TubePoints2[1].y,TubePoints1[1].z);
            var step_1_face_cor2 = new THREE.Vector3(0,0,-1.5);
            var step_1_face_cor3 = new THREE.Vector3(TubePoints2[1].x,TubePoints2[1].y,-1.5);
            var vertices = [
                        step_1_face_cor1,step_1_face_cor3,step_1_face_cor2,TubePoints1[1]
                    ];

                var faces = [
                            new THREE.Face3(0, 1, 2),
                            new THREE.Face3(0, 2, 3),

                        ];

                var geom = new THREE.Geometry();
                geom.vertices = vertices;
                geom.faces = faces;
                geom.computeFaceNormals();
                var material_step_1 = [
                    //new THREE.MeshLambertMaterial({color: 0x4d4dff, transparent: true}),
                    new THREE.MeshBasicMaterial({color: "white", wireframe: false, transparent: true,opacity:0.1}),
                    new THREE.MeshPhongMaterial({
                    color: 0x009600,transparent: true,opacity:0.3,side:THREE.DoubleSide,depthWrite:false
                    } )
                ];

                var step_1_face_1 = THREE.SceneUtils.createMultiMaterialObject(geom, material_step_1);
                //step_group_1.add(step_1_face_1);

                var step_1_face_cor3 = new THREE.Vector3(TubePoints3[1].x,TubePoints3[1].y,TubePoints1[1].z);
                var step_1_face_cor4 = new THREE.Vector3(0,0,-1.5);
                var step_1_face_cor5 = new THREE.Vector3(TubePoints3[1].x,TubePoints3[1].y,-1.5);
                var vertices = [
                            step_1_face_cor3,step_1_face_cor5,step_1_face_cor4,TubePoints1[1]
                        ];

                var faces = [
                            new THREE.Face3(0, 1, 2),
                            new THREE.Face3(0, 2, 3),

                        ];

                var geom = new THREE.Geometry();
                geom.vertices = vertices;
                geom.faces = faces;
                geom.computeFaceNormals();
                var material_step_2 =[
                    //new THREE.MeshLambertMaterial({color: 0x4d4dff, transparent: true}),
                    new THREE.MeshBasicMaterial({color: "white", wireframe: false, transparent: true,opacity:0.1}),
                    new THREE.MeshPhongMaterial({
                    color: 0x009600,transparent: true,opacity:0.3,side:THREE.DoubleSide,depthWrite:false
                    } )
                ];

                var step_1_face_2 = THREE.SceneUtils.createMultiMaterialObject(geom, material_step_2);
                step_group_1.add(step_1_face_2);

                var step_1_face_cor5 = new THREE.Vector3(TubePoints4[1].x,TubePoints4[1].y,TubePoints1[1].z);
                var step_1_face_cor6 = new THREE.Vector3(0,0,-1.5);
                var step_1_face_cor7 = new THREE.Vector3(TubePoints4[1].x,TubePoints4[1].y,-1.5);
                var vertices = [
                            step_1_face_cor5,step_1_face_cor7,step_1_face_cor6,TubePoints1[1]
                        ];

                var faces = [
                            new THREE.Face3(0, 1, 2),
                            new THREE.Face3(0, 2, 3),

                        ];

                var geom = new THREE.Geometry();
                geom.vertices = vertices;
                geom.faces = faces;
                geom.computeFaceNormals();

                var material_step_3 = [
                    //new THREE.MeshLambertMaterial({color: 0x4d4dff, transparent: true}),
                    new THREE.MeshBasicMaterial({color: "white", wireframe: false, transparent: true,opacity:0.1}),
                    new THREE.MeshPhongMaterial({
                    color: 0x009600,transparent: true,opacity:0.3,side:THREE.DoubleSide,depthWrite:false
                    } )
                ];


                var step_1_face_3 = THREE.SceneUtils.createMultiMaterialObject(geom, material_step_3);
      //          var material_step_3 = new THREE.MeshPhongMaterial({color: 0x009600, transparent: true, opacity:0.3, side: THREE.DoubleSide});
      //          var step_1_face_3 = new THREE.Mesh(geom,material_step_3);
                step_group_1.add(step_1_face_3);

                function roundedCornerLine(points, radius, smoothness, closed) {

                    radius = radius !== undefined ? radius : .1;
                    smoothness = smoothness !== undefined ? Math.floor(smoothness) : 3;
                    closed = closed !== undefined ? closed : false;

                    let newGeometry = new THREE.BufferGeometry();

                    if (points === undefined) {
                      console.log("RoundedCornerLine: 'points' is undefined");
                      return newGeometry;
                    }
                    if (points.length < 3) {
                      console.log("RoundedCornerLine: 'points' has insufficient length (should be equal or greater than 3)");
                      return newGeometry.setFromPoints(points);
                    }

                    // minimal segment
                    let minVector = new THREE.Vector3();
                    let minLength = minVector.subVectors(points[0], points[1]).length();
                    for (let i = 1; i < points.length - 1; i++) {
                      minLength = Math.min(minLength, minVector.subVectors(points[i], points[i + 1]).length());
                    }
                    if (closed) {
                      minLength = Math.min(minLength, minVector.subVectors(points[points.length - 1], points[0]).length());
                    }

                    radius = radius > minLength * .5 ? minLength * .5 : radius; // radius can't be greater than a half of a minimal segment

                    let startIndex = 1;
                    let endIndex = points.length - 2;
                    if (closed) {
                      startIndex = 0;
                      endIndex = points.length - 1;
                    }

                    let positions = [];
                    if (!closed) {
                      positions.push(points[0].clone())
                    };

                    for (let i = startIndex; i <= endIndex; i++) {

                      let iStart = i - 1 < 0 ? points.length - 1 : i - 1;
                      let iMid = i;
                      let iEnd = i + 1 > points.length - 1 ? 0 : i + 1;
                      let pStart = points[iStart];
                      let pMid = points[iMid];
                      let pEnd = points[iEnd];

                      // key points
                      let vStartMid = new THREE.Vector3().subVectors(pStart, pMid).normalize();
                      let vEndMid = new THREE.Vector3().subVectors(pEnd, pMid).normalize();
                      let vCenter = new THREE.Vector3().subVectors(vEndMid, vStartMid).divideScalar(2).add(vStartMid).normalize();
                      let angle = vStartMid.angleTo(vEndMid);
                      let halfAngle = angle * .5;

                      let sideLength = radius / Math.tan(halfAngle);
                      let centerLength = Math.sqrt(sideLength * sideLength + radius * radius);

                      let startKeyPoint = vStartMid.multiplyScalar(sideLength);
                      let centerKeyPoint = vCenter.multiplyScalar(centerLength);
                      let endKeyPoint = vEndMid.multiplyScalar(sideLength);

                      let cb = new THREE.Vector3(),
                        ab = new THREE.Vector3(),
                        normal = new THREE.Vector3();
                      cb.subVectors(centerKeyPoint, endKeyPoint);
                      ab.subVectors(startKeyPoint, endKeyPoint);
                      cb.cross(ab);
                      normal.copy(cb).normalize();

                      let rotatingPointStart = new THREE.Vector3().subVectors(startKeyPoint, centerKeyPoint);
                      let rotatingPointEnd = new THREE.Vector3().subVectors(endKeyPoint, centerKeyPoint);
                      let rotatingAngle = rotatingPointStart.angleTo(rotatingPointEnd);
                      let angleDelta = rotatingAngle / smoothness;
                      let tempPoint = new THREE.Vector3();
                      for (let a = 0; a < smoothness + 1; a++) {
                        tempPoint.copy(rotatingPointStart).applyAxisAngle(normal, angleDelta * a).add(pMid).add(centerKeyPoint);
                        positions.push(tempPoint.clone());
                      }

                    }

                    if (!closed) {
                      positions.push(points[points.length - 1].clone());
                    } else {
                      positions.push(positions[0].clone());
                    }

                    return newGeometry.setFromPoints(positions);

                  }

                  function getCurveGeometry(points, smoothness, weight) {
                      var nurbsControlPoints = [];
                      var nurbsKnots = [];
                      var nurbsDegree = 2;
                      for (let i = 0; i <= nurbsDegree; i++) {
                        nurbsKnots.push(0);
                      }
                      for (let i = 0, j = points.length; i < j; i++) {
                        nurbsControlPoints.push(
                          new THREE.Vector4(
                            points[i].x,
                            points[i].y,
                            points[i].z,
                            i === 1 ? weight : 1
                          )
                        );
                        let knot = (i + 1) / (j - nurbsDegree);
                        nurbsKnots.push(THREE.Math.clamp(knot, 0, 1));
                      }
                      let nurbsCurve = new THREE.NURBSCurve(nurbsDegree, nurbsKnots, nurbsControlPoints);
                      return new THREE.BufferGeometry().setFromPoints(nurbsCurve.getPoints(smoothness));
                    }


                  // offset test

                  var Sphere_offset_1 = new THREE.Sphere(new THREE.Vector3(TubePoints1[1].x,TubePoints1[1].y,TubePoints1[1].z),0.12);
                  var Point_offset_1_1 = Sphere_offset_1.clampPoint(new THREE.Vector3(TubePoints2[1].x,TubePoints2[1].y,TubePoints1[1].z));
                  var Point_offset_1_2 = Sphere_offset_1.clampPoint(new THREE.Vector3(TubePoints4[1].x,TubePoints4[1].y,TubePoints1[1].z));
                  var offset_mid_1 = new THREE.Vector3( (Point_offset_1_1.x+Point_offset_1_2.x)/2, (Point_offset_1_1.y+Point_offset_1_2.y)/2, (Point_offset_1_1.z+Point_offset_1_2.z)/2 );
                  var offset_mid_geo1 = new THREE.SphereGeometry(0.02);
                  var offset_midpoint = new THREE.Mesh(offset_mid_geo1, new THREE.MeshPhongMaterial({color: "black", transparent: true, opacity:0.7}));

                //  offset_midpoint.position.copy(offset_mid_1);
                //  step_group_1.add(offset_midpoint);

                  var Sphere_offset_2 = new THREE.Sphere(new THREE.Vector3(TubePoints2[1].x,TubePoints2[1].y,TubePoints1[1].z),0.2);
                  var Point_offset_2_1 = Sphere_offset_2.clampPoint(new THREE.Vector3(TubePoints1[1].x,TubePoints1[1].y,TubePoints1[1].z));
                  var Point_offset_2_2 = Sphere_offset_2.clampPoint(new THREE.Vector3(TubePoints4[1].x,TubePoints4[1].y,TubePoints1[1].z));
                  var offset_mid_2 = new THREE.Vector3( (Point_offset_2_1.x+Point_offset_2_2.x)/2, (Point_offset_2_1.y+Point_offset_2_2.y)/2, (Point_offset_2_1.z+Point_offset_2_2.z)/2 );
                  var offset_mid_geo2 = new THREE.SphereGeometry(0.02);
                  var offset_midpoint2 = new THREE.Mesh(offset_mid_geo2, new THREE.MeshPhongMaterial({color: "black", transparent: true, opacity:0.7}));

              //    offset_midpoint2.position.copy(offset_mid_2);
              //    step_group_1.add(offset_midpoint2);

                  var Sphere_offset_3 = new THREE.Sphere(new THREE.Vector3(TubePoints4[1].x,TubePoints4[1].y,TubePoints1[1].z),0.2);
                  var Point_offset_3_1 = Sphere_offset_3.clampPoint(new THREE.Vector3(TubePoints1[1].x,TubePoints1[1].y,TubePoints1[1].z));
                  var Point_offset_3_2 = Sphere_offset_3.clampPoint(new THREE.Vector3(TubePoints2[1].x,TubePoints2[1].y,TubePoints1[1].z));
                  var offset_mid_3 = new THREE.Vector3( (Point_offset_3_1.x+Point_offset_3_2.x)/2, (Point_offset_3_1.y+Point_offset_3_2.y)/2, (Point_offset_3_1.z+Point_offset_3_2.z)/2 );
                  var offset_mid_geo3 = new THREE.SphereGeometry(0.02);
                  var offset_midpoint3 = new THREE.Mesh(offset_mid_geo3, new THREE.MeshPhongMaterial({color: "black", transparent: true, opacity:0.7}));

              //    offset_midpoint3.position.copy(offset_mid_3);
              //    step_group_1.add(offset_midpoint3);


                  var points_offset = [
                    new THREE.Vector3(offset_mid_1.x,offset_mid_1.y,offset_mid_1.z),
                    new THREE.Vector3(offset_mid_2.x,offset_mid_2.y,offset_mid_2.z),
                    new THREE.Vector3(offset_mid_3.x,offset_mid_3.y,offset_mid_3.z),
                  ];

                  var radius = 0.04;
                  var smoothness = 12;

                  var geom_offset = roundedCornerLine(points_offset, radius, smoothness, true);
                  var line1_offset = new THREE.Line(geom_offset, new THREE.LineDashedMaterial({
                                   color: "black",//color
                                   dashSize: 0.1,
                                  gapSize: 0.03,
                                  linewidth: 1

                                   }));
                  line1_offset.computeLineDistances();
                  step_group_1.add(line1_offset);



                  // offset test 2

                  var Sphere_offset_12 = new THREE.Sphere(new THREE.Vector3(TubePoints1[1].x,TubePoints1[1].y,TubePoints1[1].z),0.12);
                  var Point_offset_1_12 = Sphere_offset_12.clampPoint(new THREE.Vector3(TubePoints2[1].x,TubePoints2[1].y,TubePoints1[1].z));
                  var Point_offset_1_22 = Sphere_offset_12.clampPoint(new THREE.Vector3(TubePoints3[1].x,TubePoints3[1].y,TubePoints1[1].z));
                  var offset_mid_12 = new THREE.Vector3( (Point_offset_1_12.x+Point_offset_1_22.x)/2, (Point_offset_1_12.y+Point_offset_1_22.y)/2, (Point_offset_1_12.z+Point_offset_1_22.z)/2 );
                  var offset_mid_geo12 = new THREE.SphereGeometry(0.02);
                  var offset_2midpoint = new THREE.Mesh(offset_mid_geo12, new THREE.MeshPhongMaterial({color: "black", transparent: true, opacity:0.7}));

                  //  offset_midpoint.position.copy(offset_mid_1);
                  //  step_group_1.add(offset_midpoint);

                  var Sphere_offset_22 = new THREE.Sphere(new THREE.Vector3(TubePoints2[1].x,TubePoints2[1].y,TubePoints1[1].z),0.2);
                  var Point_offset_2_12 = Sphere_offset_2.clampPoint(new THREE.Vector3(TubePoints1[1].x,TubePoints1[1].y,TubePoints1[1].z));
                  var Point_offset_2_22 = Sphere_offset_2.clampPoint(new THREE.Vector3(TubePoints3[1].x,TubePoints3[1].y,TubePoints1[1].z));
                  var offset_mid_22 = new THREE.Vector3( (Point_offset_2_12.x+Point_offset_2_22.x)/2, (Point_offset_2_12.y+Point_offset_2_22.y)/2, (Point_offset_2_12.z+Point_offset_2_22.z)/2 );
                  var offset_mid_geo22 = new THREE.SphereGeometry(0.02);
                  var offset_2midpoint2 = new THREE.Mesh(offset_mid_geo22, new THREE.MeshPhongMaterial({color: "black", transparent: true, opacity:0.7}));

                  //    offset_midpoint2.position.copy(offset_mid_2);
                  //    step_group_1.add(offset_midpoint2);

                  var Sphere_offset_32 = new THREE.Sphere(new THREE.Vector3(TubePoints3[1].x,TubePoints3[1].y,TubePoints1[1].z),0.2);
                  var Point_offset_3_12 = Sphere_offset_32.clampPoint(new THREE.Vector3(TubePoints1[1].x,TubePoints1[1].y,TubePoints1[1].z));
                  var Point_offset_3_22 = Sphere_offset_32.clampPoint(new THREE.Vector3(TubePoints2[1].x,TubePoints2[1].y,TubePoints1[1].z));
                  var offset_mid_32 = new THREE.Vector3( (Point_offset_3_12.x+Point_offset_3_22.x)/2, (Point_offset_3_12.y+Point_offset_3_22.y)/2, (Point_offset_3_12.z+Point_offset_3_22.z)/2 );
                  var offset_mid_geo32 = new THREE.SphereGeometry(0.02);
                  var offset_2midpoint3 = new THREE.Mesh(offset_mid_geo32, new THREE.MeshPhongMaterial({color: "black", transparent: true, opacity:0.7}));

                  //    offset_midpoint3.position.copy(offset_mid_3);
                  //    step_group_1.add(offset_midpoint3);


                  var points_offset2 = [
                    new THREE.Vector3(offset_mid_12.x,offset_mid_12.y,offset_mid_12.z),
                    new THREE.Vector3(offset_mid_22.x,offset_mid_22.y,offset_mid_22.z),
                    new THREE.Vector3(offset_mid_32.x,offset_mid_32.y,offset_mid_32.z),
                  ];

                  var radius = 0.04;
                  var smoothness = 12;

                  var geom_offset2 = roundedCornerLine(points_offset2, radius, smoothness, true);
                  var line1_offset2 = new THREE.Line(geom_offset2, new THREE.LineDashedMaterial({
                                   color: "black",//color
                                   dashSize: 0.1,
                                  gapSize: 0.03,
                                  linewidth: 1

                                   }));
                  line1_offset2.computeLineDistances();
                  step_group_1.add(line1_offset2);

                  // offset test 3

                  var Sphere_offset_13 = new THREE.Sphere(new THREE.Vector3(TubePoints1[1].x,TubePoints1[1].y,TubePoints1[1].z),0.12);
                  var Point_offset_1_13 = Sphere_offset_13.clampPoint(new THREE.Vector3(TubePoints4[1].x,TubePoints4[1].y,TubePoints1[1].z));
                  var Point_offset_1_23 = Sphere_offset_13.clampPoint(new THREE.Vector3(TubePoints3[1].x,TubePoints3[1].y,TubePoints1[1].z));
                  var offset_mid_13 = new THREE.Vector3( (Point_offset_1_13.x+Point_offset_1_23.x)/2, (Point_offset_1_13.y+Point_offset_1_23.y)/2, (Point_offset_1_13.z+Point_offset_1_23.z)/2 );
                  var offset_mid_geo13 = new THREE.SphereGeometry(0.02);
                  var offset_3midpoint = new THREE.Mesh(offset_mid_geo13, new THREE.MeshPhongMaterial({color: "black", transparent: true, opacity:0.7}));

                  //  offset_midpoint.position.copy(offset_mid_1);
                  //  step_group_1.add(offset_midpoint);

                  var Sphere_offset_23 = new THREE.Sphere(new THREE.Vector3(TubePoints3[1].x,TubePoints3[1].y,TubePoints1[1].z),0.2);
                  var Point_offset_2_13 = Sphere_offset_23.clampPoint(new THREE.Vector3(TubePoints1[1].x,TubePoints1[1].y,TubePoints1[1].z));
                  var Point_offset_2_23 = Sphere_offset_23.clampPoint(new THREE.Vector3(TubePoints4[1].x,TubePoints4[1].y,TubePoints1[1].z));
                  var offset_mid_23 = new THREE.Vector3( (Point_offset_2_13.x+Point_offset_2_23.x)/2, (Point_offset_2_13.y+Point_offset_2_23.y)/2, (Point_offset_2_13.z+Point_offset_2_23.z)/2 );
                  var offset_mid_geo23 = new THREE.SphereGeometry(0.02);
                  var offset_3midpoint2 = new THREE.Mesh(offset_mid_geo23, new THREE.MeshPhongMaterial({color: "black", transparent: true, opacity:0.7}));

                  //    offset_midpoint2.position.copy(offset_mid_2);
                  //    step_group_1.add(offset_midpoint2);

                  var Sphere_offset_33 = new THREE.Sphere(new THREE.Vector3(TubePoints4[1].x,TubePoints4[1].y,TubePoints1[1].z),0.2);
                  var Point_offset_3_13 = Sphere_offset_33.clampPoint(new THREE.Vector3(TubePoints1[1].x,TubePoints1[1].y,TubePoints1[1].z));
                  var Point_offset_3_23 = Sphere_offset_33.clampPoint(new THREE.Vector3(TubePoints3[1].x,TubePoints3[1].y,TubePoints1[1].z));
                  var offset_mid_33 = new THREE.Vector3( (Point_offset_3_13.x+Point_offset_3_23.x)/2, (Point_offset_3_13.y+Point_offset_3_23.y)/2, (Point_offset_3_13.z+Point_offset_3_23.z)/2 );
                  var offset_mid_geo33 = new THREE.SphereGeometry(0.02);
                  var offset_3midpoint3 = new THREE.Mesh(offset_mid_geo33, new THREE.MeshPhongMaterial({color: "black", transparent: true, opacity:0.7}));

                  //    offset_midpoint3.position.copy(offset_mid_3);
                  //    step_group_1.add(offset_midpoint3);


                  var points_offset3 = [
                    new THREE.Vector3(offset_mid_13.x,offset_mid_13.y,offset_mid_13.z),
                    new THREE.Vector3(offset_mid_23.x,offset_mid_23.y,offset_mid_23.z),
                    new THREE.Vector3(offset_mid_33.x,offset_mid_33.y,offset_mid_33.z),
                  ];

                  var radius = 0.04;
                  var smoothness = 12;

                  var geom_offset3 = roundedCornerLine(points_offset3, radius, smoothness, true);
                  var line1_offset3 = new THREE.Line(geom_offset3, new THREE.LineDashedMaterial({
                                   color: "black",//color
                                   dashSize: 0.1,
                                  gapSize: 0.03,
                                  linewidth: 1

                                   }));
                  line1_offset3.computeLineDistances();
                  step_group_1.add(line1_offset3);



                                  //draw step 1 space 1

                                  var point2z = new THREE.Vector3( TubePoints2[1].x, TubePoints2[1].y, TubePoints1[1].z);
                                  var point3z = new THREE.Vector3( TubePoints3[1].x, TubePoints3[1].y, TubePoints1[1].z);
                                  var point4z = new THREE.Vector3( TubePoints4[1].x, TubePoints4[1].y, TubePoints1[1].z);

                                  var midpoint_24 = new THREE.Vector3( (point2z.x+point4z.x)/2, (point2z.y+point4z.y)/2, (point2z.z+point4z.z)/2 );
                                  var Sphere_step_1 = new THREE.Sphere(new THREE.Vector3(0,0,TubePoints1[1].z),0.4);
                                  var Point_step_1 = Sphere_step_1.clampPoint(midpoint_24);
                                  var spGeom_step_1 = new THREE.SphereGeometry(0.02);
                                  var sp_step_1 = new THREE.Mesh(spGeom_step_1, new THREE.MeshPhongMaterial({color: "black", transparent: true, opacity:0.7}));
                                  sp_step_1.position.copy(Point_step_1);
                                //  step_group_1.add(sp_step_1);

                                  var TXMeshS1=createSpriteTextstep1("C",Point_step_1);

                                  step_group_1.add(TXMeshS1);


                                  var midpoint_23 = new THREE.Vector3( (point2z.x+point3z.x)/2, (point2z.y+point3z.y)/2, (point2z.z+point3z.z)/2 );
                                  var Sphere_step_2 = new THREE.Sphere(new THREE.Vector3(0,0,TubePoints1[1].z),0.4);
                                  var Point_step_2 = Sphere_step_2.clampPoint(midpoint_23);
                                  var spGeom_step_2 = new THREE.SphereGeometry(0.02);
                                  var sp_step_2 = new THREE.Mesh(spGeom_step_2, new THREE.MeshPhongMaterial({color: "black", transparent: true, opacity:0.7}));
                                  sp_step_2.position.copy(Point_step_2);
                              //    step_group_1.add(sp_step_2);

                                  var TXMeshS2=createSpriteTextstep1("A",Point_step_2);

                                  step_group_1.add(TXMeshS2);

                                  var midpoint_34 = new THREE.Vector3( (point4z.x+point3z.x)/2, (point4z.y+point3z.y)/2, (point4z.z+point3z.z)/2 );
                                  var Sphere_step_3 = new THREE.Sphere(new THREE.Vector3(0,0,TubePoints1[1].z),0.4);
                                  var Point_step_3 = Sphere_step_2.clampPoint(midpoint_34);
                                  var spGeom_step_3 = new THREE.SphereGeometry(0.02);
                                  var sp_step_3 = new THREE.Mesh(spGeom_step_3, new THREE.MeshPhongMaterial({color: "black", transparent: true, opacity:0.7}));
                                  sp_step_3.position.copy(Point_step_3);
                              //    step_group_1.add(sp_step_3);

                                  var TXMeshS3=createSpriteTextstep1("B",Point_step_3);

                                  step_group_1.add(TXMeshS3);







                geometry44 = new THREE.SphereGeometry( 0.03);
                material44 = new THREE.MeshPhongMaterial({color: "grey"});

                mesh44 = new THREE.Mesh( geometry44, material44 );
                //        scene2.add( mesh44 );

                P_A_Left=Pnt_copy(P_A);
                P_B_Left=Pnt_copy(P_B);
                P_C_Left=Pnt_copy(P_C);
                P_D_Left=Pnt_copy(P_D);

                geometry45 = new THREE.SphereGeometry( 0.03);
                material45 = new THREE.MeshPhongMaterial({color: "black"});

                mesh45 = new THREE.Mesh( geometry45, material45 );
                //step_group_1_1.add( mesh45 );
                mesh45.position.copy(P_A_Left);


                mesh46 = new THREE.Mesh( geometry45, material45 );
                //step_group_1_1.add( mesh46 );
                mesh46.position.copy(P_B_Left);

                mesh47 = new THREE.Mesh( geometry45, material45 );
                //step_group_1_1.add( mesh47 );
                mesh47.position.copy(P_C_Left);

                //var tween1 = new TWEEN.Tween( mesh44.position ).to( P_A_Right, 3000 );
                //var tween2 = new TWEEN.Tween( mesh44.position ).to( P_B_Right, 3000 );
                //var tween3 = new TWEEN.Tween( mesh44.position ).to( P_C_Right, 3000 );

              //  tween1.chain( tween2 );
              //  tween2.chain( tween3 );
              //  tween3.chain( tween1 );

                //tween1.start();



                var step_1_line = new THREE.Geometry();

                P_A_Right=Pnt_copy(P_A);
                P_B_Right=Pnt_copy(P_B);
                P_C_Right=Pnt_copy(P_C);
                P_D_Right=Pnt_copy(P_D);


                var vertices2 = [
                    P_A_Right,P_B_Right,P_C_Right
                ];

            //    var step_1_force = [];
            //    step_1_force.push(P_A_Right);
            //    step_1_force.push(P_B_Right);
            //    step_1_force.push(P_C_Right);

            //    var step_1_force_p = new THREE.Geometry().setFromPoints( step_1_force );

                var faces2 = [
                    new THREE.Face3(0, 1, 2),

                ];


                var geomstep1 = new THREE.Geometry();
                geomstep1.vertices = vertices2;
                geomstep1.faces = faces2;
                geomstep1.computeFaceNormals();

            //    var step_1_line_Material = new THREE.LineDashedMaterial({
            //                             color: "black",//color
            //                             dashSize: 0.1,//size
            //                            gapSize: 0.05//gap size
            //                             });



            //    var step_1_force_path = new THREE.LineSegments(step_1_force_p,step_1_line_Material);
            //    step_1_force_path.computeLineDistances();//compute

            //    step_1_force_path = THREE.SceneUtils.createMultiMaterialObject(geomstep1, materialsp1);
              //  step_1_force_path.children.forEach(function (e) {
              //      e.geometry.vertices = vertices2;
              //      e.geometry.verticesNeedUpdate = true;

                    // e.geometry.faces[0].color.set(0xff00ee);
                    // e.geometry.facesNeedUpdate=true;
              //      e.geometry.elementsNeedUpdate = true;
              //      e.geometry.computeFaceNormals();
                    //e.geometry.center();
              //  });
              //  step_group_1_1.add( step_1_force_path );

                var materialsp1 = [
                     //new THREE.MeshLambertMaterial({color: 0x4d4dff, transparent: true}),
                    new THREE.MeshBasicMaterial({color: "black", wireframe: true, transparent: true,opacity:0.2}),
                    new THREE.MeshLambertMaterial({
                    colors: 0x009600,transparent: true,opacity:0.1,side:THREE.DoubleSide,depthWrite:false
                } )
                ];


                step_1_line_Path = THREE.SceneUtils.createMultiMaterialObject(geomstep1, materialsp1);
                step_1_line_Path.children.forEach(function (e) {
                    e.geometry.vertices = vertices2;
                    e.geometry.verticesNeedUpdate = true;

                    // e.geometry.faces[0].color.set(0xff00ee);
                    // e.geometry.facesNeedUpdate=true;
                    e.geometry.elementsNeedUpdate = true;
                    e.geometry.computeFaceNormals();
                    //e.geometry.center();
                });

                //step_group_1_1.add( step_1_line_Path );

                var SphereTest_step_1 = new THREE.Sphere(P_A_Right,2.5);
                var PointClose1_step_1 = SphereTest_step_1.clampPoint(P_B_Right);
                //        var SphereTest2_2 = new THREE.Sphere(PointClose1_2,0.05);
                //        var PointClose2_2 = SphereTest2_2.clampPoint(TubePoints3[1]);
                //        var SphereTest3_2 = new THREE.Sphere(PointClose2_2,0.045);


                var setp_1_arrow_1 = createCylinderArrowMesh(PointClose1_step_1,P_B_Right,material45,0.023,0.05,0.55);
                //step_group_1_1.add( setp_1_arrow_1 );
                setp_1_arrow_1.position.copy(P_A_Right);

                var SphereTest_step_1_2 = new THREE.Sphere(P_B_Right,2.5);
                var PointClose1_step_1_2 = SphereTest_step_1_2.clampPoint(P_C_Right);

                var setp_1_arrow_2 = createCylinderArrowMesh(PointClose1_step_1_2,P_C_Right,material45,0.023,0.05,0.55);
                //step_group_1_1.add( setp_1_arrow_2 );
                setp_1_arrow_2.position.copy(P_B_Right);

                var SphereTest_step_1_3 = new THREE.Sphere(P_C_Right,2.5);
                var PointClose1_step_1_3 = SphereTest_step_1_3.clampPoint(P_A_Right);

                var setp_1_arrow_3 = createCylinderArrowMesh(PointClose1_step_1_3,P_A_Right,material45,0.023,0.05,0.55);
                //step_group_1_1.add( setp_1_arrow_3 );
                setp_1_arrow_3.position.copy(P_C_Right);

                //var tween4 = new TWEEN.Tween( setp_1_arrow_1.position ).to( P_B_Right, 2000 );
                //var tween5 = new TWEEN.Tween( setp_1_arrow_2.position ).to( P_C_Right, 2000 );
                //var tween6 = new TWEEN.Tween( setp_1_arrow_3.position ).to( P_A_Right, 2000 );

                //tween4.chain( tween5 );
                //tween5.chain( tween6 );
                //tween6.chain( tween4 );

                //tween4.start();
                //      tween5.start();
                //      tween6.start();
                //      step_1_line_Path.scale.set(0.5,0.5,0.5);







          var Sphere_step_2_1 = new THREE.Sphere(new THREE.Vector3(TubePoints2[1].x,TubePoints2[1].y,TubePoints2[1].z),0.9);
          var Point_step_2_1 = Sphere_step_2_1.clampPoint(TubePoints1[1]);
          var spGeom_step_2_1 = new THREE.SphereGeometry(0.02);
          var sp_step_2_1 = new THREE.Mesh(spGeom_step_2_1, new THREE.MeshPhongMaterial({color: "black", transparent: true, opacity:0.7}));
          sp_step_2_1.position.copy(Point_step_2_1);
          //step_group_2.add(sp_step_2_1);

          var Sphere_step_2_12 = new THREE.Sphere(new THREE.Vector3(TubePoints2[1].x,TubePoints2[1].y,TubePoints2[1].z),0.8);
          var Point_step_2_12 = Sphere_step_2_12.clampPoint(TubePoints1[0]);
          var spGeom_step_2_12 = new THREE.SphereGeometry(0.2);
          var sp_step_2_12 = new THREE.Mesh(spGeom_step_2_12, new THREE.MeshPhongMaterial({color: "black", transparent: true, opacity:0.7}));
          sp_step_2_12.position.copy(Point_step_2_12);
          //step_group_2.add(sp_step_2_12);

          var Sphere_step_2_13 = new THREE.Sphere(new THREE.Vector3(TubePoints2[1].x,TubePoints2[1].y,TubePoints2[1].z),0.9);
          var Point_step_2_13 = Sphere_step_2_13.clampPoint(TubePoints4[1]);
          var spGeom_step_2_13 = new THREE.SphereGeometry(0.2);
          var sp_step_2_13 = new THREE.Mesh(spGeom_step_2_13, new THREE.MeshPhongMaterial({color: "black", transparent: true, opacity:0.7}));
          sp_step_2_13.position.copy(Point_step_2_13);
          //step_group_2.add(sp_step_2_13);

          var Sphere_step_2_14 = new THREE.Sphere(new THREE.Vector3(TubePoints2[1].x,TubePoints2[1].y,TubePoints2[1].z),0.9);
          var Point_step_2_14 = Sphere_step_2_14.clampPoint(TubePoints3[1]);
          var spGeom_step_2_14 = new THREE.SphereGeometry(0.2);
          var sp_step_2_14 = new THREE.Mesh(spGeom_step_2_14, new THREE.MeshPhongMaterial({color: "black", transparent: true, opacity:0.7}));
          sp_step_2_14.position.copy(Point_step_2_14);
          //step_group_2.add(sp_step_2_13);

          var vertices_step_21 = [
              TubePoints2[1],Point_step_2_1,Point_step_2_12,Point_step_2_13,Point_step_2_14
          ];

          var face_step_21 = [
            new THREE.Face3(0, 1, 2),
          ]
          var geom_step_21 = new THREE.Geometry();
          geom_step_21.vertices = vertices_step_21;
          geom_step_21.faces = face_step_21;
          geom_step_21.computeFaceNormals();

          var material_step_21 = [
              //new THREE.MeshLambertMaterial({color: 0x4d4dff, transparent: true}),
              new THREE.MeshBasicMaterial({color: "white", wireframe: true, transparent: true,opacity:0.1}),
              new THREE.MeshPhongMaterial({
              color: "grey",transparent: true,opacity:0.7,side:THREE.DoubleSide,depthWrite:false
              } )
          ];


          var step_2_face_1 = THREE.SceneUtils.createMultiMaterialObject(geom_step_21, material_step_21);
        //          var material_step_3 = new THREE.MeshPhongMaterial({color: 0x009600, transparent: true, opacity:0.3, side: THREE.DoubleSide});
        //          var step_1_face_3 = new THREE.Mesh(geom,material_step_3);
          //step_group_2.add(step_2_face_1);

          var face_step_22 = [
            new THREE.Face3(0, 2, 3),
          ]
          var geom_step_22 = new THREE.Geometry();
          geom_step_22.vertices = vertices_step_21;
          geom_step_22.faces = face_step_22;
          geom_step_22.computeFaceNormals();

          var material_step_22 = [
              //new THREE.MeshLambertMaterial({color: 0x4d4dff, transparent: true}),
              new THREE.MeshBasicMaterial({color: "white", wireframe: true, transparent: true,opacity:0.1}),
              new THREE.MeshPhongMaterial({
              color: "grey",transparent: true,opacity:0.7,side:THREE.DoubleSide,depthWrite:false
              } )
          ];


          var step_2_face_2 = THREE.SceneUtils.createMultiMaterialObject(geom_step_22, material_step_22);
          //          var material_step_3 = new THREE.MeshPhongMaterial({color: 0x009600, transparent: true, opacity:0.3, side: THREE.DoubleSide});
          //          var step_1_face_3 = new THREE.Mesh(geom,material_step_3);
          //step_group_2.add(step_2_face_2);

          var face_step_23 = [
            new THREE.Face3(0, 2, 4),
          ]
          var geom_step_23 = new THREE.Geometry();
          geom_step_23.vertices = vertices_step_21;
          geom_step_23.faces = face_step_23;
          geom_step_23.computeFaceNormals();

          var material_step_23 = [
              //new THREE.MeshLambertMaterial({color: 0x4d4dff, transparent: true}),
              new THREE.MeshBasicMaterial({color: "white", wireframe: true, transparent: true,opacity:0.1}),
              new THREE.MeshPhongMaterial({
              color: "grey",transparent: true,opacity:0.7,side:THREE.DoubleSide,depthWrite:false
              } )
          ];


          var step_2_face_3 = THREE.SceneUtils.createMultiMaterialObject(geom_step_23, material_step_23);
          //          var material_step_3 = new THREE.MeshPhongMaterial({color: 0x009600, transparent: true, opacity:0.3, side: THREE.DoubleSide});
          //          var step_1_face_3 = new THREE.Mesh(geom,material_step_3);
        //  step_group_2.add(step_2_face_3);

          var points4 = [
            Point_step_2_1,
            Point_step_2_12,
            Point_step_2_13,
          ];

          var radius = 0.01;
          var smoothness = 12;

          var geom4 = roundedCornerLine(points4, radius, smoothness, true);
          var line4 = new THREE.Line(geom4, new THREE.LineDashedMaterial({
                           color: "black",//color
                           dashSize: 0.1,
                          gapSize: 0.03,
                          linewidth: 1

                           }));
          line4.computeLineDistances();
        //  step_group_2.add(line4);

          var points5 = [
            Point_step_2_1,
            Point_step_2_12,
            Point_step_2_14,
          ];

          var radius = 0.01;
          var smoothness = 12;

          var geom5 = roundedCornerLine(points5, radius, smoothness, true);
          var line5 = new THREE.Line(geom5, new THREE.LineDashedMaterial({
                           color: "black",//color
                           dashSize: 0.1,
                          gapSize: 0.03,
                          linewidth: 1

                           }));
          line5.computeLineDistances();
          //step_group_2.add(line5);

          var points6 = [
            Point_step_2_12,
            Point_step_2_13,
            Point_step_2_14,
          ];

          var radius = 0.02;
          var smoothness = 12;

          var geom6 = roundedCornerLine(points6, radius, smoothness, true);
          var line6 = new THREE.Line(geom6, new THREE.LineDashedMaterial({
                           color: "black",//color
                           dashSize: 0.1,
                          gapSize: 0.03,
                          linewidth: 1

                           }));
          line6.computeLineDistances();
          //step_group_2.add(line6);


                //


                var SphereTest5 = new THREE.Sphere(new THREE.Vector3(0,0,0),0.7);
                var PointClose4 = SphereTest5.clampPoint(TubePoints1[1]);

                var SphereTest6 = new THREE.Sphere(new THREE.Vector3(0,0,0),0.45);
                var PointClose5 = SphereTest6.clampPoint(TubePoints1[1]);
                var tubeMesh_apply_2=createCylinderMesh(PointClose4,PointClose5,arrow_apply_1,0.01,0.01);
                //Tube_group.add(tubeMesh_apply_2);

                var SphereTest7 = new THREE.Sphere(new THREE.Vector3(0,0,0),0.4);
                var PointClose6 = SphereTest7.clampPoint(TubePoints1[1]);

                var SphereTest8 = new THREE.Sphere(new THREE.Vector3(0,0,0),0.1);
                var PointClose7 = SphereTest8.clampPoint(TubePoints1[1]);
                var tubeMesh_apply_3=createCylinderMesh(PointClose6,PointClose7,arrow_apply_1,0.01,0.01);
                //Tube_group.add(tubeMesh_apply_3);



                //mesh sphere1scene.remove(tubeMesh1);

                // var material = new THREE.MeshBasicMaterial({color: 0xff0000, transparent: false});
                var material2 = new THREE.MeshPhongMaterial({color: "white", transparent: true, opacity:0.5});

                var spGeom1 = new THREE.SphereGeometry(0.015);
                var sp_tube1 = new THREE.Mesh(spGeom1, material2);




                 sp_tube1.position.copy(TubePoints1[1]);

                 sp_tube1.castShadow=false;

                 sp_tube1.name="sp1";//name

              // add the points as a group to the scene

                 Tube_group.add(sp_tube1);

                 Ctrl_pts.push(sp_tube1);

                var outlineMaterial3 = new THREE.MeshBasicMaterial( { color: "black", transparent: false, side: THREE.BackSide } );
                  var outlineMesh3 = new THREE.Mesh( spGeom0, outlineMaterial3 );
                  outlineMesh3.position.copy(TubePoints1[1]);
                  outlineMesh3.scale.multiplyScalar(0.3);
                  Tube_group.add( outlineMesh3 );



                var tubeMesh1=createCylinderMesh(TubePoints1[0],TubePoints1[1],lattice_line_material,0.02,0.02);
                tubeMesh1.castShadow=true;
                tubeMesh1.name="tb1";
                Ctrl_tubes.push(tubeMesh1);



                var tpoints = [];
                tpoints.push(TubePoints1[0]);
                tpoints.push(TubePoints1[1]);

                var dgeo = new THREE.Geometry().setFromPoints( tpoints );
                var dashline1 = new THREE.LineDashedMaterial({
                                 color: "black",//color
                                 dashSize: 0.2,
                                gapSize: 0.03,
                                linewidth: 1

                                 });

                var Dashl = new THREE.LineSegments(dgeo,dashline1);
                Dashl.computeLineDistances();//compute

          //      Tube_group.add(tubeMesh1);
          //        Tube_group.add(Dashl);

                var arrow_material1=new THREE.MeshPhongMaterial( {
                color: 0x009600
                } );

                var arrow_material_outline = new THREE.MeshBasicMaterial( { color: "white", transparent: false, side: THREE.BackSide } );


                //arrow

                if(TubePoints1[1].z>=0)//p or t

                var tube_arrow1=createCylinderArrowMesh(new THREE.Vector3(1.4*TubePoints1[1].x,1.4*TubePoints1[1].y,1.4*TubePoints1[1].z),TubePoints1[1],arrow_material1,0.02,0.05,0.6);
            else
                var tube_arrow1=createCylinderArrowMesh(TubePoints1[1],new THREE.Vector3(1.4*TubePoints1[1].x,1.4*TubePoints1[1].y,1.4*TubePoints1[1].z),arrow_material1,0.02,0.05,0.6);

                Tube_group.add(tube_arrow1);

                if(TubePoints1[1].z>=0)//p or t

                var tube_arrow12=createCylinderArrowMesh(new THREE.Vector3(1.37*TubePoints1[1].x,1.37*TubePoints1[1].y,1.37*TubePoints1[1].z),TubePoints1[1],arrow_material_outline,0.023,0.05,0.55);
            else
                var tube_arrow12=createCylinderArrowMesh(TubePoints1[1],new THREE.Vector3(1.37*TubePoints1[1].x,1.37*TubePoints1[1].y,1.37*TubePoints1[1].z),arrow_material_outline,0.023,0.05,0.55);

                Tube_group.add(tube_arrow12);
                tube_arrow12.scale.multiplyScalar(1.2);


                //mesh sphere2

                var material3 = new THREE.MeshPhongMaterial({color: "white", transparent: true, opacity:0.5});

                var spGeom2 = new THREE.SphereGeometry(0.022);
                 var sp_tube2 = new THREE.Mesh(spGeom2, material3);
                 sp_tube2.position.copy(TubePoints2[1]);
            // add the points as a group to the scene
                 sp_tube2.name="sp2";//name
                 Ctrl_pts.push(sp_tube2);
                 Tube_group.add(sp_tube2);
                  sp_tube2.castShadow=false;

                  var outlineMaterial2 = new THREE.MeshBasicMaterial( { color: "black", transparent: false, side: THREE.BackSide } );
                    var outlineMesh2 = new THREE.Mesh( spGeom0, outlineMaterial2 );
                    outlineMesh2.position.copy(TubePoints2[1]);
                    outlineMesh2.scale.multiplyScalar(0.6);
                    Tube_group.add( outlineMesh2 );



                //arrow

                if(arr_direction[0]>=0)//p or t
                {
                  P_A_Right=Pnt_copy(P_A);
                  P_B_Right=Pnt_copy(P_B);
                  P_C_Right=Pnt_copy(P_C);
                  P_D_Right=Pnt_copy(P_D);


                  var vertices = [
                      P_A_Right,P_B_Right,P_C_Right,P_D_Right
                  ];

                  var face_bar_1 = [
                    new THREE.Face3(0, 2, 3),
                  ]
                  var face_bar_2 = [
                    new THREE.Face3(0, 1, 3),
                  ]
                  var face_bar_3 = [
                    new THREE.Face3(1, 2, 3),
                  ]

                  var face_bar_1_area = new THREE.Vector3().crossVectors(
                  new THREE.Vector3().subVectors( P_C_Right, P_A_Right ),
                  new THREE.Vector3().subVectors( P_D_Right, P_A_Right ),
                  ).length()/2

                  var face_bar_2_area = new THREE.Vector3().crossVectors(
                  new THREE.Vector3().subVectors( P_B_Right, P_A_Right ),
                  new THREE.Vector3().subVectors( P_D_Right, P_A_Right ),
                  ).length()/2

                  var face_bar_3_area = new THREE.Vector3().crossVectors(
                  new THREE.Vector3().subVectors( P_C_Right, P_B_Right ),
                  new THREE.Vector3().subVectors( P_D_Right, P_B_Right ),
                  ).length()/2

                  var max = Math.max(face_bar_1_area, face_bar_2_area, face_bar_3_area)
                  var tubeMesh2_p1 = face_bar_1_area/max;

                  tt = 0.5*tubethick.v*face_bar_1_area;

                  if (tubeMesh2_p1<0.25 & tubeMesh2_p1>=0)
                    { var Colorbar_blue_1 = new THREE.MeshPhongMaterial( {
                                        color: 0x5B84AE
                                    } );
                   var SphereTest3_Geo = new THREE.SphereGeometry(tt-0.001);
                   var SphereTest3_SP = new THREE.Mesh(SphereTest3_Geo, Colorbar_blue_1);
                   var tubeMesh2=createCylinderMesh(TubePoints2[1],PointClose2,Colorbar_blue_1,tt,tt);
                   var tube_arrow2=createCylinderArrowMesh(new THREE.Vector3(1.22*TubePoints2[1].x,1.22*TubePoints2[1].y,1.22*TubePoints2[1].z) ,TubePoints2[1],Colorbar_blue_1,0.02,0.05,0.6);
                                  }
                  if (tubeMesh2_p1<0.5 & tubeMesh2_p1>=0.25)
                  {  var Colorbar_blue_2 = new THREE.MeshPhongMaterial( {
                                        color: 0x376D9B
                                    } );
                   var SphereTest3_Geo = new THREE.SphereGeometry(tt-0.001);
                   var SphereTest3_SP = new THREE.Mesh(SphereTest3_Geo, Colorbar_blue_2);
                   var tubeMesh2=createCylinderMesh(TubePoints2[1],PointClose2,Colorbar_blue_2,tt,tt);
                   var tube_arrow2=createCylinderArrowMesh(new THREE.Vector3(1.22*TubePoints2[1].x,1.22*TubePoints2[1].y,1.22*TubePoints2[1].z) ,TubePoints2[1],Colorbar_blue_2,0.02,0.05,0.6);
                                  }
                  if (tubeMesh2_p1<0.75 & tubeMesh2_p1>=0.5)
                  {  var Colorbar_blue_3 = new THREE.MeshPhongMaterial( {
                                        color: 0x05416D
                                    } );
                   var SphereTest3_Geo = new THREE.SphereGeometry(tt-0.001);
                   var SphereTest3_SP = new THREE.Mesh(SphereTest3_Geo, Colorbar_blue_3);
                   var tubeMesh2=createCylinderMesh(TubePoints2[1],PointClose2,Colorbar_blue_3,tt,tt);
                   var tube_arrow2=createCylinderArrowMesh(new THREE.Vector3(1.22*TubePoints2[1].x,1.22*TubePoints2[1].y,1.22*TubePoints2[1].z) ,TubePoints2[1],Colorbar_blue_3,0.02,0.05,0.6);
                  }

                  if (tubeMesh2_p1>=0.75)
                  {  var Colorbar_blue_4 = new THREE.MeshPhongMaterial( {
                                        color: 0x0F3150
                                    } );
                   var SphereTest3_Geo = new THREE.SphereGeometry(tt-0.001);
                   var SphereTest3_SP = new THREE.Mesh(SphereTest3_Geo, Colorbar_blue_4);
                   var tubeMesh2=createCylinderMesh(TubePoints2[1],PointClose2,Colorbar_blue_4,tt,tt);
                   var tube_arrow2=createCylinderArrowMesh(new THREE.Vector3(1.22*TubePoints2[1].x,1.22*TubePoints2[1].y,1.22*TubePoints2[1].z) ,TubePoints2[1],Colorbar_blue_4,0.02,0.05,0.6);
                  }
  //                var tubeMesh2=createCylinderMesh(new THREE.Vector3(TubePoints2[0].x+0.05,TubePoints2[0].y-0.05,TubePoints2[0].z-0.05) ,TubePoints2[1],Colorbar_blue,tt,tt);

  //                var tube_arrow2=createCylinderArrowMesh(new THREE.Vector3(1.22*TubePoints2[1].x,1.22*TubePoints2[1].y,1.22*TubePoints2[1].z) ,TubePoints2[1],arrow_material,0.02,0.05,0.6);

              }
              else
              {
                P_A_Right=Pnt_copy(P_A);
                P_B_Right=Pnt_copy(P_B);
                P_C_Right=Pnt_copy(P_C);
                P_D_Right=Pnt_copy(P_D);


                var vertices = [
                    P_A_Right,P_B_Right,P_C_Right,P_D_Right
                ];

                var face_bar_1 = [
                  new THREE.Face3(0, 2, 3),
                ]
                var face_bar_2 = [
                  new THREE.Face3(0, 1, 3),
                ]
                var face_bar_3 = [
                  new THREE.Face3(1, 2, 3),
                ]

                var face_bar_1_area = new THREE.Vector3().crossVectors(
                new THREE.Vector3().subVectors( P_C_Right, P_A_Right ),
                new THREE.Vector3().subVectors( P_D_Right, P_A_Right ),
                ).length()/2

                var face_bar_2_area = new THREE.Vector3().crossVectors(
                new THREE.Vector3().subVectors( P_B_Right, P_A_Right ),
                new THREE.Vector3().subVectors( P_D_Right, P_A_Right ),
                ).length()/2

                var face_bar_3_area = new THREE.Vector3().crossVectors(
                new THREE.Vector3().subVectors( P_C_Right, P_B_Right ),
                new THREE.Vector3().subVectors( P_D_Right, P_B_Right ),
                ).length()/2

                var max = Math.max(face_bar_1_area, face_bar_2_area, face_bar_3_area)
                var tubeMesh2_t1 = face_bar_1_area/max;

                tt = 0.5*tubethick.v*face_bar_1_area;

                if (tubeMesh2_t1<0.25 & tubeMesh2_t1>=0)
                  { var Colorbar_red_1 = new THREE.MeshPhongMaterial( {
                                      color: 0xD72F62
                                  } );
                 var SphereTest3_Geo = new THREE.SphereGeometry(tt-0.001);
                 var SphereTest3_SP = new THREE.Mesh(SphereTest3_Geo, Colorbar_red_1);
                 var tubeMesh2=createCylinderMesh(TubePoints2[1],PointClose2,Colorbar_red_1,tt,tt);
                 var tube_arrow2=createCylinderArrowMesh(TubePoints2[1],new THREE.Vector3(1.22*TubePoints2[1].x,1.22*TubePoints2[1].y,1.22*TubePoints2[1].z),Colorbar_red_1,0.02,0.05,0.6);
                                }
                if (tubeMesh2_t1<0.5 & tubeMesh2_t1>=0.25)
                {  var Colorbar_red_2 = new THREE.MeshPhongMaterial( {
                                      color: 0xCC0549
                                  } );
                 var SphereTest3_Geo = new THREE.SphereGeometry(tt-0.001);
                 var SphereTest3_SP = new THREE.Mesh(SphereTest3_Geo, Colorbar_red_2);
                 var tubeMesh2=createCylinderMesh(TubePoints2[1],PointClose2,Colorbar_red_2,tt,tt);
                 var tube_arrow2=createCylinderArrowMesh(TubePoints2[1],new THREE.Vector3(1.22*TubePoints2[1].x,1.22*TubePoints2[1].y,1.22*TubePoints2[1].z),Colorbar_red_2,0.02,0.05,0.6);
                                }
                if (tubeMesh2_t1<0.75 & tubeMesh2_t1>=0.5)
                {  var Colorbar_red_3 = new THREE.MeshPhongMaterial( {
                                      color: 0x940041
                                  } );
                 var SphereTest3_Geo = new THREE.SphereGeometry(tt-0.001);
                 var SphereTest3_SP = new THREE.Mesh(SphereTest3_Geo, Colorbar_red_3);
                 var tubeMesh2=createCylinderMesh(TubePoints2[1],PointClose2,Colorbar_red_3,tt,tt);
                 var tube_arrow2=createCylinderArrowMesh(TubePoints2[1],new THREE.Vector3(1.22*TubePoints2[1].x,1.22*TubePoints2[1].y,1.22*TubePoints2[1].z),Colorbar_red_3,0.02,0.05,0.6);
                }

                if (tubeMesh2_t1>=0.75)
                {  var Colorbar_red_4 = new THREE.MeshPhongMaterial( {
                                      color: 0x80002F
                                  } );
                 var SphereTest3_Geo = new THREE.SphereGeometry(tt-0.001);
                 var SphereTest3_SP = new THREE.Mesh(SphereTest3_Geo, Colorbar_red_4);
                 var tubeMesh2=createCylinderMesh(TubePoints2[1],PointClose2,Colorbar_red_4,tt,tt);
                 var tube_arrow2=createCylinderArrowMesh(TubePoints2[1],new THREE.Vector3(1.22*TubePoints2[1].x,1.22*TubePoints2[1].y,1.22*TubePoints2[1].z),Colorbar_red_4,0.02,0.05,0.6);
                }

  //              var tubeMesh2=createCylinderMesh(new THREE.Vector3(TubePoints2[0].x-0.05,TubePoints2[0].y+0.05,TubePoints2[0].z+0.05) ,TubePoints2[1],Colorbar_red1,tt,tt);
  //              var tube_arrow2=createCylinderArrowMesh(TubePoints2[1],new THREE.Vector3(1.22*TubePoints2[1].x,1.22*TubePoints2[1].y,1.22*TubePoints2[1].z),arrow_material2,0.02,0.05,0.6);
              }
              tubeMesh2.castShadow=true;
              tubeMesh2.name="tb2";
              Ctrl_tubes.push(tubeMesh2);
              SphereTest3_SP.position.copy(PointClose2);

              Tube_group.add(tubeMesh2);
              Tube_group.add(tube_arrow2);
              Tube_group.add(SphereTest3_SP);

                if(arr_direction[0]>=0)//p or t

                var tube_arrow22=createCylinderArrowMesh(new THREE.Vector3(1.2*TubePoints2[1].x,1.2*TubePoints2[1].y,1.2*TubePoints2[1].z) ,TubePoints2[1],arrow_material_outline,0.023,0.05,0.54);

            else
                var tube_arrow22=createCylinderArrowMesh(TubePoints2[1],new THREE.Vector3(1.2*TubePoints2[1].x,1.2*TubePoints2[1].y,1.2*TubePoints2[1].z),arrow_material_outline,0.023,0.055,0.62);

              //  Tube_group.add(tube_arrow22);
                tube_arrow22.scale.multiplyScalar(1.2);

                //mesh sphere3

                var material4 = new THREE.MeshPhongMaterial({color: "white", transparent: true, opacity:0.5});

                var spGeom3 = new THREE.SphereGeometry(0.015);
                var sp_tube3 = new THREE.Mesh(spGeom3, material4);
                 sp_tube3.position.copy(TubePoints3[1]);
                 sp_tube3.name="sp3";//name
            // add the points as a group to the scene
                 Ctrl_pts.push(sp_tube3);
                 Tube_group.add(sp_tube3);
                 sp_tube3.castShadow=false;

                 var outlineMaterial4 = new THREE.MeshBasicMaterial( { color: "black", transparent: false, side: THREE.BackSide } );
                   var outlineMesh4 = new THREE.Mesh( spGeom0, outlineMaterial4 );
                   outlineMesh4.position.copy(TubePoints3[1]);
                   outlineMesh4.scale.multiplyScalar(0.6);
                   Tube_group.add( outlineMesh4 );

                   var SphereTest = new THREE.Sphere(new THREE.Vector3(0,0,0),0.07);
                   var PointClose1_2 = SphereTest.clampPoint(TubePoints3[1]);
                   var SphereTest2_2 = new THREE.Sphere(PointClose1_2,0.05);
                   var PointClose2_2 = SphereTest2_2.clampPoint(TubePoints3[1]);
                   var SphereTest3_2 = new THREE.Sphere(PointClose2_2,0.045);

                //arrow

                if(arr_direction[1]>=0){

                  P_A_Right=Pnt_copy(P_A);
                  P_B_Right=Pnt_copy(P_B);
                  P_C_Right=Pnt_copy(P_C);
                  P_D_Right=Pnt_copy(P_D);


                  var vertices = [
                      P_A_Right,P_B_Right,P_C_Right,P_D_Right
                  ];

                  var face_bar_1 = [
                    new THREE.Face3(0, 2, 3),
                  ]
                  var face_bar_2 = [
                    new THREE.Face3(0, 1, 3),
                  ]
                  var face_bar_3 = [
                    new THREE.Face3(1, 2, 3),
                  ]

                  var face_bar_1_area = new THREE.Vector3().crossVectors(
                  new THREE.Vector3().subVectors( P_C_Right, P_A_Right ),
                  new THREE.Vector3().subVectors( P_D_Right, P_A_Right ),
                  ).length()/2

                  var face_bar_2_area = new THREE.Vector3().crossVectors(
                  new THREE.Vector3().subVectors( P_B_Right, P_A_Right ),
                  new THREE.Vector3().subVectors( P_D_Right, P_A_Right ),
                  ).length()/2

                  var face_bar_3_area = new THREE.Vector3().crossVectors(
                  new THREE.Vector3().subVectors( P_C_Right, P_B_Right ),
                  new THREE.Vector3().subVectors( P_D_Right, P_B_Right ),
                  ).length()/2

                  var max = Math.max(face_bar_1_area, face_bar_2_area, face_bar_3_area)
                  var tubeMesh3_p2 = face_bar_2_area/max;
                  tt = 0.5*tubethick.v*face_bar_2_area;

                  if (tubeMesh3_p2<0.25 & tubeMesh3_p2>=0)
                    { var Colorbar_blue_1 = new THREE.MeshPhongMaterial( {
                                        color: 0x5B84AE
                                    } );
                   var SphereTest3_Geo = new THREE.SphereGeometry(tt-0.001);
                   var SphereTest3_SP_2 = new THREE.Mesh(SphereTest3_Geo, Colorbar_blue_1);
                   var tubeMesh3=createCylinderMesh(TubePoints3[1],PointClose2_2,Colorbar_blue_1,tt,tt);
                   var tube_arrow3=createCylinderArrowMesh(new THREE.Vector3(1.22*TubePoints3[1].x,1.22*TubePoints3[1].y,1.22*TubePoints3[1].z) ,TubePoints3[1],Colorbar_blue_1,0.02,0.05,0.6);
                                  }
                  if (tubeMesh3_p2<0.5 & tubeMesh3_p2>=0.25)
                  {  var Colorbar_blue_2 = new THREE.MeshPhongMaterial( {
                                        color: 0x376D9B
                                    } );
                  var SphereTest3_Geo = new THREE.SphereGeometry(tt-0.001);
                  var SphereTest3_SP_2 = new THREE.Mesh(SphereTest3_Geo, Colorbar_blue_2);
                  var tubeMesh3=createCylinderMesh(TubePoints3[1],PointClose2_2,Colorbar_blue_2,tt,tt);
                   var tube_arrow3=createCylinderArrowMesh(new THREE.Vector3(1.22*TubePoints3[1].x,1.22*TubePoints3[1].y,1.22*TubePoints3[1].z) ,TubePoints3[1],Colorbar_blue_2,0.02,0.05,0.6);
                                  }
                  if (tubeMesh3_p2<0.75 & tubeMesh3_p2>=0.5)
                  {  var Colorbar_blue_3 = new THREE.MeshPhongMaterial( {
                                        color: 0x05416D
                                    } );
                  var SphereTest3_Geo = new THREE.SphereGeometry(tt-0.001);
                  var SphereTest3_SP_2 = new THREE.Mesh(SphereTest3_Geo, Colorbar_blue_3);
                  var tubeMesh3=createCylinderMesh(TubePoints3[1],PointClose2_2,Colorbar_blue_3,tt,tt);
                   var tube_arrow3=createCylinderArrowMesh(new THREE.Vector3(1.22*TubePoints3[1].x,1.22*TubePoints3[1].y,1.22*TubePoints3[1].z) ,TubePoints3[1],Colorbar_blue_3,0.02,0.05,0.6);
                  }

                  if (tubeMesh3_p2>=0.75)
                  {  var Colorbar_blue_4 = new THREE.MeshPhongMaterial( {
                                        color: 0x0F3150
                                    } );
                  var SphereTest3_Geo = new THREE.SphereGeometry(tt-0.001);
                  var SphereTest3_SP_2 = new THREE.Mesh(SphereTest3_Geo, Colorbar_blue_4);
                  var tubeMesh3=createCylinderMesh(TubePoints3[1],PointClose2_2,Colorbar_blue_4,tt,tt);
                   var tube_arrow3=createCylinderArrowMesh(new THREE.Vector3(1.22*TubePoints3[1].x,1.22*TubePoints3[1].y,1.22*TubePoints3[1].z) ,TubePoints3[1],Colorbar_blue_4,0.02,0.05,0.6);
                  }

  //                var tubeMesh3=createCylinderMesh(new THREE.Vector3(TubePoints3[0].x-0.07,TubePoints3[0].y-0.03,TubePoints3[0].z-0.03) ,TubePoints3[1],Colorbar_blue1,tt,tt);
  //                var tube_arrow3=createCylinderArrowMesh(new THREE.Vector3(1.22*TubePoints3[1].x,1.22*TubePoints3[1].y,1.22*TubePoints3[1].z) ,TubePoints3[1],arrow_material,0.02,0.05,0.6);
              }
              else
              {

                P_A_Right=Pnt_copy(P_A);
                P_B_Right=Pnt_copy(P_B);
                P_C_Right=Pnt_copy(P_C);
                P_D_Right=Pnt_copy(P_D);


                var vertices = [
                    P_A_Right,P_B_Right,P_C_Right,P_D_Right
                ];

                var face_bar_1 = [
                  new THREE.Face3(0, 2, 3),
                ]
                var face_bar_2 = [
                  new THREE.Face3(0, 1, 3),
                ]
                var face_bar_3 = [
                  new THREE.Face3(1, 2, 3),
                ]

                var face_bar_1_area = new THREE.Vector3().crossVectors(
                new THREE.Vector3().subVectors( P_C_Right, P_A_Right ),
                new THREE.Vector3().subVectors( P_D_Right, P_A_Right ),
                ).length()/2

                var face_bar_2_area = new THREE.Vector3().crossVectors(
                new THREE.Vector3().subVectors( P_B_Right, P_A_Right ),
                new THREE.Vector3().subVectors( P_D_Right, P_A_Right ),
                ).length()/2

                var face_bar_3_area = new THREE.Vector3().crossVectors(
                new THREE.Vector3().subVectors( P_C_Right, P_B_Right ),
                new THREE.Vector3().subVectors( P_D_Right, P_B_Right ),
                ).length()/2

                var max = Math.max(face_bar_1_area, face_bar_2_area, face_bar_3_area)
                var tubeMesh3_t2 = face_bar_2_area/max;
                tt = 0.5*tubethick.v*face_bar_2_area;

                if (tubeMesh3_t2<0.25 & tubeMesh3_t2>=0)
                  { var Colorbar_red_1 = new THREE.MeshPhongMaterial( {
                                      color: 0xD72F62
                                  } );
                                  var SphereTest3_Geo = new THREE.SphereGeometry(tt-0.001);
                                  var SphereTest3_SP_2 = new THREE.Mesh(SphereTest3_Geo, Colorbar_red_1);
                                  var tubeMesh3=createCylinderMesh(TubePoints3[1],PointClose2_2,Colorbar_red_1,tt,tt);
                 var tube_arrow3=createCylinderArrowMesh(TubePoints3[1],new THREE.Vector3(1.22*TubePoints3[1].x,1.22*TubePoints3[1].y,1.22*TubePoints3[1].z),Colorbar_red_1,0.02,0.05,0.6);
                                }
                if (tubeMesh3_t2<0.5 & tubeMesh3_t2>=0.25)
                {  var Colorbar_red_2 = new THREE.MeshPhongMaterial( {
                                      color: 0xCC0549
                                  } );
                                  var SphereTest3_Geo = new THREE.SphereGeometry(tt-0.001);
                                  var SphereTest3_SP_2 = new THREE.Mesh(SphereTest3_Geo, Colorbar_red_2);
                                  var tubeMesh3=createCylinderMesh(TubePoints3[1],PointClose2_2,Colorbar_red_2,tt,tt);
                 var tube_arrow3=createCylinderArrowMesh(TubePoints3[1],new THREE.Vector3(1.22*TubePoints3[1].x,1.22*TubePoints3[1].y,1.22*TubePoints3[1].z),Colorbar_red_2,0.02,0.05,0.6);
                                }
                if (tubeMesh3_t2<0.75 & tubeMesh3_t2>=0.5)
                {  var Colorbar_red_3 = new THREE.MeshPhongMaterial( {
                                      color: 0x940041
                                  } );
                                  var SphereTest3_Geo = new THREE.SphereGeometry(tt-0.001);
                                  var SphereTest3_SP_2 = new THREE.Mesh(SphereTest3_Geo, Colorbar_red_3);
                                  var tubeMesh3=createCylinderMesh(TubePoints3[1],PointClose2_2,Colorbar_red_3,tt,tt);
                 var tube_arrow3=createCylinderArrowMesh(TubePoints3[1],new THREE.Vector3(1.22*TubePoints3[1].x,1.22*TubePoints3[1].y,1.22*TubePoints3[1].z),Colorbar_red_3,0.02,0.05,0.6);
                }

                if (tubeMesh3_t2>=0.75)
                {  var Colorbar_red_4 = new THREE.MeshPhongMaterial( {
                                      color: 0x80002F
                                  } );
                                  var SphereTest3_Geo = new THREE.SphereGeometry(tt-0.001);
                                  var SphereTest3_SP_2 = new THREE.Mesh(SphereTest3_Geo, Colorbar_red_4);
                                  var tubeMesh3=createCylinderMesh(TubePoints3[1],PointClose2_2,Colorbar_red_4,tt,tt);
                 var tube_arrow3=createCylinderArrowMesh(TubePoints3[1],new THREE.Vector3(1.22*TubePoints3[1].x,1.22*TubePoints3[1].y,1.22*TubePoints3[1].z),Colorbar_red_4,0.02,0.05,0.6);
                }

//                var tubeMesh3=createCylinderMesh(new THREE.Vector3(TubePoints3[0].x+0.07,TubePoints3[0].y+0.03,TubePoints3[0].z+0.03),TubePoints3[1],Colorbar_red1,tt,tt);
//                var tube_arrow3=createCylinderArrowMesh(TubePoints3[1],new THREE.Vector3(1.22*TubePoints3[1].x,1.22*TubePoints3[1].y,1.22*TubePoints3[1].z),arrow_material2,0.02,0.05,0.6);
              }

              tubeMesh3.castShadow=true;
              tubeMesh3.name="tb3";
              Ctrl_tubes.push(tubeMesh3);
              SphereTest3_SP_2.position.copy(PointClose2_2);

              Tube_group.add(tubeMesh3);
              Tube_group.add(tube_arrow3);
              Tube_group.add(SphereTest3_SP_2);

                if(arr_direction[1]>=0)

                var tube_arrow32=createCylinderArrowMesh(new THREE.Vector3(1.2*TubePoints3[1].x,1.2*TubePoints3[1].y,1.2*TubePoints3[1].z) ,TubePoints3[1],arrow_material_outline,0.023,0.05,0.54);
            else
                var tube_arrow32=createCylinderArrowMesh(TubePoints3[1],new THREE.Vector3(1.2*TubePoints3[1].x,1.2*TubePoints3[1].y,1.2*TubePoints3[1].z),arrow_material_outline,0.023,0.055,0.62);

             //   Tube_group.add(tube_arrow32);
                tube_arrow32.scale.multiplyScalar(1.2);

                //mesh sphere4
                var material5 = new THREE.MeshPhongMaterial({color: "white", transparent: true, opacity:0.5});

                var spGeom4 = new THREE.SphereGeometry(0.015);
                var sp_tube4= new THREE.Mesh(spGeom4, material5);
                 sp_tube4.position.copy(TubePoints4[1]);
                 sp_tube4.castShadow=false;

                 sp_tube4.name="sp4";//name
                 Ctrl_pts.push(sp_tube4);
            // add the points as a group to the scene
                 Tube_group.add(sp_tube4);

                 var outlineMaterial5 = new THREE.MeshBasicMaterial( { color: "black", transparent: false, side: THREE.BackSide } );
                   var outlineMesh5 = new THREE.Mesh( spGeom0, outlineMaterial5 );
                   outlineMesh5.position.copy(TubePoints4[1]);
                   outlineMesh5.scale.multiplyScalar(0.6);
                   Tube_group.add( outlineMesh5 );

                   var SphereTest = new THREE.Sphere(new THREE.Vector3(0,0,0),0.07);
                   var PointClose1_3 = SphereTest.clampPoint(TubePoints4[1]);
                   var SphereTest2_3 = new THREE.Sphere(PointClose1_3,0.05);
                   var PointClose2_3 = SphereTest2_3.clampPoint(TubePoints4[1]);
                   var SphereTest3_3 = new THREE.Sphere(PointClose2_3,0.045);

                //arrow

                if(arr_direction[2]>=0){
                  P_A_Right=Pnt_copy(P_A);
                  P_B_Right=Pnt_copy(P_B);
                  P_C_Right=Pnt_copy(P_C);
                  P_D_Right=Pnt_copy(P_D);


                  var vertices = [
                      P_A_Right,P_B_Right,P_C_Right,P_D_Right
                  ];

                  var face_bar_1 = [
                    new THREE.Face3(0, 2, 3),
                  ]
                  var face_bar_2 = [
                    new THREE.Face3(0, 1, 3),
                  ]
                  var face_bar_3 = [
                    new THREE.Face3(1, 2, 3),
                  ]

                  var face_bar_1_area = new THREE.Vector3().crossVectors(
                  new THREE.Vector3().subVectors( P_C_Right, P_A_Right ),
                  new THREE.Vector3().subVectors( P_D_Right, P_A_Right ),
                  ).length()/2

                  var face_bar_2_area = new THREE.Vector3().crossVectors(
                  new THREE.Vector3().subVectors( P_B_Right, P_A_Right ),
                  new THREE.Vector3().subVectors( P_D_Right, P_A_Right ),
                  ).length()/2

                  var face_bar_3_area = new THREE.Vector3().crossVectors(
                  new THREE.Vector3().subVectors( P_C_Right, P_B_Right ),
                  new THREE.Vector3().subVectors( P_D_Right, P_B_Right ),
                  ).length()/2

                  var max = Math.max(face_bar_1_area, face_bar_2_area, face_bar_3_area)
                  var tubeMesh4_p3 = face_bar_3_area/max;
                  tt = 0.5*tubethick.v*face_bar_3_area;

                  if (tubeMesh4_p3<0.25 & tubeMesh4_p3>=0)
                    { var Colorbar_blue_1 = new THREE.MeshPhongMaterial( {
                                        color: 0x5B84AE
                                    } );
                  var SphereTest3_Geo = new THREE.SphereGeometry(tt-0.001);
                  var SphereTest3_SP_3 = new THREE.Mesh(SphereTest3_Geo, Colorbar_blue_1);
                  var tubeMesh4=createCylinderMesh(TubePoints4[1],PointClose2_3,Colorbar_blue_1,tt,tt);
                   var tube_arrow4=createCylinderArrowMesh(new THREE.Vector3(1.22*TubePoints4[1].x,1.22*TubePoints4[1].y,1.22*TubePoints4[1].z) ,TubePoints4[1],Colorbar_blue_1,0.02,0.05,0.6);
                                  }
                  if (tubeMesh4_p3<0.5 & tubeMesh4_p3>=0.25)
                  {  var Colorbar_blue_2 = new THREE.MeshPhongMaterial( {
                                        color: 0x376D9B
                                    } );
                   var SphereTest3_Geo = new THREE.SphereGeometry(tt-0.001);
                   var SphereTest3_SP_3 = new THREE.Mesh(SphereTest3_Geo, Colorbar_blue_2);
                   var tubeMesh4=createCylinderMesh(TubePoints4[1],PointClose2_3,Colorbar_blue_2,tt,tt);
                   var tube_arrow4=createCylinderArrowMesh(new THREE.Vector3(1.22*TubePoints4[1].x,1.22*TubePoints4[1].y,1.22*TubePoints4[1].z) ,TubePoints4[1],Colorbar_blue_2,0.02,0.05,0.6);
                                  }
                  if (tubeMesh4_p3<0.75 & tubeMesh4_p3>=0.5)
                  {  var Colorbar_blue_3 = new THREE.MeshPhongMaterial( {
                                        color: 0x05416D
                                    } );
                   var SphereTest3_Geo = new THREE.SphereGeometry(tt-0.001);
                   var SphereTest3_SP_3 = new THREE.Mesh(SphereTest3_Geo, Colorbar_blue_3);
                   var tubeMesh4=createCylinderMesh(TubePoints4[1],PointClose2_3,Colorbar_blue_3,tt,tt);
                   var tube_arrow4=createCylinderArrowMesh(new THREE.Vector3(1.22*TubePoints4[1].x,1.22*TubePoints4[1].y,1.22*TubePoints4[1].z) ,TubePoints4[1],Colorbar_blue_3,0.02,0.05,0.6);
                  }

                  if (tubeMesh4_p3>=0.75)
                  {  var Colorbar_blue_4 = new THREE.MeshPhongMaterial( {
                                        color: 0x0F3150
                                    } );
                   var SphereTest3_Geo = new THREE.SphereGeometry(tt-0.001);
                   var SphereTest3_SP_3 = new THREE.Mesh(SphereTest3_Geo, Colorbar_blue_4);
                   var tubeMesh4=createCylinderMesh(TubePoints4[1],PointClose2_3,Colorbar_blue_4,tt,tt);
                   var tube_arrow4=createCylinderArrowMesh(new THREE.Vector3(1.22*TubePoints4[1].x,1.22*TubePoints4[1].y,1.22*TubePoints4[1].z) ,TubePoints4[1],Colorbar_blue_4,0.02,0.05,0.6);
                  }

  //                var tubeMesh4=createCylinderMesh(new THREE.Vector3(TubePoints4[0].x+0.01,TubePoints4[0].y+0.07,TubePoints4[0].z-0.05) ,TubePoints4[1],Colorbar_blue1,tt,tt);
  //                var tube_arrow4=createCylinderArrowMesh(new THREE.Vector3(1.22*TubePoints4[1].x,1.22*TubePoints4[1].y,1.22*TubePoints4[1].z) ,TubePoints4[1],arrow_material,0.02,0.05,0.6);
                }
                else
                {
                  P_A_Right=Pnt_copy(P_A);
                  P_B_Right=Pnt_copy(P_B);
                  P_C_Right=Pnt_copy(P_C);
                  P_D_Right=Pnt_copy(P_D);


                  var vertices = [
                      P_A_Right,P_B_Right,P_C_Right,P_D_Right
                  ];

                  var face_bar_1 = [
                    new THREE.Face3(0, 2, 3),
                  ]
                  var face_bar_2 = [
                    new THREE.Face3(0, 1, 3),
                  ]
                  var face_bar_3 = [
                    new THREE.Face3(1, 2, 3),
                  ]

                  var face_bar_1_area = new THREE.Vector3().crossVectors(
                  new THREE.Vector3().subVectors( P_C_Right, P_A_Right ),
                  new THREE.Vector3().subVectors( P_D_Right, P_A_Right ),
                  ).length()/2

                  var face_bar_2_area = new THREE.Vector3().crossVectors(
                  new THREE.Vector3().subVectors( P_B_Right, P_A_Right ),
                  new THREE.Vector3().subVectors( P_D_Right, P_A_Right ),
                  ).length()/2

                  var face_bar_3_area = new THREE.Vector3().crossVectors(
                  new THREE.Vector3().subVectors( P_C_Right, P_B_Right ),
                  new THREE.Vector3().subVectors( P_D_Right, P_B_Right ),
                  ).length()/2

                  var max = Math.max(face_bar_1_area, face_bar_2_area, face_bar_3_area)
                  var tubeMesh4_t3 = face_bar_3_area/max;
                  tt = 0.5*tubethick.v*face_bar_3_area;

                  if (tubeMesh4_t3<0.25 & tubeMesh4_t3>=0)
                    { var Colorbar_red_1 = new THREE.MeshPhongMaterial( {
                                        color: 0xD72F62
                                    } );
                   var SphereTest3_Geo = new THREE.SphereGeometry(tt-0.001);
                   var SphereTest3_SP_3 = new THREE.Mesh(SphereTest3_Geo, Colorbar_red_1);
                   var tubeMesh4=createCylinderMesh(TubePoints4[1],PointClose2_3,Colorbar_red_1,tt,tt);
                   var tube_arrow4=createCylinderArrowMesh(TubePoints4[1],new THREE.Vector3(1.22*TubePoints4[1].x,1.22*TubePoints4[1].y,1.22*TubePoints4[1].z),Colorbar_red_1,0.02,0.05,0.6);
                                  }
                  if (tubeMesh4_t3<0.5 & tubeMesh4_t3>=0.25)
                  {  var Colorbar_red_2 = new THREE.MeshPhongMaterial( {
                                        color: 0xCC0549
                                    } );
                   var SphereTest3_Geo = new THREE.SphereGeometry(tt-0.001);
                   var SphereTest3_SP_3 = new THREE.Mesh(SphereTest3_Geo, Colorbar_red_2);
                   var tubeMesh4=createCylinderMesh(TubePoints4[1],PointClose2_3,Colorbar_red_2,tt,tt);
                   var tube_arrow4=createCylinderArrowMesh(TubePoints4[1],new THREE.Vector3(1.22*TubePoints4[1].x,1.22*TubePoints4[1].y,1.22*TubePoints4[1].z),Colorbar_red_2,0.02,0.05,0.6);
                                  }
                  if (tubeMesh4_t3<0.75 & tubeMesh4_t3>=0.5)
                  {  var Colorbar_red_3 = new THREE.MeshPhongMaterial( {
                                        color: 0x940041
                                    } );
                   var SphereTest3_Geo = new THREE.SphereGeometry(tt-0.001);
                   var SphereTest3_SP_3 = new THREE.Mesh(SphereTest3_Geo, Colorbar_red_3);
                   var tubeMesh4=createCylinderMesh(TubePoints4[1],PointClose2_3,Colorbar_red_3,tt,tt);
                   var tube_arrow4=createCylinderArrowMesh(TubePoints4[1],new THREE.Vector3(1.22*TubePoints4[1].x,1.22*TubePoints4[1].y,1.22*TubePoints4[1].z),Colorbar_red_3,0.02,0.05,0.6);
                  }

                  if (tubeMesh4_t3>=0.75)
                  {  var Colorbar_red_4 = new THREE.MeshPhongMaterial( {
                                        color: 0x80002F
                                    } );
                   var SphereTest3_Geo = new THREE.SphereGeometry(tt-0.001);
                   var SphereTest3_SP_3 = new THREE.Mesh(SphereTest3_Geo, Colorbar_red_4);
                   var tubeMesh4=createCylinderMesh(TubePoints4[1],PointClose2_3,Colorbar_red_4,tt,tt);
                   var tube_arrow4=createCylinderArrowMesh(TubePoints4[1],new THREE.Vector3(1.22*TubePoints4[1].x,1.22*TubePoints4[1].y,1.22*TubePoints4[1].z),Colorbar_red_4,0.02,0.05,0.6);
                  }

//                  var tubeMesh4=createCylinderMesh(new THREE.Vector3(TubePoints4[0].x-0.01,TubePoints4[0].y-0.07,TubePoints4[0].z+0.05),TubePoints4[1],Colorbar_red1,tt,tt);
//                  var tube_arrow4=createCylinderArrowMesh(TubePoints4[1],new THREE.Vector3(1.22*TubePoints4[1].x,1.22*TubePoints4[1].y,1.22*TubePoints4[1].z),arrow_material2,0.02,0.05,0.6);
                }
                tubeMesh4.castShadow=true;
                tubeMesh4.name="tb4";
                Ctrl_tubes.push(tubeMesh4);
                SphereTest3_SP_3.position.copy(PointClose2_3);

                Tube_group.add(tubeMesh4);
                Tube_group.add(tube_arrow4);
                Tube_group.add(SphereTest3_SP_3);


                if(arr_direction[2]>=0){

                    var tube_arrow42=createCylinderArrowMesh(new THREE.Vector3(1.2*TubePoints4[1].x,1.2*TubePoints4[1].y,1.2*TubePoints4[1].z) ,TubePoints4[1],arrow_material_outline,0.023,0.05,0.54);
               }
                else
                {

                    var tube_arrow42=createCylinderArrowMesh(TubePoints4[1],new THREE.Vector3(1.2*TubePoints4[1].x,1.2*TubePoints4[1].y,1.2*TubePoints4[1].z),arrow_material_outline,0.023,0.055,0.62);
               }
              //  Tube_group.add(tube_arrow42);
                tube_arrow42.scale.multiplyScalar(1.2);





                //Tube_group.geometry.center();

               // scene.add(Tube_group);
              //  scene.add(step_group_1);
                scene.add(step_group_2);
                scene.add(form_group);
                scene.add(form_trial);
                scene.add(form_closingplane);
                scene.add(form_greenfaces);
 
                scene2.add(step_group_1_1);
                scene2.add(trial_force);
                scene2.add(force_group);
                scene2.add(force_cell);






                L=3

                Cal_ForcesPnt();

                Force_move();

                P_A_Right=Pnt_copy(P_A);
                P_B_Right=Pnt_copy(P_B);
                P_C_Right=Pnt_copy(P_C);
                P_D_Right=Pnt_copy(P_D);



               var vertices = [
                        P_A_Right,P_B_Right,P_C_Right,P_D_Right
                    ];

                corePoint_body=new THREE.Vector3();

                corePoint_body.x=(P_A_Right.x+P_B_Right.x+P_C_Right.x+P_D_Right.x)/4;
                corePoint_body.y=(P_A_Right.y+P_B_Right.y+P_C_Right.y+P_D_Right.y)/4;
                corePoint_body.z=(P_A_Right.z+P_B_Right.z+P_C_Right.z+P_D_Right.z)/4;

    


            mesh.children.forEach(function (e) {
                e.geometry.vertices = vertices;
                e.geometry.verticesNeedUpdate = true;

                // e.geometry.faces[0].color.set(0xff00ee);
                // e.geometry.facesNeedUpdate=true;
                e.geometry.elementsNeedUpdate = true;
                e.geometry.computeFaceNormals();
                //e.geometry.center();
            });







                mesh_TriFace1=create_Tri_FaceMesh(P_A_Right,P_B_Right,P_C_Right,Force_face_dir[0],true,TubePoints1[1].z,'n1');



                 if(Change_N3N4&&Change_BC)
                {

                    mesh_TriFace2=create_Tri_FaceMesh(P_A_Right,P_D_Right,P_B_Right,Force_face_dir[2],false,arr_direction[1],'n3');
                    mesh_TriFace3=create_Tri_FaceMesh(P_B_Right,P_D_Right,P_C_Right,Force_face_dir[3],false,arr_direction[2],'n4');
                    mesh_TriFace4=create_Tri_FaceMesh(P_A_Right,P_C_Right,P_D_Right,Force_face_dir[1],false,arr_direction[0],'n2');


                }
                else if(!Change_N3N4&&Change_BC)
                {
                    mesh_TriFace2=create_Tri_FaceMesh(P_A_Right,P_D_Right,P_B_Right,Force_face_dir[2],false,arr_direction[2],'n4');
                    mesh_TriFace3=create_Tri_FaceMesh(P_B_Right,P_D_Right,P_C_Right,Force_face_dir[3],false,arr_direction[1],'n3');
                    mesh_TriFace4=create_Tri_FaceMesh(P_A_Right,P_C_Right,P_D_Right,Force_face_dir[1],false,arr_direction[0],'n2');



                }else if(Change_N3N4&&!Change_BC)
                {
                    mesh_TriFace2=create_Tri_FaceMesh(P_A_Right,P_D_Right,P_B_Right,Force_face_dir[2],false,arr_direction[0],'n2');
                    mesh_TriFace3=create_Tri_FaceMesh(P_B_Right,P_D_Right,P_C_Right,Force_face_dir[3],false,arr_direction[2],'n4');
                    mesh_TriFace4=create_Tri_FaceMesh(P_A_Right,P_C_Right,P_D_Right,Force_face_dir[1],false,arr_direction[1],'n3');

                }
                else if(!Change_N3N4&&!Change_BC)
                {
                    mesh_TriFace2=create_Tri_FaceMesh(P_A_Right,P_D_Right,P_B_Right,Force_face_dir[2],false,arr_direction[0],'n2');
                    mesh_TriFace3=create_Tri_FaceMesh(P_B_Right,P_D_Right,P_C_Right,Force_face_dir[3],false,arr_direction[1],'n3');
                    mesh_TriFace4=create_Tri_FaceMesh(P_A_Right,P_C_Right,P_D_Right,Force_face_dir[1],false,arr_direction[2],'n4');

                }

                // scene2.add(mesh_TriFace1);
                // scene2.add(mesh_TriFace2);
                // scene2.add(mesh_TriFace3);
                // scene2.add(mesh_TriFace4);

              if(!controls_scale.Arrow_face)
              {
                mesh_TriFace1.children[0].material.visible=false;
                mesh_TriFace2.children[0].material.visible=false;
                mesh_TriFace3.children[0].material.visible=false;
                mesh_TriFace4.children[0].material.visible=false;

                for(i=1;i<=3;i++){
                    mesh_TriFace1.children[i].visible=false;
                    mesh_TriFace2.children[i].visible=false;
                    mesh_TriFace3.children[i].visible=false;
                    mesh_TriFace4.children[i].visible=false;
                }
            }


        
                var TXMeshA=createSpriteText1("A",P_A_Right);
                var TXMeshB=createSpriteText1("B",P_B_Right);
                var TXMeshC=createSpriteText1("C",P_C_Right);
                var TXMeshD=createSpriteText1("D",P_D_Right);

                text_group2.add(TXMeshA);
                text_group2.add(TXMeshB);
                text_group2.add(TXMeshC);
                text_group2.add(TXMeshD);

                var TXMeshA_2=createSpriteText1("A",P_A);
                var TXMeshB_2=createSpriteText1("B",P_B);
                var TXMeshC_2=createSpriteText1("C",P_C);


            //    scene2.add(TXMeshA_2);
            //    scene2.add(TXMeshB_2);
            //    scene2.add(TXMeshC_2);


              for(i=0;i<=8;i++){
                text_group2.children[4].material.visible=false;
                text_group2.children[5].material.visible=false;
                text_group2.children[6].material.visible=false;
                text_group2.children[7].material.visible=false;
}



                // createTextMesh1('A',P_A_Right);
                // createTextMesh1('B',P_B_Right);
                // createTextMesh1('C',P_C_Right);
                // createTextMesh1('D',P_D_Right);





                scene.add(text_group1);
                scene.add(text_closingplane_group);
                scene.add(text_closingplane_trial_group);
                scene2.add(text_force_trial_group);



              //  scene2.add(text_group2);








               // console.log("P_A=",P_A,"P_B=",P_B,"P_C=",P_C,"P_D=",P_D);








            }


            function redraw_pair_base()
            {
            	 // scene.remove(textf1);
               // scene.remove(textf2);

               scene2.remove(Tube_group_pair);

               Tube_group_pair=new THREE.Group();



              
                var arr_direction=arrow_direction(TubePoints1[1],TubePoints2[1],TubePoints3[1],TubePoints4[1]);

                 var arrow_material_p=new THREE.MeshPhongMaterial( {
                color: 0x000080
            } );

               // console.log("n1=",TubePoints1[1],"n2=",TubePoints2[1],"n3=",TubePoints3[1],"n4=",TubePoints4[1]);

                var arrow_material2=new THREE.MeshPhongMaterial({
                color: 0xC00000
            } );





                var material = new THREE.MeshPhongMaterial({color: 0x5a5a5a, transparent: true, opacity:0.2});

                var spGeom0 = new THREE.SphereGeometry(0.04);
               	var sp_Tube0 = new THREE.Mesh(spGeom0, material);

               // sp_Tube0.name="sp0";
                sp_Tube0.position.copy(new THREE.Vector3(0,0,0));
                sp_Tube0.castShadow=true;

                //Ctrl_tubes.push(sp_Tube0);


                //scene.add(text0);
                //text0.position.copy(new THREE.vertices(0.2,0,0));
                //text_group1.add(text0);


                Tube_group_pair.add(sp_Tube0);
            // add the points as a group to the scene
                //scene.add(spMesh);



                //mesh sphere1scene.remove(tubeMesh1);

               // var material = new THREE.MeshBasicMaterial({color: 0xff0000, transparent: false});
               var material2 = new THREE.MeshPhongMaterial({color: 0x5a5a5a, transparent: false});

                var spGeom1 = new THREE.SphereGeometry(0.04);
                 var sp_tube1 = new THREE.Mesh(spGeom1, material2);
                 sp_tube1.position.copy(TubePoints1[1]);

                 sp_tube1.castShadow=true;

                // sp_tube1.name="sp1";//name

            // add the points as a group to the scene
            //     Tube_group_pair.add(sp_tube1);

                // Ctrl_tubes.push(sp_tube1);

                var lattice_pair_material1 = new THREE.MeshPhongMaterial( {
                color: 0xdcdcdc,transparent: true, opacity:0.2
            } );



                var tubeMesh1=createCylinderMesh(TubePoints1[0],TubePoints1[1],lattice_pair_material1,0.02,0.02);
                tubeMesh1.castShadow=true;
                //tubeMesh1.name="tb1";
                //Ctrl_tubes.push(tubeMesh1);

                Tube_group_pair.add(tubeMesh1);

                 var arrow_material1=new THREE.MeshPhongMaterial( {
                color: 0x009600
            } );


                //arrow

                if(TubePoints1[1].z>=0)//p or t

                var tube_arrow1=createCylinderArrowMesh(new THREE.Vector3(1.5*TubePoints1[1].x,1.5*TubePoints1[1].y,1.5*TubePoints1[1].z),TubePoints1[1],arrow_material1,0.02,0.05,0.7);
            else
                var tube_arrow1=createCylinderArrowMesh(TubePoints1[1],new THREE.Vector3(1.5*TubePoints1[1].x,1.5*TubePoints1[1].y,1.5*TubePoints1[1].z),arrow_material1,0.02,0.05,0.7);

        //        Tube_group_pair.add(tube_arrow1);


                //mesh sphere2

                var material3 = new THREE.MeshPhongMaterial({color: 0x5a5a5a, transparent: false});

                var spGeom2 = new THREE.SphereGeometry(0.04);
                 var sp_tube2 = new THREE.Mesh(spGeom2, material3);
                 sp_tube2.position.copy(TubePoints2[1]);
            // add the points as a group to the scene
                // sp_tube2.name="sp2";//name
                // Ctrl_pts.push(sp_tube2);
        //         Tube_group_pair.add(sp_tube2);
                  sp_tube2.castShadow=true;

                  var lattice_pair_material2 = new THREE.MeshPhongMaterial( {
                color: 0xdcdcdc,transparent: true, opacity:0.2
            } );

                var tubeMesh2=createCylinderMesh(TubePoints2[0],TubePoints2[1],lattice_pair_material2,0.02,0.02);
                tubeMesh2.castShadow=true;
                //tubeMesh2.name="tb2";
               // Ctrl_tubes.push(tubeMesh2);

                Tube_group_pair.add(tubeMesh2);

                //arrow

                if(arr_direction[0]>=0)//p or t

                var tube_arrow2=createCylinderArrowMesh(new THREE.Vector3(1.22*TubePoints2[1].x,1.22*TubePoints2[1].y,1.22*TubePoints2[1].z) ,TubePoints2[1],arrow_material_p,0.02,0.05,0.6);

            else
                var tube_arrow2=createCylinderArrowMesh(TubePoints2[1],new THREE.Vector3(1.22*TubePoints2[1].x,1.22*TubePoints2[1].y,1.22*TubePoints2[1].z),arrow_material2,0.02,0.05,0.6);

          //      Tube_group_pair.add(tube_arrow2);

                //mesh sphere3

                var material4 = new THREE.MeshPhongMaterial({color: 0x5a5a5a, transparent: false});

                var spGeom3 = new THREE.SphereGeometry(0.04);
                 var sp_tube3 = new THREE.Mesh(spGeom3, material4);
                 sp_tube3.position.copy(TubePoints3[1]);
                 //sp_tube3.name="sp3";//name
            // add the points as a group to the scene
                // Ctrl_pts.push(sp_tube3);
      //           Tube_group_pair.add(sp_tube3);
                 sp_tube3.castShadow=true;

                  var lattice_pair_material3 = new THREE.MeshPhongMaterial( {
                color: 0xdcdcdc,transparent: true, opacity:0.2
            } );

                var tubeMesh3=createCylinderMesh(TubePoints3[0],TubePoints3[1],lattice_pair_material3,0.02,0.02);

                tubeMesh3.castShadow=true;
               // tubeMesh3.name="tb3";
               // Ctrl_tubes.push(tubeMesh3);

                Tube_group_pair.add(tubeMesh3);

                //arrow

                if(arr_direction[1]>=0)

                var tube_arrow3=createCylinderArrowMesh(new THREE.Vector3(1.22*TubePoints3[1].x,1.22*TubePoints3[1].y,1.22*TubePoints3[1].z) ,TubePoints3[1],arrow_material_p,0.02,0.05,0.6);
            else
                var tube_arrow3=createCylinderArrowMesh(TubePoints3[1],new THREE.Vector3(1.22*TubePoints3[1].x,1.22*TubePoints3[1].y,1.22*TubePoints3[1].z),arrow_material2,0.02,0.05,0.6);

      //          Tube_group_pair.add(tube_arrow3);

                //mesh sphere4
                var material5 = new THREE.MeshPhongMaterial({color: 0x5a5a5a, transparent: false});

                var spGeom4 = new THREE.SphereGeometry(0.04);
                 var sp_tube4= new THREE.Mesh(spGeom4, material5);
                 sp_tube4.position.copy(TubePoints4[1]);
                 sp_tube4.castShadow=true;

                // sp_tube4.name="sp4";//name
                // Ctrl_pts.push(sp_tube4);
            // add the points as a group to the scene
      //           Tube_group_pair.add(sp_tube4);

                 var lattice_pair_material4 = new THREE.MeshPhongMaterial( {
                color: 0xdcdcdc,transparent: true, opacity:0.2
            } );

                var tubeMesh4=createCylinderMesh(TubePoints4[0],TubePoints4[1],lattice_pair_material4,0.02,0.02);

                tubeMesh4.castShadow=true;
                //tubeMesh4.name="tb4";
                //Ctrl_tubes.push(tubeMesh4);

                Tube_group_pair.add(tubeMesh4);

                //arrow

                if(arr_direction[2]>=0)
                    var tube_arrow4=createCylinderArrowMesh(new THREE.Vector3(1.22*TubePoints4[1].x,1.22*TubePoints4[1].y,1.22*TubePoints4[1].z) ,TubePoints4[1],arrow_material_p,0.02,0.05,0.6);
                else
                    var tube_arrow4=createCylinderArrowMesh(TubePoints4[1],new THREE.Vector3(1.22*TubePoints4[1].x,1.22*TubePoints4[1].y,1.22*TubePoints4[1].z),arrow_material2,0.02,0.05,0.6);

        //        Tube_group_pair.add(tube_arrow4);

                scene2.add(Tube_group_pair);
            }




            var mesh_F1;
            var mesh_F2;
            var mesh_F3;
            var mesh_F4;

            var mesh_F1_pair;
            var mesh_F2_pair;
            var mesh_F3_pair;
            var mesh_F4_pair;



            function redraw_Force(){




                scene.remove(mesh_F1);
                scene.remove(mesh_F2);
                scene.remove(mesh_F3);
                scene.remove(mesh_F4);


                 if(controls_scale.scale<controls_scale.MaxScale)
                     L=controls_scale.scale;
                     else
                       L=controls_scale.MaxScale;  

                Cal_ForcesPnt();

                Force_move_left();

                P_A_Left=Pnt_copy(P_A);
                P_B_Left=Pnt_copy(P_B);
                P_C_Left=Pnt_copy(P_C);
                P_D_Left=Pnt_copy(P_D);



               var vertices = [
                        P_A_Left,P_B_Left,P_C_Left,P_D_Left
                    ];

        //console.log("TubePoints1="+P_A.z);

        // for (i = 0;i<geom.faces.length;i++){
        //         var hex = Math.random() * 0xffffff;
        //         geom.faces[i].color.setHex(hex);
        //     }

                mesh_left.children.forEach(function (e) {
                e.geometry.vertices = vertices;
                e.geometry.verticesNeedUpdate = true;

                // e.geometry.faces[0].color.set(0xff00ee);
                // e.geometry.facesNeedUpdate=true;
                e.geometry.elementsNeedUpdate = true;
                e.geometry.computeFaceNormals();
                //e.geometry.center();
            });











                L=controls_scale.MaxScale;  

                Cal_ForcesPnt();

                Force_move_left();

                var P_A_Scale=Pnt_copy(P_A);
                var P_B_Scale=Pnt_copy(P_B);
                var P_C_Scale=Pnt_copy(P_C);
                var P_D_Scale=Pnt_copy(P_D);

                var coreN1=face_center(P_A_Scale,P_B_Scale,P_C_Scale);
                var coreN2=face_center(P_A_Scale,P_B_Scale,P_D_Scale);
                var coreN3=face_center(P_B_Scale,P_C_Scale,P_D_Scale);
                var coreN4=face_center(P_A_Scale,P_C_Scale,P_D_Scale);

                mesh_F1=create_TriangleMesh(P_A_Left,P_B_Left,P_C_Left,TubePoints1[1],coreN1);
                mesh_F4=create_TriangleMesh(P_A_Left,P_C_Left,P_D_Left,TubePoints2[1],coreN4);




                if(Change_N3N4)
                {
                    mesh_F2=create_TriangleMesh(P_A_Left,P_B_Left,P_D_Left,TubePoints3[1],coreN2);

                    mesh_F3=create_TriangleMesh(P_B_Left,P_C_Left,P_D_Left,TubePoints4[1],coreN3);

                }
                else
                {
                    mesh_F2=create_TriangleMesh(P_A_Left,P_B_Left,P_D_Left,TubePoints4[1],coreN2);

                    mesh_F3=create_TriangleMesh(P_B_Left,P_C_Left,P_D_Left,TubePoints3[1],coreN3);

                }


                scene.add(mesh_F1);
                scene.add(mesh_F2);
                scene.add(mesh_F3);
                scene.add(mesh_F4);






                if(controls_scale.Pair_Control)
                {





                scene2.remove(mesh_F1_pair);
                scene2.remove(mesh_F2_pair);
                scene2.remove(mesh_F3_pair);
                scene2.remove(mesh_F4_pair);

                if(controls_scale.scale<controls_scale.MaxScale)
                 L=controls_scale.MaxScale-controls_scale.scale;
             	else
             		L=0;



                Cal_ForcesPnt();

                Force_move_left();

                P_A_Left_Pair=Pnt_copy(P_A);
                P_B_Left_Pair=Pnt_copy(P_B);
                P_C_Left_Pair=Pnt_copy(P_C);
                P_D_Left_Pair=Pnt_copy(P_D);



               var vertices_pair = [
                        P_A_Left_Pair,P_B_Left_Pair,P_C_Left_Pair,P_D_Left_Pair
                    ];



                mesh_left_pair.children.forEach(function (e) {
                e.geometry.vertices = vertices_pair;
                e.geometry.verticesNeedUpdate = true;

                // e.geometry.faces[0].color.set(0xff00ee);
                // e.geometry.facesNeedUpdate=true;
                e.geometry.elementsNeedUpdate = true;
                e.geometry.computeFaceNormals();
                //e.geometry.center();
            });









                L=controls_scale.MaxScale;   

                Cal_ForcesPnt();

                Force_move_left();

                var P_A_Scale_pair=Pnt_copy(P_A);
                var P_B_Scale_pair=Pnt_copy(P_B);
                var P_C_Scale_pair=Pnt_copy(P_C);
                var P_D_Scale_pair=Pnt_copy(P_D);

                var coreN1_pair=face_center(P_A_Scale_pair,P_B_Scale_pair,P_C_Scale_pair);
                var coreN2_pair=face_center(P_A_Scale_pair,P_B_Scale_pair,P_D_Scale_pair);
                var coreN3_pair=face_center(P_B_Scale_pair,P_C_Scale_pair,P_D_Scale_pair);
                var coreN4_pair=face_center(P_A_Scale_pair,P_C_Scale_pair,P_D_Scale_pair);

                mesh_F1_pair=create_TriangleMesh(P_A_Left_Pair,P_B_Left_Pair,P_C_Left_Pair,TubePoints1[1],coreN1_pair);
                mesh_F4_pair=create_TriangleMesh(P_A_Left_Pair,P_C_Left_Pair,P_D_Left_Pair,TubePoints2[1],coreN4_pair);




                if(Change_N3N4)
                {
                    mesh_F2_pair=create_TriangleMesh(P_A_Left_Pair,P_B_Left_Pair,P_D_Left_Pair,TubePoints3[1],coreN2_pair);

                    mesh_F3_pair=create_TriangleMesh(P_B_Left_Pair,P_C_Left_Pair,P_D_Left_Pair,TubePoints4[1],coreN3_pair);

                }
                else
                {
                    mesh_F2_pair=create_TriangleMesh(P_A_Left_Pair,P_B_Left_Pair,P_D_Left_Pair,TubePoints4[1],coreN2_pair);

                    mesh_F3_pair=create_TriangleMesh(P_B_Left_Pair,P_C_Left_Pair,P_D_Left_Pair,TubePoints3[1],coreN3_pair);

                }



                scene2.add(mesh_F1_pair);
                scene2.add(mesh_F2_pair);
                scene2.add(mesh_F3_pair);
                scene2.add(mesh_F4_pair);

            }






            }





        var Force_face_dir=[];
        var Change_BC=false;

        function Cal_ForcesPnt(){
       
        var origin_N1=Pnt_copy(TubePoints1[1]);
        var origin_N2=Pnt_copy(TubePoints2[1]);
        var origin_N3=Pnt_copy(TubePoints3[1]);
        var origin_N4=Pnt_copy(TubePoints4[1]);

        origin_N1.multiplyScalar(-1);
        origin_N2.multiplyScalar(-1);
        origin_N3.multiplyScalar(-1);
        origin_N4.multiplyScalar(-1);

        var aa=new Array();
        aa=Cal_Arrange_AA(origin_N1,origin_N2,origin_N3,origin_N4);

        console.log("aa0",aa[0],"aa1",aa[1],"aa2",aa[2]);

        origin_N1.normalize();

        var L_AB=new THREE.Vector3(0,0,0);
        L_AB=cross(origin_N1,aa[0]);

        P_A=new THREE.Vector3(0,0,0);
        //m=Math.sqrt()
        var m=Math.sqrt(L*L/Math.pow(norm(L_AB),2));

        P_B=new THREE.Vector3((P_A.x+m*L_AB.x),(P_A.y+m*L_AB.y),(P_A.z+m*L_AB.z));

        var L_BC=new THREE.Vector3(0,0,0);
        var L_CA=new THREE.Vector3(0,0,0);

        L_BC=cross(origin_N1,aa[1]);
        L_CA=cross(origin_N1,aa[2]);

        P_C=new THREE.Vector3(0,0,0);
        P_C=LinesSectPt(L_BC,P_B,L_CA,P_A);



        var L_BD=new THREE.Vector3(0,0,0);
        var L_DC=new THREE.Vector3(0,0,0);

        L_BD=cross(aa[1],aa[0]);
        L_DC=cross(aa[1],aa[2]);

        P_D=new THREE.Vector3(0,0,0);

        P_D=LinesSectPt(L_BD,P_B,L_DC,P_C);

        console.log("P_ABCD",P_A,P_B,P_C,P_D);



        //




        //console.log("P_D_",P_D);


      

        Change_BC=false;

        var F1=cross(P_B,P_C);

        if(F1.z>0)
        {
            var temp=Pnt_copy(P_B);
            P_B=Pnt_copy(P_C);
            P_C=Pnt_copy(temp);
            Change_BC=true;
        }


         var P_BA = new THREE.Vector3().subVectors(P_B, P_A);
         var P_CB=new THREE.Vector3().subVectors(P_C, P_B);

         var P_CA=new THREE.Vector3().subVectors(P_C, P_A);
         var P_DC=new THREE.Vector3().subVectors(P_D, P_C);

         var P_DA=new THREE.Vector3().subVectors(P_D, P_A);
         var P_BD=new THREE.Vector3().subVectors(P_B, P_D);

         var P_DB=new THREE.Vector3().subVectors(P_D, P_B);
         var P_CD=new THREE.Vector3().subVectors(P_C, P_D);

         F1=cross(P_BA,P_CB);
         var F2=cross(P_CA,P_DC);
         var F3=cross(P_DA,P_BD);
         var F4=cross(P_DB,P_CD);

         Force_face_dir=[];

         Force_face_dir.push(F1);
         Force_face_dir.push(F2);
         Force_face_dir.push(F3);
         Force_face_dir.push(F4);






    }


    function Force_move(){   
        
        var P_A_temp=new THREE.Vector3(0,0,0);

        P_A_temp=Pnt_copy(P_A);

        P_A=subVec(P_A,P_A_temp);
        P_B=subVec(P_B,P_A_temp);
        P_C=subVec(P_C,P_A_temp);
        P_D=subVec(P_D,P_A_temp);



        var corePoint=new THREE.Vector3();
        corePoint.x=(P_A.x+P_B.x+P_C.x+P_D.x)/4;
        corePoint.y=(P_A.y+P_B.y+P_C.y+P_D.y)/4;
        corePoint.z=(P_A.z+P_B.z+P_C.z+P_D.z)/4;


        if(corePoint_temp.x===0&&corePoint_temp.y===0&&corePoint_temp.z===0)
        {
            corePoint_temp=Pnt_copy(corePoint);
        };


        P_A=subVec(P_A,corePoint_temp);
        P_B=subVec(P_B,corePoint_temp);
        P_C=subVec(P_C,corePoint_temp);
        P_D=subVec(P_D,corePoint_temp);

    }



    function Force_move_left()
    {

      var P_A_temp=new THREE.Vector3(0,0,0);

      P_A_temp=Pnt_copy(P_A);

      P_A=subVec(P_A,P_A_temp);
      P_B=subVec(P_B,P_A_temp);
      P_C=subVec(P_C,P_A_temp);
      P_D=subVec(P_D,P_A_temp);



        var corePoint=new THREE.Vector3();
        corePoint.x=(P_A.x+P_B.x+P_C.x+P_D.x)/4;
        corePoint.y=(P_A.y+P_B.y+P_C.y+P_D.y)/4;
        corePoint.z=(P_A.z+P_B.z+P_C.z+P_D.z)/4;



        P_A=subVec(P_A,corePoint);
        P_B=subVec(P_B,corePoint);
        P_C=subVec(P_C,corePoint);
        P_D=subVec(P_D,corePoint);

    }













    function subVec(n1,n2){
        var sub=new THREE.Vector3(0,0,0);
        sub.x=n1.x-n2.x;
        sub.y=n1.y-n2.y;
        sub.z=n1.z-n2.z;
        return sub;
    }



        function cross(n1,n2){
            var ncross=new THREE.Vector3(0,0,0);
            ncross.x=((n1.y*n2.z)-(n1.z*n2.y));
            ncross.y=((n1.z*n2.x)-(n1.x*n2.z));
            ncross.z=((n1.x*n2.y)-(n1.y*n2.x));
            return ncross;

        }

        function norm(n1){
            var nnorm=Math.sqrt(n1.x*n1.x+n1.y*n1.y+n1.z*n1.z);
            return nnorm;
        }

        function distance(n1,n2){
            var distance1=Math.sqrt((n1.x-n2.x)*(n1.x-n2.x)+(n1.y-n2.y)*(n1.y-n2.y)+(n1.z-n2.z)*(n1.z-n2.z));
            return distance1;
        }

        function face_center(n1,n2,n3){

            var face_centerD=new THREE.Vector3();

                face_centerD.x=(n1.x+n2.x+n3.x)/3;
                face_centerD.y=(n1.y+n2.y+n3.y)/3;
                face_centerD.z=(n1.z+n2.z+n3.z)/3;

                return face_centerD;



        }






        function Pnt_copy(n1){

            var n2=new THREE.Vector3(0,0,0);
            n2.x=n1.x;
            n2.y=n1.y;
            n2.z=n1.z;
            return n2;
        }

        function arrow_direction(n1,n2,n3,n4){

            var matr3=new THREE.Matrix3();
            matr3.elements=[n2.x,n2.y,n2.z,n3.x,n3.y,n3.z,n4.x,n4.y,n4.z];

            var matr3_Inver=new THREE.Matrix3();

            matr3_Inver.getInverse(matr3);

            var arr_direct=new Array();

            var Ma3=matr3_Inver.elements;

            var a1=Ma3[0]*(-1)*n1.x+Ma3[3]*(-1)*n1.y+Ma3[6]*(-1)*n1.z;
            //var a1=Ma3[0]*(-1)*n1.x+Ma3[3]*(-1)*n1.y+Ma3[6]*(-1)*n1.z;
            arr_direct.push(a1);

            var a2=Ma3[1]*(-1)*n1.x+Ma3[4]*(-1)*n1.y+Ma3[7]*(-1)*n1.z;
            arr_direct.push(a2);

            var a3=Ma3[2]*(-1)*n1.x+Ma3[5]*(-1)*n1.y+Ma3[8]*(-1)*n1.z;
            arr_direct.push(a3);

            return arr_direct;





        }

        function Cal_Arrange_AA(n1,n2,n3,n4){

            var n11=Pnt_copy(n1);
            var n22=Pnt_copy(n2);
            var n33=Pnt_copy(n3);
            var n44=Pnt_copy(n4);

            n11.normalize();
            n22.normalize();
            n33.normalize();
            n44.normalize();

            Change_N3N4=false;



        var CO=arrow_direction(n11,n22,n33,n44);

        console.log("CO0",CO[0],"CO1",CO[1],"CO2",CO[2]);



        var AngV=Math.atan2(n22.y,n22.x);





        if(CO[0]<0)
        {
            n22.x=-n22.x;
            n22.y=-n22.y;
            n22.z=-n22.z;
        }
        if(CO[1]<0)
        {
            n33.x=-n33.x;
            n33.y=-n33.y;
            n33.z=-n33.z;
        }
        if(CO[2]<0)
        {
            n44.x=-n44.x;
            n44.y=-n44.y;
            n44.z=-n44.z;
        }



        var n22_ang=Rotate_Vec(n22,new THREE.Vector3(0,0,1),-AngV);
        var n33_ang=Rotate_Vec(n33,new THREE.Vector3(0,0,1),-AngV);
        var n44_ang=Rotate_Vec(n44,new THREE.Vector3(0,0,1),-AngV);





        //var AngN33=Math.atan2(n33_ang.y,n33_ang.x);


        var AngN3=Math.atan2(n33_ang.y,n33_ang.x);
        if(AngN3<0)
            AngN3=AngN3+2.0*Math.PI;
        var AngN4=Math.atan2(n44_ang.y,n44_ang.x);
        if(AngN4<0)
            AngN4=AngN4+2.0*Math.PI;


        //console.log("AngV",AngV,"AngN3",AngN3,"AngN4",AngN4);

        var AA=new Array();
        AA.push(n22);

        if(AngN3<AngN4)
        {
            AA.push(n33);
            AA.push(n44);
        }
        else
        {
            AA.push(n44);
            AA.push(n33);
            Change_N3N4=true;
        }

        return AA;
    }







        function Rotate_Vec(p1,R_V,Theta){
          //  function [P2] = Rotate_Vec(P1, R_V, theta)

          var vector = new THREE.Vector3(0,0,0);
          var axis=new THREE.Vector3(0,0,0);

          vector=Pnt_copy(p1);
          axis=Pnt_copy(R_V);

          vector.applyAxisAngle(axis,Theta);
          return vector;
      }





        function LinesSectPt(L1_dir,P1_pnt,L2_dir,P2_pnt){

            var L1_dir1=new THREE.Vector3(0,0,0);
            var L2_dir2=new THREE.Vector3(0,0,0);

            L1_dir1=Pnt_copy(L1_dir);
            L2_dir2=Pnt_copy(L2_dir);



            L1_dir1.x=L1_dir.x/norm(L1_dir);
            L1_dir1.y=L1_dir.y/norm(L1_dir);
            L1_dir1.z=L1_dir.z/norm(L1_dir);

          
            L2_dir2.x=L2_dir.x/norm(L2_dir);
            L2_dir2.y=L2_dir.y/norm(L2_dir);
            L2_dir2.z=L2_dir.z/norm(L2_dir);

        

            var P1P2_Vec=new THREE.Vector3(0,0,0);
            P1P2_Vec.x=P2_pnt.x-P1_pnt.x;
            P1P2_Vec.y=P2_pnt.y-P1_pnt.y;
            P1P2_Vec.z=P2_pnt.z-P1_pnt.z;

          
            var P2P3_Norm=norm(cross(P1P2_Vec,L1_dir1));


            var P3_pnt=new THREE.Vector3(0,0,0);

            P3_pnt.x=P1_pnt.x+((P1P2_Vec.x*L1_dir1.x+P1P2_Vec.y*L1_dir1.y+P1P2_Vec.z*L1_dir1.z))*L1_dir1.x;
            P3_pnt.y=P1_pnt.y+((P1P2_Vec.x*L1_dir1.x+P1P2_Vec.y*L1_dir1.y+P1P2_Vec.z*L1_dir1.z))*L1_dir1.y;
            P3_pnt.z=P1_pnt.z+((P1P2_Vec.x*L1_dir1.x+P1P2_Vec.y*L1_dir1.y+P1P2_Vec.z*L1_dir1.z))*L1_dir1.z;

            var CosTheta=Math.abs(L1_dir1.x*L2_dir2.x+L1_dir1.y*L2_dir2.y+L1_dir1.z*L2_dir2.z);


            var k_pnt=new THREE.Vector3(0,0,0);

            if(CosTheta<0)
            {
                k_pnt=Pnt_copy(P3_pnt);

            }

            if(CosTheta>0)
            {
                var Tantheta=Math.sqrt((1-Math.pow(CosTheta,2)))/CosTheta;
                var KP3_Norm=P2P3_Norm/Tantheta;

                var K1_pnt=new THREE.Vector3((P3_pnt.x+KP3_Norm*L1_dir1.x),(P3_pnt.y+KP3_Norm*L1_dir1.y),(P3_pnt.z+KP3_Norm*L1_dir1.z));
                var K2_pnt=new THREE.Vector3((P3_pnt.x-KP3_Norm*L1_dir1.x),(P3_pnt.y-KP3_Norm*L1_dir1.y),(P3_pnt.z-KP3_Norm*L1_dir1.z));



                var P2K1_vec=new THREE.Vector3((K1_pnt.x-P2_pnt.x),(K1_pnt.y-P2_pnt.y),(K1_pnt.z-P2_pnt.z));
                var P2K2_vec=new THREE.Vector3((K2_pnt.x-P2_pnt.x),(K2_pnt.y-P2_pnt.y),(K2_pnt.z-P2_pnt.z));

                var D1=norm(cross(P2K1_vec,L2_dir2));
                var D2=norm(cross(P2K2_vec,L2_dir2));


                if(D1<D2)
                    k_pnt=Pnt_copy(K1_pnt);
                else
                    k_pnt=Pnt_copy(K2_pnt);

            }

            return k_pnt;


        }


        function Cal_Vec(vec1,vec2,vec3,n){

            cb = new THREE.Vector3(),
            ab = new THREE.Vector3(),
            normal = new THREE.Vector3(),
            cb.subVectors(vec1,vec2);
            ab.subVectors(vec3, vec2);
            ab.cross(cb);
            normal.copy(ab).normalize();


            var newPoint = new THREE.Vector3(vec2.x-n*normal.x, vec2.y-n*normal.y, vec2.z-n*normal.z);
            return newPoint;
        }






           function generatePoints(points) {
            // add n random spheres
                var geometry = new THREE.Geometry();
                geometry.vertices.push(points[0]);
                geometry.vertices.push(points[1]);

                var line = new THREE.Line(geometry, lattice_line_material);


            return line;
        }






    
    var stats;

    function initStats() {
        stats = new Stats();
        //document.body.appendChild(stats.dom);
    }

   
    var gui;




    var step = 0;

    var INTERSECTED;
    var SELECTED;
    function render() {

        stats.update();








            var rayCaster2=new THREE.Raycaster();
            rayCaster2.setFromCamera(mouse, camera);
            var intersects = rayCaster2.intersectObjects(Ctrl_tubes);

            // if(intersects.length>0) {

            //     intersects[0].object.material.color.set(0xff00ff);
            //     //console.log("selectobj.name="+intersects[0].object.name);

            // }
            if (intersects.length > 0) {

                //geom.faces[0].color.set(0xff00ff);
                //mesh.materials[1].color.set(0xff00ff);

                //console.log("selectobj.name="+intersects[0].object.name);
                    if (INTERSECTED != intersects[0].object) {

                        if (INTERSECTED) 
                            {
                                INTERSECTED.material.color.setHex(INTERSECTED.currentHex);



                                if(INTERSECTED.name.charAt(0)==='s')
                                {
                                   // mesh.children[1].material.color.set(0x156289);
                                   mesh.children[1].geometry.faces[0].color.set(0x009600);

                                   for(i=1;i<=3;i++)
                                   {
                                    mesh.children[1].geometry.faces[i].color.set(0x0F3150);
                                    }

                                    mesh.children[1].geometry.facesNeedUpdate=true;
                                    mesh.children[1].geometry.elementsNeedUpdate = true;
                                    mesh.children[1].geometry.computeFaceNormals();


                                    //console.log("selectobj2.name113="+INTERSECTED.name);
                                }
                                else if(INTERSECTED.name.charAt(0)==='t')
                                {
                                    var num2=Number(INTERSECTED.name.charAt(2))-1;
                                    if(num2>0){
                                    mesh.children[1].geometry.faces[Number(INTERSECTED.name.charAt(2))-1].color.set(0x0F3150);

                                }
                                else
                                    mesh.children[1].geometry.faces[0].color.set(0x009600);

                                mesh.children[1].geometry.facesNeedUpdate=true;
                                mesh.children[1].geometry.elementsNeedUpdate = true;
                                mesh.children[1].geometry.computeFaceNormals();


                                }
                                else if(INTERSECTED.name.charAt(0)==='f')
                                {
                                    if(INTERSECTED.name.charAt(1)==='p')
                                    {


                                    }
                                    if(INTERSECTED.name.charAt(1)==='t')
                                    {

                                    }
                                }




                            }


                        INTERSECTED = intersects[0].object;
                        INTERSECTED.currentHex = INTERSECTED.material.color.getHex();
                        INTERSECTED.material.color.set(0xFF6347);


                        if(INTERSECTED.name.charAt(0)==='s')
                        {
                                 for(i=0;i<=3;i++)
                                   {
                                    mesh.children[1].geometry.faces[i].color.set(0xFF6347);
                                   }
                                    mesh.children[1].geometry.facesNeedUpdate=true;
                                    mesh.children[1].geometry.elementsNeedUpdate = true;
                                    mesh.children[1].geometry.computeFaceNormals();

                                   // console.log("selectobj2.name12="+INTERSECTED.name);
                            //mesh.children[1].material.color.set(0xFF6347);
                        }else if(INTERSECTED.name.charAt(0)==='t')
                            {

                            //console.log("INTERSECTED.name=",INTERSECTED.name);

                                mesh.children[1].geometry.faces[Number(INTERSECTED.name.charAt(2))-1].color.set(0xFF6347);


                                //mesh.children[1].geometry.faces[Number(INTERSECTED.name.charAt(2))-1].material.opacity;
                                mesh.children[1].geometry.facesNeedUpdate=true;
                                mesh.children[1].geometry.elementsNeedUpdate = true;
                                mesh.children[1].geometry.computeFaceNormals();


                               // console.log("selectobj2.name11="+INTERSECTED.name);


                            }
                            else if(INTERSECTED.name.charAt(0)==='f')
                                {
                                    if(INTERSECTED.name.charAt(1)==='p')
                                    {


                                    }
                                    if(INTERSECTED.name.charAt(1)==='t')
                                    {

                                    }
                                }





                               //console.log("selectobj2.name="+INTERSECTED.name);
                    }


                }
                else
                {
                    if (INTERSECTED)
                        {
                            INTERSECTED.material.color.set(INTERSECTED.currentHex);


                                if(INTERSECTED.name.charAt(0)==='s')
                                {

                                    mesh.children[1].geometry.faces[0].color.set(0x009600);
                                    for(i=1;i<=3;i++)
                                   {
                                    mesh.children[1].geometry.faces[i].color.set(0x0F3150);
                                   }
                                    mesh.children[1].geometry.facesNeedUpdate=true;
                                    mesh.children[1].geometry.elementsNeedUpdate = true;
                                    mesh.children[1].geometry.computeFaceNormals();

                                    //mesh.children[1].material.color.set(0x156289);
                                }
                                else if(INTERSECTED.name.charAt(0)==='t')
                                {
                                    var num3=Number(INTERSECTED.name.charAt(2))-1;
                                    if(num3>0)
                                    {
                                    mesh.children[1].geometry.faces[Number(INTERSECTED.name.charAt(2))-1].color.set(0x0F3150);

                                    }else
                                       mesh.children[1].geometry.faces[0].color.set(0x009600);

                                    mesh.children[1].geometry.facesNeedUpdate=true;

                                    mesh.children[1].geometry.elementsNeedUpdate = true;
                                    mesh.children[1].geometry.computeFaceNormals();
                                }
                                else if(INTERSECTED.name.charAt(0)==='f')
                                {
                                    if(INTERSECTED.name.charAt(1)==='p')
                                    {


                                    }
                                    if(INTERSECTED.name.charAt(1)==='t')
                                    {

                                    }
                                }

                        }
                    INTERSECTED = null;
                }




        renderer.clear();
        renderer.setViewport(0,0,window.innerWidth/2,window.innerHeight)
        renderer.render(scene, camera);

        renderer.autoClear = false;
        renderer.setViewport(window.innerWidth/2,0,window.innerWidth/2,window.innerHeight)
        renderer.render(scene2, camera);
    }








    function animate() {

        
        stats.update();
        requestAnimationFrame(animate);
        orbit_ctrl.update();
        trfm_ctrl.update();
        render();
        TWEEN.update();
    }



    function draw() {
        initRender();
        initScene();
        initCamera();
        orbit_ctrl = new THREE.OrbitControls(camera, renderer.domElement);
        //initLight();
        initModel();


        initStats();
        //initGui();

        animate();
        //window.onresize = onWindowResize;
    }
</script>
</html>
